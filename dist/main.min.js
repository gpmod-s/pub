(function(){
(()=>{const a=({pos:l,prevPos:m})=>l!==m,b=({minScale:l,maxScale:m,scale:n})=>n<=m&&n>=l,c=({minScale:l,maxScale:m,scale:n})=>({pos:p,prevPos:r,translate:q})=>b({minScale:l,maxScale:m,scale:n})&&a({pos:p,prevPos:r})?q+(p-r*n)*(1-1/n):q,d=({scale:l,minScale:m,maxScale:n,scaleSensitivity:p,deltaScale:r})=>[l,Math.max(m,Math.min(l+r/(p/l),n))],e=({scale:l,translateX:m,translateY:n})=>`matrix(${l}, 0, 0, ${l}, ${m}, ${n})`,g=({state:l,originX:m,originY:n})=>{l.transformation.translateX+=m;l.transformation.translateY+=
n;l.element.style.transform=e({scale:l.transformation.scale,translateX:l.transformation.translateX,translateY:l.transformation.translateY})},f=l=>({panBy:({originX:m,originY:n})=>g({state:l,originX:m,originY:n}),panTo:({originX:m,originY:n,scale:p})=>{l.transformation.scale=p;g({state:l,originX:m-l.transformation.translateX,originY:n-l.transformation.translateY})}}),h=l=>({zoom:({x:m,y:n,deltaScale:p,scaleSensitivity:r})=>{const {left:q,top:y}=l.element.getBoundingClientRect(),{minScale:A,maxScale:z,
defaultScaleSensitivity:t}=l,[w,u]=d({scale:l.transformation.scale,deltaScale:p,minScale:A,maxScale:z,scaleSensitivity:r||t});p=m-q;r=n-y;n=p/w;m=r/w;const x=c({scale:w,minScale:A,maxScale:z});p=x({pos:p,prevPos:l.transformation.originX,translate:l.transformation.translateX});r=x({pos:r,prevPos:l.transformation.originY,translate:l.transformation.translateY});l.element.style.transformOrigin=`${n/l.containerScale}px ${m/l.containerScale}px`;l.element.style.transform=e({scale:u,translateX:p/l.containerScale,
translateY:r/l.containerScale});l.transformation={originX:n,originY:m,translateX:p,translateY:r,scale:u}}}),k=l=>({getScale:()=>+l.transformation.scale,setScale:m=>{l.transformation.scale=+m},getScaleSensitivity:()=>+l.defaultScaleSensitivity,setScaleSensitivity:m=>{l.defaultScaleSensitivity=+m},setMinScale:m=>{l.minScale=+m},setMaxScale:m=>{l.maxScale=+m},getMinScale:()=>+l.minScale,getMaxScale:()=>+l.maxScale,setContainerScale:m=>{l.containerScale=+m},reset:()=>{g({state:l,originX:0-l.transformation.translateX,
originY:0-l.transformation.translateY});l.element.style.transformOrigin="";l.element.style.transform="";l.transformation={originX:0,originY:0,translateX:0,translateY:0,scale:1}},setState:({transformation:m,style:n})=>{l.transformation=Object.assign({},m);l.element.style.transformOrigin=n.transformOrigin;l.element.style.transform=n.transform},getState:()=>({transformation:Object.assign({},l.transformation),style:{transformOrigin:l.element.style.transformOrigin,transform:l.element.style.transform}})});
window.renderer=({minScale:l,maxScale:m,element:n,containerScale:p=1,scaleSensitivity:r=10})=>{l={element:n,minScale:l,maxScale:m,defaultScaleSensitivity:r,containerScale:p,transformation:{originX:0,originY:0,translateX:0,translateY:0,scale:1}};return Object.assign({},h(l),f(l),k(l))}})();(()=>{function a(d,e){c.ws=d;c.mm=new GPModulesManager_(e);c.sm=c.mm.getSettingsManager();c.app=b;c.mm.setModules([{id:0,name:"GPProxy_",required:!0,hidden:!0},{id:6,name:"GPAbout_",required:!0,hidden:!0},{id:9,name:"GPActivation_",required:!0,hidden:!0},{id:10,name:"GPAvatars_",required:!0,hiddenSettings:!0},{id:5,name:"GPAntiCheat_"},{id:1,name:"GPModeration_"},{id:2,name:"GPPlayersManager_"},{id:3,name:"GPArtBroadcaster_"},{id:7,name:"GPTimer_"},{id:8,name:"GPReference_"},{id:4,name:"GPPainter_"},
{id:11,name:"GPGlobalBanlist_",required:!0}],this,c)}const b={author:"liliezzzz",name:"gp-mod",version:"10.0",changelogURL:"https://discord.com/channels/929715202600095775/953145081471324270/1063274718548992101",summaryURL:"https://discord.com/channels/929715202600095775/929715202600095778/1063326674961317948",updateNoticeFlag:"true",updateNoticeText:"",discordURL:"https://discord.gg/hynZCVZyzN",donateURL:"https://boosty.to/gpmod"};if(function(){return navigator.userAgentData?.brands.some(d=>"Chromium"===
d.brand)}()){var c={ws:null,gpproxy:null,timer:null,reference:null,act:null,av:null,ac:null,abt:null};document.addEventListener("_ws",({detail:{ws:d,authData:e}})=>{c.gpproxy?c.gpproxy.setWebSocket(d):a(d,e);window.ws=d});(function(){var d;if(null!=(d=document.getElementById("__next"))){d=d.classList;var e=d.toggle;var g=!!document.querySelector("#__next > .side > div")?.firstElementChild?.getBoundingClientRect().height;e.call(d,"gp-ad-not-found_",!g)}})();console.log("gpmod: loaded")}else console.error(`${b.name}: Browser not supported`)})();class GPAbout_{static HEADER_MIN_SCALE=.625;static UPDATE_NOTICE_STORAGE="gp_update";static NOTICE_TYPE={SCRIPTS:"scripts",UPDATE:"update",RAID:"raid",NORMAL:"normal"};static NOTICE_PRIORITY={[this.NOTICE_TYPE.SCRIPTS]:1,[this.NOTICE_TYPE.UPDATE]:2,[this.NOTICE_TYPE.RAID]:3,[this.NOTICE_TYPE.NORMAL]:4};static NOTICE_STYLES={[this.NOTICE_TYPE.SCRIPTS]:{color:"#fff",bg:"#c14933",bold:!0,width:292},[this.NOTICE_TYPE.UPDATE]:{color:"#6654ad",bg:"#ffd0fd",bold:!0,width:292},[this.NOTICE_TYPE.RAID]:{color:"#fff",
bg:"repeating-linear-gradient(-45deg, #c75e42, #c75e42 10px, #181200 10px, #181200 20px)",bold:!1,width:340},[this.NOTICE_TYPE.NORMAL]:{color:"#6654ad",bg:"#ffd0fd",bold:!1,width:292}};static UPDATE_MESSAGE="\u0412\u044b\u0448\u043b\u043e \u043d\u043e\u0432\u043e\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435!\n\u041d\u0430\u0436\u043c\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439.";static MODULE={title:"About"};static INIT(a){a.abt=
new GPAbout_(a.app)}constructor({name:a,author:b,version:c,changelogURL:d,summaryURL:e,updateNoticeFlag:g,updateNoticeText:f,discordURL:h,donateURL:k}){this.version=c;this.changelogURL=d;this.summaryURL=e||d;this.updateNoticeFlag=JSON.parse(g);this.updateNoticeText=f;this.notificationQueue=[];this.notificationId=0;this.currentNotice=null;this.closeNotice=this.closeNotice.bind(this);window.addEventListener("resize",this.resizeHandler.bind(this));document.addEventListener("_gp_notice",({detail:l})=>
{this.addNotice(l)});document.addEventListener("_outdated-scripts",({detail:{outdatedScripts:l}})=>{l.size&&(this.printOutdatedScripts(l),this.addNotice({type:GPAbout_.NOTICE_TYPE.SCRIPTS,scripts:l}))});this.render(a,b,c,d,h,k);this.resizeHandler();this.shouldUpdateNoticeBeShown()&&this.addNotice({type:GPAbout_.NOTICE_TYPE.UPDATE,text:this.updateNoticeText,url:this.summaryURL});this.requestOutdatedScripts()}render(a,b,c,d,e,g){this.container=document.createElement("div");this.container.className=
"gp-about_";this.container.innerHTML=`${a} <span>v<span class="version_"><a class="changelog-link_" target="_blank" href="${d}" title="\u0421\u043f\u0438\u0441\u043e\u043a \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439">${c}</a></span></span>`;this.versionElem=this.container.querySelector(".version_");e&&(a=document.createTextNode("\u00a0\u00a0|\u00a0\u00a0"),this.container.appendChild(a),a=document.createElement("a"),a.className="discord-link_",a.target="_blank",a.href=e,a.title="Discord-\u0441\u0435\u0440\u0432\u0435\u0440 \u043c\u043e\u0434\u0430",
a.textContent=e.split("//")[1],this.container.appendChild(a));g&&(e=document.createTextNode("\u00a0\u00a0|\u00a0\u00a0"),this.container.appendChild(e),e=document.createElement("a"),e.className="donate-link_",e.target="_blank",e.href=g,e.title="\u0415\u0441\u043b\u0438 \u0412\u044b \u0437\u0430\u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u0438\u0442\u044c <3",e.textContent="donate",this.container.appendChild(e));document.body.appendChild(this.container)}resizeHandler(a){a=
Math.max(GPAbout_.HEADER_MIN_SCALE,this.getContainerScale());this.container.style.fontSize=`${16*a}px`;this.container.style.lineHeight=`${28*a}px`;this.updateUpdateNoticePos()}getContainerScale(){let a=(window.innerWidth-180)/1150;766*a>window.innerHeight&&(a=window.innerHeight/766);return a}shouldUpdateNoticeBeShown(){return this.updateNoticeFlag?window.localStorage.getItem(GPAbout_.UPDATE_NOTICE_STORAGE)!==this.version:!1}updateUpdateNoticePos(){if(this.notice){var {width:a}=this.versionElem.getBoundingClientRect(),
{width:b}=this.notice.getBoundingClientRect();this.notice.style.left=`calc(-${Math.floor((b-a)/2)}px)`}}requestOutdatedScripts(){document.dispatchEvent(new Event("_get-outdated-scripts"))}printOutdatedScripts(a){a.size&&console.warn(`Outdated Scripts:\n${[...a.values()].map(b=>`${b.name} (${b.version} \u2794 ${b.latestVersion}): ${b.url}?${Date.now()}.user.js`).join("\n")}`)}updateScript(a){document.dispatchEvent(new CustomEvent("_update-script",{detail:{name:a}}))}addNotice(a){a=Object.assign({},
a,{id:++this.notificationId});this.notificationQueue.push(a);this.notificationQueue.sort((b,c)=>GPAbout_.NOTICE_PRIORITY[b.type]-GPAbout_.NOTICE_PRIORITY[c.type]);this.currentNotice&&GPAbout_.NOTICE_PRIORITY[this.currentNotice.type]===GPAbout_.NOTICE_PRIORITY[this.notificationQueue[0].type]||this.showNotice(this.notificationQueue[0])}showNotice(a){this.currentNotice=a;this.notice?.remove();const {color:b,bg:c,bold:d,width:e}=GPAbout_.NOTICE_STYLES[a.type];this.container.style.setProperty("--notice-color",
a.textColor??b);this.container.style.setProperty("--notice-background",a.bgColor??c);this.container.style.setProperty("--notice-font",a.bold??d?"Bold":"Regular");this.container.style.setProperty("--notice-width",`${a.width??e}px`);this.notice=document.createElement(a.url?"a":"div");this.notice.className="gp-update-notice_";this.notice.dataset.type=a.type;this.notice.innerHTML=this.buildNoticeMessage(a.text||(a.type===GPAbout_.NOTICE_TYPE.UPDATE?GPAbout_.UPDATE_MESSAGE:""));a.url&&(this.notice.href=
a.url,this.notice.target="_blank",this.notice.title="\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 Discord",this.notice.addEventListener("click",this.closeNotice));a.scripts&&(a=this.buildScripts(a.scripts),this.notice.appendChild(a));a=document.createElement("div");a.className="close-btn_";a.textContent="\u2716";a.title="";a.addEventListener("click",g=>{g.preventDefault();g.stopPropagation();this.closeNotice(g)});this.notice.appendChild(a);this.versionElem.appendChild(this.notice);this.updateUpdateNoticePos()}closeNotice(a){this.currentNotice.type===
GPAbout_.NOTICE_TYPE.UPDATE&&window.localStorage.setItem(GPAbout_.UPDATE_NOTICE_STORAGE,this.version);this.notice.remove();this.notice=null;a=this.notificationQueue.indexOf(this.currentNotice);~a&&this.notificationQueue.splice(a,1);this.currentNotice=null;this.showNextNotice()}showNextNotice(){this.notificationQueue.length&&this.showNotice(this.notificationQueue[0])}buildNoticeMessage(a){return a?a.split("\n").map(b=>`<div class="text">${b}</div>`).join(""):""}buildScripts(a){const b=document.createElement("div");
b.className="scripts_";var c=document.createElement("div");c.className="title_";c.textContent="\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0432";b.appendChild(c);const d=document.createElement("div");d.className="reload-row_";c=document.createElement("a");c.className="reload-btn_";c.href="/";c.textContent="\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443";c.addEventListener("click",
g=>{g.preventDefault();window.onbeforeunload=null;location.reload()});c.addEventListener("auxclick",g=>{g.preventDefault()});d.appendChild(c);const e=new Set;Array.from(a.values()).forEach((g,f)=>{var h=`${g.url}?${Date.now()}.user.js`;const k=document.createElement("div");k.className="oudated-script_";var l=document.createElement("div");l.textContent=g.name;k.appendChild(l);l=document.createElement("div");l.textContent=`${g.version} \u2794 ${g.latestVersion}`;k.appendChild(l);g=document.createElement("div");
k.appendChild(g);const m=document.createElement("a");m.className="script-update-link_";m.href=h;m.target="_blank";m.textContent="\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c";h=n=>{e.add(f);e.size>=a.size&&d.classList.add("shown_");m.closest(".oudated-script_").classList.add("clicked_")};m.addEventListener("click",h);m.addEventListener("auxclick",h);g.appendChild(m);b.appendChild(k)});b.appendChild(d);return b}}window.GPAbout_=GPAbout_;class GPActivation_ extends EventTarget{static AUTH_FILENAME_STORAGE="gp_auth-filename";static ACTIVATION_KEY_PATTERN=/^[a-zA-Z0-9]{32}:\d{15,16}$/;static DEFAULT_SETTINGS={activationKey:"",publicKey:"",filename:""};static SETTINGS_UI={activationKey:{type:"input",args:{hidden:!0},description:"\u041a\u043b\u044e\u0447 \u0430\u043a\u0442\u0438\u0432\u0430\u0446\u0438\u0438"}};static MODULE={title:"Activation",settings:{storage:"gp_activation",defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){a.act=
new GPActivation_(a.sm)}constructor(a){super();this.s=a.setSettings(this,this.updateSettings);this.subsStatus=!1;this.keyMark=null;this.updateSubsStatus=this.updateSubsStatus.bind(this);this.broadcastSubsStatus=this.broadcastSubsStatus.bind(this);this.setActivationKey=this.setActivationKey.bind(this);document.addEventListener("_auth_perms",this.updateSubsStatus);this.initAuthFilenameStorage();this.updateKeyMark();this.broadcastPublicKey();document.dispatchEvent(new CustomEvent("_act_init",{detail:{pasteKey:this.setActivationKey}}))}initAuthFilenameStorage(){localStorage.setItem(GPActivation_.AUTH_FILENAME_STORAGE,
this.s.filename)}broadcastPublicKey(){document.dispatchEvent(new CustomEvent("_auth_key",{detail:{publicKey:this.s.publicKey}}))}updateKeyMark(){this.keyMark=this.km(this.s.publicKey)}getKeyMark(){return this.keyMark}km(a){let b=-559038737,c=1103547991;for(let d=0,e;d<a.length;d++)e=a.charCodeAt(d),b=Math.imul(b^e,2654435761),c=Math.imul(c^e,1597334677);b=Math.imul(b^b>>>16,2246822507)^Math.imul(c^c>>>13,3266489909);c=Math.imul(c^c>>>16,2246822507)^Math.imul(b^b>>>13,3266489909);return 4294967296*
(2097151&c)+(b>>>0)}updateSubsStatus({detail:{ps:a}}){this.subsStatus=!!(256&a);this.broadcastSubsStatus()}broadcastSubsStatus(){document.dispatchEvent(new CustomEvent("_subs_status",{detail:{status:this.subsStatus}}))}setActivationKey(a){return GPActivation_.ACTIVATION_KEY_PATTERN.test(a)?(this.s.activationKey=a,!0):!1}updateSettings({detail:{settings:a}}){if("activationKey"in a){const [b,c]=a.activationKey.split(":");this.s.publicKey=b??"";this.s.filename=c??"";this.initAuthFilenameStorage();this.updateKeyMark();
this.broadcastPublicKey();document.dispatchEvent(new Event("_auth_key_changed"))}}}window.GPActivation_=GPActivation_;class GPAntiCheat_ extends EventTarget{static MIN_STROKES_TRIGGER=100;static MIN_PERCENTAGE_TRIGGER=75;static SEQUENCE_MIN_SIZE=5;static SEQUENCES_COUNT_TRIGGER=10;static MAX_SEQUENCE_TRIGGER=20;static CANVAS_WIDTH=758;static CANVAS_HEIGHT=424;static M_STROKE_OFFSET=67;static DEFAULT_SETTINGS={enabled:!0,activatedForOwnerOnly:!0,sendReports:!0};static SETTINGS_UI={enabled:{type:"checkbox",description:"\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0410\u043d\u0442\u0438-\u0427\u0438\u0442"},
activatedForOwnerOnly:{type:"checkbox",description:"\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0410\u043d\u0442\u0438-\u0427\u0438\u0442, \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0412\u044b \u044f\u0432\u043b\u044f\u0435\u0442\u0435\u0441\u044c \u0432\u043b\u0430\u0434\u0435\u043b\u044c\u0446\u0435\u043c \u043a\u043e\u043c\u043d\u0430\u0442\u044b"},_1:{text:"Reports"},sendReports:{type:"checkbox",description:"\u041e\u0442\u0441\u044b\u043b\u0430\u0442\u044c \u043e\u0442\u0447\u0451\u0442\u044b \u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0430\u0445, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u044b\u043b\u0438 \u043f\u043e\u043c\u0435\u0447\u0435\u043d\u044b \u0430\u043d\u0442\u0438\u0447\u0438\u0442\u043e\u043c \u043a\u0430\u043a \u043f\u043e\u0434\u043e\u0437\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0435 \u0438 \u0430\u0432\u0442\u043e\u0440\u0435"}};static MODULE={title:"Anti-Cheat",
dependencies:["GPUtils_","GPAssets_","GPAlbumObserver_","GPImageReportSender_"],settings:{storage:"gp_anti-cheat",defaultSettings:GPAntiCheat_.DEFAULT_SETTINGS,ui:GPAntiCheat_.SETTINGS_UI}};static INIT(a){a.ac=new GPAntiCheat_(a.gpproxy,a.sm,a.act)}constructor(a,b,c){super();this.gpproxy=a;this.s=b.setSettings(this);this.isSubscribed=!1;this.itemsTriggers=new Map;this.isGameMWActivated=this.isAlbumMWActivated=!1;this.suspiciousItems=new Set;this.reportSender=new GPImageReportSender_(GPImageReportSender_.ANTI_CHEAT,
this.gpproxy,c);this.gameMiddleware=this.gameMiddleware.bind(this);this.albumMiddleware=this.albumMiddleware.bind(this);this.gpproxy.addEventListener("gallery_started",d=>{this.itemsTriggers.clear();this.suspiciousItems.clear()});this.gpproxy.addEventListener("album_rejoin",()=>{this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM,GPProxy_.EVENT.ALBUM_INFO],this.albumMiddleware);this.isAlbumMWActivated=!0});this.gpproxy.addEventListener("game_rejoin",()=>{this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.TURN_STARTED],
this.gameMiddleware);this.isGameMWActivated=!0});this.gpproxy.addEventListener("data",({detail:{event:d}})=>{d===GPProxy_.EVENT.GAME_STARTED?(this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.TURN_STARTED],this.gameMiddleware),this.isGameMWActivated=!0):d===GPProxy_.EVENT.GALLERY_SETTINGS?(this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM,GPProxy_.EVENT.ALBUM_INFO],this.albumMiddleware),this.isAlbumMWActivated=!0,this.gpproxy.removeWSMsgMiddleware(this.gameMiddleware),this.isGameMWActivated=
!1):this.isAlbumMWActivated&&[GPProxy_.EVENT.NEW_GAME,GPProxy_.EVENT.ALBUM_SCORE,GPProxy_.EVENT.GAME_QUIT,GPProxy_.EVENT.GAME_STARTED].includes(d)&&(this.gpproxy.removeWSMsgMiddleware(this.albumMiddleware),this.isAlbumMWActivated=!1)});document.addEventListener("_subs_status",({detail:{status:d}})=>{this.isSubscribed=d;GPAntiCheat_.toggleSettingsVisibility(d)})}gameMiddleware([a,b]){if(!this.s.enabled||this.s.activatedForOwnerOnly&&!this.gpproxy.isOwner())return[a,b];if(a[1]===GPProxy_.EVENT.TURN_STARTED&&
a[2].previous?.user?.id!==this.gpproxy.getUser().id)if(a[2].screen===GPProxy_.SCREEN.DESCRIPTION&&a[2].previous?.data?.length){var c=this.gpproxy.getCurrentTurnId();c=this.getTriggers(`t_${c}`,a[2].previous.data,a[2].previous.user.nick);c.size&&this.isSubscribed&&(a[2].previous.data=this.getPlaceholder(c),b=!0)}else a[2].screen===GPProxy_.SCREEN.PAINTER&&(a[2].background?.length||a[2].lastDraw?.length)&&(a[2].background&&(c=this.gpproxy.getCurrentTurnId(),this.getTriggers(`tbg_${c}`,a[2].background).size&&
this.isSubscribed&&(a[2].background=[],b=!0)),a[2].lastDraw&&a[2].previous&&(c=this.gpproxy.getCurrentTurnId(),c=this.getTriggers(`t_${c}`,a[2].previous.data,a[2].previous.user.nick),c.size&&this.isSubscribed&&(a[2].lastDraw=[],a[2].previous.data=this.getPlaceholder(c),b=!0)));return[a,b]}albumMiddleware([a,b]){if(!this.s.enabled||this.s.activatedForOwnerOnly&&!this.gpproxy.isOwner())return[a,b];if(a[1]===GPProxy_.EVENT.ALBUM_ITEM&&a[2].user?.id!==this.gpproxy.getUser().id&&a[2].type===GPProxy_.ALBUM_ITEM_TYPE.IMAGE&&
a[2].data)if(a[2].bg){var c=a[2].id,d=this.gpproxy.getCurrentAlbumId(),e=this.getTriggers(`${d}`,this.gpproxy.getAlbumBackground(d));e.size&&this.isSubscribed&&(a[2].bg=!1,a[2].data=this.getPlaceholder(e),this.dispatchEvent(new CustomEvent("trigger",{detail:{itemId:c,albumId:d}})),b=!0)}else a[2].data?.length&&(c=a[2].id,d=this.gpproxy.getCurrentAlbumId(),e=this.getTriggers(`${d}_${c}`,a[2].data,a[2].user.nick),e.size&&(this.isSubscribed&&(a[2].data=this.getPlaceholder(e),this.dispatchEvent(new CustomEvent("trigger",
{detail:{itemId:c,albumId:d}})),b=!0),!this.s.sendReports&&this.isSubscribed||this.reportSender.send({itemId:c,albumId:d,triggers:e})));else a[1]===GPProxy_.EVENT.ALBUM_INFO&&(a[2].background?.length&&a[2].bookAuthor.id!==this.gpproxy.getUser().id&&(c=this.gpproxy.getCurrentAlbumId(),this.getTriggers(`${c}`,a[2].background,a[2].bookAuthor.nick).size&&this.isSubscribed&&(a[2].background=[],b=!0)),a[2].timeline?.length&&(a[2].timeline=a[2].timeline.map(g=>{if(!g.type||g.user?.id===this.gpproxy.getUser().id||
g.type!==GPProxy_.ALBUM_ITEM_TYPE.IMAGE)return g;if(g.bg){var f=this.gpproxy.getCurrentAlbumId();f=this.getTriggers(`${f}`,this.gpproxy.getAlbumBackground(f));f.size&&this.isSubscribed&&(g.bg=!1,g.data=this.getPlaceholder(f),b=!0)}else g.data?.length&&(f=this.gpproxy.getCurrentAlbumId(),f=this.getTriggers(`${f}_${g.id}`,g.data,g.user.nick),f.size&&this.isSubscribed&&(g.data=this.getPlaceholder(f),b=!0));return g})));return[a,b]}getPlaceholder(a){return this.isForgery(a)?GPAssets_.ANTICHEAT_FORGERY_PLACEHOLDER:
GPAssets_.ANTICHEAT_SUSPICIOUS_ART_PLACEHOLDER}getTriggers(a,b,c){let d=this.itemsTriggers.get(a);d||(d=this.calcTriggers(b,c),this.itemsTriggers.set(a,d),d.size&&this.isSubscribed&&this.suspiciousItems.add(a));return d}calcTriggers(a,b){const c=new Set;if(!a?.length)return c;const {animate:d}=this.gpproxy.getGameConfig();let e=0;var g=0;let f=null,h=null,k=0,l=0,m=[],n=[],p=0,r=0;for(let q=0;q<a.length;q++){const y=a[q],A=y[0];if(b&&this.isMStroke(y)){const {code:z,author:t}=this.decodeMStroke(y);
z!==this.gpproxy.getGameCode()&&c.add(20);t!==this.formatUsername(b)&&c.add(21)}if(1===A){d&&2===y[2][1]&&4===y.length&&e++;const z=y.length-3,[t,w]=y[3];t===f&&3>z?k++:(k>GPAntiCheat_.SEQUENCE_MIN_SIZE&&(p=Math.max(p,k),m.push(k)),k=0);w===h&&3>z?l++:(l>GPAntiCheat_.SEQUENCE_MIN_SIZE&&(r=Math.max(r,l),n.push(l)),l=0);f=t;h=w}else 8===A&&g++;1!==A&&(f=h=null,k=l=0)}b=e/a.length*100;g=g/a.length*100;a.length>GPAntiCheat_.MIN_STROKES_TRIGGER&&(b>GPAntiCheat_.MIN_PERCENTAGE_TRIGGER||g>GPAntiCheat_.MIN_PERCENTAGE_TRIGGER)&&
c.add(1);(m.length>GPAntiCheat_.SEQUENCES_COUNT_TRIGGER||n.length>GPAntiCheat_.SEQUENCES_COUNT_TRIGGER)&&c.add(2);(p>GPAntiCheat_.MAX_SEQUENCE_TRIGGER||r>GPAntiCheat_.MAX_SEQUENCE_TRIGGER)&&c.add(3);return c}isForgery(a){return a.has(20)||a.has(21)}isMStroke(a){return!(1===a[0]&&a[3][0]>GPAntiCheat_.CANVAS_WIDTH&&a[3][1]>GPAntiCheat_.CANVAS_HEIGHT)||a[3][0]-GPAntiCheat_.CANVAS_WIDTH-GPAntiCheat_.M_STROKE_OFFSET||a.at(-1)[1]-GPAntiCheat_.CANVAS_HEIGHT-GPAntiCheat_.M_STROKE_OFFSET?!1:!0}decodeMStroke(a){const [b,
c,d]=a.slice(3).flat().map((e,g)=>e-GPAntiCheat_.M_STROKE_OFFSET-(g%2?GPAntiCheat_.CANVAS_HEIGHT:GPAntiCheat_.CANVAS_WIDTH)).filter(Boolean).map(e=>String.fromCodePoint(e)).join("").split("@");return{code:b,author:c,timestamp:d}}formatUsername(a){return this.gpproxy.isDiscordAuth()?a:a.toLowerCase()}getSuspiciousItems(){return this.suspiciousItems}isSuspicious(a){return this.suspiciousItems.has(a)}}window.GPAntiCheat_=GPAntiCheat_;class GPArtBroadcaster_ extends EventTarget{static SENT_IMAGE_DENSITY=1;static SENT_IMAGE_ORIGINAL_WIDTH=758;static SENT_IMAGE_ORIGINAL_HEIGHT=424;static SENT_IMAGE_BACKGROUND_COLOR="#ffffff";static SERVICES=["discord","vk"];static DEFAULT_SETTINGS={services:[],discordBorderColor:"#c958fe",discordBotToken:"",discordServerID:"",discordArtsChannelID:"",discordPlayerChannelID:"",discordArchiveChannelID:"",vkAccessToken:"",vkGroupID:"",vkAlbumID:"",vkPhotoDescription:"\u0410\u0432\u0442\u043e\u0440: {author}"};static SETTINGS_UI={services:{type:"list-m",
args:this.SERVICES,description:"\u0421\u0435\u0440\u0432\u0438\u0441\u044b, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0430\u0440\u0442\u044b"},_1:{text:"Discord"},discordBorderColor:{type:"color",description:"\u0426\u0432\u0435\u0442 \u043b\u0435\u0432\u043e\u0439 \u0440\u0430\u043c\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d\u043d\u044b\u043c \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u043c"},
discordBotToken:{type:"input",args:{hidden:!0},description:"\u0422\u043e\u043a\u0435\u043d Discord-\u0431\u043e\u0442\u0430"},discordServerID:{type:"input",description:"ID Discord-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e\u0431 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0438\u0433\u0440\u043e\u043a\u0430\u0445"},
discordArtsChannelID:{type:"input",description:"ID \u043a\u0430\u043d\u0430\u043b\u0430 \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0430\u0440\u0442\u043e\u0432"},discordPlayerChannelID:{type:"input",description:"ID \u043a\u0430\u043d\u0430\u043b\u0430 \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0430\u0440\u0442\u043e\u0432 \u0441 \u0441\u0441\u044b\u043b\u043a\u043e\u0439 \u043d\u0430 \u043f\u043b\u0435\u0435\u0440 \u0438 \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a"},
discordArchiveChannelID:{type:"input",hidden:!0,description:"ID \u043a\u0430\u043d\u0430\u043b\u0430 \u0434\u043b\u044f \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a\u043e\u0432"},_2:{text:"VK (\u0412 \u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435)"},vkAccessToken:{type:"input",args:{hidden:!0},description:"VK \u0442\u043e\u043a\u0435\u043d"},vkGroupID:{type:"input",description:"ID \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430, \u0433\u0434\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0430\u043b\u044c\u0431\u043e\u043c \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0430\u0440\u0442\u043e\u0432"},
vkAlbumID:{type:"input",description:"ID \u0430\u043b\u044c\u0431\u043e\u043c\u0430 \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0430\u0440\u0442\u043e\u0432"},vkPhotoDescription:{type:"input",description:"\u0428\u0430\u0431\u043b\u043e\u043d \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0430\u0440\u0442\u0430 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435 VK. \u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435: {author}, {date}"}};static MODULE={title:"Art Broadcaster",
dependencies:["GPUtils_","GPPacketParser_"],settings:{storage:"gp_art-broadcaster",defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){new GPArtBroadcaster_(a.gpproxy,a.sm)}constructor(a,b){super();this.gpproxy=a;this.s=b.setSettings(this);this.observerConfig={childList:!0,subtree:!0};this.observer=new MutationObserver(this.observerCallback.bind(this));this.monitorTimer;this.state={};this.itemsElems=[];this.buttons={};this.timeline={};this.nextItemID=null;this.gpContent=document.querySelector("#content");
this.sendResultHandler=this.sendResultHandler.bind(this);this.sendSocialMediaSettings=this.sendSocialMediaSettings.bind(this);this.addEventListener("settings_updated",this.sendSocialMediaSettings);this.addEventListener("settings_updated",this.toggleSendButtons);this.gpproxy.addEventListener("data",({detail:{event:c}})=>{c===GPProxy_.EVENT.GALLERY_SETTINGS?this.startMonitor():c===GPProxy_.EVENT.TURNS_ENDED?this.init():[GPProxy_.EVENT.NEW_GAME,GPProxy_.EVENT.ALBUM_SCORE,GPProxy_.EVENT.GAME_QUIT,GPProxy_.EVENT.GAME_STARTED].includes(c)?
this.terminate():c===GPProxy_.EVENT.ALBUM_INFO&&(this.itemsElems=[],this.buttons={},this.nextItemID=null)});this.gpproxy.addEventListener("album_item",({detail:{itemID:c,albumID:d,item:e}})=>{this.timeline[d]||(this.timeline[d]={});this.timeline[d][c]=e;(d=this.itemsElems[c])&&this.renderButton(d,e,c)});this.gpproxy.addEventListener("album_rejoin",()=>{this.startMonitor();this.init()});this.gpproxy.addEventListener("album_item_loading",({detail:{id:c}})=>{this.nextItemID=c});this.sendSocialMediaSettings();
this.toggleSendButtons()}init(){document.addEventListener("_send_image_complete",this.sendResultHandler);document.dispatchEvent(new CustomEvent("_update_urls_avatars_cache",{detail:{users:this.gpproxy.getUsers().map(a=>a.nick),authType:this.gpproxy.authType}}))}terminate(){this.stopMonitor();this.itemsElems=[];this.timeline={};this.buttons={};this.state={};this.nextItemID=null;document.removeEventListener("_send_image_complete",this.sendResultHandler)}renderButton(a,b,c){if(b.type===GPProxy_.ALBUM_ITEM_TYPE.IMAGE){a.style.position=
"relative";var d=document.createElement("div");d.className="gp-art-broadcaster_";d.classList.add("hidden");d.addEventListener("click",f=>{d.classList.remove("hidden");f.ctrlKey?(GPArtBroadcaster_.SERVICES.forEach(h=>{delete d.dataset[h]}),this.sendImage(this.s.services,b,c,d)):(f=this.s.services.filter(h=>{if(d.dataset[h]&&"false"!==d.dataset[h])return!1;delete d.dataset[h];return!0}),f.length&&this.sendImage(f,b,c,d))});this.setInitialButtonState(d,c);var e=document.createElement("div");e.className=
"media_";var g=document.createElement("div");g.className="discord_";e.appendChild(g);g=document.createElement("div");g.className="vk_";e.appendChild(g);d.appendChild(e);a.appendChild(d);this.buttons[c]=d}}startMonitor(){if(!this.inProgress){var a=document.querySelector(".scrapbook");a?(this.observer.observe(a,this.observerConfig),this.inProgress=!0):this.monitorTimer=setTimeout(()=>{this.startMonitor()},200)}}stopMonitor(){clearTimeout(this.monitorTimer);this.inProgress&&(this.observer.disconnect(),
this.inProgress=!1)}observerCallback(a,b){for(const d of a)if("childList"===d.type&&d.addedNodes.length&&(a=d.addedNodes[0],d.target.classList.contains("scrollElements")&&a.classList.contains("item"))){var c=this.gpproxy.getCurrentAlbumId();b=this.nextItemID;null===b&&(b=[...a.parentElement.children].filter(e=>e.classList.contains("item")).indexOf(a),(c=this.timeline[c]?.[b])&&this.renderButton(a,c,b));this.itemsElems[b]=a}}sendImage(a,b,c,d){const {data:e,background:g,meta:f}=b;var h=GPArtBroadcaster_.SENT_IMAGE_DENSITY;
const k=GPArtBroadcaster_.SENT_IMAGE_ORIGINAL_WIDTH*h,l=GPArtBroadcaster_.SENT_IMAGE_ORIGINAL_HEIGHT*h,m=document.createElement("canvas");m.width=k;m.height=l;var n=m.getContext("2d");n.fillStyle=GPArtBroadcaster_.SENT_IMAGE_BACKGROUND_COLOR;n.fillRect(0,0,k,l);g&&this.drawFunction(n,g,h,!1);n=document.createElement("canvas");n.width=k;n.height=l;var p=n.getContext("2d");this.drawFunction(p,e,h,!0);h=document.createElement("canvas");h.width=k;h.height=l;p=h.getContext("2d");p.drawImage(m,0,0,k,l);
p.drawImage(n,0,0,k,l);h.toBlob(async r=>{d.classList.remove("complete_");d.classList.add("uploading_");var q=(new Date(f.date)).toLocaleDateString("ru-RU");q=`${f.author} - ${f.title} (${q})`;r=new File([r],`${q}.png`);const y=await GPUtils_.compressImageData(b);q=new File([y],`${q}.gpimg`);document.dispatchEvent(new CustomEvent("_send_to_media",{detail:{services:a,artFile:r,sourceFile:q,meta:f,authType:this.gpproxy.authType,albumID:this.gpproxy.getCurrentAlbumId(),itemID:c}}))})}sendResultHandler({detail:{service:a,
success:b,albumID:c,itemID:d}}){this.setState(a,b,c,d);if(c===this.gpproxy.getCurrentAlbumId()){const e=this.buttons[d];e.dataset[a]=b;let g=!0,f=!0;this.s.services.forEach(h=>{e.dataset[h]?"true"!==e.dataset[h]&&(g=!1):f=g=!1});f&&(e.classList.remove("uploading_"),g&&e.classList.add("complete_"))}}setState(a,b,c,d){let e,g;((g=(e=this.state)[c]??(e[c]={}))[d]??(g[d]={}))[a]=b}setInitialButtonState(a,b){const c=this.gpproxy.getCurrentAlbumId();b=this.state[c]?.[b];for(const d in b)a.dataset[d]=b[d];
this.s.services.length&&this.s.services.every(d=>"true"===a.dataset[d])?a.classList.add("complete_"):a.classList.remove("hidden")}sendSocialMediaSettings(){document.dispatchEvent(new CustomEvent("_update_sm_settings",{detail:{settings:JSON.parse(JSON.stringify(this.settings))}}))}toggleSendButtons(a){(a=(a?.detail?.settings||this.settings).services)&&this.gpContent.classList.toggle("gp-sm-hidden_",!a.length)}drawFunction(a,b,c=this.density,d=!1,e=!1){a.lineCap=a.lineJoin="round";a.save();if(b){let n=
[];for(var g=0;g<b.length;g++){var f=b[g],h=f[0];f=(f[1],f.slice(2));if(10!=h){var k=void 0;a.save();if(8!=h){for(k=1;k<f.length;k++)f[k]=[f[k][0]*c,f[k][1]*c];if(2<f.length)switch(h){case 1:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;k=[f[1][0],f[1][1]];a.beginPath();a.moveTo(...k);for(var l=2;l<f.length;l++)k=[f[l][0],f[l][1]],h=[f[l-1][0],f[l-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(k[0]-h[0])/2,h[1]+(k[1]-h[1])/2);a.lineTo(k[0],k[1]);a.stroke();break;case 2:a.strokeStyle=
"#FFFFFF";a.lineWidth=f[0]*c;k=[f[1][0],f[1][1]];d&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo(...k);for(l=2;l<f.length;l++)k=[f[l][0],f[l][1]],h=[f[l-1][0],f[l-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(k[0]-h[0])/2,h[1]+(k[1]-h[1])/2);a.lineTo(k[0],k[1]);a.stroke();d&&(a.globalCompositeOperation="source-over");break;case 3:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.moveTo(f[1][0],f[1][1]);a.lineTo(f[2][0],f[2][1]);a.stroke();
break;case 4:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.rect(f[1][0],f[1][1],f[2][0]-f[1][0],f[2][1]-f[1][1]);a.stroke();break;case 6:h=f[0];a.fillStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.rect(f[1][0],f[1][1],f[2][0]-f[1][0],f[2][1]-f[1][1]);a.fill();break;case 5:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;h=(f[2][0]-f[1][0])/2;k=(f[2][1]-f[1][1])/2;l=Math.round(f[1][0]+h);f=Math.round(f[1][1]+
k);var m=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(l,f-k);a.bezierCurveTo(l+m*h,f-k,l+h,f-m*k,l+h,f);a.bezierCurveTo(l+h,f+m*k,l+m*h,f+k,l,f+k);a.bezierCurveTo(l-m*h,f+k,l-h,f+m*k,l-h,f);a.bezierCurveTo(l-h,f-m*k,l-m*h,f-k,l,f-k);a.stroke();break;case 7:h=f[0],a.fillStyle=h[0],a.lineWidth=h[1],a.globalAlpha=h[2],a.lineWidth*=c,h=(f[2][0]-f[1][0])/2,k=(f[2][1]-f[1][1])/2,l=Math.round(f[1][0]+h),f=Math.round(f[1][1]+k),m=(Math.sqrt(2)-1)/3*4,a.beginPath(),a.moveTo(l,f-k),a.bezierCurveTo(l+m*h,f-k,
l+h,f-m*k,l+h,f),a.bezierCurveTo(l+h,f+m*k,l+m*h,f+k,l,f+k),a.bezierCurveTo(l-m*h,f+k,l-h,f+m*k,l-h,f),a.bezierCurveTo(l-h,f-m*k,l-m*h,f-k,l,f-k),a.fill()}else if(![6,7].includes(h)){switch(h){case 2:a.fillStyle="#FFFFFF";a.lineWidth=f[0]*c;k=f[1];d&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*c;a.globalAlpha=1;k=f[1];break;default:k=f[0],a.fillStyle=k[0],a.lineWidth=k[1],a.globalAlpha=k[2],a.lineWidth*=c,k=f[1]}a.beginPath();a.arc(k[0],k[1],a.lineWidth/
2,0,2*Math.PI);a.fill();2==h&&d&&(a.globalCompositeOperation="source-over")}}else{h=f[0];a.fillStyle=h[0];a.globalAlpha=h[1];a.beginPath();for(h=1;h<f.length;h+=4)a.rect(f[h]*c,f[h+1]*c,f[h+2]*c,f[h+3]*c);a.fill()}a.restore()}else e&&n.push(f)}for(b=0;b<n.length;b++){d=n[b];for(e=1;e<d.length;e++)d[e]=[d[e][0]*c,d[e][1]*c];a.strokeStyle="#CC0053";a.lineWidth=2*c;a.globalAlpha=1;e=[d[1][0],d[1][1]];a.beginPath();a.moveTo(...e);for(g=2;g<d.length;g++)e=[d[g][0],d[g][1]],h=[d[g-1][0],d[g-1][1]],a.quadraticCurveTo(h[0],
h[1],h[0]+(e[0]-h[0])/2,h[1]+(e[1]-h[1])/2);a.lineTo(e[0],e[1]);a.stroke()}}a.restore()}}window.GPArtBroadcaster_=GPArtBroadcaster_;class GPAssets_{}
GPAssets_.CENSORED_IMAGE_PLACEHOLDER=[[3,5,["#a30000",14,1],[121,221],[586,50]],[3,6,["#a30000",14,1],[585,50],[641,190]],[3,7,["#a30000",14,1],[641,191],[175,364]],[3,9,["#a30000",14,1],[174,364],[121,223]],[3,10,["#a30000",14,1],[287,269],[270,221]],[3,11,["#a30000",14,1],[271,221],[321,254]],[3,12,["#a30000",14,1],[305,208],[322,255]],[3,13,["#a30000",14,1],[439,160],[457,209]],[3,14,["#a30000",14,1],[490,139],[507,187]],[3,15,["#a30000",14,1],[222,239],[239,284]],[3,16,["#a30000",10,1],[225,235],
[248,228]],[3,17,["#a30000",10,1],[234,259],[256,251]],[3,18,["#a30000",10,1],[243,284],[265,276]],[3,20,["#a30000",10,1],[491,139],[516,130]],[3,21,["#a30000",10,1],[501,164],[523,154]],[3,22,["#a30000",10,1],[511,186],[532,179]],[3,23,["#a30000",14,1],[537,125],[555,170]],[3,29,["#a30000",14,1],[202,242],[182,250]],[3,30,["#a30000",14,1],[182,250],[176,271]],[3,31,["#a30000",14,1],[175,272],[187,294]],[3,32,["#a30000",14,1],[187,294],[203,296]],[3,33,["#a30000",14,1],[203,296],[218,291]],[3,34,
["#a30000",14,1],[353,188],[334,197]],[3,35,["#a30000",14,1],[334,197],[333,213]],[3,36,["#a30000",14,1],[333,213],[363,221]],[3,37,["#a30000",14,1],[364,222],[369,233]],[3,38,["#a30000",14,1],[366,237],[353,245]],[3,40,["#a30000",14,1],[353,245],[343,245]],[3,41,["#a30000",14,1],[392,174],[413,173]],[3,42,["#a30000",14,1],[413,173],[426,192]],[3,43,["#a30000",14,1],[425,193],[426,216]],[3,44,["#a30000",14,1],[426,216],[409,225]],[3,45,["#a30000",14,1],[409,225],[392,221]],[3,46,["#a30000",14,1],
[392,221],[382,200]],[3,47,["#a30000",14,1],[380,199],[388,178]],[3,48,["#a30000",14,1],[443,156],[460,151]],[3,49,["#a30000",14,1],[460,151],[473,157]],[3,50,["#a30000",14,1],[473,157],[468,173]],[3,51,["#a30000",14,1],[468,173],[453,179]],[3,52,["#a30000",14,1],[466,177],[486,194]],[3,53,["#a30000",14,1],[542,121],[563,116]],[3,54,["#a30000",14,1],[562,116],[582,123]],[3,55,["#a30000",14,1],[582,124],[586,141]],[3,56,["#a30000",14,1],[585,146],[579,160]],[3,57,["#a30000",14,1],[579,160],[561,168]]];
GPAssets_.CENSORED_USERNAME_PLACEHOLDER="CENSORED";GPAssets_.CENSORED_ART_PLACEHOLDER="CENSORED";GPAssets_.CENSORED_DESCRIPTION_PLACEHOLDER="CENSORED";
GPAssets_.GIRL_PORTRAIT_PLACEHOLDER=[[1,1,["#FFFFFF",869,1],[379,212]],[1,2,["#000000",2,1],[152,185],[151,188],[149,196],[148,208],[148,224],[150,232],[153,239],[156,245],[159,250],[162,253]],[1,3,["#000000",2,1],[190,264],[190,265],[191,265],[193,265],[196,265],[201,265],[205,264],[208,263]],[1,4,["#000000",2,1],[248,228],[248,227],[248,226],[248,227],[246,229],[244,233],[241,240],[239,245],[236,249],[232,254],[229,257],[226,258],[223,260],[219,262],[215,263],[211,264],[209,264]],[1,5,["#000000",
2,1],[187,244],[188,244],[190,244],[192,244],[196,244],[198,244],[200,246],[201,247],[202,247]],[1,6,["#000000",2,1],[216,207],[217,208]],[1,7,["#000000",2,1],[214,210],[214,209],[215,208],[216,207],[219,205],[223,203],[229,202],[234,202],[238,203],[241,204],[243,205],[245,206],[246,207],[246,208],[246,209]],[1,8,["#000000",2,1],[246,209],[247,211],[248,213],[248,214]],[1,9,["#000000",2,1],[214,210],[215,210],[215,209],[217,209],[219,208],[223,206],[231,205],[235,206],[237,208],[240,210],[240,211]],
[1,10,["#000000",2,1],[241,211],[242,212],[243,213],[244,215],[244,216],[244,218]],[1,11,["#000000",2,1],[243,219],[244,218],[244,217],[245,216],[246,215],[248,214],[249,214]],[1,12,["#000000",2,1],[219,208],[218,208],[219,207],[220,207],[221,206],[225,205],[232,204],[236,204],[240,205],[241,206],[242,206]],[1,13,["#000000",2,1],[229,204],[230,204],[230,203],[232,203],[235,203],[238,204],[241,205],[243,207],[244,210],[245,210],[245,211],[245,210],[244,210],[244,209],[243,209],[242,208],[240,208],
[239,206],[239,205],[238,205],[237,205],[236,205],[237,206],[238,207],[239,208],[240,208],[242,209],[244,211],[245,212],[246,213],[245,213],[244,213],[243,211],[241,210],[240,207],[239,206],[239,205],[239,206],[239,207],[240,209],[243,212],[244,214],[245,214],[245,213],[244,213],[244,210],[244,209],[244,208],[245,208],[245,209],[245,210],[245,211]],[1,14,["#000000",2,1],[149,204],[150,205],[151,207],[152,208],[153,209],[155,211],[157,213]],[1,15,["#000000",2,1],[154,210],[153,210],[153,208],[154,
206],[155,204],[158,201],[163,198],[167,197],[171,197],[173,197]],[1,16,["#000000",2,1],[150,205],[150,204],[150,203],[152,201],[154,199],[157,197],[163,195],[168,195],[172,196],[176,197],[179,198],[180,199],[180,200],[181,201],[182,201]],[1,17,["#000000",2,1],[177,198],[178,198],[179,198],[180,198],[180,199],[181,200],[182,202],[183,203],[184,204]],[1,18,["#000000",2,1],[151,206],[151,205],[152,204],[154,202],[156,200],[160,198],[163,197],[164,197],[166,197],[166,198],[165,198],[164,198],[163,198],
[162,199],[161,199],[160,199],[158,200],[157,201],[156,202],[155,203],[154,204],[153,205],[153,206]],[1,19,["#000000",2,1],[234,206],[234,207],[235,208],[236,211],[236,219],[234,224],[232,228],[229,230],[226,231],[225,230],[225,229]],[1,20,["#000000",2,1],[219,211],[218,215],[218,220],[218,224],[220,227],[224,230],[227,230]],[1,21,["#000000",2,1],[169,197],[168,197],[167,197],[166,198],[164,200],[163,203],[162,206],[162,210],[162,215],[164,218],[165,221],[168,222]],[1,22,["#000000",2,1],[168,223],
[169,223],[170,224],[171,224],[172,224],[174,224],[176,222],[179,217],[181,213],[181,208],[182,204],[182,203]],[1,23,["#000000",2,1],[178,200],[179,200],[180,201],[180,203],[181,205],[181,208]],[1,24,["#000000",2,1],[166,218],[166,217],[167,216],[168,215],[169,214],[171,213],[173,213],[175,213],[176,216],[177,218],[177,219]],[1,25,["#000000",2,1],[172,216],[171,216],[171,215],[171,214],[171,213],[171,212],[172,211],[173,211],[174,211],[174,212],[174,213],[174,214],[173,216],[172,216],[172,215],[172,
213],[172,212]],[1,26,["#000000",2,1],[220,224],[220,223],[220,222],[222,220],[223,219],[226,218],[228,218],[231,219],[232,221],[233,223],[233,224],[233,225],[234,225]],[1,27,["#000000",2,1],[226,220],[226,219],[226,218],[226,217],[226,218],[227,218],[227,219],[227,221],[226,221],[226,220],[226,219],[226,217],[226,216],[227,215],[228,216],[228,218],[228,219],[227,220],[226,219],[226,218],[227,218],[227,217],[228,218],[228,219],[227,220],[226,221],[226,220],[226,219],[226,217],[228,217],[228,218],
[228,219],[228,221],[227,222],[227,221]],[1,28,["#000000",2,1],[220,207],[220,208],[219,208],[219,209],[219,211],[218,214],[218,215]],[8,29,["#000000",1],220,209,14,5,234,210,1,4,220,213,1,8,220,214,6,1,228,214,7,1,221,209,13,1,222,208,12,1,223,208,11,1,224,207,9,1,227,207,6,1,220,215,1,5,219,217,1,5,229,215,7,1,229,215,6,1,229,216,6,2,221,215,5,1,230,217,5,1,221,215,1,4,220,220,1,1,231,218,4,1,222,215,4,2,222,217,1,2,235,213,1,2,222,217,2,1,232,218,3,1,232,219,3,1,233,219,2,1,233,220,1,1,222,218,
1,1,234,221,1,1],[8,30,["#000000",1],164,205,16,5,180,206,1,4,163,208,1,6,164,210,8,1,175,210,5,1,164,204,16,1,164,204,15,1,165,202,15,2,165,201,14,1,165,201,12,1,166,200,12,1,166,200,11,1,167,199,11,1,167,199,9,1,169,198,7,1,164,211,7,1,164,211,7,2,164,213,6,1,164,213,5,1,175,211,5,1,176,212,4,1,164,214,4,1,164,214,4,1,176,213,4,1,177,213,3,1,164,215,3,1,164,215,2,1,177,214,3,1,177,214,2,1,177,215,2,1,164,216,2,1,165,216,1,1,178,216,1,1],[8,31,["#ffe194",1],221,225,12,1,221,226,11,1,221,224,11,2,
221,223,11,1,221,226,11,1,222,227,10,1,228,223,4,1,221,223,5,1,223,227,8,1,223,228,7,1,226,228,3,1,222,222,5,1,222,222,3,1,229,222,3,1,223,221,3,1,226,229,2,1,223,221,2,1,229,222,2,1,229,221,2,1,224,220,2,1,229,220,1,1],[8,32,["#ffe194",1],167,218,9,3,176,219,1,2,166,219,1,1,169,221,7,1,168,217,8,1,174,217,2,1,168,217,2,1,169,221,6,1,169,222,6,1,170,222,4,1,171,223,3,1,169,216,2,1,169,216,1,1,174,216,1,1,170,215,1,1],[1,33,["#ffffff",2,1],[223,210],[223,211],[223,212],[222,212],[221,212],[221,211],
[221,210],[222,211],[223,211],[223,212],[223,211],[223,210],[224,210],[224,211],[224,212],[223,212],[222,212],[222,211],[222,210],[223,210],[223,211],[223,212],[222,212]],[1,34,["#ffffff",2,1],[167,204],[166,205],[165,206],[164,205],[165,205],[165,204],[166,204],[166,205],[165,206],[164,207],[163,206],[163,205],[164,204],[165,204],[166,203],[166,204],[166,205],[165,206],[164,206],[164,205],[165,204],[166,204]],[1,35,["#000000",2,1],[174,123],[173,124],[173,125],[171,128],[168,134],[164,143],[159,
154],[154,171],[153,180],[153,188],[155,193]],[1,36,["#000000",2,1],[157,193],[157,192],[157,191],[158,190],[159,189],[160,189],[161,189],[162,189],[163,190],[163,191]],[1,37,["#000000",2,1],[171,148],[170,150],[169,154],[167,161],[165,170],[163,183],[163,189]],[1,38,["#000000",2,1],[172,148],[172,147],[172,146],[171,148],[170,153],[168,160],[166,174],[166,182],[166,187],[166,189],[167,190]],[1,39,["#000000",2,1],[168,191],[168,190],[169,190],[170,189],[171,189],[172,189]],[1,40,["#000000",2,1],[186,
130],[186,131],[184,133],[182,138],[180,145],[176,154],[174,165],[172,180],[172,186],[172,190]],[1,41,["#000000",2,1],[181,145],[181,146],[179,151],[178,157],[177,165],[176,178],[176,185],[176,189],[176,191]],[1,42,["#000000",2,1],[177,192],[178,191],[180,190],[182,189],[184,189],[186,189],[187,191],[187,193]],[1,43,["#000000",2,1],[199,130],[198,134],[196,141],[193,151],[190,163],[187,181],[187,188],[187,192]],[1,44,["#000000",2,1],[199,134],[199,136],[197,140],[196,147],[193,161],[192,172],[192,
181],[192,187],[192,191]],[1,45,["#000000",2,1],[193,192],[194,192],[195,191],[196,191]],[1,46,["#000000",2,1],[200,154],[200,153],[200,152],[200,153],[199,155],[198,159],[197,165],[196,177],[196,185],[196,190],[197,191]],[1,47,["#000000",2,1],[201,152],[201,153],[201,156],[200,165],[199,173],[199,180],[200,188],[201,190],[202,191]],[1,48,["#000000",2,1],[203,192],[204,191],[205,190],[207,190],[208,190],[210,192],[211,193]],[1,49,["#000000",2,1],[217,129],[217,133],[217,145],[216,157],[215,170],[213,
181],[212,188],[211,192],[210,192]],[1,50,["#000000",2,1],[217,161],[217,160],[218,161],[218,163],[218,169],[218,176],[217,183],[216,188],[215,191]],[1,51,["#000000",2,1],[215,190],[216,190],[216,191],[217,191],[217,192],[219,192],[220,193],[221,195],[222,195],[223,194],[224,193],[224,192],[225,192],[226,191],[227,191],[228,191]],[1,52,["#000000",2,1],[229,122],[230,123],[230,125],[232,131],[234,140],[235,151],[235,163],[234,173],[232,180],[230,186],[229,188],[229,190]],[1,53,["#000000",2,1],[236,
161],[237,164],[237,168],[236,175],[235,182],[234,190],[232,193],[232,194]],[1,54,["#000000",2,1],[231,197],[232,196],[233,196],[234,196],[234,195],[235,195]],[1,55,["#000000",2,1],[243,142],[244,145],[244,149],[244,157],[243,167],[240,182],[238,189],[236,195],[235,197],[235,198]],[1,56,["#000000",2,1],[244,154],[244,153],[244,154],[245,155],[245,158],[245,164],[244,170],[243,178],[241,187],[240,191],[239,194],[239,195],[239,197],[240,196]],[1,57,["#000000",2,1],[239,196],[240,196],[241,196],[243,
197],[244,199],[244,200],[244,201],[245,201]],[1,58,["#000000",2,1],[238,118],[240,120],[243,128],[246,138],[249,152],[250,169],[251,198],[250,216],[249,233],[248,246],[246,258],[245,262],[244,265],[244,266]],[1,59,["#000000",2,1],[247,202],[248,201],[248,198],[250,195],[251,192],[252,192]],[1,60,["#000000",2,1],[245,260],[245,261],[245,262],[245,263],[243,269],[241,276],[238,282],[236,288],[235,289]],[1,61,["#000000",2,1],[244,277],[243,278],[241,282],[239,286],[237,290],[236,291],[236,292]],[1,
62,["#000000",2,1],[244,276],[243,279],[243,282],[241,287],[240,289],[240,290]],[1,63,["#000000",2,1],[241,288],[241,289],[242,288],[244,288],[246,288],[249,288],[251,287]],[1,64,["#000000",2,1],[267,194],[267,193],[267,195],[267,200],[267,209],[266,222],[263,237],[259,260],[256,272],[254,281],[252,286],[251,288]],[1,65,["#000000",2,1],[254,287],[254,290],[254,298],[255,305],[255,311],[256,314]],[1,66,["#000000",2,1],[171,100],[170,100],[169,101],[168,101],[166,102],[163,104],[160,106],[155,110],
[149,115],[140,126],[133,134],[126,145],[121,155],[117,167],[114,181],[112,203],[110,220],[108,235],[107,254],[107,263],[107,267]],[1,67,["#000000",2,1],[166,103],[167,103],[168,102],[171,100],[180,96],[190,95],[203,96],[217,99],[235,104],[243,107]],[1,68,["#000000",2,1],[243,107],[246,107],[250,109],[255,113],[262,119],[273,133],[278,143],[281,152],[283,159],[284,162]],[1,69,["#000000",2,1],[284,168]],[1,70,["#000000",2,1],[282,159],[283,159],[284,161],[285,164],[286,169],[287,184],[288,201],[288,
221],[288,240],[289,266],[290,280],[292,292],[294,302],[296,308],[298,311]],[1,71,["#000000",2,1],[172,251],[172,252],[172,251],[172,250],[172,249],[172,247],[172,244],[172,242],[171,241],[171,240],[170,240],[170,239],[169,239],[169,240],[168,241],[168,242],[167,244],[167,246],[166,248],[166,249],[165,250],[165,251],[164,251],[164,252],[163,252],[163,253],[164,253]],[1,72,["#000000",2,1],[163,253],[162,253],[162,254],[162,255],[161,256],[161,260],[161,262],[161,265],[161,266]],[1,73,["#000000",2,
1],[172,254],[172,253],[173,253],[174,253],[179,253],[185,253],[192,253],[199,253],[202,253],[203,254]],[1,74,["#000000",2,1],[203,254],[204,254],[205,254],[206,254],[207,255],[207,256],[207,257],[204,259],[201,260],[197,260],[195,260],[192,260],[191,260]],[1,75,["#000000",2,1],[189,261],[189,262],[189,263],[189,264],[189,265],[189,266],[188,266],[187,266],[186,266],[186,267],[187,267],[187,268],[187,269],[186,269],[186,270],[186,271],[186,272],[185,272],[184,272],[183,272],[182,272],[181,272],[181,
273],[181,274],[180,275],[180,276],[180,277]],[1,76,["#000000",2,1],[150,276],[150,277],[150,278],[149,278],[149,276],[151,272],[154,269],[157,266],[161,264],[168,265],[173,268],[176,271],[179,274],[181,276],[182,278],[184,279]],[1,77,["#000000",2,1],[183,277],[185,281],[187,285],[189,290],[191,298],[192,306],[193,316],[193,320],[194,323]],[1,78,["#000000",2,1],[188,269],[190,270],[192,271],[195,271],[198,271],[204,269],[207,267],[209,266]],[1,79,["#000000",2,1],[211,265],[211,266],[211,267],[211,
269],[212,269],[213,270]],[1,80,["#000000",2,1],[212,268],[212,269],[211,269],[209,269],[207,270],[204,272],[202,273],[200,274],[199,275],[199,274],[200,274],[201,273]],[1,81,["#000000",2,1],[201,275],[202,275],[204,275],[205,276],[206,278],[207,282],[206,285],[204,287],[203,288],[203,289]],[1,82,["#000000",2,1],[203,287],[204,288],[205,289],[206,291],[207,293],[208,294],[208,295]],[1,83,["#000000",2,1],[208,292],[208,293],[208,294],[208,296],[208,297]],[1,84,["#000000",2,1],[203,297],[204,297],[205,
297],[207,297]],[1,85,["#000000",2,1],[200,289],[200,291],[201,293],[203,295],[203,296],[204,297]],[1,86,["#000000",2,1],[198,289],[198,290],[198,294],[199,296]],[1,87,["#000000",2,1],[199,295],[200,296],[201,297],[201,298],[201,299]],[1,88,["#000000",2,1],[199,298],[200,298],[200,299],[199,299],[198,300],[197,301],[196,302]],[1,89,["#000000",2,1],[192,298],[193,298],[194,299],[195,299],[197,299],[198,299]],[1,90,["#000000",2,1],[192,294],[192,295],[191,297],[191,298],[191,299]],[1,91,["#000000",
2,1],[193,290],[193,291],[193,293],[193,294],[194,294]],[1,92,["#000000",2,1],[186,280],[186,279],[186,278],[186,277],[186,276],[188,275],[189,274],[190,274]],[1,93,["#000000",2,1],[188,273],[188,274],[189,275],[190,275],[193,275],[196,275],[200,273],[201,273]],[1,94,["#000000",2,1],[198,277],[198,278],[199,278],[200,278],[201,278],[203,279],[203,281],[203,282],[203,283],[203,284],[202,284]],[1,95,["#000000",2,1],[199,277],[199,278],[199,279],[198,280],[198,281],[198,282],[199,281],[200,281],[200,
282],[201,283],[201,284]],[1,96,["#000000",2,1],[199,282],[198,284],[198,285],[197,285]],[1,97,["#000000",2,1],[193,283],[193,284],[194,284],[195,285],[196,285],[196,286],[197,286],[197,287]],[1,98,["#000000",2,1],[192,283],[192,282],[192,281],[193,281],[193,280],[194,280],[195,280]],[1,99,["#000000",2,1],[192,283],[193,279],[193,280],[193,282]],[1,100,["#000000",2,1],[193,277],[192,278],[191,279],[190,280],[190,281],[190,282],[190,283],[190,284],[191,285],[193,286]],[1,101,["#000000",2,1],[209,285],
[210,285],[210,284],[212,283],[215,282],[219,282],[221,282],[223,284],[224,284]],[1,102,["#000000",2,1],[212,270],[213,270],[213,271],[214,272],[215,273],[217,275],[221,276],[227,278],[231,278],[234,279],[236,279],[238,279],[239,280],[241,281],[241,282]],[1,103,["#000000",2,1],[237,297],[237,298],[236,298],[236,299],[236,300],[236,303],[236,304],[236,305]],[1,104,["#000000",2,1],[195,307],[195,308],[195,309],[195,310],[194,313],[194,316],[195,319],[195,321],[197,324]],[1,105,["#000000",2,1],[191,
306],[191,305],[192,305],[193,305],[194,305],[195,305],[196,305],[197,305],[197,306],[196,306],[196,307],[195,308],[196,308],[196,307],[197,306],[200,305],[203,305],[206,304],[209,304],[213,303]],[1,106,["#000000",2,1],[211,304],[212,304],[213,304],[214,303],[215,303],[216,303],[216,304],[216,305],[215,306],[214,307],[213,308],[214,308],[215,308],[216,307],[219,306],[221,306],[224,305],[229,304],[231,303]],[1,107,["#000000",2,1],[215,308],[215,309],[214,309],[213,312],[212,315],[210,318],[209,321],
[209,322],[210,322]],[1,108,["#000000",2,1],[195,326],[197,326],[198,326],[201,326],[204,325],[207,323],[209,321]],[1,109,["#000000",2,1],[211,321],[212,323],[214,323],[216,323],[218,322]],[1,110,["#000000",2,1],[232,302],[232,303],[232,302],[233,302],[233,303],[232,303],[231,304],[229,305],[225,310],[222,314],[219,319],[218,322],[218,324]],[1,111,["#000000",2,1],[235,307],[232,309],[230,311],[228,314],[225,319],[221,325],[220,327],[220,328]],[1,112,["#000000",2,1],[235,309],[236,309],[237,309],[239,
308],[240,307],[242,307],[243,307],[243,306],[244,306],[244,307],[245,307],[245,308],[245,309],[246,309],[246,308],[247,308],[248,308],[249,307],[250,306],[253,305]],[1,113,["#000000",2,1],[245,309],[245,310],[244,311],[243,313],[242,314],[242,316],[243,316]],[1,114,["#000000",2,1],[255,314],[254,316],[253,319],[251,324],[251,326]],[1,115,["#000000",2,1],[256,313],[257,313],[258,313],[260,312],[263,311],[264,311],[265,311],[265,312],[264,314],[263,315],[262,317],[261,319],[259,321],[258,324],[257,
325]],[1,116,["#000000",2,1],[232,302],[232,303],[231,303],[232,302],[233,302],[235,302],[237,302],[238,303],[238,304],[238,305],[238,306],[238,307]],[1,117,["#000000",2,1],[194,322],[193,322],[193,323],[193,324],[193,325],[193,328],[193,330],[194,331]],[1,118,["#000000",2,1],[194,328],[195,328],[196,328],[197,328],[199,328],[203,328],[209,329],[213,329],[217,329]],[1,119,["#000000",2,1],[241,318],[241,317],[242,316],[243,316],[243,315],[245,315],[246,315],[248,315],[248,316],[249,316],[249,317],
[249,318],[249,319],[249,320],[249,321],[250,321],[250,320]],[1,120,["#000000",2,1],[243,322],[242,322],[243,322],[244,322],[245,322],[246,322],[247,322],[249,322],[250,322]],[1,121,["#000000",2,1],[233,311],[233,312],[233,314],[233,315],[234,316],[235,316]],[1,122,["#000000",2,1],[227,314],[228,314],[230,315],[233,315],[234,316]],[1,123,["#000000",2,1],[226,320],[226,321],[226,322],[227,323],[228,323],[229,324],[230,324],[232,324],[234,323],[235,323],[237,322],[238,322]],[1,124,["#000000",2,1],[234,
322],[234,323],[233,323],[232,323],[231,324],[229,325],[228,325],[228,326],[227,327],[228,328],[229,329],[230,329],[231,330],[232,330]],[1,125,["#000000",2,1],[236,328],[235,329],[234,330]],[1,126,["#000000",2,1],[244,324],[245,326],[245,327],[247,327],[248,328],[248,329]],[1,127,["#000000",2,1],[237,318],[236,318],[235,319],[235,320],[235,322],[236,323],[237,324],[239,324],[240,324],[242,323],[242,321],[242,320],[242,319],[241,318],[240,317],[239,318],[238,318],[237,318]],[1,128,["#000000",2,1],
[236,328],[237,328],[238,327],[239,327],[240,328],[241,329],[241,330],[242,330]],[1,129,["#000000",2,1],[242,330],[243,330],[246,328],[247,328]],[1,130,["#000000",2,1],[107,264],[107,265],[107,268],[107,280],[107,291],[107,303],[108,313],[108,319],[109,322]],[4,131,["#000000",1,1],[98,95],[300,331]],[1,132,["#000000",2,1],[253,326],[253,325],[255,324],[256,324],[257,324]],[1,133,["#000000",2,1],[220,323],[221,323],[222,323]],[1,134,["#000000",2,1],[219,329],[219,328],[220,328],[220,327],[221,327]],
[8,135,["#ff8a8a",1],195,314,16,1,195,315,16,1,196,312,16,3,211,305,1,9,196,309,15,3,196,315,15,1,196,316,15,1,197,309,15,1,197,308,14,1,196,317,14,1,196,317,14,1,198,307,14,1,199,307,13,1,196,318,13,1,196,318,13,2,196,320,12,1,201,306,10,1,197,320,12,1,197,321,11,1,197,321,11,1,197,322,10,1,205,306,7,1,198,322,9,1,198,323,8,1,212,305,1,7,198,323,7,1,212,309,1,2,212,305,1,2,198,324,6,1,207,305,4,1,198,324,5,1,198,325,2,1,213,305,1,2,213,305,1,1,214,305,1,1],[8,136,["#ff8a8a",1],193,307,1,1],[8,137,
["#ff8a8a",1],214,314,8,1,214,314,7,1,214,312,7,2,221,307,1,6,215,311,7,2,214,315,7,1,213,315,1,7,214,316,6,1,214,317,4,5,213,316,1,6,215,310,6,1,216,310,6,1,217,317,2,1,222,307,1,6,217,308,5,2,222,307,1,5,216,309,1,1,212,317,1,5,217,317,1,4,214,322,2,1,212,318,1,3,223,307,1,5,223,307,1,4,224,307,1,3,218,317,1,2,224,306,1,3,225,306,1,3,225,306,1,2,211,319,1,2,226,306,1,1,218,317,1,1,211,320,1,1,218,308,4,1,220,307,2,1,226,306,1,1],[8,138,["#ff8a8a",1],245,312,10,2,254,313,1,1,244,313,1,1,249,314,
5,1,245,312,9,1,246,311,9,1,246,310,8,1,247,310,8,1,247,309,7,1,249,309,5,1,250,308,5,1,249,315,5,1,250,315,4,1,250,308,4,1,251,307,4,1,252,307,3,1,250,316,3,1,250,316,3,2,250,318,2,2,253,306,1,1,251,319,1,1],[8,139,["#ff8a8a",1],255,318,6,1,255,318,6,1,255,316,6,2,261,313,1,4,256,315,5,1,255,319,5,1,255,319,5,1,257,314,4,1,254,319,1,4,255,320,4,1,255,321,4,1,255,322,3,1,254,321,1,3,261,313,1,3,259,314,2,1,262,313,1,3,253,322,1,2,262,313,1,2,253,323,1,1,263,313,1,1,260,313,1,1,263,312,1,1,255,323,
3,1],[8,140,["#fbdc89",1],234,310,9,1,234,311,9,1,238,310,5,1,234,312,8,1,234,313,8,1,234,314,7,1,235,315,7,1,236,315,5,1,236,316,5,1,243,308,1,2,239,309,4,1,236,316,3,1,240,309,3,1,241,308,3,1,236,317,3,1,244,308,1,2],[8,141,["#fbdc89",1],243,317,5,4,243,317,1,1,244,317,4,1,244,316,3,1],[8,142,["#fbdc89",1],236,320,5,2,239,321,2,1,237,319,4,1,239,322,2,1,239,323,1,1],[8,143,["#fbdc89",1],227,318,8,1,227,318,7,3,228,317,7,1,235,317,1,1,228,317,6,1,227,319,1,1,227,321,6,1,228,322,6,1,229,322,2,1,228,
316,5,1,229,316,1,1,230,323,1,1],[8,144,["#fbdc89",1],229,326,8,1,229,327,8,1,230,326,7,1,229,327,6,1,237,325,7,1,231,325,6,1,233,325,4,1,230,328,5,1,231,328,3,1,235,324,1,1,232,329,2,1,240,326,4,1,241,325,2,1,241,327,4,1,241,327,3,1,242,328,3,1,242,328,2,1,242,324,1,1,242,329,1,1,243,324,1,1],[1,145,["#000000",2,"1"],[150,275],[149,276],[147,279],[145,285],[142,294],[139,309],[138,316],[139,321],[140,324]],[1,146,["#000000",14,"0.61"],[115,311],[114,312],[114,308],[114,299],[117,279],[120,264],[121,
252],[122,245],[123,246],[122,254],[121,267],[121,282],[121,298],[121,310],[121,315],[122,309],[124,296],[126,278],[130,259],[133,240],[134,239],[134,249],[131,276],[128,297],[124,315],[122,324],[121,314],[123,295],[128,270],[134,248],[140,237],[144,239],[145,261],[143,280],[140,296],[137,304],[135,303],[135,284],[138,268],[142,257],[146,256],[146,264],[145,273],[142,278],[139,277],[139,269],[139,257],[142,248],[144,245],[147,248],[149,260],[149,267],[148,268],[147,264],[147,253],[147,236],[148,230],
[149,229],[149,237],[147,243],[144,244],[142,242],[138,228],[138,216],[138,204],[138,197],[139,199],[141,208],[141,225],[139,234],[138,237],[137,231],[137,216],[139,187],[140,168],[140,154],[141,154],[139,167],[137,187],[132,209],[125,240],[121,249],[120,248],[120,238],[122,221],[127,199],[136,168],[140,159],[141,160],[139,172],[135,192],[126,224],[119,242],[113,252],[109,249],[109,235],[112,213],[120,186],[134,148],[141,134],[144,129],[145,131],[145,138],[142,150],[138,170],[134,182],[132,189],[131,
188],[134,178],[143,155],[150,140],[157,128],[162,123],[161,130],[157,146],[152,163],[144,183],[142,186],[142,181],[146,167],[153,150],[160,136],[166,127],[166,133],[163,147],[158,165],[152,180],[148,184],[149,174],[155,156],[167,128],[174,118],[176,117],[176,128],[170,154],[164,168],[161,173],[160,168],[164,155],[175,128],[182,116],[186,112],[186,117],[182,131],[176,147],[168,161],[166,160],[167,150],[177,130],[184,120],[188,119],[188,129],[181,153],[176,168],[170,177],[167,178],[167,171],[174,155],
[180,145],[184,141],[185,144],[183,155],[178,169],[171,184],[168,186],[168,181],[173,164],[180,152],[187,144],[191,142],[191,151],[188,161],[184,169],[182,171],[182,166],[187,149],[194,136],[201,125],[207,120],[209,125],[208,137],[201,159],[196,168],[193,170],[195,160],[201,147],[208,133],[214,124],[217,126],[216,138],[213,154],[208,168],[204,176],[202,172],[203,162],[207,149],[211,139],[212,135],[212,140],[207,158],[202,169],[198,174],[197,167],[200,156],[204,146],[208,141],[210,149],[209,162],[207,
175],[205,183],[205,182],[209,167],[215,152],[222,137],[229,128],[233,127],[234,136],[232,159],[227,172],[224,179],[222,176],[224,166],[227,153],[231,141],[234,135],[234,142],[233,156],[230,171],[227,181],[225,182],[226,173],[230,158],[235,144],[239,135],[242,133],[245,146],[245,161],[244,174],[243,182],[242,179],[244,169],[247,157],[254,146],[257,148],[259,157],[260,170],[259,184],[257,193],[256,190],[256,181],[257,170],[258,160],[259,158],[261,169],[262,185],[263,202],[262,223],[262,229],[261,228],
[260,221],[259,205],[260,197],[260,195],[261,201],[261,216],[263,243],[263,261],[262,274],[261,281],[260,279],[259,270],[259,244],[261,223],[263,208],[265,205],[265,216],[263,232],[261,248],[257,265],[255,270],[254,270],[253,267],[253,264],[253,265],[253,266],[252,269],[251,271],[251,272],[250,273],[249,276],[249,279],[248,281],[248,284],[248,285],[249,285],[249,284],[253,278],[256,272],[260,264],[264,259],[268,258],[271,267],[272,277],[273,288],[274,298],[275,305],[275,307],[275,302],[273,295],[270,
286],[267,279],[267,280],[267,285],[269,293],[272,304],[274,308],[274,309],[274,306],[271,301],[268,294],[264,289],[263,289],[262,293],[262,298],[262,301],[263,302],[264,301],[265,297],[268,290],[269,288],[270,288],[272,292],[272,301],[272,307],[273,310],[274,310],[276,309],[278,307],[281,305],[283,306],[284,309],[284,314],[284,319],[284,323],[285,322],[287,322],[288,322],[287,322],[286,322],[282,322],[277,322],[274,321],[273,319],[274,318],[277,319],[281,322],[286,325],[289,327],[291,328],[292,329],
[293,329],[294,328],[295,323],[295,319],[294,316],[291,317],[286,322],[282,325],[280,328],[279,329],[282,327],[284,323],[286,318],[286,309],[285,296],[278,265],[271,241],[266,219],[263,196],[262,186],[262,179],[262,177],[262,184],[263,199],[266,220],[269,244],[273,268],[276,287],[278,298],[279,294],[279,280],[277,257],[274,229],[270,190],[269,177],[269,180],[271,209],[273,234],[276,258],[277,274],[278,274],[277,261],[276,240],[274,215],[271,190],[270,174],[269,176],[269,189],[271,206],[272,219],[272,
223],[272,213],[270,197],[267,177],[263,155],[263,152],[264,159],[267,173],[272,195],[274,202],[274,203],[274,196],[273,183],[272,161],[271,152],[271,153],[272,165],[274,184],[277,207],[278,237],[278,248],[277,250],[277,236],[277,221],[278,202],[277,187],[277,185],[276,199],[276,216],[275,231],[273,239],[269,231],[266,216],[263,197],[260,177],[257,161],[254,154],[250,158],[248,166],[246,171],[243,176],[241,177],[239,177],[236,177],[232,179],[231,180],[232,181],[234,182],[236,182],[239,184],[243,186],
[246,188],[248,188],[250,187],[250,185],[251,185],[251,187],[251,191],[251,193],[251,192],[251,191],[251,189],[251,189],[251,191],[251,192],[251,191],[249,187],[244,181],[241,179],[237,179],[233,180],[230,182],[228,184],[226,185],[225,186],[225,187],[225,188],[226,187],[226,185],[226,183],[225,182],[224,183],[222,186],[221,188],[221,189],[221,185],[222,179],[224,174],[224,171],[225,170],[224,171],[221,175],[218,175],[216,172],[213,164],[212,160],[211,159],[209,161],[207,168],[204,170],[202,171],[201,
171],[200,171],[200,176],[199,179],[199,180],[199,181],[199,180],[200,180],[204,179],[207,180],[209,181],[209,180],[206,176],[202,174],[198,174],[194,177],[191,182],[189,185],[188,184],[187,184],[185,184],[182,183],[179,182],[177,179],[176,176],[175,176],[175,178],[175,180],[175,183],[174,184],[173,183],[172,182],[170,181],[167,180],[162,180],[160,180],[159,180],[157,181],[156,183],[155,185],[153,187],[150,190],[148,190],[146,191],[143,191],[140,191],[138,192],[137,192],[136,192],[136,191],[136,195],
[136,201],[137,208],[138,220],[138,227],[137,232],[137,234],[136,234],[136,231],[136,223],[136,211],[139,197],[144,183],[153,165],[160,156],[166,148],[171,143],[174,140],[176,136],[177,134],[178,132],[179,130],[178,131],[177,132],[173,137],[164,144],[157,148],[151,151],[147,152],[146,145],[151,137],[159,127],[169,117],[180,111],[187,110],[190,113],[187,123],[181,131],[174,137],[161,143],[154,143],[150,143],[150,141],[153,135],[160,129],[169,121],[182,114],[196,110],[211,112],[214,117],[212,123],[205,
129],[194,134],[181,139],[162,143],[155,143],[151,141],[150,136],[153,131],[155,127],[158,124],[160,122],[162,122],[162,121],[163,121],[163,122],[161,125],[157,129],[151,133],[146,136],[143,137],[142,136],[144,131],[149,125],[158,116],[175,106],[185,104],[192,106],[194,111],[191,119],[183,125],[172,130],[161,134],[153,135],[149,133],[150,126],[156,119],[165,111],[179,104],[195,100],[218,103],[229,109],[236,115],[240,119],[239,119],[238,119],[234,118],[224,116],[216,114],[213,112],[212,111],[215,109],
[227,109],[237,112],[247,117],[254,123],[257,129],[256,132],[247,134],[236,132],[223,128],[209,119],[207,116],[209,115],[218,115],[239,122],[253,131],[262,142],[267,150],[267,155],[262,154],[257,149],[252,140],[248,128],[247,120],[250,118],[259,127],[265,140],[271,152],[275,165],[275,167],[274,165],[270,154],[268,146],[266,140],[266,139],[267,144],[270,154],[274,170],[276,178],[276,182],[276,181],[276,179],[274,172],[272,158],[270,151],[270,148],[272,154],[275,163],[277,173],[279,183],[280,193],[280,
195],[280,194],[279,189],[279,181],[276,165],[274,155],[273,149],[273,146],[273,145],[273,144],[273,143],[273,141],[272,140],[271,138],[270,137],[270,138],[272,144],[275,154],[278,167],[280,182],[282,207],[283,223],[284,237],[284,249],[285,259],[287,265],[288,268],[288,265],[288,257],[286,237],[284,220],[283,201],[283,187],[283,180],[283,181],[283,188],[283,196],[283,208],[283,226],[284,238],[284,249],[284,257],[285,265],[285,272],[286,282],[287,287],[288,291],[289,295],[291,298],[292,300],[294,303],
[296,306],[298,309],[299,312],[300,314],[300,315],[299,312],[295,305],[289,292],[277,263],[271,242],[268,224],[267,211],[266,203],[266,205],[266,208],[265,211],[264,218],[263,227],[262,236],[261,245],[259,255],[259,259],[258,262],[258,263],[257,262],[256,260],[255,257],[255,253],[255,242],[256,232],[257,221],[257,213],[257,210],[257,212],[256,221],[256,234],[257,248],[257,260],[257,269],[257,268],[257,267],[256,261],[256,253],[257,237],[258,223],[259,210],[260,203],[259,207],[258,217],[257,232],[256,
256],[255,270],[255,276],[255,277],[255,272],[256,262],[258,245],[259,236],[259,232],[258,233],[255,238]],[1,147,["#000000",14,"0.61"],[147,253],[148,254],[148,255],[149,258],[149,262],[149,264],[149,263],[149,262],[149,259],[149,257],[150,256],[151,258],[152,260]],[1,148,["#000000",14,"0.61"],[257,238],[256,238],[255,239],[254,241],[252,243],[248,247],[242,256],[236,262],[232,267],[228,270],[226,269],[226,267],[226,264],[226,262],[225,262],[225,263],[225,264],[224,265],[224,267],[223,267],[223,268],
[222,268],[223,268],[224,268],[225,269],[227,270],[230,271],[232,272],[235,273],[240,273],[243,272],[245,270],[246,269],[245,269],[244,270],[242,271],[240,271],[239,271],[238,269],[239,263],[241,258],[243,252],[245,246],[248,237],[248,235],[247,235],[246,239],[243,248],[240,254],[239,258],[238,260],[238,259],[238,258],[238,254]],[1,149,["#000000",14,"0.61"],[115,243],[115,242],[115,243],[114,249],[113,258],[113,271],[113,287],[114,308],[116,318],[119,323],[120,325],[121,324],[122,321],[122,317],[123,
312]],[1,150,["#000000",14,"0.61"],[130,316],[131,316],[132,316],[133,316],[134,316],[135,317]],[1,151,["#000000",14,"0.61"],[119,205],[115,223],[112,238],[110,248],[109,249],[110,241],[113,225],[119,203],[127,177],[138,151],[154,121],[162,111],[167,108],[169,109],[169,114],[168,118],[165,122],[161,126],[155,135],[151,142],[145,149],[139,157],[131,172],[127,183],[124,191],[124,194],[125,192],[127,188],[137,169],[146,153],[157,136],[167,123],[174,116],[173,121],[170,132],[165,146],[157,163],[154,167],
[154,165],[156,158],[164,142],[169,134],[172,130],[172,134],[170,144],[166,159],[161,176],[159,179],[161,174],[166,162],[176,141],[182,131],[186,127],[186,132],[183,151],[179,165],[175,175],[174,177],[176,167],[181,155],[186,143],[190,136],[191,136],[191,144],[187,162],[184,171],[183,173],[184,168],[188,150],[192,137],[196,128],[198,126],[198,138],[196,153],[195,166],[193,172],[194,167],[197,156],[201,144],[205,135],[208,132],[209,136],[209,154],[207,163],[206,166],[206,162],[209,145],[211,133],[212,
127],[213,127],[213,144],[211,157],[209,164],[207,164],[205,151],[203,138],[201,127],[198,122],[193,122],[187,129],[180,138],[178,138],[178,135],[182,127],[193,115],[201,109],[206,107],[208,107],[206,111],[205,112],[204,112],[205,112],[208,118],[211,123],[214,127],[216,128],[218,126],[220,125],[225,128],[229,136],[231,146],[232,156],[232,162],[231,160],[230,154],[229,145],[228,137],[227,140],[227,150],[226,170],[225,182],[223,186],[221,182],[221,172],[221,159],[223,143],[225,140],[228,148],[231,162],
[234,178],[236,190],[236,187],[236,176],[236,162],[237,143],[240,138],[245,143],[250,157],[258,180],[261,191],[262,193],[261,189],[260,179],[259,162],[259,156],[260,155],[261,163],[263,177],[265,201],[265,217],[266,228],[266,231],[267,228],[267,221],[266,209],[263,180],[262,162],[262,152],[264,154],[266,165],[269,185],[273,221],[274,241],[274,251],[272,252],[270,241],[263,209],[259,181],[256,156],[256,141],[258,135],[260,138],[263,146],[268,166],[273,186],[278,209],[283,234],[286,258],[288,279],[287,
299],[286,303],[284,300],[280,289],[276,270],[269,230],[267,202],[266,180],[267,170],[269,172],[271,187],[274,210],[277,245],[277,259],[277,262],[275,256],[272,239],[268,214],[262,172],[260,157],[259,157],[258,170],[257,192],[257,227],[257,244],[257,253],[257,257],[255,260],[255,264],[255,267],[256,268],[256,266],[256,261],[257,253],[257,246],[258,243],[259,246],[263,264],[265,279],[267,291],[268,299],[269,304],[271,304],[272,304],[272,303],[270,292],[268,277],[265,253],[263,207],[265,179],[269,159],
[272,147],[274,145],[275,150],[274,160],[271,167],[267,165],[263,158],[258,147],[253,132],[249,125],[245,121],[241,119],[236,115],[234,112],[231,111],[227,111],[224,112],[220,116],[216,118],[212,119],[209,117],[207,112],[207,109],[208,108],[209,108],[209,109],[206,110],[201,110],[194,110],[186,111],[172,117],[162,125],[151,136],[135,156],[126,172],[120,186],[117,197],[115,205],[115,211],[115,216],[115,217],[116,216],[118,211],[120,204],[124,192],[124,189],[124,193],[122,205],[120,233],[117,253],[116,
269],[115,277],[117,272],[120,260],[126,240],[133,215],[140,190],[145,172],[146,175],[143,188],[140,205],[136,224],[133,244],[133,246],[133,242],[136,230],[142,204],[146,188],[149,178],[150,180],[149,191],[147,207],[144,224],[142,238],[141,247],[139,252],[139,253],[139,256],[139,260],[138,267],[136,274],[135,276],[134,277],[134,278],[133,283],[132,288],[130,293],[128,299],[126,302],[125,304],[125,302],[125,300],[127,293],[128,288],[128,290],[127,297],[125,303],[123,306],[122,302],[124,294],[127,287],
[130,283],[131,284],[131,289],[131,292],[131,291],[131,289],[130,288],[128,290],[127,295],[126,299],[125,300],[128,296],[131,295],[133,295]],[1,152,["#000000",14,"0.61"],[225,276],[225,277],[225,276],[226,274],[229,270],[233,264],[238,255],[243,248],[246,244],[245,246],[243,251],[239,257],[235,262],[235,263],[236,263],[238,261],[242,255]],[1,153,["#000000",14,"0.61"],[281,318],[280,319],[279,321],[278,321],[278,320],[278,318],[278,315],[279,313],[281,313],[284,315],[287,319],[289,322],[290,323],[290,
320],[289,314],[288,306],[288,304],[289,305],[291,308],[294,311],[296,312],[296,309],[297,306],[297,304]],[1,154,["#000000",14,"0.61"],[179,182],[179,184],[178,186],[178,185],[178,183],[178,180],[181,168],[183,161],[185,159]],[1,155,["#000000",14,"0.61"],[206,178],[205,179],[205,177],[205,171],[207,164],[209,157],[211,155]],[1,156,["#000000",14,"0.61"],[241,186],[240,186],[239,183],[239,176],[240,166]],[1,157,["#000000",14,"0.61"],[178,109],[179,108],[184,105],[192,102],[202,102],[212,105],[225,115]],
[1,158,["#000000",14,"0.61"],[249,117],[250,116],[255,117],[262,124],[269,135],[277,152],[285,185],[288,207],[290,224],[291,233]],[1,159,["#000000",14,"0.61"],[234,125],[237,132],[241,146],[245,164]],[1,160,["#000000",14,"0.61"],[129,247],[129,243],[130,242],[132,247],[136,266],[139,283],[140,292]],[1,161,["#FEE6DB",10,"0.61"],[155,225],[155,224],[154,224],[154,223],[155,225],[156,228],[157,230],[157,229],[157,228],[156,224],[154,220],[153,218],[153,217],[153,219],[155,222],[157,226],[159,229],[159,
230],[160,230],[160,228],[159,226],[159,224],[159,225],[159,228],[159,232],[159,237],[159,239],[159,242],[159,244],[160,245],[160,244],[160,243],[160,244],[161,245],[161,244],[161,242],[162,240],[164,238],[165,237],[166,236],[167,236],[168,236],[169,236],[170,236],[172,235],[173,234],[174,234],[174,235],[175,236],[176,237],[177,238],[177,239],[177,240],[177,241],[176,242],[177,242],[177,243],[177,244],[177,245],[177,246],[177,247],[177,246],[177,245],[177,242],[178,238],[178,235],[178,234],[177,234],
[176,234],[175,233],[174,232],[174,231],[175,231],[176,230],[178,230],[181,233],[183,234],[185,234],[186,234],[185,233],[183,232],[181,231],[181,229],[181,228],[184,227],[187,225],[191,223],[193,220],[195,217],[195,214],[195,213],[195,211],[194,211],[193,213],[192,215],[190,217],[188,220],[185,222],[185,223],[185,222],[187,216],[191,209],[194,203],[197,197],[198,194],[197,197],[195,203],[192,210],[190,216],[188,220],[188,221],[189,216],[192,210],[195,205],[197,203],[198,207],[198,215],[197,222],[195,
228],[195,229],[196,226],[197,223],[199,221],[199,222],[198,223],[196,224],[195,225],[192,228],[191,230],[190,231],[189,231],[189,232],[189,233],[188,234],[187,234],[187,233],[187,234],[187,235],[187,236],[187,238],[186,239],[186,238],[186,237],[186,238],[186,239],[185,240],[184,241],[183,241],[182,242],[182,243],[182,244],[182,245],[183,246],[184,246],[184,245],[183,245],[183,244],[182,244],[182,245],[183,245],[183,244],[182,243],[182,241],[182,239],[182,237],[184,236],[186,234],[190,233],[193,233],
[196,234],[199,235],[203,237],[204,237],[204,236],[204,235],[203,234],[201,234],[200,234],[201,235],[202,235],[203,236],[201,236],[199,236],[196,236],[195,236],[196,236],[197,237],[199,238],[200,238],[202,239],[203,239],[204,240],[205,241],[205,242],[206,242],[207,243],[208,245],[209,246],[208,245],[208,243],[207,240],[203,230],[200,222],[198,217],[198,216],[200,220],[202,226],[205,234],[207,239],[207,240],[207,234],[205,224],[203,213],[201,204],[200,199],[201,203],[203,212],[204,221],[206,227],[206,
228],[206,222],[206,214],[206,203],[206,200],[206,201],[206,205],[207,209],[207,212],[207,213],[208,211],[209,208],[209,205],[209,203],[208,202],[208,201],[209,201],[211,201],[212,201],[214,201],[214,200],[215,199],[216,199],[217,199],[217,198],[217,197],[218,197],[218,196],[219,196],[218,196],[216,196],[210,196],[206,196],[202,196],[199,196],[196,196],[194,196],[191,196],[190,195],[189,195],[188,195],[187,195],[186,195],[186,194],[185,194],[185,195],[184,195],[183,195],[185,196],[186,196],[187,196],
[188,197],[190,197],[192,198],[193,198],[196,198],[198,198],[203,198],[205,198],[207,197],[209,196],[210,196],[211,196],[212,196],[213,196],[215,196],[216,197],[217,197],[216,197],[215,197],[213,197],[211,198],[208,199],[206,201],[204,204],[203,206],[203,212],[203,217],[205,222],[207,226],[209,230],[209,232],[210,233],[210,232],[210,229],[211,226],[213,226],[215,230],[217,236],[218,242],[218,243],[218,241],[217,234],[215,229],[214,226],[214,228],[215,229],[217,235],[220,242],[221,244],[222,245],[222,
246],[222,247],[222,248],[221,248],[220,247],[220,246],[221,245],[222,244],[224,242],[228,238],[230,236],[233,234],[234,233],[235,233],[235,232],[235,233],[234,233],[234,234],[234,235],[234,234],[235,230],[237,226],[238,222],[239,221],[239,220],[240,220],[241,219],[242,219],[242,220],[243,220],[243,221],[243,222],[242,223],[241,225],[240,227],[239,229],[238,231],[236,233],[235,234],[234,235],[233,236],[232,237],[232,238],[231,240],[231,242],[231,243],[230,245]],[1,162,["#FEE6DB",10,"0.61"],[165,259],
[165,260],[165,261],[165,260],[165,259],[166,258],[166,257],[167,256],[169,254],[169,253],[171,251],[171,250],[171,249],[171,248],[171,247],[170,248],[170,250],[170,254],[169,257],[169,259],[170,259],[171,259],[172,260],[173,260],[174,260],[176,261],[178,261],[179,260],[181,259],[179,261],[176,263],[176,264],[176,265],[176,266],[177,267],[178,268],[179,268],[179,267],[179,266],[179,265],[179,264],[181,261],[183,259],[186,256],[189,255],[191,255],[192,255],[192,256],[193,257],[194,257],[194,256],[195,
255],[196,255],[197,255],[198,255],[199,256],[200,256],[201,256],[200,256],[199,256],[197,257],[196,257],[195,257],[195,256],[194,256],[194,255],[194,254],[193,254],[192,253],[191,253],[192,253],[193,253],[194,254],[194,255],[195,255],[196,255]],[1,163,["#FEE6DB",10,"0.61"],[215,254],[215,255],[215,254],[216,253],[217,253],[219,252],[220,253],[220,254],[220,256]],[1,164,["#FEE6DB",10,"0.61"],[212,278],[212,277],[211,277],[212,279],[213,282],[214,286],[215,290],[215,292],[215,293],[215,294],[215,295],
[215,296],[214,297],[214,298],[213,298],[213,297],[213,296],[212,296],[211,296],[211,297],[209,297],[209,298],[209,297],[210,297],[213,296],[216,295],[221,294],[225,293],[228,293],[230,293],[231,294],[231,295],[231,294],[230,292],[229,291],[228,292],[227,293],[227,294],[227,293],[228,292],[228,291],[230,287],[230,285],[231,285],[231,284],[231,283],[231,282],[231,281],[232,281],[233,282],[234,283],[235,285],[236,287],[236,289],[237,291],[238,292],[239,292],[241,293],[242,294],[243,294],[243,295],[244,
296],[245,296],[246,295],[247,295],[247,296],[248,297],[248,299],[248,300],[247,300],[247,301],[247,300],[248,298],[248,297],[249,296],[250,298],[251,300],[250,302],[249,302],[247,301],[245,299],[243,298],[244,298]],[8,165,["#fbdc89","1"],190,286,1,5,191,287,1,4,190,286,1,3,191,291,2,2,192,287,4,2,189,286,1,2,189,286,2,1,196,288,1,1,194,289,3,4,194,287,2,1,195,293,2,5,197,295,1,3,195,295,1,3,194,295,1,3,198,296,1,2,193,295,1,2,193,296,1,1,194,286,1,1,189,285,1,1,191,292,1,1,188,276,1,9,189,276,1,
3,188,277,1,8,187,277,1,7,187,281,1,1,190,276,1,3,190,276,1,2,191,276,1,2,191,276,1,1,192,276,1,1],[8,166,["#fbdc89","1"],198,286,4,2,201,288,1,3,199,286,4,1,202,285,2,1,199,285,3,1,199,285,1,1,200,284,1,1,204,285,1,1,204,277,1,8,205,279,1,6,204,278,1,1,205,280,1,4,203,278,1,1,202,277,2,1,200,277,2,1,200,276,4,1,202,290,3,1,202,291,3,2,205,291,1,1,202,292,4,1,203,293,3,1,203,293,3,1,204,294,2,1,204,294,1,1,204,295,1,1],[8,167,["#fbdc89","1"],194,276,3,3,197,279,1,1,194,278,1,1,196,279,1,5,197,283,
1,1,196,281,1,3,195,281,1,3,194,281,1,2],[8,168,["#fbdc89","1"],189,271,1,2,190,272,1,2,187,271,2,1,191,272,7,1,198,272,1,1,191,273,6,1,191,274,4,1,187,271,2,1,187,270,1,1],[8,169,["#fbdc89","1"],205,269,1,1],[1,170,["#FEE6DB",6,"0.59"],[194,268],[195,268],[196,268],[197,268],[197,267],[198,267],[200,267],[201,266],[203,266],[204,265]],[1,171,["#99BCFF",6,"0.59"],[96,110],[95,110],[95,109],[96,108],[99,104],[104,99],[109,94],[112,92],[113,93],[108,101],[102,109],[95,117],[90,122],[89,123],[95,117],
[104,108],[119,98],[124,97],[123,102],[117,113],[107,125],[95,137],[93,137],[98,131],[109,121],[122,110],[133,103],[136,103],[129,110],[116,121],[103,131],[94,136],[99,132],[110,122],[133,104],[144,97],[146,96],[140,103],[127,113],[105,130],[97,135],[98,133],[108,123],[122,110],[138,98],[150,90],[147,95],[135,107],[120,122],[98,144],[91,150],[94,148],[113,131],[130,115],[144,101],[150,95],[146,99],[127,120],[110,137],[97,152],[91,158],[94,156],[105,144],[129,119],[142,105],[148,101],[144,108],[127,
132],[113,149],[102,160],[100,162],[108,153],[120,140],[130,130],[135,128],[130,143],[120,160],[109,177],[99,194],[92,206],[90,210],[95,209],[98,207]],[1,172,["#99BCFF",6,"0.59"],[236,101],[238,101],[243,102],[251,105],[261,111],[272,120],[286,139],[292,153],[296,165],[298,175],[298,177],[298,178],[298,175],[294,163],[289,150],[281,135],[272,120],[264,109],[256,100],[254,98],[253,98],[252,97],[251,97],[252,97],[253,98],[255,100],[261,107],[276,122],[285,132],[293,141],[297,147],[298,150],[296,148],
[292,141],[285,130],[271,111],[263,100],[258,95],[257,94],[260,98],[266,108],[281,127],[291,139],[299,146],[301,148],[296,139],[289,127],[279,114],[273,105],[274,104],[280,112],[289,122],[296,129],[299,131],[296,126],[291,117],[285,109],[281,104],[282,104],[289,114],[293,120],[294,121],[291,117],[284,104],[281,97],[282,97],[287,102],[294,111],[296,112],[296,108],[296,100],[303,97]],[1,173,["#99BCFF",6,"0.59"],[296,174],[296,173],[296,171],[296,170],[296,171],[296,176],[297,188],[297,208],[297,232],
[297,267],[298,281],[298,287],[298,289],[298,288],[298,285]],[1,174,["#99BCFF",6,"0.59"],[108,185],[107,185]],[1,175,["#99BCFF",6,"0.59"],[108,185],[108,180],[108,178],[107,179],[107,181],[106,184],[104,193],[101,220],[100,246],[99,273],[99,293],[101,309],[102,315],[103,317],[104,318],[104,319],[103,319],[102,319],[101,318],[100,318],[100,319],[101,319],[101,322],[102,323],[103,325],[104,327],[105,327],[106,327],[106,326],[106,324],[106,323],[106,317],[106,306],[106,291],[106,268],[106,256]],[1,176,
["#99BCFF",6,"0.59"],[99,185],[99,183],[101,177],[106,167],[121,142],[135,123],[149,107],[161,96],[168,89],[171,89],[171,92],[168,96],[164,100],[160,104],[155,107],[149,111]],[1,177,["#99BCFF",6,"0.59"],[111,111],[116,106],[123,101],[125,100]],[1,178,["#99BCFF",6,"0.59"],[98,127],[98,126],[100,123],[111,110],[122,100],[130,91],[135,88],[135,90],[126,104],[117,115],[108,125],[102,133],[100,135],[103,132],[114,121],[123,114],[128,111],[127,118],[121,130],[113,143],[107,152],[105,156],[109,152],[116,
144],[123,135],[128,130],[127,134],[121,142],[114,151],[108,158],[106,159],[108,157],[117,146],[124,139],[128,136],[126,143],[119,156],[112,169],[106,182],[100,194],[100,196],[102,195],[103,193]]];
GPAssets_.ANTICHEAT_SUSPICIOUS_ART_PLACEHOLDER=[...GPAssets_.GIRL_PORTRAIT_PLACEHOLDER,[1,200,["#cc6969",4,1],[369,156.5],[369,160],[369.5,163.5],[370.5,167.5],[371,172.5],[371.5,177],[371.5,181.5],[372,186],[372,188.5],[372,190.5],[372,190.5],[372,190.5],[372,190]],[1,201,["#cc6969",4,1],[371.5,156.5],[371.5,156],[372.5,156],[374,156],[376.5,156],[380.5,155],[383,155],[384.5,154.5],[386,154.5],[386.5,154.5],[387,154.5],[387,155],[387,155.5],[386.5,156],[386.5,158.5],[386.5,161],[386.5,163.5],[386.5,
166],[386.5,169.5],[387,174],[387,177],[387,180],[387,182.5],[387,186],[387.5,187.5],[388,188],[388,189],[388.5,189],[388.5,189.5],[388.5,189],[388.5,188.5]],[1,202,["#cc6969",4,1],[401,172.5],[400,173.5],[399.5,176.5],[399.5,179],[399.5,181],[399.5,183],[400.5,184.5],[403,186.5],[404.5,187],[406.5,187.5],[408.5,187],[411,186],[411.5,185],[413,182.5],[413.5,180.5],[414,178.5],[413.5,175],[413,173.5],[411,172.5],[409.5,171.5],[406.5,171.5],[404.5,171.5],[403.5,172.5],[402.5,174],[402.5,175]],[1,203,
["#cc6969",4,1],[434,174],[433,172],[432.5,171],[430,171],[428.5,171],[426,171.5],[425,173],[424,175],[423,177.5],[422.5,181.5],[423,183.5],[424,185.5],[427,187],[429,187.5],[431,187.5],[432.5,187],[433.5,186],[435,183.5],[435.5,181.5],[436,178.5],[436,176],[436,174.5],[436,175],[436,176],[436.5,177],[437,180],[438,185],[439.5,188.5],[441.5,192.5],[443.5,195.5],[447,199.5],[448.5,201.5],[449.5,203],[449.5,204],[449,204.5],[448,205],[445,205],[442,205],[439.5,205],[435.5,205],[434,204],[433,203],[433,
201.5],[433,199.5],[434,197],[436,195.5],[437.5,195]],[1,204,["#cc6969",4,1],[447,174.5],[446.5,174.5],[446.5,176.5],[446.5,179],[446.5,181.5],[448.5,184],[449.5,185.5],[451.5,186],[453,186],[455,186],[457.5,184.5],[459,183],[459.5,181.5],[459.5,179],[458,175.5],[456.5,173],[455,172],[453.5,171.5],[452,171.5],[449,173],[447.5,174.5],[447.5,177.5],[447.5,179]],[1,205,["#cc6969",4,1],[466.5,173.5],[466,172.5],[467.5,170],[469,169.5],[471,169],[473,169],[475,170],[475.5,171],[475.5,174],[474.5,176.5],
[473,178],[472.5,179],[473,179],[476,178.5],[479,178.5],[481.5,179],[483.5,181],[484.5,182.5],[485.5,185],[485.5,186.5],[485,188.5],[484,190],[481.5,192],[479.5,192.5],[477,193],[474.5,193],[472,192.5],[469.5,192],[469,191.5],[468.5,190.5],[470,189],[471,188.5]],[1,206,["#cc6969",4,1],[488,171.5],[489.5,174.5],[491,178.5],[492.5,182],[494.5,186],[495.5,189.5],[496,191],[496.5,192.5],[496.5,193],[496.5,193.5]],[1,207,["#cc6969",4,1],[490,171.5],[491,169.5],[493.5,169],[496.5,169],[499,169.5],[501.5,
170],[503,171.5],[504.5,174],[505,175],[505,177],[504.5,178.5],[503.5,179.5],[502,180.5],[501.5,181.5],[499.5,181.5],[498.5,181.5],[498,181.5]],[1,208,["#cc6969",4,1],[512.5,168],[512.5,168],[512.5,169],[512.5,172],[513,173.5],[514,175.5],[514.5,177],[516.5,179],[517.5,179],[519,179],[519.5,179],[520.5,179],[522,176.5],[523,175],[523.5,173.5]],[1,209,["#cc6969",4,1],[525.5,166],[525.5,167],[525.5,169.5],[526.5,171.5],[527,173.5],[528,175.5],[528.5,177.5],[528.5,179],[529,179.5],[530,180],[530,180.5]],
[1,210,["#cc6969",4,1],[542.5,167.5],[542.5,168.5],[543.5,170.5],[544,174],[544.5,176],[545,177],[545,178],[545,178.5]],[1,211,["#cc6969",4,1],[536.5,168.5],[537,168],[537.5,168],[539,168],[543,167],[545.5,166],[547.5,165.5],[550,164.5],[551.5,164],[552,163.5],[552.5,163.5]],[1,212,["#cc6969",4,1],[564.5,174.5],[565.5,174],[567.5,172.5],[569.5,172],[570.5,171],[571.5,170],[572,169.5],[572,168.5],[572,168],[571,167.5],[569.5,166.5],[567.5,166.5],[566.5,166.5],[565,167],[564,168],[563,168.5],[561.5,
170],[561,171.5],[561,172.5],[561,174.5],[562,177],[563,179],[564,180],[565,180.5],[567,181],[568.5,181],[571,181],[572,180],[574,179.5],[576,179]],[1,213,["#cc6969",4,1],[587.5,165.5],[587,168.5],[586.5,170.5],[586.5,173],[586,175],[585,178],[585,179],[585,179.5],[585,180]],[1,214,["#cc6969",4,1],[589.5,164.5],[592,168.5],[594.5,172],[596,174],[597.5,176],[598.5,177.5],[599.5,179],[599.5,179.5],[600,180],[600,180.5]],[1,215,["#cc6969",4,1],[603,163.5],[602.5,163.5],[602.5,164.5],[603.5,166.5],[604.5,
169.5],[605,172.5],[606,175],[607,178],[607,179],[607,179.5],[607,180]],[1,216,["#cc6969",4,1],[606.5,170],[611.5,168.5],[613.5,168.5],[615.5,168.5],[618,170],[619.5,171],[620,173],[620,174.5],[620,175.5],[619,176.5],[617.5,177.5],[616,178.5],[615,179],[613.5,179],[613.5,179.5],[613,179.5]],[1,217,["#cc6969",4,1],[627.5,164],[630,170],[631,172.5],[631.5,174.5],[632.5,177],[633,178],[633,179],[633,180],[633.5,180]],[1,218,["#cc6969",4,1],[635,173.5],[635.5,173.5],[637.5,173],[638.5,172.5],[639,172.5],
[639.5,172],[640,172]],[1,219,["#cc6969",4,1],[641.5,165],[641,165.5],[642,169],[642.5,171.5],[643,173.5],[644,175.5],[644,177],[645,178],[645.5,178.5],[646,179],[646.5,179],[647,179]],[1,220,["#cc6969",4,1],[661.5,168],[659,165],[657.5,163.5],[656.5,163],[654.5,162.5],[653,162.5],[652.5,163],[651,163.5],[650.5,165],[650.5,166.5],[650.5,170],[650.5,172.5],[651,174.5],[652.5,177],[653,178],[654,179],[655,179],[656,179],[657.5,178.5],[659,177],[659.5,175.5],[660.5,174],[661,171.5],[661,169.5],[661,
168],[661,167],[661,167.5],[662,169],[662,171],[662.5,174.5],[662.5,176],[663,177],[663,178.5],[663.5,179],[663.5,179],[664,179],[664,179.5]],[1,221,["#cc6969",4,1],[672.5,172.5],[672.5,173.5],[673,174.5],[673,176],[674,176.5],[675,177],[676,177],[678,175],[679,174.5],[681,172.5],[682,171],[683.5,169.5],[684,166],[684,164.5],[684,163],[684,161.5],[683,160.5],[682,160],[680.5,159.5],[679,159.5],[677.5,160],[675.5,161],[675,162],[675,163],[675,163.5],[675.5,165],[676.5,165.5],[677.5,166.5],[679,167.5],
[680,168],[682.5,168.5],[684.5,169],[686.5,169.5],[688.5,170],[690.5,171],[690.5,172],[691,172.5],[691,173.5],[690.5,174.5],[690,175.5],[689.5,176.5],[689.5,177]],[1,222,["#cc6969",4,1],[395.5,234],[395.5,231],[395.5,230.5],[395.5,230],[395.5,229.5],[395.5,230.5],[395.5,231],[394.5,235.5],[394,240.5],[393,246.5],[392,253],[391.5,258.5],[391,264.5],[391,267.5],[391,269],[391,269.5],[391,268.5],[391,266.5]],[1,223,["#cc6969",4,1],[397.5,233.5],[397.5,232.5],[397.5,232],[397.5,231.5],[397.5,231],[397.5,
231.5],[398.5,233],[399.5,235],[400.5,238.5],[402.5,244],[404,248.5],[404.5,253],[406,257],[406.5,259.5],[407.5,263],[408,264.5],[408,265.5],[408,266],[408,265.5],[408,264.5],[408,264],[407.5,262.5],[407.5,262]],[1,224,["#cc6969",4,1],[397,255],[398,255],[399,255],[400,254],[401,253.5],[402,253.5],[403,253.5]],[1,225,["#cc6969",4,1],[415,246],[414.5,245.5],[415,246.5],[416,248.5],[417.5,252.5],[419,257.5],[419.5,260.5],[420,262.5],[420,264],[420,265],[420,265.5],[420,264.5],[420,264]],[1,226,["#cc6969",
4,1],[424,244],[426,244.5],[426,245.5],[426,246.5],[426,249],[425.5,251],[424.5,253],[424,254.5],[423.5,256],[423,257],[422.5,257.5],[422,258],[422,258.5],[422.5,258.5],[423,258.5],[423.5,258.5],[424.5,259],[426.5,260],[428,261],[430,262],[430.5,262.5],[432,263],[433,264]],[1,227,["#cc6969",4,1],[438,246.5],[439,251],[441,254],[442,256.5],[443,258.5],[443.5,260.5],[443.5,261.5],[443.5,262],[443.5,262],[443.5,261.5]],[1,228,["#cc6969",4,1],[433,248],[433.5,248],[434,248],[436.5,248],[439,247],[441,
246.5],[443.5,245.5],[446,244.5],[447,244],[447.5,244],[448,244]],[1,229,["#cc6969",4,1],[455.5,245.5],[455.5,246.5],[456,248.5],[456.5,251],[457.5,253],[458.5,255],[460.5,257.5],[461.5,258],[463,258],[464.5,257.5],[465.5,256],[465.5,254.5],[466,253],[466,250.5],[466,248.5],[466,246],[465.5,245],[465.5,244],[465.5,243.5],[465.5,244],[465.5,246],[466,248.5],[467.5,252.5],[468,255],[469,257],[470,258.5],[470,259.5],[470.5,259.5],[471,259.5]],[1,230,["#cc6969",4,1],[477,243.5],[479,241],[480,240],[481,
239],[483.5,237],[486.5,233],[488,231],[489,229],[489.5,227],[489.5,225.5],[488,224],[486,223],[484,222.5],[482,222.5],[479,224.5],[476.5,226],[474.5,228.5],[473.5,231.5],[472.5,235],[472.5,238],[473.5,243.5],[474.5,246.5],[475.5,250],[478.5,254],[480.5,256],[482,257.5],[484,258],[485.5,258],[487,258],[489,256],[490,254.5],[490.5,252.5],[490.5,249.5],[490.5,248],[489.5,246.5],[487.5,245],[486,244.5],[484.5,244],[482,245.5],[480.5,247],[479.5,249],[479.5,250]],[1,231,["#cc6969",4,1],[497,242],[497.5,
243.5],[498.5,245.5],[499,248],[500,250.5],[501,252.5],[501,255],[501.5,255],[502,255.5]],[1,232,["#cc6969",4,1],[503,249.5],[504.5,249.5],[505.5,249],[506.5,248.5],[507.5,248.5],[507.5,248.5],[508,247.5],[508.5,247]],[1,233,["#cc6969",4,1],[510,242],[510,244],[510.5,246],[511,248],[511.5,251],[512,252],[512.5,253],[513,253.5],[513.5,253.5],[514,253.5]],[1,234,["#cc6969",4,1],[518,243],[518,246],[518.5,248.5],[520,250.5],[520.5,251.5],[521.5,252.5],[523,253],[524,253],[525,253],[526,252.5],[527,251],
[528.5,248.5],[529.5,247],[529.5,245.5],[529.5,244],[529,242],[527.5,241],[526.5,239.5],[525,239.5],[523,239],[520.5,239],[518,239.5],[517,241],[516.5,242.5],[517.5,245.5]],[1,235,["#cc6969",4,1],[546.5,239.5],[546,238.5],[545,237.5],[543,237.5],[542,237],[540.5,237],[539,238],[538,241.5],[538,244],[538,246.5],[539.5,248.5],[542,250.5],[544.5,251],[547,251],[549.5,250.5],[551,249],[553.5,247.5]],[1,236,["#cc6969",4,1],[560,238.5],[559.5,239.5],[560,242],[560,244],[560.5,246.5],[561,248.5],[561.5,
249.5],[561.5,250],[562,250.5],[562,250]],[1,237,["#cc6969",4,1],[556.5,238.5],[555,238],[555.5,238],[556,238],[557.5,238],[559.5,238],[561,237.5],[563,237.5],[565.5,237.5],[566.5,237.5],[567.5,237]],[1,238,["#cc6969",4,1],[576,235],[576,236.5],[577,238.5],[577.5,240.5],[578,243],[578.5,245],[579.5,247],[580,248],[580,248.5],[580,248.5],[580,248]],[1,239,["#cc6969",4,1],[580.5,242],[583.5,240],[586,240],[587.5,240],[589,241],[590.5,241.5],[591,242.5],[592,243.5],[592,244],[592,244.5],[592,245],[591,
246],[590.5,246.5],[589,247],[588.5,248],[587,248],[586,248.5]]];
GPAssets_.ANTICHEAT_FORGERY_PLACEHOLDER=[...GPAssets_.GIRL_PORTRAIT_PLACEHOLDER,[1,200,["#cc6969",4,1],[425,196.5],[425,200],[425.5,203.5],[426.5,207.5],[427,212.5],[427.5,217],[427.5,221.5],[428,226],[428,228.5],[428,230.5],[428,230.5],[428,230.5],[428,230]],[1,201,["#cc6969",4,1],[427.5,196.5],[427.5,196],[428.5,196],[430,196],[432.5,196],[436.5,195],[439,195],[440.5,194.5],[442,194.5],[442.5,194.5],[443,194.5],[443,195],[443,195.5],[442.5,196],[442.5,198.5],[442.5,201],[442.5,203.5],[442.5,206],
[442.5,209.5],[443,214],[443,217],[443,220],[443,222.5],[443,226],[443.5,227.5],[444,228],[444,229],[444.5,229],[444.5,229.5],[444.5,229],[444.5,228.5]],[1,202,["#cc6969",4,1],[458,212.5],[457,213.5],[456.5,216.5],[456.5,219],[456.5,221],[456.5,223],[457.5,224.5],[460,226.5],[461.5,227],[463.5,227.5],[465.5,227],[468,226],[468.5,225],[470,222.5],[470.5,220.5],[471,218.5],[470.5,215],[470,213.5],[468,212.5],[466.5,211.5],[463.5,211.5],[461.5,211.5],[460.5,212.5],[459.5,214],[459.5,215]],[1,203,["#cc6969",
4,1],[492,214],[491,212],[490.5,211],[488,211],[486.5,211],[484,211.5],[483,213],[482,215],[481,217.5],[480.5,221.5],[481,223.5],[482,225.5],[485,227],[487,227.5],[489,227.5],[490.5,227],[491.5,226],[493,223.5],[493.5,221.5],[494,218.5],[494,216],[494,214.5],[494,215],[494,216],[494.5,217],[495,220],[496,225],[497.5,228.5],[499.5,232.5],[501.5,235.5],[505,239.5],[506.5,241.5],[507.5,243],[507.5,244],[507,244.5],[506,245],[503,245],[500,245],[497.5,245],[493.5,245],[492,244],[491,243],[491,241.5],
[491,239.5],[492,237],[494,235.5],[495.5,235]],[1,204,["#cc6969",4,1],[518,213],[517,211],[516.5,210],[514,210],[512.5,210],[510,210.5],[509,212],[508,214],[507,216.5],[506.5,220.5],[507,222.5],[508,224.5],[511,226],[513,226.5],[515,226.5],[516.5,226],[517.5,225],[519,222.5],[519.5,220.5],[520,217.5],[520,215],[520,213.5],[520,214],[520,215],[520.5,216],[521,219],[522,224],[523.5,227.5],[525.5,231.5],[527.5,234.5],[531,238.5],[532.5,240.5],[533.5,242],[533.5,243],[533,243.5],[532,244],[529,244],[526,
244],[523.5,244],[519.5,244],[518,243],[517,242],[517,240.5],[517,238.5],[518,236],[520,234.5],[521.5,234]],[1,205,["#cc6969",4,1],[536.5,217.5],[537.5,217],[539.5,215.5],[541.5,215],[542.5,214],[543.5,213],[544,212.5],[544,211.5],[544,211],[543,210.5],[541.5,209.5],[539.5,209.5],[538.5,209.5],[537,210],[536,211],[535,211.5],[533.5,213],[533,214.5],[533,215.5],[533,217.5],[534,220],[535,222],[536,223],[537,223.5],[539,224],[540.5,224],[543,224],[544,223],[546,222.5],[548,222]],[1,206,["#cc6969",4,
1],[560.5,209.5],[560,212.5],[559.5,214.5],[559.5,217],[559,219],[558,222],[558,223],[558,223.5],[558,224]],[1,207,["#cc6969",4,1],[562.5,208.5],[565,212.5],[567.5,216],[569,218],[570.5,220],[571.5,221.5],[572.5,223],[572.5,223.5],[573,224],[573,224.5]],[1,208,["#cc6969",4,1],[579,207],[578.5,206.5],[579,207.5],[580,209.5],[581.5,213.5],[583,218.5],[583.5,221.5],[584,223.5],[584,225],[584,226],[584,226.5],[584,225.5],[584,225]],[1,209,["#cc6969",4,1],[588,205],[590,205.5],[590,206.5],[590,207.5],
[590,210],[589.5,212],[588.5,214],[588,215.5],[587.5,217],[587,218],[586.5,218.5],[586,219],[586,219.5],[586.5,219.5],[587,219.5],[587.5,219.5],[588.5,220],[590.5,221],[592,222],[594,223],[594.5,223.5],[596,224],[597,225]],[1,210,["#cc6969",4,1],[614.5,211],[612,208],[610.5,206.5],[609.5,206],[607.5,205.5],[606,205.5],[605.5,206],[604,206.5],[603.5,208],[603.5,209.5],[603.5,213],[603.5,215.5],[604,217.5],[605.5,220],[606,221],[607,222],[608,222],[609,222],[610.5,221.5],[612,220],[612.5,218.5],[613.5,
217],[614,214.5],[614,212.5],[614,211],[614,210],[614,210.5],[615,212],[615,214],[615.5,217.5],[615.5,219],[616,220],[616,221.5],[616.5,222],[616.5,222],[617,222],[617,222.5]]];window.GPAssets_=GPAssets_;class GPAvatarEditor_ extends EventTarget{static AVATAR_WIDTH=42;static AVATAR_HEIGHT=50;static AVATAR_PADDING=1;static AVATAR_SMOOTH_DENSITY=2;static AVATAR_DENSITY=3;static AVATAR_FRAME_WIDTH=46;static AVATAR_FRAME_BORDER_WIDTH=2;static VIEWFINDER_WIDTH=374;static VIEWFINDER_HEIGHT=240;static OVERFLOWING_AREA_BORDER_WIDTH=2;static COLOR_PICKER_UPDATE_INTERVAL=50;static LIVE_PREVIEW_ENABLED=!0;static ZOOM_SENSITIVITY=1.03;static IMAGE_SMOOTHING_ENABLED=!0;static HAS_FOREGROUND=!0;static BACKGROUND_COLOR="#eaf1fd";static AVATAR_TYPE="image/webp";static AVATAR_QUALITY=1;static IMAGE_TYPES=new Set("image/jpeg image/png image/gif image/webp image/svg+xml image/bmp".split(" "));static IMAGE_TYPES_WITHOUT_TRANSPARENCY=["image/jpeg"];constructor(a,
b,c,d,e){super();this.updatePreview=this.updatePreview.bind(this);this.updatePreviewHandler=this.updatePreviewHandler.bind(this);this.handleFile=this.handleFile.bind(this);this.livePreviewEnabled=a??GPAvatarEditor_.LIVE_PREVIEW_ENABLED;this.zoomSensitivity=b??GPAvatarEditor_.ZOOM_SENSITIVITY;this.imageSmoothingEnabled=c??GPAvatarEditor_.IMAGE_SMOOTHING_ENABLED;this.hasForeground=d??GPAvatarEditor_.HAS_FOREGROUND;this.backgroundColor=e??GPAvatarEditor_.BACKGROUND_COLOR;this.isDragging=!1;this.render();
this.updateAvatarViews()}getElement(){return this.container}render(){this.container=document.createElement("div");this.container.className="avatar-editor";this.container.classList.toggle("has-foreground",this.hasForeground);this.container.style.setProperty("--av-editor-viewfinder-width",`${GPAvatarEditor_.VIEWFINDER_WIDTH}px`);this.container.style.setProperty("--av-editor-viewfinder-height",`${GPAvatarEditor_.VIEWFINDER_HEIGHT}px`);this.container.style.setProperty("--av-editor-focus-width",`${GPAvatarEditor_.AVATAR_WIDTH*
GPAvatarEditor_.AVATAR_DENSITY}px`);this.container.style.setProperty("--av-editor-focus-height",`${GPAvatarEditor_.AVATAR_HEIGHT*GPAvatarEditor_.AVATAR_DENSITY}px`);this.container.style.setProperty("--av-editor-focus-frame-width",`${GPAvatarEditor_.AVATAR_FRAME_WIDTH*GPAvatarEditor_.AVATAR_DENSITY}px`);this.container.style.setProperty("--av-editor-focus-frame-border-width",`${GPAvatarEditor_.AVATAR_FRAME_BORDER_WIDTH*GPAvatarEditor_.AVATAR_DENSITY}px`);this.container.style.setProperty("--av-editor-focus-frame-shadow-radius",
`${(Math.ceil(Math.sqrt(GPAvatarEditor_.VIEWFINDER_WIDTH**2+GPAvatarEditor_.VIEWFINDER_HEIGHT**2))-GPAvatarEditor_.AVATAR_FRAME_WIDTH)/2}px`);this.container.style.setProperty("--av-editor-overflowing-area-width",`${GPAvatarEditor_.AVATAR_WIDTH*GPAvatarEditor_.AVATAR_DENSITY+2*GPAvatarEditor_.OVERFLOWING_AREA_BORDER_WIDTH}px`);this.container.style.setProperty("--av-editor-overflowing-area-height",`${(GPAvatarEditor_.AVATAR_HEIGHT-GPAvatarEditor_.AVATAR_WIDTH/2)*GPAvatarEditor_.AVATAR_DENSITY+2*GPAvatarEditor_.OVERFLOWING_AREA_BORDER_WIDTH}px`);
this.container.style.setProperty("--av-editor-overflowing-area-border-width",`${GPAvatarEditor_.OVERFLOWING_AREA_BORDER_WIDTH}px`);this.container.style.setProperty("--av-editor-avatar-background",this.backgroundColor);this.viewfinder=document.createElement("div");this.viewfinder.className="viewfinder";this.container.appendChild(this.viewfinder);this.viewfinder.addEventListener("dropenter",()=>{},!0);this.viewfinder.addEventListener("dropleave",()=>{},!0);this.viewfinder.addEventListener("pointerdown",
e=>{0!==e.button||e.ctrlKey?(1===e.button||0===e.button&&e.ctrlKey)&&this.saveCanvas(this.buildAvatar()):(this.isDragging=!0,this.livePreviewEnabled||(this.clearViewfinderFocus(),this.focusFrame.classList.remove("rendered")),this.viewfinder.addEventListener("pointerup",g=>{this.isDragging=!1;this.updatePreviewHandler(g)},{once:!0}))});this.viewfinder.addEventListener("wheel",e=>{this.updatePreviewHandler(e);!this.livePreviewEnabled&&this.isDragging&&this.clearViewfinderFocus()});this.viewfinder.addEventListener("drop",
this.handleFile,!0);this.viewfinder.addEventListener("dragover",e=>{e.preventDefault();e.dataTransfer.dropEffect="move"},!0);this.source=document.createElement("canvas");this.source.className="source";this.source.width=GPAvatarEditor_.VIEWFINDER_WIDTH;this.source.height=GPAvatarEditor_.VIEWFINDER_HEIGHT;this.viewfinder.appendChild(this.source);this.sourceCtx=this.source.getContext("2d");this.zoomer=new GPCanvasZoomer_(this.source,null,this.zoomSensitivity);this.zoomer.addEventListener("change",this.updatePreviewHandler);
var a=document.createElement("div");a.className="blackout";this.viewfinder.appendChild(a);a=document.createElement("div");a.className="overflowing-area";this.viewfinder.appendChild(a);this.focusFrame=document.createElement("div");this.focusFrame.className="focus-frame";this.viewfinder.appendChild(this.focusFrame);this.focus=document.createElement("canvas");this.focus.className="focus";this.focus.width=GPAvatarEditor_.AVATAR_WIDTH*GPAvatarEditor_.AVATAR_DENSITY*2;this.focus.height=GPAvatarEditor_.AVATAR_HEIGHT*
GPAvatarEditor_.AVATAR_DENSITY*2;this.viewfinder.appendChild(this.focus);this.focusCtx=this.focus.getContext("2d");this.focusCtx.imageSmoothingEnabled=this.imageSmoothingEnabled;this.focusCtx.imageSmoothingQuality="high";this.preview=document.createElement("div");this.preview.className="preview";this.preview.innerHTML='<div class="user"><div class="avatar"><div class="icon"></div></div></div>';this.container.appendChild(this.preview);this.previewAvatar=this.preview.querySelector(".icon");a=document.createElement("div");
a.className="buttons";this.fgModeBtn=document.createElement("div");this.fgModeBtn.className="fg-mode btn";this.fgModeBtn.title="\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0440\u0435\u0436\u0438\u043c \u0441 \u0437\u0430\u0445\u043e\u0434\u043e\u043c \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0437\u0430 \u043f\u0440\u0435\u0434\u0435\u043b\u044b \u0440\u0430\u043c\u043a\u0438 \u0441\u0432\u0435\u0440\u0445\u0443";this.fgModeBtn.addEventListener("click",this.toggleForegroundMode.bind(this));
a.appendChild(this.fgModeBtn);var b=document.createElement("div");b.className="mirror btn";b.title="\u041e\u0442\u0440\u0430\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043e \u0433\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u0438";b.addEventListener("click",e=>{this.mirror()});a.appendChild(b);const c=document.createElement("input");c.className="bg-color-input";c.type="color";c.addEventListener("input",e=>{this.container.style.setProperty("--av-editor-avatar-background",
e.target.value);clearTimeout(this.bgColorTimer);this.bgColorTimer=setTimeout(()=>{this.setBackground(e.target.value)},GPAvatarEditor_.COLOR_PICKER_UPDATE_INTERVAL)});c.addEventListener("change",e=>{clearTimeout(this.bgColorTimer);this.setBackground(e.target.value)});b=document.createElement("div");b.className="bg-color btn";b.title="\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u043e\u043d (\u043a\u0440\u0443\u0433 \u043f\u043e\u0434 \u0430\u0432\u0430\u0442\u0430\u0440\u043e\u043c)";b.appendChild(c);
b.addEventListener("click",e=>{c.showPicker()});a.appendChild(b);const d=document.createElement("input");d.className="open-image-input";d.type="file";d.accept=[...GPAvatarEditor_.IMAGE_TYPES].join();d.addEventListener("change",this.handleFile);b=document.createElement("div");b.className="open-image btn";b.title="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430";b.addEventListener("click",
e=>{d.click()});a.appendChild(b);this.container.appendChild(a)}buildAvatar(){const a=GPAvatarEditor_.AVATAR_SMOOTH_DENSITY;var b=GPAvatarEditor_.AVATAR_WIDTH*GPAvatarEditor_.AVATAR_DENSITY*a,c=GPAvatarEditor_.AVATAR_HEIGHT*GPAvatarEditor_.AVATAR_DENSITY*a;const d=b/2,e=document.createElement("canvas");e.width=b;e.height=c;var g=e.getContext("2d");g.beginPath();g.arc(d,c-d,d,0,2*Math.PI);g.fill();this.hasForeground&&g.fillRect(0,0,b,c-b/2);g=document.createElement("canvas");g.width=b;g.height=c;const f=
g.getContext("2d");f.fillStyle=this.backgroundColor;f.beginPath();f.arc(d,c-d,d,0,2*Math.PI);f.fill();f.drawImage(this.source,(GPAvatarEditor_.VIEWFINDER_WIDTH-b/a)/2,(GPAvatarEditor_.VIEWFINDER_HEIGHT-(c/a*2-b/a))/2,b/a,c/a,0,0,b,c);f.globalCompositeOperation="destination-in";f.drawImage(e,0,0);b=document.createElement("canvas");b.width=g.width/a+2*GPAvatarEditor_.AVATAR_PADDING*GPAvatarEditor_.AVATAR_DENSITY;b.height=g.height/a;c=b.getContext("2d");c.imageSmoothingEnabled=this.imageSmoothingEnabled;
c.imageSmoothingQuality="high";c.drawImage(g,GPAvatarEditor_.AVATAR_PADDING*GPAvatarEditor_.AVATAR_DENSITY,0,g.width/a,g.height/a);return b}saveCanvas(a){const b=document.createElement("canvas");b.width=a.width;b.height=a.height;b.getContext("2d").drawImage(a,0,0,a.width,a.height);a=document.createElement("a");a.href=b.toDataURL(GPAvatarEditor_.AVATAR_TYPE,GPAvatarEditor_.AVATAR_QUALITY);a.download=`gp-avatar.${GPAvatarEditor_.AVATAR_TYPE.split("/")[1]}`;a.click()}updatePreviewHandler(a){"change"!==
a.type&&0!==a.button||!this.livePreviewEnabled&&"pointerup"!==a.type&&"wheel"!==a.type||this.updateAvatarViews()}updateAvatarViews(){this.updateViewfinderFocus();this.updatePreview()}updatePreview(){const a=this.buildAvatar().toDataURL(GPAvatarEditor_.AVATAR_TYPE,GPAvatarEditor_.AVATAR_QUALITY);this.previewAvatar.style.backgroundImage=`url(${a})`}updateViewfinderFocus(){this.focusFrame.classList.add("rendered");this.focusCtx.save();const a=GPAvatarEditor_.AVATAR_WIDTH*GPAvatarEditor_.AVATAR_DENSITY*
2,b=GPAvatarEditor_.AVATAR_HEIGHT*GPAvatarEditor_.AVATAR_DENSITY*2,c=a/2,d=document.createElement("canvas");d.width=a;d.height=b;const e=d.getContext("2d");e.beginPath();e.arc(c,b-c,c,0,2*Math.PI);e.fill();this.hasForeground&&e.fillRect(0,0,a,b-a/2);this.focusCtx.clearRect(0,0,a,b);this.focusCtx.fillStyle=this.backgroundColor;this.focusCtx.beginPath();this.focusCtx.arc(c,b-c,c,0,2*Math.PI);this.focusCtx.fill();this.focusCtx.drawImage(this.source,(GPAvatarEditor_.VIEWFINDER_WIDTH-a/2)/2,(GPAvatarEditor_.VIEWFINDER_HEIGHT-
(b/2*2-a/2))/2,a/2,b/2,0,0,a,b);this.focusCtx.globalCompositeOperation="destination-in";this.focusCtx.drawImage(d,0,0);this.focusCtx.restore()}clearViewfinderFocus(){this.focusCtx.clearRect(0,0,this.focus.width,this.focus.height)}setSource(a){const b=new Image;b.src=a;b.decode().then(()=>{this.zoomer.setImage(b);this.clearViewfinderFocus();this.up})}async imageCantHaveAlphaChannel(a){return GPAvatarEditor_.IMAGE_TYPES_WITHOUT_TRANSPARENCY.includes(a.type)?!0:"image/png"===a.type?(a=await a.arrayBuffer(),
!this.pngHasAlpha(a)):!1}pngHasAlpha(a){a=new DataView(a);if(2303741511===a.getUint32(0)&&218765834===a.getUint32(4))return a=a.getUint8(25),4===a||6===a}async handleFile(a){a.preventDefault();a=a.target.files||a.dataTransfer.files;if(a?.length&&(a=Array.from(a).find(b=>GPAvatarEditor_.IMAGE_TYPES.has(b.type)))){const b=await this.imageCantHaveAlphaChannel(a);b&&this.setForegroundState(!1);this.changeFgModeBtnState(b);const c=new FileReader;c.addEventListener("loadend",d=>{this.setSource(c.result)});
c.readAsDataURL(a)}}setLivePreview(a){this.livePreviewEnabled=!!a}setBackground(a){this.backgroundColor=a;this.isDragging||this.updateAvatarViews();this.dispatchEvent(new CustomEvent("background-color-changed",{detail:{backgroundColor:a}}))}setForegroundState(a){a!==this.hasForeground&&(this.hasForeground=a,this.container.classList.toggle("has-foreground",this.hasForeground),this.updateAvatarViews(),this.dispatchEvent(new CustomEvent("foreground-mode-changed",{detail:{foregroundMode:a}})))}setZoomSensitivity(a){this.zoomSensitivity=
a;this.zoomer.setScaleFactor(a)}setImageSmoothing(a){this.imageSmoothingEnabled=!!a;this.focusCtx.imageSmoothingEnabled=!!a;this.updateAvatarViews()}toggleForegroundMode(){this.setForegroundState(!this.hasForeground)}changeFgModeBtnState(a){this.fgModeBtn.classList.toggle("disabled",!!a)}mirror(){this.zoomer.mirror();this.updateAvatarViews()}requestAvatar(){return new Promise(a=>{this.buildAvatar().toBlob(a,GPAvatarEditor_.AVATAR_TYPE,GPAvatarEditor_.AVATAR_QUALITY)})}}window.GPAvatarEditor_=GPAvatarEditor_;class GPAvatars_ extends EventTarget{static URL="https://gpmod.github.io/avatars/{service}/{filename}";static NOTICE_COLORS={REVIEW:11726246,REMOVAL:12467260};static REQUEST_TYPE={REVIEW:"review",REMOVAL:"removal"};static DEFAULT_SETTINGS={zoomSensitivity:1.03,livePreview:!0,imageSmoothing:!0,hasForeground:!1,backgroundColor:"#cb55e2"};static SETTINGS_UI={editor:{type:"component",args:[this.getEditor]},reviewButtons:{type:"buttons",args:[this.getButtons]},_1:{size:"small"},livePreview:{type:"checkbox",
description:"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044e \u043f\u0440\u0435\u0432\u044c\u044e \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438 \u043f\u043e\u0437\u0438\u0446\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0432 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0435)"},
zoomSensitivity:{type:"range",args:[1.01,1.1,.01],formatter:this.zoomSensitivityFormatter,description:"\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0432 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0435"},imageSmoothing:{type:"checkbox",description:"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0441\u0433\u043b\u0430\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f"}};static zoomSensitivityFormatter(a){return Math.trunc(100*
(a-1))}static getEditor(){return GPAvatars_.instance.getEditor()}static getButtons(){return[GPAvatars_.instance.reviewBtn,GPAvatars_.instance.removalBtn]}static MODULE={title:"Avatars",dependencies:["GPAvatarEditor_"],settings:{storage:"gp_avatars",defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){a.av=new GPAvatars_(a.gpproxy,a.sm,a.act)}constructor(a,b,c){if(GPAvatars_.instance)return GPAvatars_.instance;super();GPAvatars_.instance=this;this.gpproxy=a;this.act=c;this.s=
b.setSettings(this,this.updateSettings);this.avatarsStates=new Map;this.pendingStates=new Set;this.editor=new GPAvatarEditor_(this.s.livePreview,this.s.zoomSensitivity,this.s.imageSmoothing,this.s.hasForeground,this.s.backgroundColor);this.isSubscribed=!1;this.handlePlayer=this.handlePlayer.bind(this);this.handleAlbumItem=this.handleAlbumItem.bind(this);this.sendToReview=this.sendToReview.bind(this);this.submitRemovalRequest=this.submitRemovalRequest.bind(this);a=new GPPlayersObserver_(a);a.addHandler(this.handlePlayer);
a.addResultHandler(this.handlePlayer);a.addAlbumHandler(this.handleAlbumItem);this.editor.addEventListener("foreground-mode-changed",({detail:{foregroundMode:d}})=>{this.s.hasForeground=d});this.editor.addEventListener("background-color-changed",({detail:{backgroundColor:d}})=>{this.s.backgroundColor=d});document.addEventListener("_av_complete",({detail:{type:d}})=>{d===GPAvatars_.REQUEST_TYPE.REVIEW&&this.removalBtn.classList.remove("disabled_")},{once:!0});document.addEventListener("_av_complete",
({detail:{type:d}})=>{d===GPAvatars_.REQUEST_TYPE.REVIEW?this.reviewBtn.classList.add("complete_"):this.removalBtn.classList.add("complete_")});document.addEventListener("_subs_status",({detail:{status:d}})=>{this.isSubscribed=d;this.reviewBtn.classList.toggle("inactivated_",!d);this.removalBtn.classList.toggle("inactivated_",!d);GPAvatars_.toggleSettingsVisibility(d)});this.gpproxy.addEventListener("presets",()=>{this.gpproxy.isAuthorized&&(this.url=GPAvatars_.URL.replace("{service}",this.gpproxy.getAuthType()?.[0]))},
{once:!0});this.init()}init(){this.reviewBtn=document.createElement("div");this.reviewBtn.className="av-review-btn_";this.reviewBtn.classList.toggle("inactivated_",!this.isSubscribed);this.reviewBtn.title="\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043d\u0430 \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u0438\u0435";this.reviewBtn.textContent="\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c";this.reviewBtn.addEventListener("click",this.sendToReview);this.reviewBtn.addEventListener("animationend",
()=>{this.reviewBtn.classList.remove("complete_")});this.removalBtn=document.createElement("div");this.removalBtn.className="av-removal-btn_";this.removalBtn.classList.add("disabled_");this.removalBtn.classList.toggle("inactivated_",!this.isSubscribed);this.removalBtn.title="\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0430\u0432\u0430\u0442\u0430\u0440\u0430";
this.removalBtn.textContent="\u0423\u0434\u0430\u043b\u0438\u0442\u044c";this.removalBtn.addEventListener("click",this.submitRemovalRequest);this.removalBtn.addEventListener("animationend",()=>{this.removalBtn.classList.remove("complete_")});this.gpproxy.addEventListener("presets",()=>{if(this.gpproxy.isAuthorized){var a=this.formatUsername(this.gpproxy.getUser().nick);this.requestState(a,()=>{this.removalBtn.classList.remove("disabled_")})}},{once:!0})}sendToReview(){this.editor.requestAvatar().then(a=>
{this.sendRequest(GPAvatars_.REQUEST_TYPE.REVIEW,a)})}submitRemovalRequest(){this.sendRequest(GPAvatars_.REQUEST_TYPE.REMOVAL)}sendRequest(a,b){if(this.isSubscribed){var {authId:c,nick:d}=this.gpproxy.getUser(),e=this.gpproxy.getAuthType(),g=this.act.getKeyMark(),f=this.usernameHash(this.formatUsername(d));switch(a){case GPAvatars_.REQUEST_TYPE.REVIEW:a=new File([b],`${f}.${b.type.split("/")[1]}`);document.dispatchEvent(new CustomEvent("_av_review",{detail:{sender:d,senderId:c,service:e,keyMark:g,
imageFile:a,filename:f,noticeColor:GPAvatars_.NOTICE_COLORS.REVIEW}}));break;case GPAvatars_.REQUEST_TYPE.REMOVAL:document.dispatchEvent(new CustomEvent("_av_removal",{detail:{sender:d,senderId:c,service:e,keyMark:g,filename:f,noticeColor:GPAvatars_.NOTICE_COLORS.REMOVAL}}))}}}getEditor(){return this.editor.getElement()}handlePlayer(a){const b=a.querySelector(".avatar > span");a=a.querySelector(".nick")?.textContent;a=this.formatUsername(a);this.insertAvatar(a,b)}handleAlbumItem(a){const b=a.querySelector(".avatar > span");
a=a.querySelector(":scope > :not(.avatar) > span")?.textContent;a=this.formatUsername(a);this.insertAvatar(a,b)}insertAvatar(a,b){this.requestState(a,c=>{b.style.backgroundImage=`url(${c})`})}requestState(a,b){if(this.pendingStates.has(a)){const c=({detail:{username:d,avatarURL:e,isExists:g}})=>{d===a&&(g&&b(e),this.removeEventListener("state-changed",c))};this.addEventListener("state-changed",c)}else{const c=this.buildURL(a),d=this.getAvatarState(a);d?b(c):void 0===d&&(this.pendingStates.add(a),
fetch(c,{method:"HEAD"}).then(e=>{e.ok?(b(c),this.avatarsStates.set(a,!0)):this.avatarsStates.set(a,!1)}).finally(()=>{this.pendingStates.delete(a);this.dispatchEvent(new CustomEvent("state-changed",{detail:{username:a,avatarURL:c,isExists:this.avatarsStates.get(a)}}))}))}}buildURL(a){a=this.usernameHash(a);return this.url.replace("{filename}",a)}formatUsername(a){return this.gpproxy.isDiscordAuth()?a:a.toLowerCase()}usernameHash(a){let b=-559038721,c=1103547975;for(let d=0,e;d<a.length;d++)e=a.charCodeAt(d),
b=Math.imul(b^e,2654435761),c=Math.imul(c^e,1597334677);b=Math.imul(b^b>>>16,2246822507)^Math.imul(c^c>>>13,3266489909);c=Math.imul(c^c>>>16,2246822507)^Math.imul(b^b>>>13,3266489909);return(4294967296*(2097151&c)+(b>>>0)).toString(36)}getAvatarState(a){return this.avatarsStates.get(a)}updateSettings({detail:{settings:a}}){"livePreview"in a&&this.editor.setLivePreview(a.livePreview);"zoomSensitivity"in a&&this.editor.setZoomSensitivity(a.zoomSensitivity);"imageSmoothing"in a&&this.editor.setImageSmoothing(a.imageSmoothing)}}
window.GPAvatars_=GPAvatars_;class GPCanvasZoomer_ extends EventTarget{static SCALE_FACTOR=1.05;constructor(a,b,c){super();this.scaleFactor=c??GPCanvasZoomer_.SCALE_FACTOR;this.canvas=a;this.canvas.addEventListener("contextmenu",d=>{d.preventDefault()});this.canvas.addEventListener("pointerdown",d=>{d.preventDefault();2===d.button&&this.reset();0!==d.button||d.ctrlKey||(this.canvas.setPointerCapture(d.pointerId),this.lastX=d.offsetX,this.lastY=d.offsetY,this.dragStartPoint=this.ctx.transformedPoint(this.lastX,this.lastY))});
this.canvas.addEventListener("pointermove",d=>{this.lastX=d.offsetX;this.lastY=d.offsetY;this.dragStartPoint&&(d=this.ctx.transformedPoint(this.lastX,this.lastY),this.ctx.translate(d.x-this.dragStartPoint.x,d.y-this.dragStartPoint.y),this.redraw())});this.canvas.addEventListener("pointerup",d=>{this.dragStartPoint=null});this.canvas.addEventListener("wheel",d=>{this.zoom(-d.deltaY/40);d.preventDefault()});this.ctx=a.getContext("2d");this.ctx.imageSmoothingQuality="high";this.trackTransforms(this.ctx);
this.image=b;this.lastX=a.width/2;this.lastY=a.height/2;this.dragStartPoint;this.mirror=this.mirror.bind(this)}reset(){this.ctx.resetTransform();this.redraw()}redraw(){if(this.image){var a=this.ctx.transformedPoint(0,0),b=this.ctx.transformedPoint(this.canvas.width,this.canvas.height);this.ctx.clearRect(a.x,a.y,b.x-a.x,b.y-a.y);this.ctx.drawImage(this.image,-(this.image.width-this.canvas.width)/2,-(this.image.height-this.canvas.height)/2);this.dispatchEvent(new Event("change"))}}zoom(a){const b=this.ctx.transformedPoint(this.lastX,
this.lastY);this.ctx.translate(b.x,b.y);a=Math.pow(this.scaleFactor,a);this.ctx.scale(a,a);this.ctx.translate(-b.x,-b.y);this.redraw()}setTransform(a,b,c,d,e,g){this.ctx.setTransform(a,b,c,d,e,g);this.redraw()}trackTransforms(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg");let c=b.createSVGMatrix();a.getTransform=function(){return c};const d=[],e=a.save;a.save=function(){d.push(c.translate(0,0));return e.call(a)};const g=a.restore;a.restore=function(){c=d.pop();return g.call(a)};
const f=a.scale;a.scale=function(r,q){c=c.scaleNonUniform(r,q);return f.call(a,r,q)};const h=a.rotate;a.rotate=function(r){c=c.rotate(180*r/Math.PI);return h.call(a,r)};const k=a.translate;a.translate=function(r,q){c=c.translate(r,q);return k.call(a,r,q)};const l=a.transform;a.transform=function(r,q,y,A,z,t){const w=b.createSVGMatrix();w.a=r;w.b=q;w.c=y;w.d=A;w.e=z;w.f=t;c=c.multiply(w);return l.call(a,r,q,y,A,z,t)};const m=a.setTransform;a.setTransform=function(r,q,y,A,z,t){c.a=r;c.b=q;c.c=y;c.d=
A;c.e=z;c.f=t;return m.call(a,r,q,y,A,z,t)};const n=a.resetTransform;a.resetTransform=function(){c=b.createSVGMatrix();d.length=0;return n.call(a)};const p=b.createSVGPoint();a.transformedPoint=function(r,q){p.x=r;p.y=q;return p.matrixTransform(c.inverse())}}setImage(a){this.image=a;this.reset()}setScaleFactor(a){this.scaleFactor=a}mirror(){this.image&&(this.ctx.translate(this.canvas.width,0),this.ctx.scale(-1,1),this.ctx.drawImage(this.image,0,0),this.redraw())}};class GPAlbumObserver_{static MONITOR_INTERVAL=200;static ITEM_TYPE={IMAGE:"image",TEXT:"text",ANIMATION:"animation"};constructor(a){if(GPAlbumObserver_.instance)return GPAlbumObserver_.instance;GPAlbumObserver_.instance=this;this.gpproxy=a;this.isInitialized=!1;this.monitorTimer;this.inObserving=!1;this.nextItemId=null;this.items=[];this.observerConfig={childList:!0,subtree:!0};this.observer=new MutationObserver(this.observerCallback.bind(this));this.handlers=new Set}init(){this.gpproxy.addEventListener("album_rejoin",
a=>{this.gpproxy.isAuthorized&&this.startMonitor()});this.gpproxy.addEventListener("data",({detail:{event:a}})=>{this.gpproxy.isAuthorized&&(a===GPProxy_.EVENT.ALBUM_INFO?(this.nextItemId=null,this.items.length=0):a===GPProxy_.EVENT.GALLERY_SETTINGS?this.startMonitor():[GPProxy_.EVENT.NEW_GAME,GPProxy_.EVENT.ALBUM_SCORE,GPProxy_.EVENT.GAME_QUIT,GPProxy_.EVENT.GAME_STARTED].includes(a)&&(this.stopMonitor(),this.terminate()))});this.gpproxy.addEventListener("album_item_loading",({detail:{id:a}})=>{this.nextItemId=
a});this.isInitialized=!0}terminate(){this.nextItemId=null;this.items.length=0}addHandler(a){this.handlers.add(a);this.isInitialized||this.init()}removeHandler(a){this.handlers.remove(a)}getItems(){return this.items}startMonitor(){if(!this.inObserving){var a=document.querySelector(".scrapbook");a?(this.observer.observe(a,this.observerConfig),this.inObserving=!0):this.monitorTimer=setTimeout(()=>{this.startMonitor()},GPAlbumObserver_.MONITOR_INTERVAL)}}stopMonitor(){clearTimeout(this.monitorTimer);
this.inObserving&&(this.observer.disconnect(),this.inObserving=!1)}observerCallback(a,b){for(const c of a)if("childList"===c.type&&c.addedNodes.length&&c.target.classList.contains("scrollElements")&&c.addedNodes[0].classList.contains("item")){const d=c.addedNodes[0];this.items.push(d);a=this.nextItemId??[...d.parentElement.children].filter(e=>e.classList.contains("item")).indexOf(d);b=null;d.querySelector(":scope > .drawing")?b=GPAlbumObserver_.ITEM_TYPE.IMAGE:d.querySelector(":scope > .answer")?
b=GPAlbumObserver_.ITEM_TYPE.TEXT:d.querySelector(":scope > section > .animationmode")&&(b=GPAlbumObserver_.ITEM_TYPE.ANIMATION);d.dataset.id=a;d.dataset.type=b;this.handlers.forEach(e=>e(d))}}}window.GPAlbumObserver_=GPAlbumObserver_;class GPImageReportSender_ extends EventTarget{static ANTI_CHEAT="ANTI_CHEAT";static BAN="BAN";static EVENTS={ANTI_CHEAT:"_ac_report",BAN:"_ban_report"};static COLORS={ANTI_CHEAT:5358253,BAN:12467260};static ITEM_TYPE={IMAGE:1,TEXT:2};constructor(a,b,c){super();this.gpproxy=b;this.eventType=GPImageReportSender_.EVENTS[a];this.noticeColor=GPImageReportSender_.COLORS[a];this.keyMark=c.getKeyMark();this.twitchIdsCache=new Map;this.reportedItems=new Set;document.addEventListener("_tw_ids_usernames",({detail:{usernamesMap:d}})=>
{this.updateTwitchIdsCache(d)});this.gpproxy.addEventListener("data",({detail:{event:d}})=>{d===GPProxy_.EVENT.GALLERY_SETTINGS&&this.reportedItems.clear()})}async send({itemId:a,albumId:b,...c}){var d=`${b}_${a}`;if(!this.reportedItems.has(d)){this.reportedItems.add(d);var e=this.gpproxy.getAlbumItem(a,b);if(e){var {authId:g,nick:f}=this.gpproxy.getUser(),{meta:{author:h,title:k,date:l},data:m,type:n}=e,p=(new Date(l)).toLocaleDateString("ru-RU");d=n===GPImageReportSender_.ITEM_TYPE.IMAGE;switch(n){case GPImageReportSender_.ITEM_TYPE.IMAGE:var r=
`${h} - ${k} (${p})`;p=await GPUtils_.compressImageData(e);r=new File([p],`${r}.gpimg`);break;case GPImageReportSender_.ITEM_TYPE.TEXT:r=`${h} - ${m} (${p})`,p=new Blob([m],{type:"text/plain"}),r=new File([p],`${r}.txt`)}p=Object.keys(GPProxy_.AUTH_TYPE_IDS).find(y=>GPProxy_.AUTH_TYPE_IDS[y]===e.auth);var q=this.gpproxy.isTwitchAuth()?this.twitchIdsCache.get(h.toLowerCase())??null:null;document.dispatchEvent(new CustomEvent(this.eventType,{detail:{noticeColor:this.noticeColor,author:h,authorId:q,
sender:f,senderId:g,itemData:e,sourceFile:r,service:p,itemId:a,albumId:b,isImage:d,gameCode:this.gpproxy.getGameCode(),keyMark:this.keyMark,...c}}))}}}updateTwitchIdsCache(a){a.forEach((b,c)=>{this.twitchIdsCache.set(b,c)})}}window.GPImageReportSender_=GPImageReportSender_;class GPPlayersObserver_ extends EventTarget{static MONITOR_INTERVAL=200;static SCREEN={START:"start",LOBBY:"lobby",FIRST:"first",DRAW:"draw",WRITE:"write",BOOK:"book",RESULT:"result"};static OBSERVED_SCREENS=new Set([this.SCREEN.LOBBY,this.SCREEN.BOOK,this.SCREEN.RESULT]);constructor(a){if(GPPlayersObserver_.instance)return GPPlayersObserver_.instance;super();GPPlayersObserver_.instance=this;this.gpproxy=a;this.isInitialized=!1;this.monitorTimer;this.inObserving=!1;this.observerConfig={childList:!0,
subtree:!0};this.observer=new MutationObserver(this.observerCallback.bind(this));this.albumObserverConfig={childList:!0,subtree:!0};this.albumObserver=new MutationObserver(this.albumObserverCallback.bind(this));this.currentScreen=null;this.playerItems=new Map;this.handlers=new Set;this.resultHandlers=new Set;this.albumHandlers=new Set}init(){const a=new MutationObserver((b,c)=>{for(const d of b)if(b=d.addedNodes?.[0],b?.classList.contains("screen")){b=[...b.firstElementChild.classList].find(e=>!e.startsWith("jsx-"));
if(!b)break;b!==this.currentScreen&&this.dispatchEvent(new Event("screen-changed"));this.currentScreen=b;GPPlayersObserver_.OBSERVED_SCREENS.has(b)?(this.stopMonitor(),this.startMonitor()):this.stopMonitor()}});this.gpproxy.addEventListener("presets",()=>{this.gpproxy.isAuthorized&&(a.observe(document.getElementById("content"),{childList:!0}),this.gpproxy.isGameStages(GPProxy_.GAME_STAGE.LOBBY,GPProxy_.GAME_STAGE.ALBUM,GPProxy_.GAME_STAGE.SCORE)&&this.startMonitor())},{once:!0});this.addEventListener("screen-changed",
()=>{this.playerItems.clear()});this.isInitialized=!0}addHandler(a){this.handlers.add(a);this.isInitialized||this.init()}addResultHandler(a){this.resultHandlers.add(a)}addAlbumHandler(a){this.albumHandlers.add(a)}getPlayerItems(){return this.playerItems}startMonitor(){if(!this.inObserving){var a=document.querySelector(".players");a?(this.observer.observe(a,this.observerConfig),this.inObserving=!0,this.handlePlayers(a),this.currentScreen===GPPlayersObserver_.SCREEN.BOOK&&this.albumHandlers.size?(a=
a.parentElement.querySelector(":scope > .scrapbook > .timeline"),this.albumObserver.observe(a,this.albumObserverConfig),this.handleAlbum(a)):this.currentScreen===GPPlayersObserver_.SCREEN.RESULT&&this.resultHandlers.size&&(a=a.parentElement.querySelector(".ranking"),this.handleResult(a))):this.monitorTimer=setTimeout(()=>{this.startMonitor()},GPPlayersObserver_.MONITOR_INTERVAL)}}stopMonitor(){clearTimeout(this.monitorTimer);this.inObserving&&(this.observer.disconnect(),this.albumObserver.disconnect(),
this.inObserving=!1)}observerCallback(a,b){for(const c of a)if("childList"===c.type&&c.addedNodes.length&&c.target.classList.contains("scrollElements")&&c.addedNodes[0].matches(".user:not(.empty)")){const d=c.addedNodes[0];this.handlers.forEach(e=>{this.cachePlayer(d);e(d)})}}albumObserverCallback(a,b){for(const c of a)"childList"===c.type&&c.addedNodes.length&&1===c.addedNodes[0].nodeType&&c.addedNodes[0].matches(".item:has(> :is(.answerBalloon, .drawBalloon))")&&this.albumHandlers.forEach(d=>{d(c.addedNodes[0].firstElementChild)})}cachePlayer(a){const b=
a.querySelector(".nick")?.textContent;b&&this.playerItems.set(b,a)}handlePlayers(a){a=a.querySelectorAll(".user:not(.empty)");Array.from(a).forEach(b=>{this.handlers.forEach(c=>{this.cachePlayer(b);c(b)})})}handleResult(a){a=a.querySelectorAll(".user");Array.from(a).forEach(b=>{this.resultHandlers.forEach(c=>c(b))})}handleAlbum(a){a=a.querySelectorAll(".item > :is(.answerBalloon, .drawBalloon)");Array.from(a).forEach(b=>{this.albumHandlers.forEach(c=>c(b))})}}window.GPPlayersObserver_=GPPlayersObserver_;class GPUtils_{static async compressImageData(a,b=!0){const {data:c,background:d,auth:e,meta:g}=a;a={m:{a:g.author,t:g.title,d:(new Date(g.date)).toISOString()},d:c};d&&(a.b=d);e&&(a.a=e);return b?this.wCompressData(a):this.compressData(a)}static async compressData(a){a=JSON.stringify(a);a=this.stringToArrayBuffer(a);a=await this.compressArrayBuffer(a);return this.arrayBufferToBlob(a)}static arrayBufferToBlob(a){return new Blob([a],{type:"octet/stream"})}static async compressArrayBuffer(a){var b=
new CompressionStream("deflate"),c=b.writable.getWriter();c.write(a);c.close();a=[];b=b.readable.getReader();for(c=0;;){const {value:d,done:e}=await b.read();if(e)break;a.push(d);c+=d.byteLength}b=new Uint8Array(c);c=0;for(const d of a)b.set(d,c),c+=d.byteLength;return b}static stringToArrayBuffer(a){return(new TextEncoder).encode(a)}static async decompressFile(a){return JSON.parse(await this.decompressBlob(a))}static async decompressBlob(a){let b=new DecompressionStream("deflate");a=a.stream().pipeThrough(b);
return await (new Response(a)).text()}static saveBlob(a,b=""){a=window.URL.createObjectURL(a);const c=document.createElement("a");c.href=a;c.download=b;c.click();window.URL.revokeObjectURL(a)}static wCompressData(a){return new Promise(b=>{const c=this.createWorker(this.compressWorkerBody);c.addEventListener("message",({data:d})=>{c.terminate();b(d)});c.postMessage(a)})}static compressWorkerBody(){self.work=new async function(){}.constructor("a",'a=JSON.stringify(a);a=(new TextEncoder).encode(a);var c=new CompressionStream("deflate"),b=c.writable.getWriter();b.write(a);b.close();a=[];c=c.readable.getReader();for(b=0;;){const {value:d,done:e}=await c.read();if(e)break;a.push(d);b+=d.byteLength}c=new Uint8Array(b);b=0;for(const d of a)c.set(d,b),b+=d.byteLength;return new Blob([c],{type:"octet/stream"})');
self.addEventListener("message",async({data:a})=>{self.postMessage(await self.work(a))})}static createWorker(a){a=URL.createObjectURL(new Blob([this.getFuncBody(a)]));const b=new Worker(a);URL.revokeObjectURL(a);return b}static getFuncBody(a){a=a.toString();return a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))}}window.GPUtils_=GPUtils_;class GPGlobalBanlist_ extends EventTarget{static RAID_WARNING_MESSAGE="\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!\n\u0412 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u043d\u0430 \u0441\u0442\u0440\u0438\u043c\u0435\u0440\u043e\u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u0440\u0435\u0439\u0434 \u0441 \u0446\u0435\u043b\u044c\u044e \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u0435\u0449\u0451\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430. \u0411\u0443\u0434\u044c\u0442\u0435 \u043e\u0441\u0442\u043e\u0440\u043e\u0436\u043d\u044b \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0438\u0433\u0440\u043e\u043a\u0430\u043c\u0438.";static PERSONAL_RAID_WARNING_MESSAGE="\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!\n\u041d\u0430 \u0412\u0430\u0448 \u0441\u0442\u0440\u0438\u043c \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u0440\u0435\u0439\u0434 \u0441 \u0446\u0435\u043b\u044c\u044e \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0437\u0430\u043f\u0440\u0435\u0449\u0451\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430. \u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043a \u0431\u0430\u043d\u0443 \u043a\u0430\u043d\u0430\u043b\u0430. \u0411\u0443\u0434\u044c\u0442\u0435 \u043e\u0441\u0442\u043e\u0440\u043e\u0436\u043d\u044b \u043f\u0440\u0438 \u0438\u0433\u0440\u0435 \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0438\u0433\u0440\u043e\u043a\u0430\u043c\u0438.";static RAID_NOTICE_OPTIONS={type:GPAbout_.NOTICE_TYPE.NORMAL,
text:this.RAID_WARNING_MESSAGE,textColor:"#fff",bgColor:"#d64242",width:344};static PERSONAL_RAID_NOTICE_OPTIONS={type:GPAbout_.NOTICE_TYPE.RAID,text:this.PERSONAL_RAID_WARNING_MESSAGE};static RAID_PATTERNS=[RegExp("discord.gg&#47;"),RegExp("\\b\\d{1,2}:\\d{2}\\b")];static RAID_START_TIME="18:00";static RAID_DURATION=216E5;static PERSONAL_RAID_CHECK_TIMEOUT=3E3;static DEFAULT_SETTINGS={showRaidAlert:!0,personalRaidCheck:!1,latestRaidCheck:null};static SETTINGS_UI={showRaidAlert:{type:"checkbox",description:"\u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f \u043e \u0437\u043b\u043e\u043d\u0430\u043c\u0435\u0440\u0435\u043d\u043d\u044b\u0445 \u0440\u0435\u0439\u0434\u0430\u0445 \u043d\u0430 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u0438 \u0441\u0442\u0440\u0438\u043c\u0435\u0440\u043e\u0432."},
personalRaidCheck:{type:"checkbox",description:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u0435\u0440\u0435\u0434 \u0437\u0430\u043f\u0443\u0441\u043a\u043e\u043c \u043a\u0430\u0436\u0434\u043e\u0439 \u043d\u043e\u0432\u043e\u0439 \u0438\u0433\u0440\u044b, \u043d\u0435 \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u043b\u0438 \u0440\u0435\u0439\u0434 \u043d\u0430 \u0432\u0430\u0448 \u0441\u0442\u0440\u0438\u043c."}};static MODULE={title:"Global Banlist",settings:{storage:"gp_global-banlist",
defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){new GPGlobalBanlist_(a.gpproxy,a.sm,a.abt)}constructor(a,b,c){super();this.gpproxy=a;this.abt=c;this.s=b.setSettings(this,this.updateSettings);this.globalBanlist=new Set;this.globalBanlistIds=new Set;this.twitchUsernamesCache=new Map;this.startGameTimer;this.currentRaidDate=null;this.isPersonalRaidDetected=this.isRaidCheckPending=!1;this.startGameHandler=this.startGameHandler.bind(this);this.addEventListener("global_banlist_updated",
d=>{this.clearPlayersByGlobalBanlist()});this.gpproxy.addEventListener("data",({detail:{event:d}})=>{d===GPProxy_.EVENT.NEW_GAME?this.gpproxy.isAuthorized&&this.requestGlobalBanlist():d===GPProxy_.EVENT.GAME_STARTED&&(document.removeEventListener("click",this.startGameHandler,!0),this.isRaidCheckPending=!1)});this.gpproxy.addEventListener("users_updated",()=>{this.clearPlayersByGlobalBanlist()});document.addEventListener("_global_banlist_received",({detail:{ids:d}})=>{this.globalBanlistIds=new Set(d);
this.updateGlobalBanlist()});document.addEventListener("_tw_ids_usernames",({detail:{usernamesMap:d}})=>{this.updateTwitchUsernamesCache(d);this.updateGlobalBanlist(d)});document.addEventListener("_raid_status",({detail:{status:d,date:e}})=>{this.s.latestRaidCheck=e;d&&(this.currentRaidDate=e,this.s.showRaidAlert&&this.abt?.addNotice(GPGlobalBanlist_.RAID_NOTICE_OPTIONS))});document.addEventListener("_raid_personal_status",({detail:{status:d,startBtn:e}})=>{this.isRaidCheckPending&&(this.isRaidCheckPending=
!1,clearTimeout(this.startGameTimer),d?(this.isPersonalRaidDetected=!0,this.s.personalRaidCheck&&this.abt?.addNotice(GPGlobalBanlist_.PERSONAL_RAID_NOTICE_OPTIONS)):e.click())});document.addEventListener("_url_changed",({detail:{path:d}})=>{this.isLobbyScreen(d)&&this.s.showRaidAlert&&(this.requestRaidStatus(),this.s.personalRaidCheck&&this.gpproxy.isTwitchAuth()&&!this.isPersonalRaidDetected&&document.addEventListener("click",this.startGameHandler,!0))});this.clearPlayersByGlobalBanlist();this.requestGlobalBanlist()}requestGlobalBanlist(){document.dispatchEvent(new CustomEvent("_request_global_banlist"))}clearPlayersByGlobalBanlist(){this.gpproxy.isOwner()&&
this.gpproxy.isTwitchAuth()&&this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.LOBBY)&&this.gpproxy.getUsers().forEach(a=>{!this.gpproxy.isYou(a.nick)&&this.globalBanlist.has(this.formatUsername(a.nick))&&this.gpproxy.kickPlayer(a.id)})}updateGlobalBanlist(a){a||this.globalBanlist.clear();const b=a||this.twitchUsernamesCache;if(b.size){var c=!1;this.globalBanlistIds.forEach(d=>{d=b.get(d);void 0!==d&&(this.globalBanlist.add(d),c=!0)});c&&this.dispatchEvent(new CustomEvent("global_banlist_updated"))}}updateTwitchUsernamesCache(a){a.forEach((b,
c)=>{this.twitchUsernamesCache.set(c,b)})}formatUsername(a){return this.gpproxy.isDiscordAuth()?a:a.toLowerCase()}requestRaidStatus(){const [,a]=this.getMSKDate();document.dispatchEvent(new CustomEvent("_raid_check",{detail:{patterns:GPGlobalBanlist_.RAID_PATTERNS,startTime:GPGlobalBanlist_.RAID_START_TIME,duration:GPGlobalBanlist_.RAID_DURATION,date:a}}))}requestPersonalRaidStatus(a,b){b.click=b.click.bind(b);document.dispatchEvent(new CustomEvent("_raid_personal_check",{detail:{username:this.gpproxy.getUser().nick.toLowerCase(),
date:a,startBtn:b}}))}isRaidTime(a){return 18<=a.getHours()&&23>=a.getHours()}getMSKDate(){var a=new Date,b=a.getTime();a=b-(new Date(a.toLocaleString("en-US",{timeZone:"Europe/Moscow"}))).getTime();b=new Date(b-a);a=b.toLocaleDateString("en-US");return[b,a]}startGameHandler(a){if(!this.isPersonalRaidDetected&&a.isTrusted){var [b,c]=this.getMSKDate();if(this.isRaidTime(b)&&c===this.currentRaidDate){const d=document.querySelector("i.playSmall").parentElement;if(a.target===d||d.contains(a.target))a.stopPropagation(),
this.isRaidCheckPending||(this.startGameTimer=setTimeout(()=>{this.isRaidCheckPending=!1;d.click()},GPGlobalBanlist_.PERSONAL_RAID_CHECK_TIMEOUT),this.requestPersonalRaidStatus(c,d),this.isRaidCheckPending=!0)}}}isLobbyScreen(a){return"lobby"===a.slice(1)}updateSettings({detail:{settings:a}}){"showRaidAlert"in a&&a.showRaidAlert&&this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.LOBBY)&&this.requestRaidStatus();"personalRaidCheck"in a&&this.gpproxy.isTwitchAuth()&&this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.LOBBY)&&
!this.isPersonalRaidDetected&&(a.personalRaidCheck?document.addEventListener("click",this.startGameHandler,!0):document.removeEventListener("click",this.startGameHandler,!0))}}window.GPGlobalBanlist_=GPGlobalBanlist_;class GPPacketParser_{constructor(){this.socketIOParser=new SocketIOParser_;this.engineIOClient=new EngineIOClient_;return{encodeString:this.socketIOParser.encodeString,add:this.socketIOParser.add,decodeString:this.socketIOParser.decodeString,decodePayload:this.engineIOClient.decodePayload,decode:this.decode.bind(this)}}decode(a,b){if(b){const {type:c,data:d}=this.engineIOClient.decodePayload(a);return"message"===c?this.socketIOParser.add(d).data:null}return this.socketIOParser.add(a).data}}
class SocketIOParser_{constructor(){function a(d){var e=0,g={type:Number(d.charAt(0))};if(null==c.types[g.type])return{type:c.ERROR,data:null};if(c.BINARY_EVENT===g.type||c.BINARY_ACK===g.type){for(var f=e+1;"-"!==d.charAt(++e)&&e!=d.length;);f=d.substring(f,e);if(f!=Number(f)||"-"!==d.charAt(e))throw Error("Illegal attachments");g.attachments=Number(f)}if("/"===d.charAt(e+1)){for(f=e+1;++e;){var h=d.charAt(e);if(","===h)break;if(e===d.length)break}g.nsp=d.substring(f,e)}else g.nsp="/";f=d.charAt(e+
1);if(""!==f&&Number(f)==f){for(f=e+1;++e;){h=d.charAt(e);if(null==h||Number(h)!=h){--e;break}if(e===d.length)break}g.id=Number(d.substring(f,e+1))}"4"===d.charAt(0)&&"5"===d.charAt(1)&&e++;if(d.charAt(++e)){d=d.substr(e);try{var k=JSON.parse(d)}catch(l){k=!1}if(!1===k||g.type!==c.ERROR&&!Array.isArray(k))return{type:c.ERROR,data:null};g.data=k}return g}var b="function"===typeof ArrayBuffer;const c={protocol:4,types:"CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" "),CONNECT:0,
DISCONNECT:1,EVENT:2,ACK:3,ERROR:4,BINARY_EVENT:5,BINARY_ACK:6};return{add:function(d){if("string"===typeof d)if(d=a(d),c.BINARY_EVENT===d.type||c.BINARY_ACK===d.type){if(this.reconstructor=new window.BinaryReconstructor(d),0===this.reconstructor.reconPack.attachments)return d}else return d;else{var e;if(e=b)(e=d instanceof ArrayBuffer)||(e="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(d):d.buffer instanceof ArrayBuffer);if(e||d.base64)if(this.reconstructor){if(d=this.reconstructor.takeBinaryData(d))return this.reconstructor=
null,d}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+d);}},decodeString:a,encodeString:function(d){let e,g=!1;e=""+d.type;if(c.BINARY_EVENT==d.type||c.BINARY_ACK==d.type)e+=d.attachments,e+="-";d.nsp&&"/"!=d.nsp&&(g=!0,e+=d.nsp);null!=d.id&&(g&&(e+=",",g=!1),e+=d.id);null!=d.data&&(g&&(e+=","),e+=JSON.stringify(d.data));return e}}}}
class EngineIOClient_{constructor(){function a(e,g,f){if(void 0===e)return d;if("string"===typeof e){if("b"===e.charAt(0))return f=e.substr(1),e=c[f.charAt(0)],window.base64encoder?(f=window.base64encoder.decode(f.substr(1)),"blob"===g&&Blob&&(f=new Blob([f])),g={type:e,data:f}):g={type:e,data:{base64:!0,data:f.substr(1)}},g;if(f){a:{g=e;try{g=window.utf8.decode(g,{strict:!1})}catch(h){e=!1;break a}e=g}if(!1===e)return d}f=e.charAt(0);return Number(f)==f&&c[f]?1<e.length?{type:c[f],data:e.substring(1)}:
{type:c[f]}:d}f=(new Uint8Array(e))[0];e=e.slice(1);Blob&&"blob"===g&&(e=new Blob([e]));return{type:c[f],data:e}}function b(e,g,f){"function"===typeof g&&(f=g,g=null);for(var h=[];0<e.byteLength;){for(var k=new Uint8Array(e),l=0===k[0],m="",n=1;255!==k[n];n++){if(310<m.length)return f(d,0,1);m+=k[n]}e=e.slice(2+m.length);m=parseInt(m);k=e.slice(0,m);if(l)try{k=String.fromCharCode.apply(null,new Uint8Array(k))}catch(r){for(l=new Uint8Array(k),k="",n=0;n<l.length;n++)k+=String.fromCharCode(l[n])}h.push(k);
e=e.slice(m)}var p=h.length;h.forEach(function(r,q){f(a(r,g,!0),q,p)})}var c=Object.keys({open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6}),d={type:"error",data:"parser error"};return{decodePayload:function(e,g,f){if("string"!==typeof e)return b(e,g,f);"function"===typeof g&&(g=null);if(""===e)return d;f="";for(var h,k,l=0,m=e.length;l<m;l++)if(k=e.charAt(l),":"!==k)f+=k;else{if(""===f||f!=(h=Number(f)))return d;k=e.substr(l+1,h);if(f!=k.length)return d;if(k.length)return e=a(k,g,!1),d.type===
e.type&&d.data===e.data?d:e;l+=h;f=""}if(""!==f)return d}}}}window.GPPacketParser_=GPPacketParser_;class GPProxy_ extends EventTarget{static MODULE={title:"GP Proxy",dependencies:["GPPacketParser_"]};static INIT(a){a.gpproxy=new GPProxy_(a.ws)}static EVENT={GAME_QUIT:28,CHANGE_GAME_MODE:26,CHANGE_LOBBY_SCREEN:27,CHANGE_GAME_SETTINGS:18,GAME_STARTED:5,DESCRIPTION_INPUT:6,TOOL:7,READY:15,GALLERY_SETTINGS:23,NEW_GAME:20,PLAYER_JOINED:2,PLAYER_LEFT:3,PLAYER_KICKED:14,PLAYER_LEFT_GAME:21,PLAYER_RETURNED:22,TURN_STARTED:11,TURNS_ENDED:24,TIMER_STARTED:25,ALBUM_INFO:12,ALBUM_ITEM:9,ALBUM_NEXT:16,ALBUM_BACK:17,
ALBUM_SCORE:35};static GAME_TIME={FAST:3,NORMAL:2,SLOW:1,REGRESSIVE:5,PROGRESSIVE:8,DYNAMIC:4,INFINITE:6,HOSTS_DECISION:7,FASTER_FIRST_TURN:9,SLOWER_FIRST_TURN:10};static GAME_ORDER={WRITING_DRAWING:1,DRAWING_WRITING:2,ONLY_DRAWINGS:3,WRITING_ONLY_AT_THE_BEGINNING_AND_THE_END:4,WRITING_ONLY_AT_THE_BEGINNING:5,WRITING_ONLY_AT_THE_END:6,SINGLE_SENTENCE:7,SINGLE_DRAWING:8,SOLO_DRAWING:9,DRAWINGS_WITH_A_BACKGROUND:10,DRAWINGS_WITH_A_BACKGROUND_NO_PREVIEW:11};static INITIAL_STATE={screen:null,user:{owner:!1},
users:[],turn:{},turnNum:0,turnMax:0,roundNum:0,bookAuthor:{id:0,nick:""},bookNum:-1,bookLoaded:!1,bookAutomatic:!0,bookVoice:!1,timeline:[],previous:{user:{id:0,nick:""},type:2,data:""},active:!1,sentence:"",write:"",draw:[],lastDraw:null,background:null,configs:{tab:1,mode:1,maxUsers:14,visible:!0,speed:2,turns:3,first:1,score:2,animate:2},animationConfigs:{speed:3,loop:1},timeStarted:!1,elapsedTime:0};static PAYLOAD_TYPE={PRESETS:1,DATA:2};static GAME_STAGE={LOBBY:1,GAME:2,GALLERY_SETTINGS:5,ALBUM:3,
SCORE:4};static ALBUM_ITEM_TYPE={DESCRIPTION:2,IMAGE:1,ANIMATION:5};static AUTH_TYPE={DISCORD:"discord",TWITCH:"twitch"};static AUTH_TYPE_IDS={twitch:1,discord:2};static DISCORD_USERNAME_PATTERN=/^.+#\d+$/;static GAME_MODES_PRESETS={1:{mode:1,visible:1,speed:2,turns:3,first:1,score:2,animate:2},2:{mode:2,speed:4},3:{mode:3,visible:2},4:{mode:4,turns:3},5:{mode:5,first:4},6:{mode:6,speed:3},7:{mode:7,speed:3,turns:1},8:{mode:8,speed:5,first:3},9:{mode:9,first:7},10:{mode:10,score:1},11:{mode:11,first:3,
animate:1},12:{mode:12,speed:6,turns:4,first:7,animate:1},13:{mode:13,speed:4,turns:7,first:9,animate:1},14:{mode:14,speed:10,turns:4,first:10,animate:1},15:{mode:15,speed:9,first:11}};static SCREEN={LOBBY:1,PHRASE:3,DESCRIPTION:4,PAINTER:5,ALBUM:7};static SCREEN_NAMES={1:"lobby",3:"phrase",4:"description",5:"painter",7:"album"};static REJOIN_STAGES={LOBBY:["lobby"],GAME:["start","draw","write","memory"],ALBUM:["book"],SCORE:["rank"]};constructor(a){super();this.ws;this.state=GPProxy_.INITIAL_STATE;
this.albums=[];this.albumsCount=0;this.prevImageData=null;this.isAuthorized=!1;this.gameStage=GPProxy_.GAME_STAGE.LOBBY;this.rejoinFlag=!1;this.stateUpdateHandler=this.stateUpdateHandler.bind(this);this.wsMessageHandler=this.wsMessageHandler.bind(this);this.dataEventHandler=this.dataEventHandler.bind(this);this.rejoinHandler=this.rejoinHandler.bind(this);this.setAlbumItem=this.setAlbumItem.bind(this);this.parser=new GPPacketParser_;this.localization={};this.wsMsgMiddlewares=new Map;document.addEventListener("_xhr_data",
({detail:{encodedPacket:b}})=>{(b=this.parser.decode(b,!0))&&this.setPresets(b[1])});document.addEventListener("_ws_send_data",({detail:{encodedPacket:b}})=>{b&&3<b.length&&(b=this.parser.decode(b))&&this.wsSendHandler(b)});document.addEventListener("_onmessage_intercept",({detail:{handler:b,e:c}})=>{if(this.wsMsgMiddlewares.size)if("string"!==typeof c.data)b(c);else{var [,d,e]=c.data.match(/4(?:(?:2)|(51-))\[2,(\d+)/)||[];if(void 0!==e&&this.wsMsgMiddlewares.has(+e)){var g=this.wsMsgMiddlewares.get(+e),
f=this.parser.decodeString(c.data).data;if(f){var [h,k]=[...g].reduce((l,m)=>m(l),[f,!1]);k?(g=this.encodePacket(h,!!d),c=this.buildMessageEvent(c,g),b(c)):b(c)}else b(c)}else b(c)}else b(c)});this.addEventListener("data",this.stateUpdateHandler);this.addEventListener("data",this.gameStageUpdateHandler);this.addEventListener("data",this.usersUpdateHandler);this.addEventListener("data",this.albumUpdateHandler);this.addEventListener("data",this.dataEventHandler);this.addEventListener("data",this.prevImageHandler);
this.addEventListener("album_reconnect",()=>{this.albumsCount=this.getAlbumsCount()});document.addEventListener("_url_changed",this.rejoinHandler,{once:!0});this.setWebSocket(a);this.requestLocalization("draw").then(({data:b,type:c})=>{this.localization[c]=b;this.dispatchEvent(new CustomEvent("localization",{detail:{data:b,type:c}}))}).catch(({err:b,type:c})=>{console.error(b);this.localization[c]={}})}setWebSocket(a){this.ws&&this.ws.removeEventListener("message",this.wsMessageHandler);this.ws=a;
this.ws.addEventListener("message",this.wsMessageHandler)}addWSMsgMiddleware(a,b){a.forEach(c=>{const d=this.wsMsgMiddlewares.get(c)||new Set;d.add(b);this.wsMsgMiddlewares.set(c,d)})}removeWSMsgMiddleware(a){this.wsMsgMiddlewares.forEach((b,c)=>{b.delete(a);b.size||this.wsMsgMiddlewares.delete(c)})}encodePacket([a,b,c,d],e){e=e?"51-":2;a=[a,b,c];void 0!==d&&a.push(d);return this.parser.encodeString({type:4,nsp:"/",id:e,data:a})}buildMessageEvent(a,b){return new MessageEvent("message",{data:b,origin:a.origin,
lastEventId:a.lastEventId,source:a.source,ports:a.ports})}setPresets(a){if(a.error)console.warn("Presets Error:",a);else try{this.state=Object.assign(GPProxy_.INITIAL_STATE,this.state,a);this.state.users.find(c=>c.id===a.user.id).you=!0;this.isAuthorized=this.state.user.uid!==this.state.user.authId;this.authTypeId=(this.authType=this.calcAuthType())?GPProxy_.AUTH_TYPE_IDS[this.authType]:0;if(a.users){const c=new CustomEvent("users_updated",{detail:{users:this.state.users}});this.dispatchEvent(c)}a.timeline?.length&&
(this.albums[a.bookNum]={items:[],background:a.background},a.timeline.forEach(this.setAlbumItem));document.dispatchEvent(new CustomEvent("_auth_id",{detail:{authId:this.state.user.authId,authTypeId:this.authTypeId,isAuthorized:this.isAuthorized}}));this.dispatchEvent(new Event("presets"));if(1!==a.screen){var b=GPProxy_.SCREEN_NAMES[a.screen];b&&(this.dispatchEvent(new CustomEvent(`${b}_reconnect`)),[3,4,5].includes(a.screen)&&this.dispatchEvent(new CustomEvent("game_reconnect")));this.rejoinFlag=
!0}}catch(c){console.warn("Presets Data Error:",{error:c,data:a})}}wsMessageHandler({data:a}){if("string"===typeof a&&(a=this.parser.decodeString(a).data)){const [,b,c]=a;this.dispatchEvent(new CustomEvent("data",{detail:{event:b,data:c}}))}}wsSendHandler(a){const [,b,c]=a;b!==GPProxy_.EVENT.CHANGE_GAME_SETTINGS&&b!==GPProxy_.EVENT.GAME_QUIT||this.dispatchEvent(new CustomEvent("data",{detail:{event:b,data:c}}))}stateUpdateHandler({detail:{event:a,data:b}}){switch(a){case GPProxy_.EVENT.CHANGE_GAME_MODE:a=
GPProxy_.GAME_MODES_PRESETS;b=Object.assign({},a[1],a[b]);this.state.configs=Object.assign({},this.state.configs,b);break;case GPProxy_.EVENT.CHANGE_LOBBY_SCREEN:b=GPProxy_.GAME_MODES_PRESETS[1];this.state.configs=Object.assign({},this.state.configs,b);break;case GPProxy_.EVENT.CHANGE_GAME_SETTINGS:this.state.configs=Object.assign({},this.state.configs,b);break;case GPProxy_.EVENT.GAME_STARTED:this.state=Object.assign({},this.state,{countDown:!0,previous:null,turnNum:0,roundNum:this.state.roundNum+
1,bookNum:0,turnMax:b,timeline:[],background:null});break;case GPProxy_.EVENT.TURN_STARTED:this.state=Object.assign({},this.state,{draw:[],lastDraw:null},b);[3,4].includes(this.state.screen)?this.state.write="":this.state.draw=[];break;case GPProxy_.EVENT.TURNS_ENDED:this.state=Object.assign({},this.state,{screen:7,bookNum:-1});break;case GPProxy_.EVENT.GALLERY_SETTINGS:this.state=Object.assign({},this.state,{background:null},b);break;case GPProxy_.EVENT.ALBUM_INFO:this.state=Object.assign({},this.state,
{timeline:[],bookLoaded:0<b.timeline.length},b);break;case GPProxy_.EVENT.NEW_GAME:this.state=Object.assign({},this.state,{screen:1,roundNum:0});break;case GPProxy_.EVENT.ALBUM_SCORE:this.state=Object.assign({},this.state,{screen:8})}}gameStageUpdateHandler({detail:{event:a}}){switch(a){case GPProxy_.EVENT.NEW_GAME:this.gameStage=GPProxy_.GAME_STAGE.LOBBY;break;case GPProxy_.EVENT.GAME_STARTED:this.gameStage=GPProxy_.GAME_STAGE.GAME;break;case GPProxy_.EVENT.TURNS_ENDED:this.gameStage=GPProxy_.GAME_STAGE.GALLERY_SETTINGS;
break;case GPProxy_.EVENT.GALLERY_SETTINGS:this.gameStage=GPProxy_.GAME_STAGE.ALBUM;break;case GPProxy_.EVENT.ALBUM_SCORE:this.gameStage=GPProxy_.GAME_STAGE.SCORE}}dataEventHandler({detail:{event:a,data:b}}){let c=!0,d;switch(a){case GPProxy_.EVENT.TURN_STARTED:d="turn_started";break;case GPProxy_.EVENT.TURNS_ENDED:d="turns_ended";break;case GPProxy_.EVENT.GALLERY_SETTINGS:d="gallery_started";break;default:c=!1}c&&(a=new CustomEvent(d,{detail:{...b}}),this.dispatchEvent(a))}prevImageHandler({detail:{event:a,
data:b}}){a===GPProxy_.EVENT.TURN_STARTED?b.screen!==GPProxy_.SCREEN.DESCRIPTION&&b.screen!==GPProxy_.SCREEN.PAINTER||!Array.isArray(b.previous?.data)?this.prevImageData=null:this.prevImageData=b.previous.data:a===GPProxy_.EVENT.TURNS_ENDED&&(this.prevImageData=null)}rejoinHandler({detail:{path:a}}){if(this.rejoinFlag){var b=a.slice(1);if(a=Object.keys(GPProxy_.REJOIN_STAGES).find(c=>GPProxy_.REJOIN_STAGES[c].find(d=>d===b)))this.gameStage=GPProxy_.GAME_STAGE[a],this.dispatchEvent(new Event(`${a.toLowerCase()}_rejoin`))}}usersUpdateHandler({detail:{event:a,
data:b}}){let c=!0,d=!1;switch(a){case GPProxy_.EVENT.NEW_GAME:this.state.users=this.state.users.filter(k=>!k.away).map(k=>{k.viewer=void 0;k.ready=!1;return k});break;case GPProxy_.EVENT.ALBUM_SCORE:this.state.users=this.state.users.map(k=>{k.viewer=void 0;return k});break;case GPProxy_.EVENT.TURN_STARTED:this.state.user.ready=!1;this.state.users=this.state.users.map(k=>{k.ready=!1;return k});break;case GPProxy_.EVENT.PLAYER_JOINED:this.state.users.push(b);break;case GPProxy_.EVENT.PLAYER_LEFT:var {userLeft:e,
newOwner:g}=b;this.state.users=this.state.users.filter(k=>k.id!==e);g&&(d=this.state.user.id===g,this.state.user.owner=d,this.state.users=this.state.users.map(k=>{k.owner=k.id===g;return k}));break;case GPProxy_.EVENT.PLAYER_LEFT_GAME:var {userLeft:e,newOwner:g}=b;this.state.users=this.state.users.map(k=>{k.away=k.id===e||k.away;return k});g&&(d=this.state.user.id===g,this.state.user.owner=d,this.state.users=this.state.users.map(k=>{k.owner=k.id===g;return k}));break;case GPProxy_.EVENT.PLAYER_RETURNED:this.state.users=
this.state.users.map(k=>{k.away=k.away&&k.id!==b;return k});break;case GPProxy_.EVENT.PLAYER_KICKED:this.state.users=this.state.users.filter(k=>k.id!==b);break;case GPProxy_.EVENT.READY:var {user:f,ready:h}=b;this.state.users=this.state.users.map(k=>{k.ready=k.id===f?h:k.ready;return k});f===this.state.user.id&&(this.state.user.ready=h);break;case GPProxy_.EVENT.GAME_QUIT:this.state.users=[];break;default:c=!1}c&&this.dispatchEvent(new CustomEvent("users_updated",{detail:{users:this.state.users}}));
d&&this.dispatchEvent(new Event("owner_status"))}albumUpdateHandler({detail:{event:a,data:b}}){switch(a){case GPProxy_.EVENT.ALBUM_INFO:this.albums[b.bookNum]={items:[],background:b.background,bookAuthor:b.bookAuthor};b.timeline&&b.timeline.forEach(this.setAlbumItem);break;case GPProxy_.EVENT.ALBUM_ITEM:if(void 0===b.id){b.bookNum+1>=this.albumsCount&&this.dispatchEvent(new Event("albums_ended"));break}if(5===b.type){this.dispatchEvent(new CustomEvent("album_item_loading",{detail:{id:null}}));break}b.user&&
!b.data?this.dispatchEvent(new CustomEvent("album_item_loading",{detail:{id:b.id}})):this.setAlbumItem(b);break;case GPProxy_.EVENT.GALLERY_SETTINGS:this.albumsCount=this.getAlbumsCount()}}getAlbumsCount(){return this.getUsers().filter(a=>!a.viewer).length}getAlbum(a=this.state.bookNum){return this.albums[a]}getAlbumBackground(a=this.state.bookNum){return this.albums[a]?.background??null}setAlbumItem({user:a,id:b,data:c,type:d,active:e}){var g=GPProxy_.ALBUM_ITEM_TYPE;if(e&&c&&a&&(d===g.DESCRIPTION||
d===g.IMAGE)){a=a.nick;g=d===g.IMAGE?this.getItemTitle(b):null;e=(new Date).toISOString();var f=this.albums[this.state.bookNum].background;0===b&&f&&!c?.length&&(c=f,f=void 0);c={data:c,background:f,type:d,meta:{author:a,title:g,date:e}};this.isAuthorized&&(c.auth=this.authTypeId);this.albums[this.state.bookNum].items[b]=c;this.dispatchEvent(new CustomEvent("album_item",{detail:{itemID:b,albumID:this.state.bookNum,item:c}}))}}getItemTitle(a){if(!a)return"\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430";
const b=Object.values(this.albums[this.state.bookNum].items),{first:c,animate:d}=this.state.configs;let e;if(1===d)return"\u043a\u0430\u0434\u0440 \u0430\u043d\u0438\u043c\u0430\u0446\u0438\u0438";if(1===c||2===c){for(a=b.length;0<a--;)if(2===b[a].type){e=b[a].data;break}return e||"\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430"}return 3===c||6===c?"\u043f\u0435\u0440\u0435\u0440\u0438\u0441\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0438\u0441\u0443\u043d\u043e\u043a":
4===c||5===c?1<a?"\u043f\u0435\u0440\u0435\u0440\u0438\u0441\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0438\u0441\u0443\u043d\u043e\u043a":b[0].data:7===c?b[0].data:9===c?"\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430":10===c||11===c?0<a?"\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0439 \u0440\u0438\u0441\u0443\u043d\u043e\u043a":"\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430":
"\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430"}getAlbumItem(a,b=this.state.bookNum){return this.albums[b]?.items[a]??null}calcAuthType(){return this.isAuthorized?GPProxy_.DISCORD_USERNAME_PATTERN.test(this.state.user.nick)?GPProxy_.AUTH_TYPE.DISCORD:GPProxy_.AUTH_TYPE.TWITCH:null}send(a,b,c=4,d=2){a=this.parser.encodeString({type:c,nsp:"/",id:d,data:[GPProxy_.PAYLOAD_TYPE.DATA,a,b]});this.ws.send(a)}kickPlayer(a){this.send(GPProxy_.EVENT.PLAYER_KICKED,
a)}tool(a,b){this.send(GPProxy_.EVENT.TOOL,{t:this.state.turnNum,d:a,v:b})}undo(a){this.tool(2,a)}redo(a){this.tool(1,a)}ready(){this.send(GPProxy_.EVENT.READY,!this.state.user.ready)}getState(){return this.state}getUser(){return this.state.user}getUsers(){return this.state.users.slice()}getAuthType(){return this.authType}isTwitchAuth(){return this.authType===GPProxy_.AUTH_TYPE.TWITCH}isDiscordAuth(){return this.authType===GPProxy_.AUTH_TYPE.DISCORD}isReady(){return!!this.state.user.ready}isOwner(){return!!this.state.user.owner}isViewer(a){return!!a.viewer}isYou(a){return void 0===
a?!1:this.state.user["number"===typeof a?"id":"nick"]===a}isAnimateMode(){return 1===this.state.configs.animate}isGameStage(a){return this.gameStage===a}isGameStages(...a){return a.some(b=>b===this.gameStage)}isGameTime(a){return this.state.configs.speed===a}isGameOrder(a){return this.state.configs.first===a}isAlbumAutoShow(){return this.state.bookAutomatic}isSoloGame(){return this.state.screen===GPProxy_.SCREEN.PAINTER&&1===this.state.users.filter(a=>!a.viewer).length}getGameConfig(){return Object.assign({},
this.state.configs)}getCurrentAlbumId(){return this.state.bookNum}getCurrentTurnId(){return this.state.turnNum}getGameCode(){return this.state.code}getPrevImageData(){return this.prevImageData}getPrevData(){return this.state.previous}getLocalization(a){return this.localization[a]||{}}requestLocalization(a){return new Promise((b,c)=>{window.__NEXT_DATA__?fetch(`${location.origin}/_next/data/${window.__NEXT_DATA__.buildId}/${window.__NEXT_DATA__.locale}/${a}.json`).then(d=>d.json()).then(d=>{(d=d.pageProps?.texts?.page)?
b({data:d,type:a}):c({error:"localization data not found",type:a})}).catch(d=>{c({error:d,type:a})}):c({error:"__NEXT_DATA__ is undefined",type:a})})}}window.GPProxy_=GPProxy_;class GPModulesManager_ extends EventTarget{static STORAGE_NAME="gp_mm";static FORCE_RELOAD=!0;static DEFAULT_PERMISSIONS=3685;static EDITION_STATE={FREE:"free",GIFT:"gift",SUBSCRIPTION:"subscription",TIME_LEFT:"time-left",EXPIRED:"expired"};static ACTIVATION_KEY_PATTERN=/^[a-zA-Z0-9]{32}:\d{15,16}$/;static DEFAULT_SETTINGS={disabledList:[]};constructor(a){super();this.settings=JSON.parse(window.localStorage.getItem(GPModulesManager_.STORAGE_NAME))||GPModulesManager_.DEFAULT_SETTINGS;this.disabledList=
new Set(this.settings.disabledList);this.modules=[];this.lm=[];this.hiddenSettings=new Set;this.initialState={};this.rootThis;this.publicKey;this.pasteKey=null;this.settingsManager=new GPSettingsManager_(this);this.onMListClick=this.onMListClick.bind(this);this.onMListContextMenu=this.onMListContextMenu.bind(this);this.renderModulesList=this.renderModulesList.bind(this);this.renderError=this.renderError.bind(this);this.toggleSettingsVisibility=this.toggleSettingsVisibility.bind(this);this.addEventListener("disabled-list-updated",
b=>{this.saveSettings()});document.addEventListener("_auth_id",async({detail:{authId:b,authTypeId:c,isAuthorized:d}})=>{function e(l){this.lm=this.lm.filter(m=>1<<m.id&l?(m.disabled||(window[m.name].INIT.apply(this.rootThis,[this.root]),window[m.name].toggleSettingsVisibility=this.toggleSettingsVisibility(m),m.initialized=!0),m.locked=!1):m.locked=!0);this.renderModulesList()}async function g(l,m){m=(new TextEncoder).encode(m);var n=await crypto.subtle.digest("SHA-256",m);m=window.atob(l).slice(0,
12);m={name:"AES-GCM",iv:new Uint8Array(Array.from(m).map(p=>p.charCodeAt(0)))};n=await crypto.subtle.importKey("raw",n,m,!1,["decrypt"]);l=window.atob(l).slice(12);l=new Uint8Array(Array.from(l).map(p=>p.charCodeAt(0)));try{const p=await crypto.subtle.decrypt(m,n,l);return(new TextDecoder).decode(p)}catch(p){throw Error("Decrypt failed");}}function f(l){document.dispatchEvent(new CustomEvent("_auth_perms",{detail:{ps:l}}))}if(this.lm.length){var h=GPModulesManager_.DEFAULT_PERMISSIONS,k=null;try{if(!c)throw new GPAuthError_;
if(!a||!this.publicKey)throw new GPAuthError_;c=1===c?"t":"d";const l=JSON.parse(await g(a,this.publicKey)),m=JSON.parse(await g(l[c],b));l.e&&this.setEditionTitle(l.e,l.m);l.g&&(k=[GPModulesManager_.EDITION_STATE.GIFT]);if(m.ed){if(m.ed<Date.now())throw k=[GPModulesManager_.EDITION_STATE.EXPIRED],2&m.p&&(h|=16),new GPAuthError_;k=[GPModulesManager_.EDITION_STATE.TIME_LEFT,m.ed-Date.now()]}else l.g||(k=[GPModulesManager_.EDITION_STATE.SUBSCRIPTION]);k&&this.setEditionState(...k);e.call(this,h|m.p);
f.call(this,h|m.p);this.renderModulesList()}catch(l){l instanceof GPAuthError_||console.error(l),d&&!k&&(k=[GPModulesManager_.EDITION_STATE.FREE]),k&&this.setEditionState(...k),e.call(this,h),f.call(this,h)}}});document.addEventListener("_auth_key_changed",b=>{this.container.classList.add("reload-required_")});document.addEventListener("_auth_key",({detail:{publicKey:b}})=>{this.publicKey=b});document.addEventListener("_act_init",({detail:{pasteKey:b}})=>{this.pasteKey=b});this.render();this.setEditionTitle("base")}getElement(){return this.container}getSettingsManager(){return this.settingsManager}render(){this.container=
document.createElement("div");this.container.className="gp-mm_";var a=document.createElement("div");a.className="buttons";this.container.appendChild(a);const b=document.createElement("div");b.className="show-btn_ gp-module-btn_ btn_";b.title="\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043c\u043e\u0434\u0443\u043b\u0435\u0439";b.addEventListener("pointerup",c=>{const d=this.container.classList.contains("shown_");this.container.classList.toggle("shown_",!d);d&&this.settingsManager.toggle(!1,
void 0,c.ctrlKey||1===c.button);b.classList.toggle("pressed_",!d)});a.appendChild(b);this.settingsBtn=document.createElement("div");this.settingsBtn.className="settings-btn_ btn_";this.settingsBtn.title="\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043c\u043e\u0434\u0443\u043b\u0435\u0439";this.settingsBtn.addEventListener("pointerup",c=>{this.settingsManager.toggle(void 0,void 0,c.ctrlKey||1===c.button)});a.appendChild(this.settingsBtn);this.keyBtn=document.createElement("div");this.keyBtn.className=
"key-btn_ btn_";this.keyBtn.title="\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u044e\u0447 \u0430\u043a\u0442\u0438\u0432\u0430\u0446\u0438\u0438";this.keyBtn.addEventListener("click",c=>{c=this.keyInput.classList.contains("hidden");this.keyInput.classList.toggle("hidden",!c);c&&this.keyInput.focus();this.settingsManager.close()});this.keyBtn.addEventListener("pointerdown",c=>{this.keyInput.preventHiding=!0});a.appendChild(this.keyBtn);this.keyInput=document.createElement("input");
this.keyInput.className="key-input_ gp-input_ hidden";this.keyInput.placeholder="\u0421\u043a\u043e\u043f\u0438\u0440\u0443\u0439\u0442\u0435 \u043a\u043b\u044e\u0447 \u0441\u044e\u0434\u0430...";this.keyInput.spellcheck=!1;this.keyInput.autocomplete="off";this.keyInput.preventHiding=!1;this.keyInput.addEventListener("input",c=>{if(this.pasteKey){c=c.target.value.trim();var d=GPModulesManager_.ACTIVATION_KEY_PATTERN.test(c);if(d){const e=this.pasteKey(c);this.keyInput.classList.toggle("hidden",e)}this.keyInput.classList.toggle("invalid_",
c&&!d)}});this.keyInput.addEventListener("keydown",c=>{switch(c.key){case "Escape":c.target.blur()}});this.keyInput.addEventListener("focus",c=>{document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!0}}));c.target.value="";c.target.preventHiding=!1});this.keyInput.addEventListener("blur",c=>{document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!1}}));c.target.value="";c.target.classList.remove("invalid_");c.target.preventHiding?c.target.preventHiding=!1:this.keyInput.classList.add("hidden")});
this.container.appendChild(this.keyInput);a=document.createElement("div");a.className="title_";a.textContent="\u041c\u043e\u0434\u0443\u043b\u0438";this.container.appendChild(a);this.edition=document.createElement("div");this.edition.className="edition_ hidden";this.edition.addEventListener("click",c=>{c=c.target.dataset.state;if(c===GPModulesManager_.EDITION_STATE.FREE||c===GPModulesManager_.EDITION_STATE.EXPIRED)c=document.createElement("a"),c.href="https://boosty.to/gpmod",c.target="_blank",c.click()});
this.container.appendChild(this.edition);this.editionTitle=document.createElement("div");this.editionTitle.className="edition-title_";this.edition.appendChild(this.editionTitle);a=document.createElement("div");a.className="ribbon_";this.edition.appendChild(a);this.modulesList=document.createElement("div");this.modulesList.className="modules-list_";this.modulesList.addEventListener("contextmenu",this.onMListContextMenu);this.modulesList.addEventListener("pointerup",this.onMListClick);this.container.appendChild(this.modulesList);
this.reloadBtn=document.createElement("div");this.reloadBtn.className="gp-btn_ reload-btn_";this.reloadBtn.classList.add("disabled_");this.reloadBtn.textContent="\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c";this.reloadBtn.addEventListener("click",this.reloadBtnClickHandler);this.container.appendChild(this.reloadBtn);document.body.appendChild(this.container)}setEditionTitle(a,b=!1){this.editionTitle.textContent=`${a} ed.`;this.edition.classList.toggle("demo_",!!b);
this.edition.classList.remove("hidden")}setEditionState(a,b){this.edition.dataset.state=a;this.edition.title="";a===GPModulesManager_.EDITION_STATE.TIME_LEFT?this.edition.dataset.timeLeft=this.formatTimeLeft(b):a===GPModulesManager_.EDITION_STATE.EXPIRED&&(this.edition.title="\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443 \u043d\u0430 Boosty")}formatTimeLeft(a){a=Math.trunc(a/864E5);const b=a%100;var c=b%10;let d;if(10<=b&&20>b)d=2;else if(1===c)d=
0;else if(1<c&&5>c)d=1;else if(!c||4<c)d=2;c=["\u041e\u0441\u0442\u0430\u043b\u0441\u044f","\u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c"];const e=["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"];return`${d?c[1]:c[0]} ${1>b?"\u043c\u0435\u043d\u044c\u0448\u0435 \u0434\u043d\u044f":`${a} ${e[d]}`}`}onMListClick(a){2===a.button?a.preventDefault():a.target.matches(".module-title_, .module-settings_")&&!a.target.classList.contains("disabled_")&&this.settingsManager.toggle(!0,
a.target.dataset.module,a.ctrlKey||1===a.button)}onMListContextMenu(a){a.preventDefault();a.stopPropagation();a.target.matches(".module-title_")&&!a.target.classList.contains("disabled_")&&this.settingsManager.toggle(!0,a.target.dataset.module,a.ctrlKey||1===a.button)}compareToInitialState(){const a=[...this.modulesList.querySelectorAll(".gp-cb_")].some(b=>b.checked!==this.initialState[b.name]);this.reloadBtn.classList.toggle("alert_",a);this.reloadBtn.classList.toggle("disabled_",!a)}reloadBtnClickHandler(a){GPModulesManager_.FORCE_RELOAD&&
(window.onbeforeunload=null);location.reload()}setModules(a,b,c){this.modules=a;this.rootThis=b;this.root=c;this.initDisabledList();this.initHiddenSettings();this.initModules(b,c).then(()=>{this.renderModulesList();this.dispatchEvent(new Event("ready"))}).catch(d=>{console.error(d);d instanceof GPModuleError_&&this.renderError(d)})}initModules(a,b){return new Promise((c,d)=>{this.modules.forEach(e=>{this.initialState[e.name]=this.disabledList.has(e.name)&&!e.required?!1:!0;const g=[],f=e.dependencies?.length?
e.dependencies.every(k=>{if(k in window)return!0;e.required?g.push(`\u0417\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c "${k}" \u043a \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u043c\u0443 \u043c\u043e\u0434\u0443\u043b\u044e "${e.name}" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d`):g.push(`\u0417\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c "${k}" \u043a \u043c\u043e\u0434\u0443\u043b\u044e "${e.name}" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d`);
return!1}):!0,h=e.name in window;e.loaded=h&&f;e.title=window[e.name].MODULE.title;if(e.loaded)window[e.name].INIT&&(e.required?(window[e.name].INIT.apply(a,[b]),window[e.name].toggleSettingsVisibility=this.toggleSettingsVisibility(e),e.initialized=!0):this.lm.push(e));else if(!f){g.forEach(k=>{console.error(k)});if(e.required)throw new GPModuleError_(`\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c "${e.name}" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d`);
console.error(`\u041c\u043e\u0434\u0443\u043b\u044c "${e.name}" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d`)}else if(!h){if(e.required)throw new GPModuleError_(`\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c "${e.name}" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d`);console.error(`\u041c\u043e\u0434\u0443\u043b\u044c "${e.name}" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d`)}});
c()})}toggleSettingsVisibility(a){return b=>{a.hiddenSettings===b&&(a.hiddenSettings=!b,a.hidden||a.hiddenSettings?this.hiddenSettings.add(a.name):this.hiddenSettings.delete(a.name),this.renderModulesList(),this.settingsManager.renderSettingsList())}}initDisabledList(){let a=!1;this.modules.forEach(b=>{b.disabled?(this.disabledList.add(b.name),a=!0):this.disabledList.has(b.name)&&(b.disabled=!0)});a&&this.dispatchEvent(new Event("disabled-list-updated"))}initHiddenSettings(){this.hiddenSettings.clear();
this.modules.forEach(a=>{(a.hidden||a.hiddenSettings)&&this.hiddenSettings.add(a.name)})}renderModulesList(){const a=document.createDocumentFragment(),b=new Intl.Collator("us",{sensitivity:"base"});this.modules.sort((c,d)=>{const [e,g]=[!c.locked,!d.locked];return e&&g||!e&&!g?b.compare(c.title,d.title):e&&!g?-1:1});this.modules.forEach((c,d)=>{if(!c.hidden){var e=this.settingsManager.hasSettings(c.name),g=document.createElement("div");g.className="module_";g.classList.toggle("locked_",!!c.locked);
var f=document.createElement("div");f.className="module-title_";f.classList.toggle("not-loaded_",!c.loaded);f.classList.toggle("disabled_",!!c.hiddenSettings||!e);f.title=c.loaded?"":"\u041c\u043e\u0434\u0443\u043b\u044c \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d";f.dataset.module=c.name;f.textContent=c.title;g.appendChild(f);f=document.createElement("div");f.className="module-settings_";f.classList.toggle("disabled_",!!c.hiddenSettings||!e);f.dataset.module=c.name;f.textContent=
"\ue92d";g.appendChild(f);f=this.initialState[c.name];e=document.createElement("div");e.className="module-tumbler_";var h=document.createElement("input");h.className="gp-cb_";h.id=`module-${d}_`;h.type="checkbox";h.checked=f;h.toggleAttribute("checked",!!f);h.toggleAttribute("disabled",!!c.required);h.addEventListener("change",k=>{c.required||(k.target.checked&&this.disabledList.has(c.name)?(c.disabled=!1,this.disabledList.delete(c.name)):(c.disabled=!0,this.disabledList.add(c.name)),this.saveSettings(),
this.compareToInitialState())});e.appendChild(h);f=document.createElement("label");f.className="gp-cb-label_";f.setAttribute("for",`module-${d}_`);e.appendChild(f);g.appendChild(e);a.appendChild(g)}});this.settingsBtn.classList.toggle("hidden",!this.settingsManager.hasModulesSettings());this.modulesList.innerHTML="";this.modulesList.appendChild(a)}renderError(a){const b=document.createElement("div");b.className="error_";b.innerHTML=`<div class="error-msg_">${a.message}</div>`;this.modulesList.before(b);
this.modulesList.remove()}areHiddenSettings(a){return this.hiddenSettings.has(a)}saveSettings(){this.settings.disabledList=Array.from(this.disabledList);window.localStorage.setItem(GPModulesManager_.STORAGE_NAME,JSON.stringify(this.settings))}}class GPModuleError_ extends Error{constructor(a){super(a)}}class GPAuthError_ extends Error{constructor(a){super(a)}};class GPSettingsManager_ extends EventTarget{constructor(a){super();this.mm=a;this.viewsData=new Map;this.isRendered=!1;this.close=this.close.bind(this);this.addEventListener("update",({detail:{source:b,storage:c,settings:d,changedSettings:e}})=>{b.dispatchEvent(new CustomEvent("settings_updated",{detail:{settings:e}}));this.saveSettings(c,Object.assign({},d,e))})}getElement(){return this.container}setSettings(a,b){const {name:c,MODULE:{title:d,settings:{storage:e,defaultSettings:g,ui:f={}}}}=a.constructor;
b&&a.addEventListener("settings_updated",b.bind(a));b=Object.assign({},g,JSON.parse(window.localStorage.getItem(e))||{});a.settings=b;const h=[...Object.values(f)].some(l=>!l.hidden),k=this.copy(b);this.viewsData.set(c,{title:d,source:a,storage:e,settings:b,defaultSettings:g,initialSettings:k,ui:f,hasVisibleSettings:h});return this.buildSettingsAPI(c,b,f,e,a)}hasSettings(a){return this.viewsData.has(a)&&this.hasVisibleSettings(a)}hasModulesSettings(){return!!this.viewsData.size}buildSettingsAPI(a,
b,c,d,e){const g=this;return new Proxy(b,{set(f,h,k){k={[h]:k};Object.assign(f,k);h=!(!c[h]||!0===c[h].hidden);g.dispatchEvent(new CustomEvent("update",{detail:{source:e,storage:d,settings:f,changedSettings:k}}));h&&g.isRendered&&a===g.selectSettings.value&&g.renderSettings(a);return!0},get(f,h){return f[h]}})}render(a,b){this.container=document.createElement("div");this.container.className="gp-settings-manager_";const c=document.createElement("div");c.className="close-btn_";c.addEventListener("click",
this.close);this.container.appendChild(c);this.settingsView=document.createElement("div");this.settingsView.className="gp-settings_";this.container.appendChild(this.settingsView);this.selectSettings=document.createElement("select");this.selectSettings.className="select-module_";this.selectSettings.addEventListener("change",d=>{this.renderSettings(d.target.value)});this.container.appendChild(this.selectSettings);this.isRendered=!0;this.renderSettingsList();this.selectSettings.value&&(this.selectSettings.value=
a||this.selectSettings.value,this.renderSettings(a||this.selectSettings.value,b))}renderSettingsList(){if(this.isRendered){this.selectSettings.innerHTML="";var a=new Intl.Collator("us",{sensitivity:"base"});Array.from(this.viewsData).filter(([b])=>!this.isHiddenModule(b)&&this.hasVisibleSettings(b)).sort(([,b],[,c])=>a.compare(b.title,c.title)).forEach(([b,c])=>{const d=document.createElement("option");d.value=b;d.textContent=c.title;this.selectSettings.appendChild(d)})}}renderSettings(a){if(a&&this.viewsData.has(a)&&
!this.isHiddenModule(a)){var {source:b,storage:c,settings:d,ui:e}=this.viewsData.get(a);this.settingsView.innerHTML="";this.settingsView.classList.remove("json-data_");var g=document.createElement("div");g.className="controls_ gp-scrollbar_";this.settingsView.appendChild(g);var f=document.createElement("div");f.className="buttons_";this.settingsView.appendChild(f);var h=document.createElement("div");h.className="load-btn_ btn_ gp-btn_";h.textContent="\ud83e\udc45";h.title="\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0438\u0437 \u0431\u0443\u0444\u0435\u0440\u0430 \u043e\u0431\u043c\u0435\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON";
h.addEventListener("click",()=>{this.settingsView.classList.toggle("json-data_");k.focus()});h.addEventListener("animationend",n=>{n.target.classList.remove("failure_");n.target.classList.remove("success_")});f.appendChild(h);var k=document.createElement("input");k.className="json-data-input_ gp-input_";k.placeholder="\u0421\u043a\u043e\u043f\u0438\u0440\u0443\u0439\u0442\u0435 \u0441\u044e\u0434\u0430 \u0434\u0430\u043d\u043d\u044b\u0435...";k.spellcheck=!1;k.autocomplete="off";k.addEventListener("input",
n=>{this.jsonDataInputHandler(a,n.target,h)});k.addEventListener("focus",n=>{document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!0}}))});k.addEventListener("blur",n=>{document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!1}}))});f.appendChild(k);var l=document.createElement("div");l.className="restore-btn_ btn_ gp-btn_";l.textContent="\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c";l.title="\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0438\u0433\u0440\u044b";
l.addEventListener("click",()=>{this.restore(a)});f.appendChild(l);l=document.createElement("div");l.className="gp-btn_ btn_ default-btn_";l.textContent="\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438";l.title="\u0412\u044b\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e";l.addEventListener("click",()=>{this.reset(a)});f.appendChild(l);
f=document.createDocumentFragment();for(let n in e){l=e[n]||{};const {type:p,args:r,hidden:q,description:y,text:A}=l;if(this.isLabel(n)){var m=document.createElement("div");m.className=A?"group-label_":"separator_";m.classList.toggle(l.size,!!l.size);m.textContent=A;f.appendChild(m)}else if(p&&!q)if("component"===p)[l]=r,m=document.createElement("div"),m.className="component_",m.appendChild(l()),f.appendChild(m);else if("buttons"===p){const z=document.createElement("div");z.className="buttons_";[l]=
r;l().forEach(t=>{t.classList.add("btn_");z.appendChild(t)});f.appendChild(z)}else if("buttons-g"===p){const z=document.createElement("div");z.className="buttons_";r.forEach(([t,w,u])=>{const x=document.createElement("div");x.className="btn_";x.title=w;x.textContent=t;x.addEventListener("click",u);z.appendChild(x)});f.appendChild(z)}else l=this.buildTooltip(y),f.appendChild(l),l=this.buildLabel(n,y),f.appendChild(l),l=this.buildControl(e,n,d[n],b,c,d),f.appendChild(l)}g.appendChild(f);this.controls=
g;this.selectSettings.value=a}}isLabel(a){return/^_\d+/.test(a)}buildTooltip(a){const b=document.createElement("div");b.className="tooltip_";b.textContent="?";if(!a)return b.classList.add("disabled_"),b;b.addEventListener("pointerenter",c=>{let d=window.gpSettingsTooltip;d||(d=document.createElement("div"),d.className="gp-settings-tooltip_",document.body.appendChild(d),window.gpSettingsTooltip=d);d.textContent=a;const {x:e,y:g,width:f,height:h}=c.target.getBoundingClientRect();({height:c}=d.getBoundingClientRect());
d.style.cssText=`top: ${g-(c-h)/2}px; left: ${e+f+12}px`;window.gpSettingsTooltip=d});b.addEventListener("pointerleave",c=>{window.gpSettingsTooltip&&(window.gpSettingsTooltip.remove(),window.gpSettingsTooltip=null)});return b}buildLabel(a,b){const c=document.createElement("div");c.className="label_";c.title=b||"";c.textContent=a.split(/(?<![A-Z])(?=[A-Z])|(?=[A-Z]\B)/).join(" ");return c}buildControl(a,b,c,d,e,g){const {type:f,data:h,args:k,formatter:l,proxyProp:m,inputTrigger:n}=a[b];a=document.createElement("div");
a.className="control_";let p;switch(f){case "range":const q=document.createElement("div");q.className="preview_ gp-range-preview_";q.textContent=l?l(c):c;const [y,A,z,t]=k;p=document.createElement("input");p.className="gp-range_";p.type="range";p.min=y;p.max=A;p.step=z;p.value=c;p.name=b;t&&(p.style.direction="rtl");p.addEventListener("input",u=>{q.textContent=l?l(Number.parseFloat(u.target.value)):u.target.value});a.appendChild(p);a.appendChild(q);break;case "list":p=document.createElement("select");
p.className="gp-list_";p.autocomplete="off";p.name=b;(m&&g[m]||(k.length?k:[c])).forEach((u,x)=>{const v=document.createElement("option");v.value=u;v.textContent=l?l(u,x):u;p.appendChild(v)});p.value=c;a.appendChild(p);break;case "list-m":case "list-md":var r="list-m"===f?k:c;p=document.createElement("form");p.className="gp-list-m_";p.name=b;r.forEach((u,x)=>{var v=document.createElement("input");v.id=`ctrl-${b}-${x}_`;v.type="checkbox";v.value=u;v.name=b;v.checked=c.includes(u);p.appendChild(v);
v=document.createElement("label");v.textContent=l?l(u,x):u;v.setAttribute("for",`ctrl-${b}-${x}_`);p.appendChild(v)});a.appendChild(p);break;case "list-i":const w=[];p=document.createElement("form");p.className="gp-list-i_";p.name=b;Object.keys(h.icons).forEach((u,x)=>{const v=document.createElement("input");v.id=`ctrl-${b}-${x}_`;v.type="checkbox";v.name=b;v.value=u;v.checked=c===u;v.addEventListener("click",C=>{w.forEach(D=>{D.checked=D===v})});p.appendChild(v);w.push(v);const B=document.createElement("label");
B.className="gp-list-i-icon_";B.title=u.split("-").map(C=>C[0].toUpperCase()+C.slice(1)).join(" ");B.style.backgroundImage=`url("${h.icons[u]}")`;B.setAttribute("for",`ctrl-${b}-${x}_`);p.appendChild(B)});a.appendChild(p);break;case "checkbox":p=document.createElement("div");p.className="gp-tumbler_";r=document.createElement("input");r.id=`ctrl-${b}_`;r.type="checkbox";r.name=b;r.checked=c;p.appendChild(r);r=document.createElement("label");r.setAttribute("for",`ctrl-${b}_`);p.appendChild(r);a.appendChild(p);
break;case "color":p=document.createElement("input");p.className="gp-color_";p.type="color";p.value=c;p.name=b;a.appendChild(p);break;case "input":({hidden:r}=k||{}),p=document.createElement("input"),p.className="gp-input_",p.classList.toggle("secure-input_",!!r),p.spellcheck=!1,p.autocomplete="off",p.value=c,p.name=b,p.addEventListener("keydown",u=>{switch(u.key){case "Escape":u.target.value=u.target.dataset.initialValue;case "Enter":u.target.blur()}}),p.addEventListener("focus",u=>{u.target.select();
document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!0}}));u.target.dataset.initialValue=u.target.value}),p.addEventListener("blur",u=>{window.getSelection().removeAllRanges();document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!1}}));delete u.target.dataset}),a.appendChild(p)}p.addEventListener(n?"input":"change",q=>{q={[q.target.name]:this.parseValue(q.target,f)};this.dispatchEvent(new CustomEvent("update",{detail:{source:d,storage:e,settings:Object.assign(g,q),changedSettings:q}}))});
return a}parseValue(a,b){switch(a.type){case "range":return Number.parseFloat(a.value);case "checkbox":return a.form?"list-i"===b?a.value:[...a.form].filter(c=>c.checked).map(c=>c.value):a.checked;default:return a.value}}jsonDataInputHandler(a,b,c){c.classList.remove("failure_");c.classList.remove("success_");try{let d=JSON.parse(b.value);const {settings:e,source:g,storage:f}=this.viewsData.get(a);d=this.filterSettings(d,e);if(Object.keys(d).length){const h=this.copy(d);Object.assign(e,h);this.renderSettings(a);
this.dispatchEvent(new CustomEvent("update",{detail:{source:g,storage:f,settings:e,changedSettings:h}}));c.classList.add("success_")}else c.classList.add("failure_")}catch(d){c.classList.add("failure_")}b.value=""}filterSettings(a,b){for(let c in a)c in b||delete a[c];return a}reset(a){const {settings:b,defaultSettings:c,source:d,storage:e}=this.viewsData.get(a),g=this.copy(c);Object.assign(b,g);for(let f in b)f in g||delete b[f];this.renderSettings(a);this.dispatchEvent(new CustomEvent("update",
{detail:{source:d,storage:e,settings:b,changedSettings:g}}))}restore(a){const {settings:b,initialSettings:c,source:d,storage:e}=this.viewsData.get(a),g=this.copy(c);Object.assign(b,g);this.renderSettings(a);this.dispatchEvent(new CustomEvent("update",{detail:{source:d,storage:e,settings:b,changedSettings:g}}))}copy(a){return JSON.parse(JSON.stringify(a))}toggle(a,b,c=!1){this.container?(this.container.classList.toggle("hidden",void 0===a?a:!a),this.settingsView.classList.remove("json-data_"),a&&b&&
this.renderSettings(b),this.container.classList.toggle("load-btn-shown_",!!c)):!1!==a&&(this.render(b),document.body.appendChild(this.getElement()),this.container.classList.toggle("load-btn-shown_",!!c))}close(){this.isOpened()&&this.toggle(!1)}isOpened(){return!this.container?.classList.contains("hidden")}isHiddenModule(a){return this.mm.areHiddenSettings(a)}hasVisibleSettings(a){return this.viewsData.get(a).hasVisibleSettings}saveSettings(a,b){window.localStorage.setItem(a,JSON.stringify(b))}}
window.GPSettingsManager_=GPSettingsManager_;class GPColorPicker_ extends EventTarget{static TOP="top";static BOTTOM="bottom";static LEFT="left";static RIGHT="right";static HORIZONTAL="horizontal";static VERTICAL="vertical";static DEFAULT_WIDTH=250;static DEFAULT_HEIGHT=250;static DEFAULT_HUE_POSITION=this.BOTTOM;static HUE_MIN_SIDE_SIZE=30;static HUE_MARGIN=15;constructor(a=GPColorPicker_.DEFAULT_WIDTH,b=GPColorPicker_.DEFAULT_HEIGHT,c=GPColorPicker_.DEFAULT_HUE_POSITION){super();this.style=document.documentElement.style;this.style.setProperty("--cp-hue-margin",
`${GPColorPicker_.HUE_MARGIN}px`);this.container;this.hsv=[0,0,0];this.width=a;this.height=b;this.palettePointerY=this.palettePointerX=0;this.hueBarSize=this.width-2*GPColorPicker_.HUE_MARGIN;this.huePosition=c;this.huePosDir=c===GPColorPicker_.TOP||c===GPColorPicker_.BOTTOM?GPColorPicker_.HORIZONTAL:GPColorPicker_.VERTICAL;this.huePosDir===GPColorPicker_.HORIZONTAL?(this.hueWidth=this.width,this.hueHeight=GPColorPicker_.HUE_MIN_SIDE_SIZE,this.paletteWidth=this.width,this.paletteHeight=this.height-
this.hueHeight):(this.hueWidth=GPColorPicker_.HUE_MIN_SIDE_SIZE,this.hueHeight=this.height,this.paletteWidth=this.width-this.hueWidth,this.paletteHeight=this.height);this.paletteDownHandler=this.paletteDownHandler.bind(this);this.paletteMoveHandler=this.paletteMoveHandler.bind(this);this.hueSliderDownHandler=this.hueSliderDownHandler.bind(this);this.hueSliderMoveHandler=this.hueSliderMoveHandler.bind(this);this.render()}getElement(){return this.container}hide(){this.container.classList.add("hidden");
this.isHidden=!0}show(a,b){let c=0,d=0;switch(this.huePosition){case GPColorPicker_.LEFT:c=this.hueWidth;break;case GPColorPicker_.TOP:d=this.hueHeight}this.container.style.top=`${b-this.palettePointerY-d}px`;this.container.style.left=`${a-this.palettePointerX-c}px`;this.container.classList.remove("hidden");this.isHidden=!1}render(a,b){this.container=document.createElement("div");this.container.className=`gp-color-picker_ ${this.huePosition}_`;this.container.innerHTML='<div class="palette"><div class="hue"><div class="lightness"><div class="darkness"></div><div class="pointer-wrapper"><div class="pointer"></div></div></div></div></div><div class="hue"><div class="slider-wrapper"><div class="slider"><div class="handle-wrapper"><div class="handle"></div></div></div></div></div>';
this.container.style.width=`${this.width}px`;this.container.style.height=`${this.height}px`;this.palette=this.container.querySelector(".palette");this.palette.addEventListener("pointerdown",this.paletteDownHandler);this.paletteHue=this.container.querySelector(".gp-color-picker_ > .palette .hue");this.pointerWrapper=this.container.querySelector(".gp-color-picker_ > .palette .pointer-wrapper");a=this.container.querySelector(".gp-color-picker_ > .hue");a.style.width=`${this.hueWidth}px`;a.style.height=
`${this.hueHeight}px`;this.hueSlider=this.container.querySelector(".gp-color-picker_ > .hue .slider");this.hueSlider.addEventListener("pointerdown",this.hueSliderDownHandler);this.hueHandleWrapper=this.container.querySelector(".gp-color-picker_ > .hue .handle-wrapper")}paletteDownHandler(a){this.palette.setPointerCapture(a.pointerId);this.palette.addEventListener("pointermove",this.paletteMoveHandler);this.palette.addEventListener("pointerup",b=>{this.palette.removeEventListener("pointermove",this.paletteMoveHandler)},
{once:!0});this.paletteMoveHandler(a)}paletteMoveHandler(a){if(!this.isHidden){var [b,c]=this.getCoords(a);b=Math.max(0,Math.min(this.paletteWidth,b));c=Math.max(0,Math.min(this.paletteHeight,c));this.palettePointerX=b;this.palettePointerY=c;this.updatePalettePointer(b,c);this.hsv=this.getPaletteColor(b,c);this.dispatchEvent(new CustomEvent("color",{detail:{color:GPColorUtils_.hsvToHex(...this.hsv)}}))}}hueSliderDownHandler(a){this.hueSlider.setPointerCapture(a.pointerId);this.hueSlider.addEventListener("pointermove",
this.hueSliderMoveHandler);this.hueSlider.addEventListener("pointerup",b=>{this.hueSlider.removeEventListener("pointermove",this.hueSliderMoveHandler)},{once:!0});this.hueSliderMoveHandler(a)}hueSliderMoveHandler(a){if(!this.isHidden){var [b,c]=this.getCoords(a),d=(a=this.huePosDir===GPColorPicker_.HORIZONTAL)?b:c;this.updateHueSlider(d,a);this.hsv[0]=Math.round(Math.max(0,Math.min(100,d/(this.hueBarSize/100))))/100;this.updatePaletteHue(this.hsv[0]);this.dispatchEvent(new CustomEvent("color",{detail:{color:GPColorUtils_.hsvToHex(...this.hsv)}}))}}updatePalettePointer(a,
b){a=Math.max(0,Math.min(100,a/(this.paletteWidth/100)));this.pointerWrapper.style.top=`${Math.max(0,Math.min(100,b/(this.paletteHeight/100)))}%`;this.pointerWrapper.style.left=`${a}%`}updatePaletteHue(a){const [b,c,d]=GPColorUtils_.hsvToRgb(a,1,1);this.paletteHue.style.backgroundColor=`rgb(${b}, ${c}, ${d})`}updateHueSlider(a,b=this.huePosDir===GPColorPicker_.HORIZONTAL){a=Math.max(0,Math.min(100,a/(this.hueBarSize/100)));b?this.hueHandleWrapper.style.left=`${a}%`:this.hueHandleWrapper.style.top=
`${a}%`}getPaletteColor(a,b){return Number.isNaN(a)||Number.isNaN(b)?this.hsv:[this.hsv[0],Math.max(0,Math.min(100,Math.round(a/(this.paletteWidth/100))))/100,Math.max(0,Math.min(100,Math.round((this.paletteHeight-b)/(this.paletteHeight/100))))/100]}getCoords(a){const b=a.target.getBoundingClientRect(),[c,d]=a.touches?[a.touches[0].clientX,a.touches[0].clientY]:[a.clientX,a.clientY],[e,g]=[c-b.left,d-b.top];return[a.target.clientWidth/b.width*e,a.target.clientHeight/b.height*g]}getColor(){return GPColorUtils_.hsvToHex(...this.hsv)}setColor(a){const [b,
c,d]=GPColorUtils_.hexToHsv(a);this.hsv=[b,c,d];a=this.hueBarSize*b;const e=this.paletteWidth*c,g=this.paletteHeight-this.paletteHeight*d;this.palettePointerX=Math.max(0,Math.min(this.paletteWidth,e));this.palettePointerY=Math.max(0,Math.min(this.paletteHeight,g));this.updateHueSlider(a);this.updatePaletteHue(b);this.updatePalettePointer(e,g)}}window.GPColorPicker_=GPColorPicker_;class GPColorUtils_{static hsvToRgb(a,b,c){let d,e,g;const f=Math.floor(6*a),h=6*a-f;a=c*(1-b);const k=c*(1-h*b);b=c*(1-(1-h)*b);switch(f%6){case 0:d=c;e=b;g=a;break;case 1:d=k;e=c;g=a;break;case 2:d=a;e=c;g=b;break;case 3:d=a;e=k;g=c;break;case 4:d=b;e=a;g=c;break;case 5:d=c,e=a,g=k}return[Math.round(255*d),Math.round(255*e),Math.round(255*g)]}static rgbToHex(a,b,c){return"#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1)}static hsvToHex(a,b,c){a=this.hsvToRgb(a,b,c);return this.rgbToHex(...a)}static hexToRgb(a){a=
a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(b,c,d,e)=>c+c+d+d+e+e);return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null}static rgbToHsv(a,b,c){a/=255;b/=255;c/=255;const d=Math.max(a,b,c),e=Math.min(a,b,c);let g;const f=d-e;if(d==e)g=0;else{switch(d){case a:g=(b-c)/f+(b<c?6:0);break;case b:g=(c-a)/f+2;break;case c:g=(a-b)/f+4}g/=6}return[g,0==d?0:f/d,d]}static hexToHsv(a){a=this.hexToRgb(a);return this.rgbToHsv(...a).map(b=>Math.floor(1E3*
b)/1E3)}}window.GPColorUtils_=GPColorUtils_;class GPPainter_ extends EventTarget{static SEARCH_DRAW_CONTAINER_INTERVAL=200;static TOOL={BRUSH:1,ERASER:2,LINE:3,RECTANGLE:4,CIRCLE:5,RECTANGLE_FILLED:6,CIRCLE_FILLED:7,FILL:8,NOTE:10};static TOOLS_IN_TIME=[this.TOOL.BRUSH,this.TOOL.ERASER,this.TOOL.NOTE];static ORIGINAL_WIDTH=758;static ORIGINAL_HEIGHT=424;static DEFAULT_DENSITY=2;static BACKGROUND_COLOR="#ffffff";static DEFAULT_COLOR="#000000";static DEFAULT_THICKNESS=6;static DEFAULT_OPACITY=1;static DEFAULT_TOOL=this.TOOL.BRUSH;static FIRST_STROKE_ID=1;static DEFAULT_MIN_THICKNESS=2;static DEFAULT_MAX_THICKNESS=300;static DEFAULT_MINIMUM_OPACITY=.02;static DEFAULT_OPACITY_STEP=.03;static DEFAULT_BRIGHTNESS_STEP=.03;static DEFAULT_MIN_ZOOM=1;static DEFAULT_MAX_ZOOM=30;static DEFAULT_ZOOM_SENSITIVITY=10;static DEFAULT_LINE_SMOOTHING_LEVEL=0;static STABILIZER_SIZE=5;static POINTER_COLOR=this.DEFAULT_COLOR;static POINTER_OPACITY=1;static POINTER_OUTLINE_COLOR="#FFFFFF";static POINTER_OUTLINE_OPACITY=1;static POINTER_CROSSHAIR_MIN_THICKNESS=5;static POINTER_CROSSHAIR_LINE_LENGTH=6;static FIXED_SCREEN_SIZE=!1;static READY_CONFIRMATION=!1;static TOOLS_THICKNESSES={[this.TOOL.RECTANGLE_FILLED]:1,
[this.TOOL.CIRCLE_FILLED]:1,[this.TOOL.FILL]:1};static DISABLED_MODE_OPTIONS={visible:2};static COLOR_PICKER_WIDTH=250;static COLOR_PICKER_HEIGHT=250;static COLOR_PICKER_HUE_POSITION=GPColorPicker_.RIGHT;static DEFAULT_PANELS_BACKGROUND_COLOR="#5e1933";static DEFAULT_PANELS_BACKGROUND_OPACITY=50;static DEFAULT_PANELS_ELEMENTS_COLOR="#ff8eaf";static DEFAULT_PANELS_ELEMENTS_OPACITY=60;static HEADER_INSTRUCTIONS_COLOR="#43de99";static HIDE_HEADER_BACKGROUND=!1;static AUTO_HIDE_HEADER_ELEMENTS=!1;static AUTO_HIDE_HEADER_ELEMENTS_DELAY=.3;static SYMMETRY_MODES={VERTICAL:0,
HORIZONTAL:1,QUADRANT:2,RADIAL:3,MANDALA:4};static UNSUBSCRIBED_SYMMETRY_MODES=["VERTICAL","HORIZONTAL"];static DEFAULT_SYMMETRY_GUIDES_COLOR="#4affff";static DEFAULT_SYMMETRY_GUIDES_OPACITY=1;static DEFAULT_SYMMETRY_GUIDES_WIDTH=1;static DEFAULT_SYMMETRY_MODE=this.SYMMETRY_MODES.VERTICAL;static DEFAULT_SYMMETRY_GUIDES_COUNT_SENSITIVITY=Math.round(window.screen.height/1080*5);static DEFAULT_SYMMETRY_RADIAL_GUIDES_COUNT=8;static DEFAULT_SYMMETRY_MANDALA_GUIDES_COUNT=4;static MIN_SYMMETRY_RADIAL_GUIDES=2;static MAX_SYMMETRY_RADIAL_GUIDES=32;static MIN_SYMMETRY_MANDALA_GUIDES=2;static MAX_SYMMETRY_MANDALA_GUIDES=16;static SYMMETRY_GUIDES_RADIUS=Math.ceil(Math.sqrt(this.ORIGINAL_WIDTH*
this.ORIGINAL_WIDTH+this.ORIGINAL_HEIGHT*this.ORIGINAL_HEIGHT))*this.DEFAULT_DENSITY;static M_STROKE_OFFSET=67;static M_STROKE_RANGE=100;static UI_SETTINGS={_1:{text:"Default Settings"},defaultColor:{value:this.DEFAULT_COLOR,type:"color",description:"\u0426\u0432\u0435\u0442 \u043a\u0438\u0441\u0442\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0443\u043d\u0434\u0430)"},
defaultThickness:{value:this.DEFAULT_THICKNESS,type:"range",args:[1,600,1],description:"\u0422\u043e\u043b\u0449\u0438\u043d\u0430 \u043a\u0438\u0441\u0442\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0443\u043d\u0434\u0430)"},defaultOpacity:{value:this.DEFAULT_OPACITY,type:"range",
args:[.01,1,.01],description:"\u041d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043a\u0438\u0441\u0442\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0443\u043d\u0434\u0430)"},_2:{text:"Thickness"},minThickness:{value:this.DEFAULT_MIN_THICKNESS,type:"range",
args:[1,600,1],description:"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043b\u0449\u0438\u043d\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},maxThickness:{value:this.DEFAULT_MAX_THICKNESS,type:"range",args:[1,600,1],description:"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043b\u0449\u0438\u043d\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
thicknessAxis:{value:"horizontal",type:"list",args:["horizontal","vertical"],description:"\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0442\u043e\u043b\u0449\u0438\u043d\u044b \u043a\u0438\u0441\u0442\u0438"},upThicknessDirection:{value:"down / right",type:"list",args:["down / right","up / left"],description:"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u0442\u043e\u043b\u0449\u0438\u043d\u044b \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
doubleEraserThickness:{value:!0,type:"checkbox",description:"\u0423\u0434\u0432\u0430\u0438\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u0449\u0438\u043d\u0443 \u043a\u0438\u0441\u0442\u0438 \u043f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u041b\u0430\u0441\u0442\u0438\u043a"},_3:{text:"Opacity"},minOpacity:{value:this.DEFAULT_MINIMUM_OPACITY,type:"range",args:[.01,1,.01],description:"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
opacityStep:{value:this.DEFAULT_OPACITY_STEP,type:"range",args:[.01,.1,.01],description:"\u0428\u0430\u0433 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},opacityAxis:{value:"horizontal",type:"list",args:["horizontal","vertical"],description:"\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438"},
upOpacityDirection:{value:"up / left",type:"list",args:["down / right","up / left"],description:"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},_4:{text:"Brightness"},brightnessStep:{value:this.DEFAULT_BRIGHTNESS_STEP,
type:"range",args:[.01,.1,.01],description:"\u0428\u0430\u0433 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},brightnessAxis:{value:"vertical",type:"list",args:["horizontal","vertical"],description:"\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438"},
upBrightnessDirection:{value:"up / left",type:"list",args:["down / right","up / left"],description:"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},_5:{text:"Zoom"},minZoom:{value:this.DEFAULT_MIN_ZOOM,
type:"range",args:[.1,1,.1],description:"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},maxZoom:{value:this.DEFAULT_MAX_ZOOM,type:"range",args:[2,60,1],description:"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
zoomSensitivity:{value:this.DEFAULT_ZOOM_SENSITIVITY,type:"range",args:[1,20,1],description:"\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},zoomAxis:{value:"vertical",type:"list",args:["horizontal","vertical"],
description:"\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430"},zoomInDirection:{value:"up / left",type:"list",args:["down / right","up / left"],description:"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
maxZoomToPoint:{value:3,type:"range",args:[2,60,1],description:"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435 \u0445\u043e\u043b\u0441\u0442\u0430 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0442\u043e\u0447\u043a\u0443"},_6:{text:"Pointer"},pointerOpacity:{value:this.POINTER_OPACITY,type:"range",args:[0,1,.1],description:"\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u044c \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f"},
pointerOutlineOpacity:{value:this.POINTER_OUTLINE_OPACITY,type:"range",args:[0,1,.1],description:"\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u044c \u043a\u043e\u043d\u0442\u0443\u0440\u0430 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f"},_7:{text:"Color Picker"},colorPickerHuePosition:{value:this.COLOR_PICKER_HUE_POSITION,type:"list",args:[GPColorPicker_.TOP,GPColorPicker_.BOTTOM,GPColorPicker_.RIGHT,GPColorPicker_.LEFT],description:"\u0420\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u0437\u0443\u043d\u043a\u0430 \u043e\u0442\u0442\u0435\u043d\u043a\u0430 \u0434\u043b\u044f \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0446\u0432\u0435\u0442\u043e\u0432 (\u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c)"},
colorPickerWidth:{value:250,type:"range",args:[100,350,1],description:"\u0428\u0438\u0440\u0438\u043d\u0430 \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0446\u0432\u0435\u0442\u043e\u0432 (\u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c)"},colorPickerHeight:{value:250,type:"range",args:[100,350,1],description:"\u0412\u044b\u0441\u043e\u0442\u0430 \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0446\u0432\u0435\u0442\u043e\u0432 (\u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c)"},
_8:{text:"Interface"},fixedScreenSize:{value:this.FIXED_SCREEN_SIZE,type:"checkbox",description:"\u0424\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430 (\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442 \u0440\u0430\u0437\u043c\u0435\u0440 \u043e\u043a\u043d\u0430 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430)"},
readyConfirmation:{value:this.READY_CONFIRMATION,type:"checkbox",description:'\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0445\u043e\u0434\u0430, \u0435\u0441\u043b\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 "\u0412\u0420\u0415\u041c\u042f" \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d, \u043a\u0430\u043a "\u0420\u0415\u0428\u0415\u041d\u0418\u0415 \u0412\u0415\u0414\u0423\u0429\u0415\u0413\u041e" (\u043f\u0440\u0438 \u0443\u0441\u043b\u043e\u0432\u0438\u0438, \u0447\u0442\u043e \u0412\u044b \u044f\u0432\u043b\u044f\u0435\u0442\u0435\u0441\u044c \u0432\u043b\u0430\u0434\u0435\u043b\u044c\u0446\u0435\u043c \u043a\u043e\u043c\u043d\u0430\u0442\u044b)'},
extendedPalettePanel:{value:!0,type:"checkbox",description:"\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u0430\u044f \u043f\u0430\u043d\u0435\u043b\u044c \u043f\u0430\u043b\u0438\u0442\u0440\u044b (\u0437\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e)"},colorPickerPanel:{value:!0,type:"checkbox",description:"\u041f\u0430\u043d\u0435\u043b\u044c \u0432\u044b\u0431\u043e\u0440\u0430 \u0446\u0432\u0435\u0442\u0430"},panelsBackgroundColor:{value:this.DEFAULT_PANELS_BACKGROUND_COLOR,
type:"color",inputTrigger:!0,description:"\u0426\u0432\u0435\u0442 \u0444\u043e\u043d\u0430 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"},panelsBackgroundOpacity:{value:this.DEFAULT_PANELS_BACKGROUND_OPACITY,type:"range",args:[0,100,1],inputTrigger:!0,description:"\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u044c \u0444\u043e\u043d\u0430 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"},
panelsElementsColor:{value:this.DEFAULT_PANELS_ELEMENTS_COLOR,type:"color",inputTrigger:!0,description:"\u0426\u0432\u0435\u0442 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"},panelsElementsOpacity:{value:this.DEFAULT_PANELS_ELEMENTS_OPACITY,type:"range",args:[0,100,1],inputTrigger:!0,description:"\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"},
_9:{text:"Header"},hideHeaderBackground:{value:this.HIDE_HEADER_BACKGROUND,type:"checkbox",description:"\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0444\u043e\u043d \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0438 \u0440\u0430\u043c\u043a\u0438 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430"},autoHideHeaderElements:{value:this.AUTO_HIDE_HEADER_ELEMENTS,type:"checkbox",description:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430 (\u043a\u0440\u043e\u043c\u0435 \u043b\u043e\u0433\u043e \u0438 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0430\u0439\u043c\u0435\u0440\u0430) \u0438 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043f\u0440\u0438 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0438\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f"},
autoHideHeaderDelay:{value:this.AUTO_HIDE_HEADER_ELEMENTS_DELAY,type:"range",args:[0,1,.1],description:"\u0417\u0430\u0434\u0435\u0440\u0436\u043a\u0430 \u043f\u0435\u0440\u0435\u0434 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u0441\u043a\u0440\u044b\u0442\u0438\u0435\u043c/\u043f\u043e\u043a\u0430\u0437\u043e\u043c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"},headerInstructionsColor:{value:this.HEADER_INSTRUCTIONS_COLOR,
type:"color",inputTrigger:!0,description:"\u0426\u0432\u0435\u0442 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0439 \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430"},_10:{text:"Line Smoothing"},lineSmoothingLevel:{value:this.DEFAULT_LINE_SMOOTHING_LEVEL,type:"range",args:[0,8,1],description:"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0441\u0433\u043b\u0430\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u043b\u0438\u043d\u0438\u0439 \u0434\u043b\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u041a\u0438\u0441\u0442\u044c, \u041b\u0430\u0441\u0442\u0438\u043a \u0438 \u0417\u0430\u043c\u0435\u0442\u043a\u0430"},
eraserLineSmoothing:{value:!1,type:"checkbox",description:"\u041f\u0440\u0438\u043c\u0435\u043d\u044f\u0442\u044c \u0441\u0433\u043b\u0430\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u043b\u0438\u043d\u0438\u0439 \u0434\u043b\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u041b\u0430\u0441\u0442\u0438\u043a"},_11:{text:"Symmetry Guides"},symmetryGuidesColor:{value:this.DEFAULT_SYMMETRY_GUIDES_COLOR,type:"color",inputTrigger:!0,description:"\u0426\u0432\u0435\u0442 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0438"},
symmetryGuidesOpacity:{value:this.DEFAULT_SYMMETRY_GUIDES_OPACITY,type:"range",args:[0,1,.01],inputTrigger:!0,description:"\u041d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0438"},symmetryGuidesWidth:{value:this.DEFAULT_SYMMETRY_GUIDES_WIDTH,type:"range",args:[1,8,.5],inputTrigger:!0,description:"\u0428\u0438\u0440\u0438\u043d\u0430 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0438"},
symmetryRadialGuidesCount:{value:this.DEFAULT_SYMMETRY_RADIAL_GUIDES_COUNT,hidden:!0},symmetryMandalaGuidesCount:{value:this.DEFAULT_SYMMETRY_MANDALA_GUIDES_COUNT,hidden:!0},symmetryMode:{value:this.DEFAULT_SYMMETRY_MODE,hidden:!0}};static DEFAULT_BINDINGS={dropper:[["AltLeft"]],thickness:[["ControlLeft"]],opacity:[["ShiftLeft"]],brightness:[["KeyV"]],zoom:[["KeyZ"]],zoomToPoint:[["KeyS"]],zoomReset:[["KeyA"]],mirror:[["CapsLock"]],palette:[["Tab"]],swap:[["KeyX"]],eraser:[["KeyC"]],grayscale:[["KeyW"]],
hand:[["Space"]],clear:[["KeyF"]],symmetry:[["KeyT"]],brushTool:[["KeyB"]],eraserTool:[["KeyE"]],save:[["ControlLeft","KeyS"]],undo:[["ControlLeft","KeyZ"]],redo:[["ControlLeft","KeyY"],["ControlLeft","ShiftLeft","KeyZ"]],save:[["ControlLeft","KeyS"]]};static NATIVE_BINDINGS_KEYS=new Set(["KeyE","KeyB","KeyZ"]);static MODULE={title:"Painter",dependencies:["GPDrawInterface_","GPColorUtils_","GPColorPicker_"]};static INIT(a){new GPPainter_(a.gpproxy,a.timer,a.reference,a.ac)}constructor(a,b,c,d){super();
this.gpproxy=a;this.timer=b;this.reference=c;this.ac=d;this.tools={dropper:{handler:this.dropperKeyDown,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041f\u0438\u043f\u0435\u0442\u043a\u0430 (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0446\u0432\u0435\u0442 \u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043c\u044b\u0448\u0438)"},thickness:{handler:this.thicknessKeyDown,description:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0442\u043e\u043b\u0449\u0438\u043d\u044b \u043a\u0438\u0441\u0442\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
opacity:{handler:this.opacityKeyDown,description:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},brightness:{handler:this.brightnessKeyDown,description:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
zoom:{handler:this.zoomKeyDown,description:"\u041f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435/\u043e\u0442\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0445\u043e\u043b\u0441\u0442\u0430 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},zoomToPoint:{handler:this.zoomToPoint,description:"\u041f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435/\u043e\u0442\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0445\u043e\u043b\u0441\u0442\u0430 \u0432 \u0442\u043e\u0447\u043a\u0443 \u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},
zoomReset:{handler:this.resetZoom,description:"\u0421\u0431\u0440\u043e\u0441 \u0443\u0440\u043e\u0432\u043d\u044f \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f/\u043e\u0442\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430"},mirror:{handler:this.mirror,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0417\u0435\u0440\u043a\u0430\u043b\u043e (\u043e\u0442\u0440\u0430\u0436\u0430\u0435\u0442 \u0445\u043e\u043b\u0441\u0442 \u043f\u043e \u0433\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u0438)"},
palette:{handler:this.palette,description:"\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043f\u0430\u043b\u0438\u0442\u0440\u0443 \u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"},swap:{handler:this.swap,description:"\u041c\u0435\u043d\u044f\u0435\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0446\u0432\u0435\u0442\u0430 \u043c\u0435\u0441\u0442\u0430\u043c\u0438 (\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043d\u0430 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0446\u0432\u0435\u0442)"},
eraser:{handler:this.eraser,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041b\u0430\u0441\u0442\u0438\u043a (\u043f\u0440\u0438 \u0437\u0430\u0436\u0430\u0442\u0438\u0438 \u043a\u043b\u0430\u0432\u0438\u0448\u0438 - \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u043f\u0440\u0438 \u043e\u0442\u043f\u0443\u0441\u043a\u0430\u043d\u0438\u0438 - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442)"},
grayscale:{handler:this.grayscale,description:"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0447\u0451\u0440\u043d\u043e-\u0431\u0435\u043b\u044b\u0439 \u0444\u0438\u043b\u044c\u0442\u0440"},hand:{handler:this.handKeyDown,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0420\u0443\u043a\u0430 (\u043f\u0440\u0438 \u0437\u0430\u0436\u0430\u0442\u0438\u0438 \u043a\u043b\u0430\u0432\u0438\u0448\u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0430\u0442\u044c \u0445\u043e\u043b\u0441\u0442 \u041b\u0435\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u0438\u043b\u0438 \u0441\u0442\u0438\u043b\u0443\u0441\u043e\u043c)"},
clear:{handler:this.clear,description:"\u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u0445\u043e\u043b\u0441\u0442\u0430 (\u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0432 \u0440\u0435\u0436\u0438\u043c\u0430\u0445 \u0410\u043d\u0438\u043c\u0430\u0446\u0438\u044f, \u0424\u043e\u043d \u0438 \u0421\u043e\u043b\u043e)"},symmetry:{handler:this.symmetry,description:"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0435 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u043e\u0433\u043e \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f"},
brushTool:{handler:this.brushTool,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041a\u0438\u0441\u0442\u044c"},eraserTool:{handler:this.eraserTool,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041b\u0430\u0441\u0442\u0438\u043a"},undo:{handler:this.undo,repeat:!0,description:"\u041e\u0442\u043c\u0435\u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0448\u0442\u0440\u0438\u0445\u0430"},redo:{handler:this.redo,repeat:!0,
description:"\u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u043e\u0442\u043c\u0435\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u0448\u0442\u0440\u0438\u0445\u0430"},save:{handler:this.save,description:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041b\u0430\u0441\u0442\u0438\u043a"}};this.settings=Object.assign({},this.parseUISettings(GPPainter_.UI_SETTINGS),JSON.parse(window.localStorage.getItem("gp_painter")));this.bindings=Object.assign({},JSON.parse(JSON.stringify(GPPainter_.DEFAULT_BINDINGS)),
JSON.parse(window.localStorage.getItem("gp_painter_bindings")));this.s=this.settings;this.areKeysLocked=!1;this.iface=new GPDrawInterface_(this,this.gpproxy);this.density=GPPainter_.DEFAULT_DENSITY;this.width=GPPainter_.ORIGINAL_WIDTH*this.density;this.height=GPPainter_.ORIGINAL_HEIGHT*this.density;this.style=document.documentElement.style;this.style.setProperty("--gp-painter-heigth-width",`${GPPainter_.ORIGINAL_WIDTH}px`);this.style.setProperty("--gp-painter-heigth",`${GPPainter_.ORIGINAL_HEIGHT}px`);
this.style.setProperty("--gp-painter-background-color",`${GPPainter_.BACKGROUND_COLOR}`);this.color=this.settings.defaultColor;this.color2=GPPainter_.BACKGROUND_COLOR;this.thickness=Math.max(this.settings.minThickness,Math.min(this.settings.maxThickness,this.settings.defaultThickness));this.opacity=Math.max(this.settings.minOpacity,this.settings.defaultOpacity);this.tool=GPPainter_.DEFAULT_TOOL;this.isNote=!1;this.searchTimer=null;this.strokeId=GPPainter_.FIRST_STROKE_ID;this.strokeOptions=[];this.strokeCoords=
[];this.history=[];this.undos=[];this.lastDrawData=this.backgroundData=null;this.isSigned=!1;this.mStrokeId=null;this.mStrokeOrigin=this.getRandomInt(GPPainter_.M_STROKE_RANGE);this.isSubscribed=!1;this.pointerY=this.pointerX=0;this.isSymmetryGuidesMoved=this.isSymmetryGuidesEditable=this.isSymmetryEnabled=this.isDrawing=this.isZoomedToPoint=this.isHand=this.isEraser=this.isMirrored=this.isZooming=this.isBrightnessSetting=this.isThicknessSetting=this.isOpacitySetting=this.isDropperDown=this.isDropper=
!1;this.symmetryStrokesOptions=[];this.symmetryCoords=[];this.symmetryStrokesGroups={};this.symmetryGuideX=Math.round(GPPainter_.ORIGINAL_WIDTH/2);this.symmetryGuideY=Math.round(GPPainter_.ORIGINAL_HEIGHT/2);this.radiansPerSymmetryRadialGuide=2*Math.PI/this.s.symmetryRadialGuidesCount;this.radiansPerSymmetryMandalaGuide=2*Math.PI/this.s.symmetryMandalaGuidesCount;this.isDisabled=!1;this.pointerMoveHandler=null;this.localization=this.gpproxy.getLocalization("draw");this.isReadyWarningShown=!1;this.lineSmoothingCounter=
1;this.background;this.backgroundCtx;this.lastDraw;this.lastDrawCtx;this.canvas;this.canvasCtx;this.stroke;this.strokeCtx;this.pointer;this.pointerCtx;this.colorPicker;this.colorPickerWidth=GPPainter_.COLOR_PICKER_WIDTH;this.colorPickerHeight=GPPainter_.COLOR_PICKER_HEIGHT;this.colorPickerHuePos=GPPainter_.COLOR_PICKER_HUE_POSITION;this.globalCoordsHandler=this.globalCoordsHandler.bind(this);this.keyDownHandler=this.keyDownHandler.bind(this);this.keyUpHandler=this.keyUpHandler.bind(this);this.inject=
this.inject.bind(this);this.searchDrawContainer=this.searchDrawContainer.bind(this);this.getFillData=this.getFillData.bind(this);this.saveImage=this.saveImage.bind(this);this.clearPointer=this.clearPointer.bind(this);this.middleButtonDown=this.middleButtonDown.bind(this);this.rightButtonDown=this.rightButtonDown.bind(this);this.strokeDown=this.strokeDown.bind(this);this.strokeUp=this.strokeUp.bind(this);this.strokeMove=this.strokeMove.bind(this);this.strokeProcess=this.strokeProcess.bind(this);this.drawPointer=
this.drawPointer.bind(this);this.dropperKeyDown=this.dropperKeyDown.bind(this);this.dropperKeyUp=this.dropperKeyUp.bind(this);this.dropperMove=this.dropperMove.bind(this);this.dropperDown=this.dropperDown.bind(this);this.dropperUp=this.dropperUp.bind(this);this.resetKeys=this.resetKeys.bind(this);this.thicknessKeyDown=this.thicknessKeyDown.bind(this);this.thicknessKeyUp=this.thicknessKeyUp.bind(this);this.thicknessDown=this.thicknessDown.bind(this);this.opacityKeyDown=this.opacityKeyDown.bind(this);
this.opacityKeyUp=this.opacityKeyUp.bind(this);this.opacityDown=this.opacityDown.bind(this);this.brightnessKeyDown=this.brightnessKeyDown.bind(this);this.brightnessKeyUp=this.brightnessKeyUp.bind(this);this.brightnessDown=this.brightnessDown.bind(this);this.zoomKeyDown=this.zoomKeyDown.bind(this);this.zoomKeyUp=this.zoomKeyUp.bind(this);this.zoomDown=this.zoomDown.bind(this);this.mouseZoom=this.mouseZoom.bind(this);this.handKeyDown=this.handKeyDown.bind(this);this.handKeyUp=this.handKeyUp.bind(this);
this.handDown=this.handDown.bind(this);this.symmetryGuidesDownHandler=this.symmetryGuidesDownHandler.bind(this);this.changeSymmetryRadialGuidesCount=this.changeSymmetryRadialGuidesCount.bind(this);this.changeSymmetryMandalaGuidesCount=this.changeSymmetryMandalaGuidesCount.bind(this);this.blockContextMenu=this.blockContextMenu.bind(this);this.resizeWindowHandler=this.resizeWindowHandler.bind(this);this.keysMap=this.buildKeysMap(this.bindings);this.pressedKeys=new Set;this.currentBinding=null;this.addEventListener("stroke",
({detail:{data:g,symmetryStrokesData:f=[]}})=>{this.drawFunction(this.canvasCtx,[g,...f]);this.strokeOptions=[];this.strokeCoords=[];this.symmetryCoords=[];f.length&&(this.symmetryStrokesGroups[g[1]]=g[1],f.map(h=>{this.symmetryStrokesGroups[h[1]]=g[1]}));this.clearStroke();this.history.push(g,...f);this.undos.length&&(this.undos=[]);this.shouldBeSigned()&&this.sign()});this.addEventListener("stroke_started",({detail:{data:g,symmetryStrokesData:f=[]}})=>{[g,...f].forEach(h=>{this.gpproxy.tool(1,h)})});
this.addEventListener("stroke_process",({detail:{data:g,symmetryStrokesData:f=[]}})=>{[g,...f].forEach(h=>{this.gpproxy.tool(3,h)})});this.addEventListener("stroke_ended",({detail:{data:g,symmetryStrokesData:f=[]}})=>{[g,...f].forEach(h=>{this.gpproxy.tool(3,h)})});this.addEventListener("stroke_undo",({detail:{data:g}})=>{this.gpproxy.undo(g[1])});this.addEventListener("stroke_redo",({detail:{data:g}})=>{this.gpproxy.redo(g)});this.gpproxy.addEventListener("localization",({detail:{data:g,type:f}})=>
{"draw"===f&&(this.localization=g)});this.gpproxy.addEventListener("turn_started",()=>{this.terminate();this.resetTurnSettings();this.setTimer()});this.gpproxy.addEventListener("turns_ended",g=>{this.terminate();this.stopTimer()});this.iface.addEventListener("settings_updated",({detail:{settings:g}})=>{this.updateSettings(g);this.saveSettings()});this.iface.addEventListener("bindings_updated",({detail:{bindings:g}})=>{this.updateBindings(g);this.saveBindings()});document.addEventListener("_url_changed",
({detail:{path:g}})=>{"/draw"===g&&(this.enabled=this.isPermittedMode(),this.terminate(),this.inject())});document.addEventListener("_keys_lock",({detail:{state:g}})=>{this.setKeysLockState(g)});document.addEventListener("_subs_status",({detail:{status:g}})=>{this.isSubscribed=g});const e=this;Element.prototype.addEventListener=new Proxy(Element.prototype.addEventListener,{apply(g,f,h){if(!(f.classList?.contains("drawingContainer")&&["mousedown","pointerdown","contextmenu","touchstart"].includes(h[0])&&
e.isPermittedMode()))return g.apply(f,h)}});this.timer&&this.timer.addEventListener("finish",g=>{this.timer.settings.readyAfterTimeExpires&&this.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION)&&this.gpproxy.isOwner()&&this.iface.readyBtn.click()});this.reference&&this.reference.addEventListener("state_changed",({detail:{isEnabled:g}})=>{g&&this.resizeWindowHandler()})}buildKeysMap(a){const b={};for(let c in a)a[c].forEach(d=>{const e=d.length;b[e]=b[e]||[];b[e].push({name:c,keys:d,...this.tools[c]})});
return b}bindingHandler(a,b){const c=this.getBinding();c?(a.preventDefault(),a.stopImmediatePropagation(),a.repeat&&a.repeat!==!!c.repeat||!a.repeat&&c.name===this.currentBinding?.name||(c.handler.apply(this,[a]),this.currentBinding=c)):!b&&this.isNativeBinding(a.code)&&a.stopImmediatePropagation()}isNativeBinding(a){return GPPainter_.NATIVE_BINDINGS_KEYS.has(a)}getBinding(){var a=this.pressedKeys.size;if(this.currentBinding){if(!a)return this.currentBinding=null;if(!this.keysMap[a])return this.currentBinding.keys.length>
a&&(this.currentBinding=null),null}if(a=(this.keysMap[a]||[]).find(({keys:b})=>{const c=this.pressedKeys.values();return b.every(d=>d===c.next().value)}))return a;this.checkForMatchBinding()||(this.currentBinding=null);return null}checkForMatchBinding(){if(this.currentBinding){var a=this.pressedKeys.values();return this.currentBinding.keys.every(b=>b===a.next().value)}}keyDownHandler(a){this.isDisabled||this.areKeysLocked||(this.pressedKeys.add(a.code),this.bindingHandler(a))}keyUpHandler(a){this.isDisabled||
this.areKeysLocked||(this.pressedKeys.delete(a.code),this.bindingHandler(a,!0))}render(){this.container=document.createElement("div");this.container.className="gp-painter_";this.container.addEventListener("pointerdown",this.suppressEvents);this.container.addEventListener("pointermove",this.suppressEvents);this.container.addEventListener("mousedown",this.suppressEvents);this.container.addEventListener("mousemove",this.suppressEvents);this.container.addEventListener("mouseup",this.suppressEvents);this.container.addEventListener("mousecancel",
this.suppressEvents);this.container.addEventListener("touchstart",this.suppressEvents,!0);this.container.addEventListener("touchend",this.suppressEvents,!0);this.container.addEventListener("touchcancel",this.suppressEvents,!0);this.drawingArea=document.createElement("div");this.drawingArea.className="drawing-area";this.container.appendChild(this.drawingArea);this.background=document.createElement("canvas");this.background.className="background_";this.background.classList.add("hidden");this.background.width=
this.width;this.background.height=this.height;this.backgroundCtx=this.background.getContext("2d");this.backgroundCtx.fillStyle=GPPainter_.BACKGROUND_COLOR;this.backgroundCtx.fillRect(0,0,this.width,this.height);this.drawingArea.appendChild(this.background);this.lastDraw=document.createElement("canvas");this.lastDraw.className="last-draw_";this.lastDraw.classList.add("hidden");this.lastDraw.width=this.width;this.lastDraw.height=this.height;this.lastDrawCtx=this.lastDraw.getContext("2d");this.drawingArea.appendChild(this.lastDraw);
this.canvas=document.createElement("canvas");this.canvas.className="canvas_";this.canvas.width=this.width;this.canvas.height=this.height;this.canvasCtx=this.canvas.getContext("2d");this.drawingArea.appendChild(this.canvas);this.stroke=document.createElement("canvas");this.stroke.className="stroke_";this.stroke.width=this.width;this.stroke.height=this.height;this.stroke.addEventListener("contextmenu",this.blockContextMenu);this.stroke.addEventListener("pointermove",this.drawPointer);this.stroke.addEventListener("pointerdown",
this.middleButtonDown);this.stroke.addEventListener("pointerdown",this.rightButtonDown);this.stroke.addEventListener("pointerdown",this.strokeDown);this.stroke.addEventListener("pointerdown",this.dropperDown);this.stroke.addEventListener("pointerdown",this.thicknessDown);this.stroke.addEventListener("pointerdown",this.opacityDown);this.stroke.addEventListener("pointerdown",this.brightnessDown);this.stroke.addEventListener("pointerdown",this.zoomDown);this.stroke.addEventListener("pointerdown",this.handDown);
this.stroke.addEventListener("pointerout",this.clearPointer);this.stroke.addEventListener("wheel",this.mouseZoom);this.drawingArea.appendChild(this.stroke);this.strokeCtx=this.stroke.getContext("2d");this.strokeCtx.lineJoin="round";this.strokeCtx.lineCap="round";this.strokeCtx.strokeStyle=this.settings.defaultColor;this.strokeCtx.lineWidth=this.settings.defaultThickness;this.strokeCtx.globalAlpha=this.settings.defaultOpacity;this.pointer=document.createElement("canvas");this.pointer.className="pointer_";
this.pointer.width=this.width;this.pointer.height=this.height;this.drawingArea.appendChild(this.pointer);this.pointerCtx=this.pointer.getContext("2d");this.pointerCtx.lineWidth=this.density;this.symmetryGuides=document.createElement("canvas");this.symmetryGuides.className="symmetry-guides_";this.symmetryGuides.width=this.width;this.symmetryGuides.height=this.height;this.symmetryGuidesCtx=this.symmetryGuides.getContext("2d");this.symmetryGuidesCtx.strokeStyle=this.s.symmetryGuidesColor;this.symmetryGuidesCtx.globalAlpha=
this.s.symmetryGuidesOpacity;this.symmetryGuidesCtx.lineWidth=this.s.symmetryGuidesWidth*this.density;this.symmetryGuides.addEventListener("contextmenu",this.blockContextMenu);this.symmetryGuides.addEventListener("pointerdown",this.symmetryGuidesDownHandler);this.drawSymmetryGuides();this.drawingArea.appendChild(this.symmetryGuides);this.zoomer=window.renderer({minScale:this.settings.minZoom,maxScale:this.settings.maxZoom,element:this.drawingArea,defaultScaleSensitivity:this.settings.zoomSensitivity});
this.initColorPicker({width:this.settings.colorPickerWidth,height:this.settings.colorPickerHeight,huePos:this.settings.colorPickerHuePosition})}terminate(){this.container&&(clearTimeout(this.strokeTimer),clearTimeout(this.searchTimer),window.removeEventListener("blur",this.resetKeys),window.removeEventListener("focus",this.resetKeys),window.removeEventListener("resize",this.resizeWindowHandler),document.removeEventListener("pointermove",this.globalCoordsHandler,!0),document.removeEventListener("keydown",
this.keyDownHandler,!0),document.removeEventListener("keyup",this.keyUpHandler,!0),document.removeEventListener("contextmenu",this.blockContextMenu),this.stroke.removeEventListener("pointermove",this.strokeMove),this.stroke.removeEventListener("pointerup",this.strokeUp,{once:!0}),this.stroke.removeEventListener("pointermove",this.thicknessMoveHandler),this.stroke.removeEventListener("pointermove",this.opacityMoveHandler),this.stroke.removeEventListener("pointermove",this.brightnessMoveHandler),this.stroke.removeEventListener("pointermove",
this.zoomMoveHandler),this.stroke.removeEventListener("pointermove",this.handMoveHandler),this.clearPointer(),this.clearStroke(),this.clearCanvas(),this.clearBackground(),this.resetZoom(),this.resetMirror(),this.container.classList.remove("grayscale_"),this.background.classList.add("hidden"),this.lastDraw.classList.add("hidden"),this.symmetryGuides.classList.remove("editable_"),this.colorPicker.hide(),this.iface.terminate(),this.reference?.terminate(),this.container.remove())}resetTurnSettings(){this.container&&
(this.color=this.settings.defaultColor,this.color2=GPPainter_.BACKGROUND_COLOR,this.thickness=Math.max(this.settings.minThickness,Math.min(this.settings.maxThickness,this.settings.defaultThickness)),this.opacity=Math.max(this.settings.minOpacity,this.settings.defaultOpacity),this.tool=GPPainter_.DEFAULT_TOOL,this.isSymmetryEnabled=!1,this.symmetryStrokesGroups={},this.symmetryGuides.classList.remove("shown_"),this.isSigned=!1,this.mStrokeOrigin=this.getRandomInt(GPPainter_.M_STROKE_RANGE))}init(){const a=
this.gpproxy.getState(),b=this.gpproxy.getCurrentTurnId();this.searchTimer=null;this.strokeOptions=[];this.strokeCoords=[];this.history=a.draw||[];this.backgroundData=this.ac?.isSuspicious(`tbg_${b}`)?[]:a.background;this.lastDrawData=this.ac?.isSuspicious(`t_${b}`)?[]:a.lastDraw;this.strokeId=this.calculateStrokeID();this.undos=[];this.pointerY=this.pointerX=0;this.isDrawing=this.isZoomedToPoint=this.isHand=this.isEraser=this.isMirrored=this.isZooming=this.isBrightnessSetting=this.isThicknessSetting=
this.isOpacitySetting=this.isDropperDown=this.isDropper=this.areKeysLocked=!1;this.currentBinding=null;this.pressedKeys.clear();this.isSymmetryGuidesMoved=this.isSymmetryGuidesEditable=this.isReadyWarningShown=this.isNote=this.isDisabled=!1;this.symmetryStrokesOptions=[];this.symmetryCoords=[];!this.isSubscribed&&!this.gpproxy.isSoloGame()&&1<this.s.symmetryMode&&(this.s.symmetryMode=GPPainter_.DEFAULT_SYMMETRY_MODE,this.drawSymmetryGuides());document.addEventListener("pointermove",this.globalCoordsHandler,
!0);document.addEventListener("keydown",this.keyDownHandler,!0);document.addEventListener("keyup",this.keyUpHandler,!0);window.addEventListener("blur",this.resetKeys);window.addEventListener("focus",this.resetKeys);window.addEventListener("resize",this.resizeWindowHandler);this.redrawBackground();this.redrawLastDraw();this.redrawCanvas();this.background.classList.toggle("hidden",!this.backgroundData);this.lastDraw.classList.toggle("hidden",!this.lastDrawData);this.zoomer.setContainerScale(this.getContainerScale());
this.iface.init();this.reference?.init();this.gpproxy.isReady()&&this.iface.disableInterface()}inject(){this.enabled&&(this.container||this.render(),this.searchDrawContainer().then(a=>{a.appendChild(this.container);this.init()}))}searchDrawContainer(){return new Promise(a=>{this.searchTimer=setTimeout(()=>{const b=document.querySelector(".drawingContainer");b?(clearTimeout(this.searchTimer),a(b)):this.searchDrawContainer()},GPPainter_.SEARCH_DRAW_CONTAINER_INTERVAL)})}isPermittedMode(){const {configs:a}=
this.gpproxy.getState();for(let b in GPPainter_.DISABLED_MODE_OPTIONS)if(a[b]===GPPainter_.DISABLED_MODE_OPTIONS[b])return!1;return!0}initColorPicker({width:a,height:b,huePos:c}={}){this.colorPickerWidth=a??this.colorPickerWidth;this.colorPickerHeight=b??this.colorPickerHeight;this.colorPickerHuePos=c??this.colorPickerHuePos;this.colorPicker?.getElement()&&this.colorPicker.getElement().remove();this.colorPicker=new GPColorPicker_(this.colorPickerWidth,this.colorPickerHeight,this.colorPickerHuePos);
this.colorPicker.setColor(this.color);this.colorPicker.hide();this.colorPicker.addEventListener("color",({detail:{color:d}})=>{this.color=d;this.iface.updateColorInput(d);this.iface.updateColorPicker(d);this.iface.resetPaletteColor()});document.body.appendChild(this.colorPicker.getElement())}calculateStrokeID(){const a=[...this.history,...this.undos].reduceRight((b,c)=>c[1]>b?c[1]:b,GPPainter_.FIRST_STROKE_ID-1);return Math.max(a+1,GPPainter_.FIRST_STROKE_ID)}middleButtonDown(a){1!==a.button||this.isThicknessSetting||
this.isOpacitySetting||this.isBrightnessSetting||this.isZooming||this.isHand||(this.handDown(a,!0),a.stopPropagation(),a.stopImmediatePropagation())}rightButtonDown(a){if(2===a.button){if(this.isThicknessSetting)this.stroke.removeEventListener("pointermove",this.thicknessMoveHandler),this.thickness=this.settings.defaultThickness,this.iface.updateThickness(this.thickness),this.renderPointer(...this.getCoords(a),void 0,void 0,!0);else if(this.isOpacitySetting)this.stroke.removeEventListener("pointermove",
this.opacityMoveHandler),this.setOpacity(this.settings.defaultOpacity),this.renderPointer(...this.getCoords(a),this.opacity,void 0,!0);else if(this.isBrightnessSetting){this.stroke.removeEventListener("pointermove",this.zoomMoveHandler);this.brightness=1;const [b,c]=GPColorUtils_.hexToHsv(this.color),d=GPColorUtils_.hsvToHex(b,c,this.brightness);this.setColor(d);this.renderPointer(...this.getCoords(a),this.opacity,void 0,!0)}else this.isZooming?(this.stroke.removeEventListener("pointermove",this.zoomMoveHandler),
this.resetZoom()):this.isHand?this.resetZoom():this.strokeDown(a,this.color2);document.addEventListener("contextmenu",this.blockContextMenu,{once:!0});a.stopPropagation();a.stopImmediatePropagation()}}strokeDown(a,b){if(!(this.isDropper||this.isDropperDown||this.isOpacitySetting||this.isThicknessSetting||this.isBrightnessSetting||this.isZooming||this.isHand)){var c=this.getOCoords(a);this.strokeOptions=this.getStrokeOptions(this.tool,b);this.strokeCoords=[c];this.isSymmetryEnabled&&this.convertToSymmetryCoords(c).forEach((d,
e)=>{const g=this.strokeOptions.slice();g[1]=this.strokeId++;this.symmetryStrokesOptions[e]=g;this.symmetryCoords[e]=[d]});this.lineSmoothingCounter=1;this.tool===GPPainter_.TOOL.FILL?(this.updateStrokeCoords(this.strokeCoords,this.getCoords(a)),a=this.buildStrokeData(this.strokeOptions,this.strokeCoords),this.dispatchEvent(new CustomEvent("stroke_started",{detail:{data:a}})),this.dispatchEvent(new CustomEvent("stroke",{detail:{data:a}}))):(this.stroke.setPointerCapture(a.pointerId),this.stroke.addEventListener("pointermove",
this.strokeMove),this.stroke.addEventListener("pointerup",this.strokeUp,{once:!0}),a=[...this.strokeOptions,...this.strokeCoords],b=this.buildSymmetryStrokesData(!0),this.drawFunction(this.strokeCtx,[a,...b],this.density,!1),clearTimeout(this.strokeTimer),this.isToolInTime()&&(this.strokeTimer=setTimeout(this.strokeProcess,1E3),this.dispatchEvent(new CustomEvent("stroke_started",{detail:{data:a,symmetryStrokesData:b}}))),this.isDrawing=!0)}}buildSymmetryStrokesData(a=!1){const b=[];this.isSymmetryEnabled&&
this.symmetryCoords.forEach((c,d)=>{b.push(this.buildStrokeData(this.symmetryStrokesOptions[d],c,a))});return b}rotatePoint(a,b,c,d,e){var g=Math.PI/180*e;e=Math.cos(g);g=Math.sin(g);return[e*(c-a)+g*(d-b)+a,e*(d-b)-g*(c-a)+b]}convertToSymmetryCoords([a,b],c=this.s.symmetryMode){const d=this.isMirrored?GPPainter_.ORIGINAL_WIDTH-this.symmetryGuideX:this.symmetryGuideX,e=this.symmetryGuideY,g=[];switch(c){case GPPainter_.SYMMETRY_MODES.VERTICAL:g.push([d+(d-a),b]);break;case GPPainter_.SYMMETRY_MODES.HORIZONTAL:g.push([a,
e+(e-b)]);break;case GPPainter_.SYMMETRY_MODES.QUADRANT:g.push([d+(d-a),b]);g.push([a,e+(e-b)]);g.push([d+(d-a),e+(e-b)]);break;case GPPainter_.SYMMETRY_MODES.RADIAL:c=this.s.symmetryRadialGuidesCount;var f=360/c;for(var h=1;h<c;h++){const [l,m]=this.rotatePoint(d,e,a,b,h*f);g.push([Math.round(l),Math.round(m)])}break;case GPPainter_.SYMMETRY_MODES.MANDALA:c=e+(e-b);f=2*this.s.symmetryMandalaGuidesCount;h=360/f;const k=this.s.symmetryMandalaGuidesCount%2?2*h:3*h;for(let l=1;l<f;l++){let m,n;l%2?(m=
l*h+k,n=c):(m=l*h,n=b);const [p,r]=this.rotatePoint(d,e,a,n,m);g.push([Math.round(p),Math.round(r)])}}return g}strokeMove(a){a=this.getOCoords(a);this.updateStrokeCoords(this.strokeCoords,a);this.isSymmetryEnabled&&(a=this.convertToSymmetryCoords(a),this.updateSymmetryStrokeCoords(a));a=this.buildSymmetryStrokesData(!0);this.clearStroke();this.drawFunction(this.strokeCtx,[[...this.strokeOptions,...this.strokeCoords],...a],this.density,!1);this.lineSmoothingCounter++}strokeUp(a){clearTimeout(this.strokeTimer);
this.s.lineSmoothingLevel&&this.lineSmoothingCounter%(this.s.lineSmoothingLevel+1)&&this.strokeCoords.push(this.getOCoords(a));a=this.buildStrokeData(this.strokeOptions,this.strokeCoords);const b=this.buildSymmetryStrokesData(),c=this.isToolInTime()?"stroke_ended":"stroke_started";this.dispatchEvent(new CustomEvent(c,{detail:{data:a,symmetryStrokesData:b}}));this.dispatchEvent(new CustomEvent("stroke",{detail:{data:a,symmetryStrokesData:b}}));this.isDrawing=!1;this.stroke.removeEventListener("pointermove",
this.strokeMove)}strokeProcess(){let a;this.isSymmetryEnabled&&(a=[],this.symmetryCoords.forEach((b,c)=>{a.push(this.buildStrokeData(this.symmetryStrokesOptions[c],b))}));this.dispatchEvent(new CustomEvent("stroke_process",{detail:{data:[...this.strokeOptions,...this.strokeCoords],symmetryStrokesData:a}}));this.isToolInTime()&&(clearTimeout(this.strokeTimer),this.strokeTimer=setTimeout(this.strokeProcess,1E3))}updateSymmetryStrokeCoords(a){a.forEach((b,c)=>{this.updateStrokeCoords(this.symmetryCoords[c],
b)})}updateStrokeCoords(a,b){switch(this.tool){case GPPainter_.TOOL.BRUSH:case GPPainter_.TOOL.ERASER:case GPPainter_.TOOL.NOTE:this.s.lineSmoothingLevel&&(this.tool!==GPPainter_.TOOL.ERASER||this.s.eraserLineSmoothing)&&this.lineSmoothingCounter%(this.s.lineSmoothingLevel+1)||a.push(b);break;case GPPainter_.TOOL.LINE:case GPPainter_.TOOL.RECTANGLE:case GPPainter_.TOOL.CIRCLE:case GPPainter_.TOOL.RECTANGLE_FILLED:case GPPainter_.TOOL.CIRCLE_FILLED:b=[a[0],b];a.splice(0,a.length);a.push(...b);break;
case GPPainter_.TOOL.FILL:a.splice(0,a.length),a.push(...this.getFillData(b[0],b[1]))}}getStrokeOptions(a=this.tool,b=this.color,c=this.thickness){switch(a){case GPPainter_.TOOL.BRUSH:case GPPainter_.TOOL.LINE:case GPPainter_.TOOL.RECTANGLE:case GPPainter_.TOOL.CIRCLE:case GPPainter_.TOOL.RECTANGLE_FILLED:case GPPainter_.TOOL.CIRCLE_FILLED:return[a,this.strokeId++,[b,c,this.opacity]];case GPPainter_.TOOL.ERASER:return[a,this.strokeId++,this.s.doubleEraserThickness?2*c:c];case GPPainter_.TOOL.FILL:return[a,
this.strokeId++,[b,this.opacity]];case GPPainter_.TOOL.NOTE:return[a,this.strokeId++,null]}}buildStrokeData(a,b,c=!1){return[...a,...(!c&&this.isMirrored&&a[0]!==GPPainter_.TOOL.FILL?this.mirrorStrokeCoords(b):b)]}drawPointer(a,b,c){const [d,e]=this.getCoords(a);this.pointerX=d;this.pointerY=e;this.renderPointer(d,e,b,c)}renderPointer(a,b,c,d=this.thickness,e){this.clearPointer();c=this.isOpacitySetting?this.opacity:c;d=this.isZooming?1:!e&&GPPainter_.TOOLS_THICKNESSES[this.tool]||d;this.tool===GPPainter_.TOOL.ERASER&&
this.s.doubleEraserThickness&&(d*=2);e=this.pointerCtx;e.beginPath();e.arc(a,b,d/2*this.density,0,2*Math.PI);c&&(e.fillStyle=`rgba(${this.hexToRgb(this.color).join(",")},${c}`,e.fill());e.strokeStyle=GPPainter_.POINTER_COLOR;e.stroke();e.beginPath();e.arc(a,b,(d/2+1)*this.density,0,2*Math.PI);e.strokeStyle=GPPainter_.POINTER_OUTLINE_COLOR;e.globalAlpha=this.settings.pointerOutlineOpacity;e.stroke();e.globalAlpha=this.settings.pointerOpacity;d<GPPainter_.POINTER_CROSSHAIR_MIN_THICKNESS&&(c=3*d*this.density,
d=GPPainter_.POINTER_CROSSHAIR_LINE_LENGTH*this.density,e.strokeStyle=GPPainter_.POINTER_OUTLINE_COLOR,e.globalAlpha=this.settings.pointerOutlineOpacity,e.beginPath(),e.moveTo(a,b-c),e.lineTo(a,b-c-d),e.moveTo(a+c,b),e.lineTo(a+c+d,b),e.moveTo(a,b+c),e.lineTo(a,b+c+d),e.moveTo(a-c,b),e.lineTo(a-c-d,b),e.stroke(),e.globalAlpha=this.settings.pointerOpacity)}updatePointer(){this.renderPointer(this.pointerX,this.pointerY)}setTool(a){this.tool=a;a=a===GPPainter_.TOOL.NOTE;const b=a!==this.isNote;this.isNote=
a;b&&(this.redrawBackground(),this.redrawLastDraw(),this.redrawCanvas())}setColor(a,b=!1){this.color=a;this.colorPicker.setColor(a);this.iface.updateColorInput(a);this.iface.updateColorPicker(a,b);this.iface.resetPaletteColor()}setColor2(a){this.color2=a;this.iface.updateColor2Input(a)}setOpacity(a){this.opacity=a;this.iface.updateOpacity(a)}setThickness(a){this.thickness=a}toggleLastDraw(a){this.lastDraw.classList.toggle("hidden",!a)}clearBackground(){this.backgroundCtx.fillStyle=GPPainter_.BACKGROUND_COLOR;
this.backgroundCtx.fillRect(0,0,this.background.width,this.background.height)}clearLastDraw(){this.lastDrawCtx.clearRect(0,0,this.lastDraw.width,this.lastDraw.height)}clearCanvas(){this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}clearStroke(){this.strokeCtx.clearRect(0,0,this.stroke.width,this.stroke.height)}clearPointer(){this.pointerCtx.clearRect(0,0,this.pointer.width,this.pointer.height)}redrawBackground(){this.clearBackground();this.backgroundData?.length&&this.drawFunction(this.backgroundCtx,
this.backgroundData,this.density,!1,this.isNote)}redrawLastDraw(){this.clearLastDraw();this.lastDrawData?.length&&this.drawFunction(this.lastDrawCtx,this.lastDrawData,this.density,!0,this.isNote)}redrawCanvas(){this.clearCanvas();this.history.length&&this.drawFunction(this.canvasCtx,this.history,this.density,!0,this.isNote)}getCoords(a){const b=a.target.getBoundingClientRect(),[c,d]=a.touches?[a.touches[0].clientX,a.touches[0].clientY]:[a.clientX,a.clientY],[e,g]=[c-b.left,d-b.top];return[Math.round(a.target.width/
b.width*e),Math.round(a.target.height/b.height*g)]}getOCoords(a){const [b,c]=this.getCoords(a);return[Math.round(b/this.density),Math.round(c/this.density)]}globalCoordsHandler(a){this.cX=a.clientX;this.cY=a.clientY}resetKeys(a){this.container&&(this.drawingArea.classList.remove("dropper_"),this.drawingArea.classList.remove("dropper-s_"),this.drawingArea.classList.remove("hand_"),this.drawingArea.classList.remove("hand-s_"),this.isHand=this.isEraser=this.isZooming=this.isBrightnessSetting=this.isThicknessSetting=
this.isOpacitySetting=this.isDropperDown=this.isDropper=!1,this.stroke.removeEventListener("pointermove",this.thicknessMoveHandler),this.stroke.removeEventListener("pointermove",this.opacityMoveHandler),this.stroke.removeEventListener("pointermove",this.brightnessMoveHandler),this.stroke.removeEventListener("pointermove",this.zoomMoveHandler),this.stroke.removeEventListener("pointermove",this.handMoveHandler),this.currentBinding=null,a&&(this.pressedKeys.clear(),this.bindingHandler(a)))}dropperKeyDown(a){a.preventDefault();
this.isDropper=!0;this.drawingArea.classList.add("dropper_");document.addEventListener("keyup",this.dropperKeyUp,{once:!0})}dropperKeyUp(a){this.isDropper&&(a.preventDefault(),this.isDropper=!1,this.drawingArea.classList.remove("dropper_"),this.isDropperDown||this.stroke.removeEventListener("pointermove",this.dropperMove))}dropperDown(a){this.isDropper&&(this.isDropperDown=!0,this.dropperMove(a),this.drawingArea.classList.add("dropper-s_"),this.stroke.setPointerCapture(a.pointerId),this.stroke.addEventListener("pointermove",
this.dropperMove),this.stroke.addEventListener("pointerup",this.dropperUp,{once:!0}))}dropperMove(a){if(this.isDropper||this.isDropperDown){var [b,c]=this.getCoords(a);b=this.isMirrored?this.width-b:b;a=this.getPixelColor(b,c);this.setColor(a)}}dropperUp(a){let [b,c]=this.getCoords(a);b=this.isMirrored?this.width-b:b;a=this.getPixelColor(b,c);this.setColor(a);this.isDropperDown=!1;this.drawingArea.classList.remove("dropper-s_");this.stroke.removeEventListener("pointermove",this.dropperMove)}getPixelColor(a,
b){var c=document.createElement("canvas");c.width=1;c.height=1;c=c.getContext("2d");c.fillStyle=GPPainter_.BACKGROUND_COLOR;c.fillRect(0,0,1,1);this.backgroundData?.length&&c.drawImage(this.background,a,b,1,1,0,0,1,1);this.lastDrawData?.length&&c.drawImage(this.lastDraw,a,b,1,1,0,0,1,1);c.drawImage(this.canvas,a,b,1,1,0,0,1,1);const [d,e,g,f]=c.getImageData(0,0,1,1).data;return f?`${this.rgbToHex(d,e,g)}`:GPPainter_.BACKGROUND_COLOR}thicknessKeyDown(a){this.isThicknessSetting=!0;this.renderPointer(this.pointerX,
this.pointerY,void 0,void 0,!0);document.addEventListener("keyup",this.thicknessKeyUp,{once:!0})}thicknessKeyUp(a){this.isThicknessSetting&&(this.isThicknessSetting=!1)}thicknessDown(a){if(this.isThicknessSetting&&0===a.button){var [b,c]=this.getCoords(a);this.thicknessMoveHandler=this.thicknessMove(b,c,b,c);this.stroke.setPointerCapture(a.pointerId);this.stroke.addEventListener("pointermove",this.thicknessMoveHandler);this.stroke.addEventListener("pointerup",d=>{this.stroke.removeEventListener("pointermove",
this.thicknessMoveHandler);this.dispatchEvent(new CustomEvent("thickness",{detail:{thickness:this.thickness}}))},{once:!0});this.thicknessMoveHandler(a)}}thicknessMove(a,b,c,d){return e=>{const [g,f]=this.getCoords(e);e=Math.round(Math.max(Math.min(this.thickness+("horizontal"===this.settings.thicknessAxis?g-c:f-d)*("down / right"===this.settings.upThicknessDirection?1:-1),this.settings.maxThickness),this.settings.minThickness));c=g;d=f;e&&(this.thickness=e,this.iface.updateThickness(e),this.renderPointer(a,
b,void 0,void 0,!0))}}opacityKeyDown(a){this.isOpacitySetting=!0;this.renderPointer(this.pointerX,this.pointerY,this.opacity,void 0,!0);document.addEventListener("keyup",this.opacityKeyUp,{once:!0})}opacityKeyUp(a){this.isOpacitySetting&&(this.isOpacitySetting=!1)}opacityDown(a){if(this.isOpacitySetting&&0===a.button){var [b,c]=this.getCoords(a);this.opacityMoveHandler=this.opacityMove(b,c,b,c);this.stroke.setPointerCapture(a.pointerId);this.stroke.addEventListener("pointermove",this.opacityMoveHandler);
this.stroke.addEventListener("pointerup",d=>{this.stroke.removeEventListener("pointermove",this.opacityMoveHandler);this.drawPointer(d,null);this.dispatchEvent(new CustomEvent("opacity",{detail:{opacity:this.opacity}}))},{once:!0});this.opacityMoveHandler(a)}}opacityMove(a,b,c,d){return e=>{const [g,f]=this.getCoords(e);e=Math.max(this.settings.minOpacity,Math.min(Math.round(100*(this.opacity+-Math.sign(("horizontal"===this.settings.opacityAxis?g-c:f-d)*("up / left"===this.settings.upOpacityDirection?
1:-1))*this.settings.opacityStep))/100,1));c=g;d=f;this.setOpacity(e);this.renderPointer(a,b,e,void 0,!0)}}brightnessKeyDown(a){this.isBrightnessSetting=!0;this.renderPointer(this.pointerX,this.pointerY,this.opacity,void 0,!0);document.addEventListener("keyup",this.brightnessKeyUp,{once:!0})}brightnessKeyUp(a){this.isBrightnessSetting&&(this.isBrightnessSetting=!1)}brightnessDown(a){if(this.isBrightnessSetting&&0===a.button){var [b,c,d]=GPColorUtils_.hexToHsv(this.color);this.brightness=d;var [e,
g]=this.getCoords(a);this.brightnessMoveHandler=this.brightnessMove(e,g,e,g,b,c);this.stroke.setPointerCapture(a.pointerId);this.stroke.addEventListener("pointermove",this.brightnessMoveHandler);this.stroke.addEventListener("pointerup",f=>{this.stroke.removeEventListener("pointermove",this.brightnessMoveHandler);this.drawPointer(f,null);this.dispatchEvent(new CustomEvent("brightness",{detail:{brightness:this.brightness}}))},{once:!0});this.brightnessMoveHandler(a)}}brightnessMove(a,b,c,d,e,g){return f=>
{const [h,k]=this.getCoords(f);f=Math.max(.01,Math.min(1,Math.round(100*(this.brightness+-Math.sign(("horizontal"===this.settings.brightnessAxis?h-c:k-d)*("up / left"===this.settings.upBrightnessDirection?1:-1))*this.settings.brightnessStep))/100));c=h;d=k;this.brightness=f;f=GPColorUtils_.hsvToHex(e,g,f);this.setColor(f);this.renderPointer(a,b,this.opacity,void 0,!0)}}handKeyDown(a){this.isHand=!0;this.drawingArea.classList.add("hand_");document.addEventListener("keyup",this.handKeyUp,{once:!0})}handKeyUp(a){this.isHand&&
(this.drawingArea.classList.remove("hand_"),this.isHand=!1)}handDown(a,b){if(b||this.isHand&&0===a.button)this.drawingArea.classList.add("hand-s_"),this.clearPointer(),this.handMoveHandler=this.handMove(),this.stroke.setPointerCapture(a.pointerId),document.addEventListener("contextmenu",this.blockContextMenu),this.stroke.addEventListener("pointermove",this.handMoveHandler),this.stroke.addEventListener("pointerup",c=>{this.stroke.removeEventListener("pointermove",this.handMoveHandler);this.drawingArea.classList.remove("hand-s_");
this.drawPointer(c);setTimeout(()=>{document.removeEventListener("contextmenu",this.blockContextMenu)},0)},{once:!0}),this.handMoveHandler(a)}handMove(){return a=>{this.zoomer.panBy({originX:a.movementX,originY:a.movementY})}}zoomKeyDown(a){this.isZooming=!0;this.renderPointer(this.pointerX,this.pointerY,null,1);document.addEventListener("keyup",this.zoomKeyUp,{once:!0})}zoomKeyUp(a){this.isZooming&&(this.renderPointer(this.pointerX,this.pointerY,null,this.thickness),this.isZooming=!1)}zoomDown(a){if(this.isZooming&&
0===a.button){this.isZoomedToPoint&&this.resetZoom();var [b,c]=this.getCoords(a),d=a.pageX,e=a.pageY;this.zoomMoveHandler=this.zoomMove(b,c,d,e,d,e);this.stroke.setPointerCapture(a.pointerId);this.stroke.addEventListener("pointermove",this.zoomMoveHandler);this.stroke.addEventListener("pointerup",g=>{this.stroke.removeEventListener("pointermove",this.zoomMoveHandler);1>=this.zoomer.getScale()&&this.resetZoom()},{once:!0});this.zoomMoveHandler(a)}}zoomMove(a,b,c,d,e,g){return f=>{const h=f.pageX;f=
f.pageY;const k=("horizontal"===this.settings.zoomAxis?h-e:f-g)*("up / left"===this.settings.zoomInDirection?1:-1);2<Math.abs(k)&&(this.zoomer.zoom({deltaScale:-Math.sign(k),x:c-window.scrollX,y:d-window.scrollY,scaleSensitivity:this.settings.zoomSensitivity}),e=h,g=f);this.renderPointer(a,b,null,1)}}mouseZoom(a){this.isZoomedToPoint&&this.resetZoom();this.zoomer.zoom({deltaScale:-Math.sign(a.deltaY),x:a.pageX-window.scrollX,y:a.pageY-window.scrollY,scaleSensitivity:this.settings.zoomSensitivity});
1>=this.zoomer.getScale()&&this.resetZoom();a.preventDefault()}resetZoom(){this.zoomer.reset();this.isZoomedToPoint=!1}resizeWindowHandler(a){a=this.getActualScale();this.zoomer.setContainerScale(a);this.iface.roundPixelOffset()}getActualScale(){return this.settings.fixedScreenSize||this.reference?.isEnabled()?1:this.getContainerScale()}getContainerScale(){let a=(window.innerWidth-180)/1150;766*a>window.innerHeight&&(a=window.innerHeight/766);return a}suppressEvents(a){a.preventDefault();a.stopPropagation();
a.stopImmediatePropagation()}blockContextMenu(a){a.preventDefault()}mirrorStrokeCoords(a){if(a.length)return Array.isArray(a[0])?a.map(([b,c])=>[this.width/this.density-b,c]):a.map(b=>b%2?b:this.width/this.density-b)}resetMirror(){this.container.classList.remove("mirror_")}isToolInTime(){return GPPainter_.TOOLS_IN_TIME.includes(this.tool)}rgbToHex(a,b,c){return"#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1)}hexToRgb(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(b,c,d,e)=>c+c+d+d+e+e);return(a=
/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null}saveImage(){const a=document.createElement("canvas");a.width=GPPainter_.ORIGINAL_WIDTH;a.height=GPPainter_.ORIGINAL_HEIGHT;var b=a.getContext("2d");b.drawImage(this.background,0,0,a.width,a.height);b.drawImage(this.canvas,0,0,a.width,a.height);var c=this.gpproxy.getState();b=c.user.nick;c="string"===typeof c.previous?.data?c.previous.data:"\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430";
const d=(new Date).toLocaleDateString("ru-RU");b=`${b} - ${c} (${d}).png`;c=document.createElement("a");c.href=a.toDataURL();c.download=b;c.click()}clear(){var a=this.getStrokeOptions(GPPainter_.TOOL.ERASER,void 0,Math.trunc(Math.hypot(GPPainter_.ORIGINAL_WIDTH,GPPainter_.ORIGINAL_HEIGHT)));a=this.buildStrokeData(a,[[GPPainter_.ORIGINAL_WIDTH/2,GPPainter_.ORIGINAL_HEIGHT/2]]);this.dispatchEvent(new CustomEvent("stroke_started",{detail:{data:a}}));this.dispatchEvent(new CustomEvent("stroke_ended",
{detail:{data:a}}));this.dispatchEvent(new CustomEvent("stroke",{detail:{data:a}}))}brushTool(){this.setTool(GPPainter_.TOOL.BRUSH);this.iface.updateToolbar(this.tool);this.updatePointer()}eraserTool(){this.setTool(GPPainter_.TOOL.ERASER);this.iface.updateToolbar(this.tool);this.updatePointer()}undo(){let a;do{if(!this.history.length)return;a=this.history.pop();this.undos.push(a);this.dispatchEvent(new CustomEvent("stroke_undo",{detail:{data:a}}))}while(void 0!==this.symmetryStrokesGroups[a[1]]&&
this.symmetryStrokesGroups[a[1]]===this.symmetryStrokesGroups[this.history.at(-1)?.[1]]);!this.history.length&&this.isSigned&&this.unsign();this.clearCanvas();this.drawFunction(this.canvasCtx,this.history,this.density,!0,this.isNote)}redo(){let a;do{if(!this.undos.length)return;a=this.undos.pop();this.history.push(a);this.drawFunction(this.canvasCtx,[a],this.density,!0,this.isNote);this.dispatchEvent(new CustomEvent("stroke_redo",{detail:{data:a}}))}while(void 0!==this.symmetryStrokesGroups[a[1]]&&
this.symmetryStrokesGroups[a[1]]===this.symmetryStrokesGroups[this.undos.at(-1)?.[1]]);this.shouldBeSigned()&&this.sign()}swap(){const [a,b]=[this.color2,this.color];this.setColor(a);this.setColor2(b)}mirror(){this.isMirrored=!this.isMirrored;this.container.classList.toggle("mirror_",this.isMirrored)}eraser(a){if(!this.isEraser){this.isEraser=!0;var b=this.tool;this.setTool(GPPainter_.TOOL.ERASER);this.iface.updateToolbar(this.tool);var c=d=>{d.code===a.code&&(this.isEraser=!1,this.setTool(b),this.iface.updateToolbar(this.tool),
document.removeEventListener("keyup",c))};document.addEventListener("keyup",c)}}symmetry(a){if(!this.isDrawing){this.isSymmetryGuidesEditable=!0;this.symmetryGuides.classList.add("editable_");if(this.isSymmetryEnabled){const c=d=>{d.code===a.code&&(this.isSymmetryGuidesMoved||(this.isSymmetryEnabled=!1,this.symmetryGuides.classList.remove("shown_"),this.iface.updateSymmetryPanel(this.isSymmetryEnabled)),document.removeEventListener("keyup",c))};document.addEventListener("keyup",c)}else this.isSymmetryEnabled=
!0,this.symmetryGuides.classList.add("shown_"),this.iface.updateSymmetryPanel(this.isSymmetryEnabled);var b=c=>{c.code===a.code&&(this.isSymmetryGuidesEditable=this.isSymmetryGuidesMoved=!1,this.symmetryGuides.classList.remove("editable_"),document.removeEventListener("keyup",b))};document.addEventListener("keyup",b)}}symmetryGuidesDownHandler(a){function b(d){const [e,g]=d.touches?[d.touches[0].clientX,d.touches[0].clientY]:[d.clientX,d.clientY];d=d.target.getBoundingClientRect();let [f,h]=[Math.round((e-
d.left)/c),Math.round((g-d.top)/c)];this.isMirrored&&(f=GPPainter_.ORIGINAL_WIDTH-f);this.updateSymmetryGuides(Math.max(0,Math.min(GPPainter_.ORIGINAL_WIDTH,f)),Math.max(0,Math.min(GPPainter_.ORIGINAL_HEIGHT,h)))}if(this.isSymmetryGuidesEditable)if(2===a.button)this.resetSymmetryGuides();else{var c=this.getActualScale();b=b.bind(this);a.target.setPointerCapture(a.pointerId);a.target.addEventListener("pointermove",b);a.target.addEventListener("pointerup",d=>{d.target.removeEventListener("pointermove",
b)},{once:!0});b(a);this.isSymmetryGuidesMoved=!0}}updateSymmetryGuides(a,b){this.symmetryGuideX=a;this.symmetryGuideY=b;this.drawSymmetryGuides(a,b)}resetSymmetryGuides(){this.updateSymmetryGuides(Math.round(GPPainter_.ORIGINAL_WIDTH/2),Math.round(GPPainter_.ORIGINAL_HEIGHT/2));this.isSymmetryGuidesMoved=!0}drawSymmetryGuides(a=this.symmetryGuideX,b=this.symmetryGuideY){const c=this.symmetryGuidesCtx;a*=this.density;b*=this.density;c.clearRect(0,0,c.canvas.width,c.canvas.height);c.beginPath();switch(this.s.symmetryMode){case GPPainter_.SYMMETRY_MODES.VERTICAL:c.moveTo(a,
0);c.lineTo(a,GPPainter_.ORIGINAL_HEIGHT*this.density);break;case GPPainter_.SYMMETRY_MODES.HORIZONTAL:c.moveTo(0,b);c.lineTo(GPPainter_.ORIGINAL_WIDTH*this.density,b);break;case GPPainter_.SYMMETRY_MODES.QUADRANT:c.moveTo(a,0);c.lineTo(a,GPPainter_.ORIGINAL_HEIGHT*this.density);c.moveTo(0,b);c.lineTo(GPPainter_.ORIGINAL_WIDTH*this.density,b);break;case GPPainter_.SYMMETRY_MODES.RADIAL:c.arc(a,b,50*this.density,0,2*Math.PI);for(var d=-(Math.PI/2);d<1.5*Math.PI;d+=this.radiansPerSymmetryRadialGuide){var e=
Math.cos(d)*GPPainter_.SYMMETRY_GUIDES_RADIUS,g=Math.sin(d)*GPPainter_.SYMMETRY_GUIDES_RADIUS;c.moveTo(a,b);c.lineTo(e+a,g+b)}break;case GPPainter_.SYMMETRY_MODES.MANDALA:for(d=1.5*Math.PI,e=-(Math.PI/2);e<d;e+=this.radiansPerSymmetryMandalaGuide){g=Math.cos(e)*GPPainter_.SYMMETRY_GUIDES_RADIUS;const f=Math.sin(e)*GPPainter_.SYMMETRY_GUIDES_RADIUS;c.moveTo(a,b);c.lineTo(g+a,f+b)}}c.stroke()}setSymmetryGuidesColor(a){this.symmetryGuidesCtx.strokeStyle=a;this.drawSymmetryGuides()}setSymmetryGuidesOpacity(a){this.symmetryGuidesCtx.globalAlpha=
a;this.drawSymmetryGuides()}setSymmetryGuidesWidth(a){this.symmetryGuidesCtx.lineWidth=a*this.density;this.drawSymmetryGuides()}setSymmetryMode(a){this.s.symmetryMode=a;this.drawSymmetryGuides();this.saveSettings()}getSymmetryMode(){return this.s.symmetryMode}getSymmetryModes(){const a=Object.keys(GPPainter_.SYMMETRY_MODES);return this.isSubscribed||this.gpproxy.isSoloGame()?a:GPPainter_.UNSUBSCRIBED_SYMMETRY_MODES}changeSymmetryRadialGuidesCount(a){this.s.symmetryRadialGuidesCount=Math.min(GPPainter_.MAX_SYMMETRY_RADIAL_GUIDES,
Math.max(GPPainter_.MIN_SYMMETRY_RADIAL_GUIDES,this.s.symmetryRadialGuidesCount+(0<a?-1:1)));this.radiansPerSymmetryRadialGuide=2*Math.PI/this.s.symmetryRadialGuidesCount;this.drawSymmetryGuides();this.saveSettings();return this.s.symmetryRadialGuidesCount}changeSymmetryMandalaGuidesCount(a){this.s.symmetryMandalaGuidesCount=Math.min(GPPainter_.MAX_SYMMETRY_MANDALA_GUIDES,Math.max(GPPainter_.MIN_SYMMETRY_MANDALA_GUIDES,this.s.symmetryMandalaGuidesCount+(0<a?-1:1)));this.radiansPerSymmetryMandalaGuide=
2*Math.PI/this.s.symmetryMandalaGuidesCount;this.drawSymmetryGuides();this.saveSettings();return this.s.symmetryMandalaGuidesCount}palette(a){const b=this.stroke.getBoundingClientRect(),c=b.left+(this.cX-b.left),d=b.top+(this.cY-b.top);if(c>=b.left&&c<=b.right&&d>=b.top&&d<=b.bottom){this.colorPicker.show(c,d);const e=g=>{g.code===a.code&&(this.colorPicker.hide(),document.removeEventListener("keyup",e))};document.addEventListener("keyup",e)}}zoomToPoint(a){a=this.zoomer.getScale();const [b,c]=[this.pointerX/
this.density,this.pointerY/this.density];1!==a?(this.resetZoom(),this.clearPointer(),this.isZoomedToPoint=!1):(a=this.settings.maxZoomToPoint,this.zoomer.panTo({originX:-(b-GPPainter_.ORIGINAL_WIDTH/2)*a,originY:-(c-GPPainter_.ORIGINAL_HEIGHT/2)*a,scale:a}),this.clearPointer(),this.isZoomedToPoint=!0)}grayscale(){this.container.classList.toggle("grayscale_")}save(){this.saveImage()}disable(){this.resetZoom();this.pressedKeys.clear();this.resetKeys();this.container.classList.add("disabled_");this.isDisabled=
!0}enable(){this.container.classList.remove("disabled_");this.isDisabled=!1}drawFunction(a,b,c=this.density,d=!0,e=!0){a.lineCap=a.lineJoin="round";a.save();if(b){let n=[];for(var g=0;g<b.length;g++){var f=b[g],h=f[0];f=(f[1],f.slice(2));if(10!=h){var k=void 0;a.save();if(8!=h){for(k=1;k<f.length;k++)f[k]=[f[k][0]*c,f[k][1]*c];if(2<f.length)switch(h){case 1:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;k=[f[1][0],f[1][1]];a.beginPath();a.moveTo(...k);for(var l=2;l<f.length;l++)k=
[f[l][0],f[l][1]],h=[f[l-1][0],f[l-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(k[0]-h[0])/2,h[1]+(k[1]-h[1])/2);a.lineTo(k[0],k[1]);a.stroke();break;case 2:a.strokeStyle=GPPainter_.BACKGROUND_COLOR;a.lineWidth=f[0]*c;k=[f[1][0],f[1][1]];d&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo(...k);for(l=2;l<f.length;l++)k=[f[l][0],f[l][1]],h=[f[l-1][0],f[l-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(k[0]-h[0])/2,h[1]+(k[1]-h[1])/2);a.lineTo(k[0],k[1]);a.stroke();d&&(a.globalCompositeOperation=
"source-over");break;case 3:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.moveTo(f[1][0],f[1][1]);a.lineTo(f[2][0],f[2][1]);a.stroke();break;case 4:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.rect(f[1][0],f[1][1],f[2][0]-f[1][0],f[2][1]-f[1][1]);a.stroke();break;case 6:h=f[0];a.fillStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.rect(f[1][0],f[1][1],f[2][0]-f[1][0],f[2][1]-
f[1][1]);a.fill();break;case 5:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;h=(f[2][0]-f[1][0])/2;k=(f[2][1]-f[1][1])/2;l=Math.round(f[1][0]+h);f=Math.round(f[1][1]+k);var m=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(l,f-k);a.bezierCurveTo(l+m*h,f-k,l+h,f-m*k,l+h,f);a.bezierCurveTo(l+h,f+m*k,l+m*h,f+k,l,f+k);a.bezierCurveTo(l-m*h,f+k,l-h,f+m*k,l-h,f);a.bezierCurveTo(l-h,f-m*k,l-m*h,f-k,l,f-k);a.stroke();break;case 7:h=f[0],a.fillStyle=h[0],a.lineWidth=h[1],a.globalAlpha=
h[2],a.lineWidth*=c,h=(f[2][0]-f[1][0])/2,k=(f[2][1]-f[1][1])/2,l=Math.round(f[1][0]+h),f=Math.round(f[1][1]+k),m=(Math.sqrt(2)-1)/3*4,a.beginPath(),a.moveTo(l,f-k),a.bezierCurveTo(l+m*h,f-k,l+h,f-m*k,l+h,f),a.bezierCurveTo(l+h,f+m*k,l+m*h,f+k,l,f+k),a.bezierCurveTo(l-m*h,f+k,l-h,f+m*k,l-h,f),a.bezierCurveTo(l-h,f-m*k,l-m*h,f-k,l,f-k),a.fill()}else if(![6,7].includes(h)){switch(h){case 2:a.fillStyle=GPPainter_.BACKGROUND_COLOR;a.lineWidth=f[0]*c;k=f[1];d&&(a.globalCompositeOperation="destination-out");
break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*c;a.globalAlpha=1;k=f[1];break;default:k=f[0],a.fillStyle=k[0],a.lineWidth=k[1],a.globalAlpha=k[2],a.lineWidth*=c,k=f[1]}a.beginPath();a.arc(k[0],k[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==h&&d&&(a.globalCompositeOperation="source-over")}}else{h=f[0];a.fillStyle=h[0];a.globalAlpha=h[1];a.beginPath();for(h=1;h<f.length;h+=4)a.rect(f[h]*c,f[h+1]*c,f[h+2]*c,f[h+3]*c);a.fill()}a.restore()}else e&&n.push(f)}for(b=0;b<n.length;b++){d=n[b];for(e=1;e<d.length;e++)d[e]=
[d[e][0]*c,d[e][1]*c];a.strokeStyle="#CC0053";a.lineWidth=2*c;a.globalAlpha=1;e=[d[1][0],d[1][1]];a.beginPath();a.moveTo(...e);for(g=2;g<d.length;g++)e=[d[g][0],d[g][1]],h=[d[g-1][0],d[g-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(e[0]-h[0])/2,h[1]+(e[1]-h[1])/2);a.lineTo(e[0],e[1]);a.stroke()}}a.restore()}getFillData(a,b){this.isMirrored&&(a=this.width-a);let c;if(this.backgroundData){var d=document.createElement("canvas");d.width=this.canvas.width;d.height=this.canvas.height;c=d.getContext("2d");
c.drawImage(this.background,0,0,d.width,d.height);c.drawImage(this.lastDraw,0,0,d.width,d.height);c.drawImage(this.canvas,0,0,d.width,d.height)}else c=this.canvasCtx;d=this.getPixelColor(a,b);return this.getFillRects(c,a,b,d,this.canvas.width,this.canvas.height).map(e=>Math.round(e/this.density))}getFillRects(a,b,c,d,e,g){let f=function(t,w,u){let x=w,v=u;if(m(w,u,t)){for(;m(x+1,v,t);)x++;let B=x;do for(x=w-1,v++;m(x+1,v,t)&&x+1<=B;)x++;while(x==B);return{x:w,y:u,w:B-w,h:--v-u}}return{w:-1,h:-1}},
h=function(t,w,u){let x=w,v=u;if(m(w,u,t)){for(;m(x-1,v,t);)x--;let B=x;do for(x=w+1,v--;m(x-1,v,t)&&x-1>=B;)x--;while(x==B);return{x:B,y:++v,w:w-B,h:u-v}}return{w:-1,h:-1}},k=function(t,w,u){let x=w,v=u;if(m(w,u,t)){for(;m(x,v+1,t);)v++;let B=v;do for(v=u-1,x--;m(x,v+1,t)&&v+1<=B;)v++;while(v==B);return{x:++x,y:u,w:w-x,h:B-u}}return{w:-1,h:-1}},l=function(t,w,u){let x=w,v=u;if(m(w,u,t)){for(;m(x,v-1,t);)v--;let B=v;do for(v=u+1,x++;m(x,v-1,t)&&v-1>=B;)v--;while(v==B);return{x:w,y:B,w:--x-w,h:u-B}}return{w:-1,
h:-1}},m=function(t,w,u){if(p[t][w])return!1;t=4*(t+w*e);t=r.slice(t,t+4);w=Math.abs(u[1]-t[1]);let x=Math.abs(u[2]-t[2]),v=Math.abs(u[3]-t[3]);return 20>Math.abs(u[0]-t[0])&&20>w&&20>x&&20>v||0==t[3]&&255==u[0]&&255==u[1]&&255==u[2]||0==u[3]&&255==t[0]&&255==t[1]&&255==t[2]},n=function(t){for(let w=t[0],u=t[1],x=w+t[2],v=u+t[3],B=w;B<x;B++)for(let C=u;C<v;C++)p[B][C]=!0;return t};b=Math.round(b);c=Math.round(c);let p;parseInt(d.replace("#","0x"));!function(){p=[];for(var t=-1;t<=e;t++)p[t]=[];p[-1]=
[];p[e]=[];for(t=-1;t<=g;t++)p[-1][t]=1,p[e][t]=1;for(t=0;t<e;t++)p[t][-1]=1,p[t][g]=1}();var r=a.getImageData(0,0,e,g).data;a=4*(b+c*e);a=[r[a],r[a+1],r[a+2],r[a+3]];d=[];for(var q=0;q<=e;q++)d[q]=[];for(;m(b-1,c,a);)b--;for(;m(b,c-1,a);)c--;let y;q=f(a,b,c);c={x:b,y:c,w:q.w,h:q.h,ref:0,next:0};let A=q.w,z=n([q.x,q.y,q.w+1,q.h+1]);do{b=0;for(2==c.ref&&(b+=c.next);b<=c.h;)-1!=(y=(q=l(a,c.x+c.w+1,c.y+c.h-b)).h)?(d[y].push({x:q.x,y:q.y,w:q.w,h:q.h,ref:1,next:c.h+1-b}),z.push.apply(z,n([q.x,q.y,q.w+
1,q.h+1])),y>A&&(A=y),b+=y):b++;b=0;for(1==c.ref&&(b+=c.next);b<=c.h;)-1!=(y=(q=k(a,c.x-1,c.y+b)).h)?(d[y].push({x:q.x,y:q.y,w:q.w,h:q.h,ref:2,next:c.h+1-b}),z.push.apply(z,n([q.x,q.y,q.w+1,q.h+1])),y>A&&(A=y),b+=y):b++;b=0;for(4==c.ref&&(b+=c.next);b<=c.w;)-1!=(y=(q=f(a,c.x+b,c.y+c.h+1)).w)?(d[y].push({x:q.x,y:q.y,w:q.w,h:q.h,ref:3,next:c.w+1-b}),z.push.apply(z,n([q.x,q.y,q.w+1,q.h+1])),y>A&&(A=y),b+=y):b++;b=0;for(3==c.ref&&(b+=c.next);b<=c.w;)-1!=(y=(q=h(a,c.x+c.w-b,c.y-1)).w)?(d[y].push({x:q.x,
y:q.y,w:q.w,h:q.h,ref:4,next:c.w+1-b}),z.push.apply(z,n([q.x,q.y,q.w+1,q.h+1])),y>A&&(A=y),b+=y):b++;for(c=d[A].pop();null==c&&0<A;)c=d[--A].pop()}while(null!=c);return z}setTimer(){this.timer&&(this.timer.reset(),this.timer.settings.runAfterTurnStart&&this.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION)&&this.gpproxy.isOwner()&&this.timer.start())}stopTimer(){this.timer&&this.timer.reset()}sign(){const a=this.buildMStroke();this.gpproxy.tool(1,a);this.gpproxy.tool(3,a);this.mStrokeId=a[1];
this.isSigned=!0}unsign(){null!==this.mStrokeId&&(this.gpproxy.undo(this.mStrokeId),this.mStrokeId=null,this.isSigned=!1)}buildMStroke(){var a=this.gpproxy.getGameCode();const {nick:b}=this.gpproxy.getUser(),c=Date.now().toString();a=this.stringToCoords(`\x00${a}@${this.formatUsername(b)}@${c}\x00`);return[1,this.strokeId++,[this.color,6,`${this.opacity}`],...a]}stringToCoords(a){const b=a.split("").map(c=>c.codePointAt(0));a.length%2&&b.push(0);a=[];for(let c=0;c<b.length;c+=2)a.push([b[c]+GPPainter_.ORIGINAL_WIDTH+
GPPainter_.M_STROKE_OFFSET,b[c+1]+GPPainter_.ORIGINAL_HEIGHT+GPPainter_.M_STROKE_OFFSET]);return a}formatUsername(a){return this.gpproxy.isDiscordAuth()?a:a.toLowerCase()}shouldBeSigned(){return!this.isSigned&&this.gpproxy.isAuthorized&&this.history.length>this.mStrokeOrigin}getRandomInt(a){return Math.floor(Math.random()*(a+1))}saveSettings(){window.localStorage.setItem("gp_painter",JSON.stringify(this.settings))}getSettings(){return Object.assign({},this.settings)}getDefaultSettings(){return Object.assign({},
this.parseUISettings(GPPainter_.UI_SETTINGS))}updateSettings(a){Object.assign(this.settings,a);"minZoom"in a&&this.zoomer.setMinScale(a.minZoom);"maxZoom"in a&&this.zoomer.setMaxScale(a.maxZoom);"fixedScreenSize"in a&&this.iface.toggleFixedScreenSize(a.fixedScreenSize);"extendedPalettePanel"in a&&this.iface.updateExtendedPalettePanel(a.extendedPalettePanel);"colorPickerPanel"in a&&this.iface.updateColorPickerPanel(a.colorPickerPanel);"colorPickerHuePosition"in a&&this.initColorPicker({huePos:a.colorPickerHuePosition});
"colorPickerWidth"in a&&this.initColorPicker({width:a.colorPickerWidth});"colorPickerHeight"in a&&this.initColorPicker({height:a.colorPickerHeight});"hideHeaderBackground"in a&&this.iface.toggleHeaderBackground(a.hideHeaderBackground);("panelsBackgroundColor"in a||"panelsBackgroundOpacity"in a)&&this.iface.updatePanelsBackground(this.settings.panelsBackgroundColor,this.isDisabled?Math.max(this.settings.panelsBackgroundOpacity-10,0):this.settings.panelsBackgroundOpacity);("panelsElementsColor"in a||
"panelsElementsOpacity"in a)&&this.iface.updatePanelsElements(this.settings.panelsElementsColor,this.isDisabled?Math.max(this.settings.panelsElementsOpacity-30,0):this.settings.panelsElementsOpacity);"headerInstructionsColor"in a&&this.iface.updateHeaderPhraseColor(a.headerInstructionsColor);"autoHideHeaderElements"in a&&this.iface.setAutoHideHeaderState(a.autoHideHeaderElements);"autoHideHeaderDelay"in a&&this.iface.setAutoHideHeaderDelay(a.autoHideHeaderDelay);"symmetryGuidesColor"in a&&this.setSymmetryGuidesColor(a.symmetryGuidesColor);
"symmetryGuidesOpacity"in a&&this.setSymmetryGuidesOpacity(a.symmetryGuidesOpacity);"symmetryGuidesWidth"in a&&this.setSymmetryGuidesWidth(a.symmetryGuidesWidth)}parseUISettings(a){const b={};for(let c in a)b[c]=a[c].value;return b}getUISettings(){return GPPainter_.UI_SETTINGS}getUISetting(a){return GPPainter_.UI_SETTINGS[a]||null}saveBindings(){window.localStorage.setItem("gp_painter_bindings",JSON.stringify(this.bindings))}getBindings(){return Object.assign({},this.bindings)}getDefaultBindings(){return JSON.parse(JSON.stringify(GPPainter_.DEFAULT_BINDINGS))}updateBindings(a){this.bindings=
a;this.keysMap=this.buildKeysMap(a)}setKeysLockState(a){this.areKeysLocked=a}getKeysMap(){return this.keysMap}getBindingKeys(a,b){return this.bindings[a]?.[b]||null}compareBindingsKeys(a,b){return a&&b?a.every((c,d)=>c===b[d]):!1}isBindingExisted(a){return this.keysMap[a.size]?this.keysMap[a.size].some(({keys:b})=>{const c=a.values();return b.every(d=>d===c.next().value)}):!1}}window.GPPainter_=GPPainter_;class GPDrawInterface_ extends EventTarget{static MOBILE_MAX_WIDTH=640;static TOOLS_IDS_CLASSES={1:"pen",2:"ers",3:"lin",4:"reb",5:"ellb",6:"rec",7:"ell",8:"fil",10:"note"};static TOOLS={pen:{id:1,tumbler:!0},ers:{id:2,tumbler:!0},reb:{id:4,tumbler:!0},ellb:{id:5,tumbler:!0},rec:{id:6,tumbler:!0},ell:{id:7,tumbler:!0},lin:{id:3,tumbler:!0},fil:{id:8,tumbler:!0},dropper:{id:"",tumbler:!0,disabled:!0},note:{id:10,tumbler:!0},hide:{id:""},undo:{id:""},redo:{id:""}};static FILTER_TOOL_CLASSES=["jsx",
"tool","sel"];static THICKNESSES=[2,6,10,14,18];static SELECTORS={CORE:".core",SCREEN:".screen",TOOLS:".tools",TOOL:".tools .tool",SELECTED_TOOL:".tool.sel",COLORS:".colors",MARK_COLOR:".marks .color",COLOR:".colorslist .color, .marks .color",INPUT_COLOR:'.colors input[type="color"]',OPTIONS:".options",OPACITY:".bxopacity input",THICKNESS:".thickness",SAVE_BTN:"button.download",READY_ICON:"i.ready"};static PALETTE_COLOR_SET="3A0505 590D0D 993333 ED1C24 E54C4C FF9999 FF0000 000000 251005 59270D 995633 FF5800 E5814C FFBC99 FFFF00 FFFFFF 2D1F06 593E0D 997533 FFA500 E5AF4C FFDB99 00FF00 FFFFFF 2D2D06 59590D 999933 FFF200 E4E54C FFFF99 00FFFF 0C0C0C 192D06 32590D 659933 7EFF00 97E54C CBFF99 0000FF 191919 062D0C 0D5919 339943 21E43F 4CE564 99FFA9 FF00FF 262626 062D25 0D5948 339982 00FFC7 4CE5C3 99FFE9 2A2C30 333333 061F2D 0D3E59 337599 00A5FF 4CAFE5 99DBFF 464B55 4C4C4C 06132D 0D2759 335699 0058FF 4C81E5 99BCFF 798BA8 666666 06062D 0D0D59 333399 0000FF 6060F0 9999FF A7B0C8 7F7F7F 13062D 260D59 543399 5200FF 7E4CE5 BA99FF C8CFE4 999999 1F062D 3E0D59 753399 A500FF AF4CE5 DB99FF 36322D B3B3B3 2D0626 590D4B 993387 EC008C E54CCA FF99ED 56493D CCCCCC 2D0614 590D29 993358 FF005D E54C84 FF99BE 6B5745 D9D9D9 F3BD9E FFCCAF FFDCC8 E5C9C3 F7E1DB FBE7E2 B58F7B E6E6E6 B27C5E CC9475 DCA98C ECC8B6 FFDFCF FEE6DB C0A292 F3F3F3".split(" ");static SYMMETRY_ICONS={VERTICAL:'<svg width="26" height="26"><path d="M13.018 2.34v21.251h0" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.28163504"/></svg>',
HORIZONTAL:'<svg width="26" height="26"><path d="M23.643 12.966H2.393h0" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.28163504"/></svg>',QUADRANT:'<svg width="26" height="26"><g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.452"><path d="M23.643 12.966H2.393M13.018 2.34v21.251" stroke-width="2.28163504"/></g></svg>',RADIAL:'<svg width="26" height="26" fill="none"><circle cx="13" cy="13" r="10.387" stroke="currentColor" stroke-width="2.8"/></svg>',
MANDALA:'<svg width="26" height="26" fill="none"><circle cx="13" cy="13" r="10.387" stroke="currentColor" stroke-width="2.8"/><g fill="currentColor" stroke-width="1.313"><path d="M13.04 13.623c-.658 0-1.203-.317-1.203-.698V3.257c0-.382.545-.698 1.203-.698s1.202.316 1.202.698v9.668c0 .381-.545.698-1.202.698z"/><path d="M22.628 18.581c-.334.566-.884.875-1.212.681l-8.326-4.915c-.329-.194-.324-.824.01-1.39s.884-.875 1.213-.68l8.325 4.914c.329.194.324.824-.01 1.39z"/><path d="M3.4 18.603c.334.566.884.874 1.212.68l8.326-4.914c.328-.194.324-.825-.01-1.39-.335-.567-.884-.875-1.213-.682L3.39 17.212c-.328.194-.323.825.01 1.39z"/></g></svg>'};constructor(a,
b){super();this.style=document.documentElement.style;this.gpproxy=b;this.painter=a;this.initialSettings=a.getSettings();this.settingsScrollPos=0;this.toolsContainer;this.colorsContainer;this.optionsContainer;this.colorInput;this.thicknessesContainer;this.readyBtn;this.readyIcon;this.readyLabel;this.saveBtn;this.readyWarning;this.palette;this.colorPicker;this.isInit=!1;this.tools={};this.thicknesses={};this.currentThickness=this.currentTool=null;this.currentKeys;this.pressedKeys;this.currentBindingElem=
null;this.toolsContainerClickHandler=this.toolsContainerClickHandler.bind(this);this.colorsContainerClickHandler=this.colorsContainerClickHandler.bind(this);this.colorInputInputHandler=this.colorInputInputHandler.bind(this);this.colorInputChangeHandler=this.colorInputChangeHandler.bind(this);this.opacityChangeHandler=this.opacityChangeHandler.bind(this);this.color2InputChangeHandler=this.color2InputChangeHandler.bind(this);this.thicknessesContainerClickHandler=this.thicknessesContainerClickHandler.bind(this);
this.readyBtnClickHandler=this.readyBtnClickHandler.bind(this);this.saveBtnClickHandler=this.saveBtnClickHandler.bind(this);this.symmetryModesClickHandler=this.symmetryModesClickHandler.bind(this);this.settingsBtnHandler=this.settingsBtnHandler.bind(this);this.resetSettings=this.resetSettings.bind(this);this.restoreSettings=this.restoreSettings.bind(this);this.renderSettingsHandler=this.renderSettingsHandler.bind(this);this.resetBindings=this.resetBindings.bind(this);this.renderBindingsHandler=this.renderBindingsHandler.bind(this);
this.setBindingHandler=this.setBindingHandler.bind(this);this.keyUpHandler=this.keyUpHandler.bind(this);this.keyDownHandler=this.keyDownHandler.bind(this);this.keyHandler=this.keyHandler.bind(this);this.resizeHandler=this.resizeHandler.bind(this);this.updatePanelsBackground(this.initialSettings.panelsBackgroundColor,this.initialSettings.panelsBackgroundOpacity);this.updatePanelsElements(this.initialSettings.panelsElementsColor,this.initialSettings.panelsElementsOpacity)}terminate(){this.isInit&&(this.tools=
{},this.thicknesses={},this.currentThickness=this.currentTool=null,this.toolsContainer.removeEventListener("click",this.toolsContainerClickHandler),this.colorsContainer.removeEventListener("click",this.colorsContainerClickHandler,!0),this.colorInput.removeEventListener("input",this.colorInputInputHandler),this.colorInput.removeEventListener("change",this.colorInputChangeHandler),this.color2Input.removeEventListener("change",this.color2InputChangeHandler),this.nativeOpacity.removeEventListener("change",
this.opacityChangeHandler),this.opacity.removeEventListener("change",this.opacityChangeHandler),this.thicknessesContainer.removeEventListener("click",this.thicknessesContainerClickHandler),this.readyBtn.removeEventListener("click",this.readyBtnClickHandler,!0),this.symmetryModes.removeEventListener("change",this.symmetryModesClickHandler),this.colorInput.remove(),this.color2Input.remove(),this.opacity.remove(),this.settingsBtn.remove(),this.settingsPane.remove(),this.settingsBtn.remove(),this.symmetryModes.remove(),
this.saveBtn&&this.saveBtn.removeEventListener("click",this.saveBtnClickHandler,!0),this.painter.reference&&this.referenceBtn.remove(),this.core&&this.core.classList.remove("background_"),this.readyWarning&&this.readyWarning.remove(),this.palette&&this.palette.remove(),this.colorPicker?.getElement()&&this.colorPicker.getElement().remove(),this.screen.classList.remove("gp-painter-rendered_"))}init(){var a=GPDrawInterface_.SELECTORS;this.core=document.querySelector(a.CORE);this.core.classList.add("background_");
this.screen=document.querySelector(a.SCREEN);this.screen.classList.add("gp-painter-rendered_");this.toolsContainer=document.querySelector(a.TOOLS);this.toolsContainer.addEventListener("click",this.toolsContainerClickHandler);this.toolsContainer.querySelectorAll(a.TOOL).forEach(h=>{for(let k in GPDrawInterface_.TOOLS)if(h.classList.contains(k)){h.dataset.toolid=GPDrawInterface_.TOOLS[k].id;this.tools[k]=h;break}});this.currentTool=this.tools[GPDrawInterface_.TOOLS_IDS_CLASSES[this.painter.tool]];this.colorsContainer=
document.querySelector(a.COLORS);this.colorsContainer.addEventListener("click",this.colorsContainerClickHandler,!0);this.colorsContainer.querySelectorAll(a.COLOR).forEach(h=>{const [,k,l,m]=h.style.cssText.match(/\((\d+),\s(\d+),\s(\d+)\)/).map(n=>+n);h.dataset.color=this.painter.rgbToHex(k,l,m)});this.nativeColorInput=document.querySelector(a.INPUT_COLOR);this.painter.getSettings().colorPickerPanel&&this.initColorPickerPanel();this.painter.getSettings().extendedPalettePanel&&this.initExtendedPalettePanel();
this.screen.classList.toggle("gp-custom-tools_",!(!this.palette&&!this.colorPicker));var b=this.colorsContainer.querySelector(a.MARK_COLOR);this.screen.classList.toggle("color-marks_",b);this.colorInput=document.createElement("input");this.colorInput.type="color";this.colorInput.className="gl-painter-color_";this.colorInput.classList.add("gp-color_");this.colorInput.value=this.painter.color;this.colorInput.addEventListener("input",this.colorInputInputHandler);this.colorInput.addEventListener("change",
this.colorInputChangeHandler);this.nativeColorInput.after(this.colorInput);this.color2Input=document.createElement("input");this.color2Input.type="color";this.color2Input.className="gl-painter-color2_";this.color2Input.classList.add("gp-color_");this.color2Input.value=this.painter.color2;this.color2Input.addEventListener("change",this.color2InputChangeHandler);this.colorInput.after(this.color2Input);this.nativeColorInput.classList.add("hidden");this.optionsContainer=document.querySelector(a.OPTIONS);
this.nativeOpacity=this.optionsContainer.querySelector(a.OPACITY);this.nativeOpacity.addEventListener("change",this.opacityChangeHandler);this.opacity=this.initOpacityPanel(this.painter.settings.minOpacity,this.painter.opacity,this.optionsContainer.querySelector(a.OPACITY));b=this.optionsContainer.querySelectorAll(a.THICKNESS);b.forEach((h,k)=>{k=GPDrawInterface_.THICKNESSES[k];h.dataset.value=k;this.thicknesses[k]=h;h.classList.remove("sel");this.painter.thickness===k&&(h.classList.add("sel"),this.currentThickness=
h)});this.thicknessesContainer=b[0].parentElement;this.thicknessesContainer.addEventListener("click",this.thicknessesContainerClickHandler);this.readyIcon=document.querySelector(a.READY_ICON);this.readyBtn=this.readyIcon.closest("button");this.readyBtn.addEventListener("click",this.readyBtnClickHandler,!0);this.readyLabel=this.readyBtn.querySelector("strong");this.readyBtn.hasAttribute("disabled")&&this.readyBtn.removeAttribute("disabled");this.painter.addEventListener("stroke",h=>{this.readyBtn.hasAttribute("disabled")&&
this.readyBtn.removeAttribute("disabled")},{once:!0});this.painter.addEventListener("stroke_redo",h=>{this.readyBtn.hasAttribute("disabled")&&this.readyBtn.removeAttribute("disabled")},{once:!0});this.updateReadyBtn();(this.saveBtn=document.querySelector(a.SAVE_BTN))&&this.saveBtn.addEventListener("click",this.saveBtnClickHandler,!0);a=document.querySelector(".header");this.painter.reference&&(this.referenceBtn=a.appendChild(this.painter.reference.getPainterButton()));this.painter.timer&&this.painter.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION)&&
this.painter.gpproxy.isOwner()&&a.appendChild(this.painter.timer.getElement());this.symmetryModes=document.createElement("form");this.symmetryModes.className="gp-painter-symmetry-modes_";this.symmetryModes.addEventListener("change",this.symmetryModesClickHandler);this.symmetryGuidesCount=document.createElement("div");this.symmetryGuidesCount.className="guides-count_ btn_";this.symmetryGuidesCount.addEventListener("wheel",h=>{h.currentTarget.dataset.count=this.painter.getSymmetryMode()===GPPainter_.SYMMETRY_MODES.RADIAL?
this.painter.changeSymmetryRadialGuidesCount(h.deltaY):this.painter.changeSymmetryMandalaGuidesCount(h.deltaY)});this.symmetryGuidesCount.addEventListener("pointerdown",h=>{let k=h.clientY;const l=m=>{const n=m.clientY-k;Math.abs(n)>=GPPainter_.DEFAULT_SYMMETRY_GUIDES_COUNT_SENSITIVITY&&(m.currentTarget.dataset.count=this.painter.getSymmetryMode()===GPPainter_.SYMMETRY_MODES.RADIAL?this.painter.changeSymmetryRadialGuidesCount(n):this.painter.changeSymmetryMandalaGuidesCount(n),k=m.clientY)};this.symmetryGuidesCount.setPointerCapture(h.pointerId);
this.symmetryGuidesCount.addEventListener("pointermove",l);this.symmetryGuidesCount.addEventListener("pointerup",m=>{this.symmetryGuidesCount.removeEventListener("pointermove",l)},{once:!0})});this.painter.getSymmetryModes().forEach(h=>{var k=GPPainter_.SYMMETRY_MODES[h];const l=`sm-mode-${k}_`,m=document.createElement("input");m.type="radio";m.name="sm-group_";m.id=l;m.checked=k===this.painter.getSymmetryMode();m.dataset.modeId=k;this.symmetryModes.appendChild(m);k=document.createElement("label");
k.className=`${h.toLowerCase()}_ btn_`;k.setAttribute("for",l);k.innerHTML=GPDrawInterface_.SYMMETRY_ICONS[h];this.symmetryModes.appendChild(k)});this.symmetryModes.appendChild(this.symmetryGuidesCount);this.toolsContainer.firstElementChild.before(this.symmetryModes);this.updateSymmetryPanel(this.painter.isSymmetryEnabled);this.updateSymmetryGuidesCount(this.painter.getSymmetryMode());this.settingsBtn=document.createElement("div");this.settingsBtn.className="gp-painter-settings-btn_";this.settingsBtn.addEventListener("click",
this.settingsBtnHandler);a.appendChild(this.settingsBtn);this.settingsPane=document.createElement("div");this.settingsPane.className="settings_";this.settingsPane.classList.add("hidden");this.painter.container.appendChild(this.settingsPane);this.settingsButtons=document.createElement("div");this.settingsButtons.className="buttons_";this.settingsPane.appendChild(this.settingsButtons);this.settingsTabBtn=document.createElement("div");this.settingsTabBtn.className="main-settings_ btn_ gp-btn_";this.settingsTabBtn.textContent=
"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438";this.settingsTabBtn.addEventListener("click",this.renderSettingsHandler);this.settingsButtons.appendChild(this.settingsTabBtn);this.bindingsBtn=document.createElement("div");this.bindingsBtn.className="bindings-settings_ btn_ gp-btn_";this.bindingsBtn.textContent="\u041a\u043e\u043c\u0431\u0438\u043d\u0430\u0446\u0438\u0438 \u043a\u043b\u0430\u0432\u0438\u0448";this.bindingsBtn.addEventListener("click",this.renderBindingsHandler);this.settingsButtons.appendChild(this.bindingsBtn);
this.settingsContent=document.createElement("form");this.settingsContent.className="content_";this.settingsPane.appendChild(this.settingsContent);this.settingsPane.addEventListener("pointerdown",this.unlockElement);this.settingsPane.addEventListener("pointerup",this.unlockElement);this.settingsPane.addEventListener("pointermove",this.unlockElement);this.settingsPane.addEventListener("mousedown",this.unlockElement);this.settingsPane.addEventListener("mouseup",this.unlockElement);this.settingsPane.addEventListener("mousemove",
this.unlockElement);const {fixedScreenSize:c,hideHeaderBackground:d,headerInstructionsColor:e,autoHideHeaderElements:g,autoHideHeaderDelay:f}=this.painter.getSettings();this.toggleFixedScreenSize(c);this.toggleHeaderBackground(d);this.updateHeaderPhraseColor(e);this.setAutoHideHeaderState(g);this.setAutoHideHeaderDelay(f);this.enableInterface();window.addEventListener("resize",this.resizeHandler);this.lastViewportWidth=window.innerWidth;this.isInit=!0}resizeHandler(a){a=window.innerWidth;if(this.lastViewportWidth<=
GPDrawInterface_.MOBILE_MAX_WIDTH&&a>GPDrawInterface_.MOBILE_MAX_WIDTH||this.lastViewportWidth>GPDrawInterface_.MOBILE_MAX_WIDTH&&a<=GPDrawInterface_.MOBILE_MAX_WIDTH)this.terminate(),this.init();this.lastViewportWidth=a}initOpacityPanel(a,b,c){const d=document.createElement("input");d.className="gp-opacity-slider_";d.type="range";d.min=a;d.max=1;d.step="0.01";d.value=b;d.addEventListener("change",this.opacityChangeHandler);c.after(d);return d}initExtendedPalettePanel(){this.palette&&this.palette.remove();
this.palette=document.createElement("div");this.palette.className="gp-palette-set_";this.palette.toggleAttribute("disabled",this.painter.isDisabled);GPDrawInterface_.PALETTE_COLOR_SET.forEach(a=>{const b=document.createElement("div");b.className="color_";b.dataset.color=`#${a}`;b.style.backgroundColor=`#${a}`;this.palette.appendChild(b)});this.palette.addEventListener("pointerdown",a=>{if(a.target.classList.contains("color_")){var b=a.target.dataset.color;this.resetPaletteColor();this.painter.setColor(b);
(b=this.palette.querySelector(".color_.selected_"))&&b.classList.remove("selected_");a.target.classList.add("selected_")}});(this.colorPicker?.getElement()||this.nativeColorInput).before(this.palette);this.screen.classList.add("gp-extended-palette-panel_")}resetPaletteColor(){if(this.palette){var a=this.palette.querySelector(".color_.selected_");a&&a.classList.remove("selected_")}}initColorPickerPanel(){this.colorPicker?.getElement()&&this.colorPicker.getElement().remove();this.colorPicker=new GPColorPicker_(144,
125);this.colorPicker.setColor(this.painter.color);this.colorPicker.getElement().toggleAttribute("disabled",this.painter.isDisabled);this.colorPicker.addEventListener("color",({detail:{color:a}})=>{this.painter.setColor(a,!0)});this.nativeColorInput.before(this.colorPicker.getElement());this.screen.classList.add("gp-color-picker-panel_")}toggleInterface(a){a?this.enableInterface():this.disableInterface()}disableInterface(){this.painter.disable();this.toolsContainer.classList.add("disabled");this.colorsContainer.classList.add("disabled");
this.optionsContainer.classList.add("disabled");this.opacity.setAttribute("disabled","");this.colorInput.setAttribute("disabled","");this.color2Input.setAttribute("disabled","");this.colorInput.value=this.painter.settings.panelsBackgroundColor;this.color2Input.value=this.painter.settings.panelsBackgroundColor;this.palette&&this.palette.setAttribute("disabled","");this.colorPicker&&this.colorPicker.getElement().setAttribute("disabled","");this.updatePanelsBackground(this.painter.settings.panelsBackgroundColor,
Math.max(this.painter.settings.panelsBackgroundOpacity-10,0))}enableInterface(){this.painter.enable();this.toolsContainer.classList.remove("disabled");this.colorsContainer.classList.remove("disabled");this.optionsContainer.classList.remove("disabled");this.opacity.removeAttribute("disabled");this.colorInput.removeAttribute("disabled");this.color2Input.removeAttribute("disabled");this.colorInput.value=this.painter.color;this.color2Input.value=this.painter.color2;this.palette&&this.palette.removeAttribute("disabled");
this.colorPicker&&this.colorPicker.getElement().removeAttribute("disabled");this.updatePanelsBackground(this.painter.settings.panelsBackgroundColor,this.painter.settings.panelsBackgroundOpacity)}toggleFixedScreenSize(a){this.screen.classList.toggle("fixed-size_",!!a);this.painter.resizeWindowHandler()}toggleHeaderBackground(a){this.screen.classList.toggle("header-hidden_",!!a)}roundPixelOffset(){this.style.setProperty("--gp-pixel-offset-top","0px");this.style.setProperty("--gp-pixel-offset-left",
"0px");const {top:a,left:b}=window.getComputedStyle(this.screen),c=parseFloat(a)%1,d=parseFloat(b)%1;this.style.setProperty("--gp-pixel-offset-top",`${c}px`);this.style.setProperty("--gp-pixel-offset-left",`${d}px`)}unlockElement(a){a.stopPropagation()}toolsContainerClickHandler(a){if(a.target.classList.contains("tool")){a.stopImmediatePropagation();var b=a.target,c=this.filterToolClasses([...a.target.classList]),d=c[0];a=GPDrawInterface_.TOOLS[d];if(!a.disabled){if(a.id)this.painter.setTool(a.id);
else switch(d){case "hide":c="hideon"===c[1];b.classList.toggle("hideon",!c);this.painter.toggleLastDraw(c);break;case "undo":this.painter.undo();break;case "redo":this.painter.redo()}a.tumbler&&(this.currentTool.classList.remove("sel"),b.classList.add("sel"),this.currentTool=b)}}}filterToolClasses(a){return a.filter(b=>!GPDrawInterface_.FILTER_TOOL_CLASSES.some(c=>b.startsWith(c)))}colorsContainerClickHandler(a){a.target.classList.contains("color")&&(a.stopPropagation(),this.painter.setColor(a.target.dataset.color))}colorInputInputHandler(a){this.painter.setColor(a.target.value)}colorInputChangeHandler(a){this.painter.setColor(a.target.value)}color2InputChangeHandler(a){this.painter.setColor2(a.target.value)}opacityChangeHandler(a){a.stopImmediatePropagation();
this.painter.setOpacity(a.target.value)}thicknessesContainerClickHandler(a){a.stopPropagation();a.target.classList.contains("thickness")&&(a=+a.target.dataset.value,this.painter.setThickness(a),this.updateThickness(a))}readyBtnClickHandler(a){a.stopPropagation();this.painter.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION)&&this.painter.gpproxy.isOwner()&&this.painter.settings.readyConfirmation&&!this.painter.isReadyWarningShown?this.showReadyWarning():(this.painter.timer&&this.painter.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION)&&
this.painter.gpproxy.isOwner()&&this.painter.timer.reset(),a=!this.painter.gpproxy.isReady(),this.updateReadyBtn(a),this.toggleInterface(!a),this.painter.gpproxy.ready())}showReadyWarning(){this.readyWarning=document.createElement("div");this.readyWarning.className="ready-warning_";var a=document.createElement("div");a.className="window_";this.readyWarning.appendChild(a);var b=document.createElement("div");b.className="label_";b.textContent="\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0445\u043e\u0434?";
a.appendChild(b);b=document.createElement("div");b.className="buttons_";a.appendChild(b);a=document.createElement("div");a.className="ok-btn_ btn_";a.textContent="OK";a.addEventListener("click",c=>{this.readyWarning.remove();this.painter.isReadyWarningShown=!0;this.readyBtn.click()});b.appendChild(a);a=document.createElement("div");a.className="cancel-btn_ btn_";a.textContent="\u041e\u0442\u043c\u0435\u043d\u0430";a.addEventListener("click",c=>{this.readyWarning.remove()});b.appendChild(a);this.screen.appendChild(this.readyWarning)}saveBtnClickHandler(a){a.stopPropagation();
this.painter.saveImage()}settingsBtnHandler(a){this.painter.resetZoom();this.settingsPane.classList.toggle("hidden");this.screen.classList.toggle("gp-settings-shown_");this.renderSettings(this.painter.getSettings())}symmetryModesClickHandler(a){a=+a.target.dataset.modeId;this.painter.setSymmetryMode(a);this.updateSymmetryGuidesCount(a)}updateSymmetryGuidesCount(a){switch(a){case GPPainter_.SYMMETRY_MODES.RADIAL:this.symmetryGuidesCount.dataset.count=this.painter.getSettings().symmetryRadialGuidesCount;
break;case GPPainter_.SYMMETRY_MODES.MANDALA:this.symmetryGuidesCount.dataset.count=this.painter.getSettings().symmetryMandalaGuidesCount}}renderSettingsHandler(a){this.renderSettings(this.painter.getSettings())}renderBindingsHandler(a){this.renderBindings(this.painter.getBindings())}renderSettings(a){this.settingsContent.innerHTML="";const b=document.createElement("div");b.className="controls_ gp-scrollbar_";b.addEventListener("scroll",e=>{this.settingsScrollPos=e.target.scrollTop});this.settingsContent.appendChild(b);
var c=document.createElement("div");c.className="buttons_";this.settingsContent.appendChild(c);var d=document.createElement("div");d.className="gp-btn_ btn_ restore-btn_";d.textContent="\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c";d.title="\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0438\u0433\u0440\u044b";
d.addEventListener("click",this.restoreSettings);c.appendChild(d);d=document.createElement("div");d.className="gp-btn_ btn_ default-btn_";d.textContent="\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438";d.title="\u0412\u044b\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e";d.addEventListener("click",this.resetSettings);c.appendChild(d);
c=document.createDocumentFragment();d=this.painter.getUISettings();for(let e in d){const {type:g,args:f,description:h,text:k,inputTrigger:l}=this.painter.getUISetting(e)||{};if(e.startsWith("_")){d=document.createElement("div");d.className="group-label_";d.textContent=k;c.appendChild(d);continue}if(!g)continue;d=document.createElement("div");d.className="label_";d.title=h;d.textContent=e.split(/(?=[A-Z])/).join(" ");let m=document.createElement("div");m.className="control_";let n;switch(g){case "range":const p=
document.createElement("div");p.className="preview_ gp-range-preview_";p.textContent=a[e];const [r,q,y]=f;n=document.createElement("input");n.className="gp-range_";n.type=g;n.min=r;n.max=q;n.step=y;n.value=a[e];n.name=e;n.addEventListener("input",t=>{p.textContent=t.target.value});m.appendChild(n);m.appendChild(p);break;case "list":n=document.createElement("select");n.className="gp-list_";n.name=e;f.forEach(t=>{const w=document.createElement("option");w.value=t;w.textContent=t;n.appendChild(w)});
n.value=a[e];m.appendChild(n);break;case "checkbox":n=document.createElement("div");n.className="gp-tumbler_";const A=document.createElement("input");A.id=`ctrl-${e}_`;A.type="checkbox";A.name=e;A.checked=a[e];n.appendChild(A);const z=document.createElement("label");z.for=`ctrl-${e}_`;z.addEventListener("click",t=>{A.click()});n.appendChild(z);m.appendChild(n);break;case "color":n=document.createElement("input"),n.className="gp-color_",n.type=g,n.value=a[e],n.name=e,m.appendChild(n)}n.addEventListener(l?
"input":"change",p=>{this.dispatchEvent(new CustomEvent("settings_updated",{detail:{settings:{[p.target.name]:this.parseSettingsValue(p.target)}}}))});c.appendChild(d);c.appendChild(m)}b.appendChild(c);this.toggleScrollbar(b);b.scrollTop=this.settingsScrollPos}getInitialSettings(){return Object.assign({},this.initialSettings)}parseSettingsValue(a){switch(a.type){case "range":return Number.parseFloat(a.value);case "checkbox":return a.checked;default:return a.value}}resetSettings(a){a=this.painter.getDefaultSettings();
this.renderSettings(a);this.dispatchEvent(new CustomEvent("settings_updated",{detail:{settings:a}}))}restoreSettings(a){a=this.getInitialSettings();this.renderSettings(a);this.dispatchEvent(new CustomEvent("settings_updated",{detail:{settings:a}}))}renderBindings(a){this.settingsContent.innerHTML="";const b=document.createElement("div");b.className="bindings_ gp-scrollbar_";this.settingsContent.appendChild(b);var c=document.createElement("div");c.className="buttons_";this.settingsContent.appendChild(c);
var d=document.createElement("div");d.className="reset-btn_ btn_ gp-btn_";d.textContent="\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438";d.title="\u0412\u044b\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e";d.addEventListener("click",this.resetBindings);c.appendChild(d);c=document.createDocumentFragment();for(let e in a){d=document.createElement("div");
d.className="label_";d.title=this.painter.tools[e].description;d.textContent=e.split(/(?=[A-Z])/).join(" ");c.appendChild(d);const g=document.createElement("div");g.className="keys-bindings_";a[e].length?a[e].forEach((f,h)=>{f=this.renderBindingKeys(e,h,f,g,b);g.appendChild(f)}):(d=this.renderBindingKeys(e,-1,[],g,b),d.classList.add("empty_"),g.appendChild(d));c.appendChild(g)}b.appendChild(c);this.toggleScrollbar(b)}renderBindingKeys(a,b,c,d,e){c=this.formatKeys(c);const g=document.createElement("div");
g.className="keys-binding_";var f=document.createElement("div");f.className="keys_";f.textContent=c;f.dataset.name=a;f.dataset.index=b;f.dataset.initialValue=c;f.addEventListener("click",this.setBindingHandler);g.appendChild(f);c=document.createElement("div");c.className="buttons_";g.appendChild(c);f=document.createElement("div");f.className="add-btn_ btn_ gp-btn_";f.textContent="+";f.addEventListener("click",h=>{h=this.renderBindingKeys(a,-1,[],d,e);d.appendChild(h);this.toggleScrollbar(e)});c.appendChild(f);
f=document.createElement("div");f.className="delete-btn_ btn_ gp-btn_";f.textContent="-";f.addEventListener("click",h=>{this.deleteBinding(a,b,g);this.toggleScrollbar(e)});c.appendChild(f);f=document.createElement("div");f.className="accept-btn_ btn_ gp-btn_";f.textContent="\u2713";f.addEventListener("click",h=>{this.isAcceptedBinding(this.currentKeys,this.pressedKeys)?this.acceptBinding(this.currentBindingElem,this.pressedKeys):this.cancelBinding(this.currentBindingElem)});c.appendChild(f);return g}deleteBinding(a,
b,c){~b?(c=this.painter.getBindings(),c[a].splice(b,1),this.renderBindings(c),this.dispatchEvent(new CustomEvent("bindings_updated",{detail:{bindings:c}}))):c.remove()}setBindingHandler(a){this.currentBindingElem&&this.cancelBinding(this.currentBindingElem);this.painter.setKeysLockState(!0);a=a.target;this.currentKeys=this.painter.getBindingKeys(a.dataset.name,+a.dataset.index);this.pressedKeys=new Set;this.currentBindingElem=a;a.parentElement.classList.add("process_");a.textContent=this.getPlaceholderKeys();
document.addEventListener("keydown",this.keyDownHandler,!0);document.addEventListener("keyup",this.keyUpHandler,!0)}keyDownHandler(a){a.preventDefault();a.stopPropagation();if(!a.repeat){var b=this.currentBindingElem;switch(a.code){case "Escape":this.cancelBinding(b);break;case "Enter":case "NumpadEnter":this.isAcceptedBinding(this.currentKeys,this.pressedKeys)?this.acceptBinding(b,this.pressedKeys):this.cancelBinding(b);break;default:this.pressedKeys.add(a.code),this.keyHandler(a)}}}keyUpHandler(a){this.pressedKeys.delete(a.code);
this.keyHandler(a)}keyHandler(a){a=this.currentBindingElem;a.classList.remove("existed_");if(this.pressedKeys.size){a.textContent=this.formatKeys(this.pressedKeys);const b=this.isSameBindingKeys(this.currentKeys,this.pressedKeys)||this.isBindingExists(this.pressedKeys);a.classList.toggle("existed_",b)}else a.textContent=this.getPlaceholderKeys()}isAcceptedBinding(a,b){return!(0===b.size||this.isSameBindingKeys(a,b)||this.isBindingExists(b))}isBindingExists(a){return this.painter.isBindingExisted(a)}isSameBindingKeys(a,
b){return this.painter.compareBindingsKeys(a,b)}acceptBinding(a,b){b=Array.from(b).map(this.formatKey).join(" + ");a.textContent=b;a.dataset.initialValue=b;this.updateBindingsSettings(a.dataset.name,a.dataset.index);this.endBinding(a)}cancelBinding(a){a.textContent=a.dataset.initialValue;this.endBinding(a)}endBinding(a){this.painter.setKeysLockState(!1);a.parentElement.classList.remove("process_");a.classList.remove("existed_");document.removeEventListener("keydown",this.keyDownHandler,!0);document.removeEventListener("keyup",
this.keyUpHandler,!0);this.currentBindingElem=null}resetBindings(a){a=this.painter.getDefaultBindings();this.renderBindings(a);this.dispatchEvent(new CustomEvent("bindings_updated",{detail:{bindings:a}}))}updateBindingsSettings(a,b){const c=this.painter.getBindings();b=~b?b:c[a].length;c[a][b]=[...this.pressedKeys];this.renderBindings(c);this.dispatchEvent(new CustomEvent("bindings_updated",{detail:{bindings:c}}))}getPlaceholderKeys(){return"\u00a0"}formatKeys(a){return a?Array.from(a).map(this.formatKey).join(" + "):
this.getPlaceholderKeys()}formatKey(a){return a.replace(/^Key/,"").replace(/((?:Left)|(?:Right))$/," ($1)")}toggleScrollbar(a){a.classList.toggle("scrollbar_",a.scrollHeight>a.clientHeight)}updateToolbar(a){this.currentTool.classList.remove("sel");this.currentTool=this.tools[GPDrawInterface_.TOOLS_IDS_CLASSES[a]];this.currentTool.classList.add("sel")}updateColorInput(a){this.colorInput.value=a}updateColor2Input(a){this.color2Input.value=a}updateOpacity(a){this.opacity.value=a}updateThickness(a){a=
this.thicknesses[a];this.currentThickness&&(this.currentThickness.classList.remove("sel"),this.currentThickness=null);a&&(a.classList.add("sel"),this.currentThickness=a)}updateReadyBtn(a){a??this.painter.gpproxy.isReady()?(this.readyIcon.classList.replace("ready","pencil"),this.readyLabel.textContent=this.painter.localization.edit):(this.readyIcon.classList.replace("pencil","ready"),this.readyLabel.textContent=this.painter.localization.ready)}updateColorPicker(a,b){this.colorPicker&&!b&&this.colorPicker.setColor(a)}updateExtendedPalettePanel(a){a?
this.initExtendedPalettePanel():this.palette&&(this.palette.remove(),this.palette=null,this.screen.classList.remove("gp-extended-palette-panel_"));this.screen.classList.toggle("gp-custom-tools_",!(!this.palette&&!this.colorPicker))}updateColorPickerPanel(a){a?this.initColorPickerPanel():this.colorPicker&&(this.colorPicker.getElement().remove(),this.colorPicker=null,this.screen.classList.remove("gp-color-picker-panel_"));this.screen.classList.toggle("gp-custom-tools_",!(!this.palette&&!this.colorPicker))}updatePanelsBackground(a,
b){const c=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5,2),16);this.style.setProperty("--gp-panels-bg-color",`rgb(${c} ${d} ${e} / ${b}%)`);const [g,f,h]=GPColorUtils_.rgbToHsv(c,d,e),[k,l,m]=GPColorUtils_.hsvToRgb(Math.max(g-.04246122552758713,0),Math.max(f-.012523565849717255,0),Math.max(h-.05882352941176472,0));this.style.setProperty("--gp-panels-elems2-color",`rgb(${k}, ${l}, ${m})`);this.painter.isDisabled&&(this.updateColorInput(a),this.updateColor2Input(a))}updatePanelsElements(a,
b){const c=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16);a=parseInt(a.substr(5,2),16);this.style.setProperty("--gp-panels-elems-rgb",`${c} ${d} ${a}`);this.style.setProperty("--gp-panels-elems-rgb-opacity",`${b}%`)}updateHeaderPhraseColor(a){this.style.setProperty("--gp-header-phrase-color",a)}setAutoHideHeaderState(a){this.screen.classList.toggle("gp-auto-hide-header_",a)}setAutoHideHeaderDelay(a){this.style.setProperty("--gp-header-auto-hide-delay",`${a}s`)}updateSymmetryPanel(a){this.screen.classList.toggle("gp-symmetry-panel_",
a)}}window.GPDrawInterface_=GPDrawInterface_;class GPReference_ extends EventTarget{static CONTAINER_HEIGHT=698;static CONTAINER_MIN_WIDTH=256;static QUERY_INPUT_HEIGHT=56;static BORDER_SIZE=4;static PREVIEW_MAX_HEIGHT=180;static DEFAULT_COLUMNS_COUNT=4;static RESULTS_COLUMN_MIN_WIDTH=125;static MAX_ZOOM_SENSITIVITY=20;static ALIGNMENT_ICONS={center:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='2' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='8' y='3.5' rx='1'/%3E%3Cpath d='M6 1h1v11H6z'/%3E%3C/svg%3E",
"flex-start":"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='6' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='2' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1z'/%3E%3C/svg%3E","flex-end":"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' transform='scale(-1,1)' rx='1' y='3.5' x='-7'/%3E%3Crect width='3' height='6' transform='scale(-1,1)' rx='1' y='3.5' x='-11'/%3E%3Cpath d='m12 1h-1v11h1z'/%3E%3C/svg%3E",
"space-between":"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='8' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='2' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1zM11 1h1v11h-1z'/%3E%3C/svg%3E","space-around":"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='7.25' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='2.75' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1zM11 1h1v11h-1z'/%3E%3C/svg%3E",
"space-evenly":"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='7' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='3' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1zM11 1h1v11h-1z'/%3E%3C/svg%3E"};static URL_PATTERN=/^https?:\/\/\w/;static IMAGE_TYPES=new Set("image/jpeg image/png image/gif image/webp image/svg+xml image/bmp".split(" "));static SEARCH_ENGINES={GOOGLE:"google",PINTEREST:"pinterest",UNSPLASH:"unsplash"};static INTERFACE_ALIGNMENT={CENTER:"center",
RIGHT:"flex-start",LEFT:"flex-end",SPACE_BETWEEN:"space-between",SPACE_AROUND:"space-around",SPACE_EVENLY:"space-evenly"};static DEFAULT_SETTINGS={enabled:!1,searchEngine:this.SEARCH_ENGINES.GOOGLE,interfaceAlignment:this.INTERFACE_ALIGNMENT.CENTER,containerMaxWidth:"none",zoomSensitivity:10,minZoom:1,maxZoom:30};static SETTINGS_UI={interfaceAlignment:{type:"list-i",data:{icons:this.ALIGNMENT_ICONS},description:"\u0412\u044b\u0440\u0430\u0432\u043d\u0438\u0432\u0430\u043d\u0438\u0435 \u043e\u043a\u043e\u043d \u043c\u043e\u0434\u0443\u043b\u0435\u0439 Reference \u0438 Painter \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u0440\u0443\u0433 \u0434\u0440\u0443\u0433\u0430"},
minZoom:{type:"range",args:[.1,1,.1],description:"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0441\u0430"},maxZoom:{type:"range",args:[2,60,1],description:"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0441\u0430"},
zoomSensitivity:{type:"range",args:[1,this.MAX_ZOOM_SENSITIVITY,1,!0],formatter:this.zoomSensitivityFormatter.bind(this),description:"\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0441\u0430"}};static zoomSensitivityFormatter(a){return this.MAX_ZOOM_SENSITIVITY-(a-1)}static MODULE={title:"Reference",settings:{storage:"gp_reference",defaultSettings:this.DEFAULT_SETTINGS,
ui:this.SETTINGS_UI}};static INIT(a){a.reference=new GPReference_(a.gpproxy,a.sm)}constructor(a,b){super();this.gpproxy=a;this.s=b.setSettings(this,this.updateSettings);this.history=new Map;this.searchData=this.pendingSearch=this.pendingImage=this.lastQuery=null;this.isRefOpened=this.isLastPage=!1;this.scrollPos=0;this.resizeStartX;this.resizeInitialWidth;this.resizeTimer;this.isReRenderNeeded=this.isResizing=!1;this.columns=[];this.columnsCount=GPReference_.DEFAULT_COLUMNS_COUNT;this.lastColumnsCount=
null;this.style=document.documentElement.style;this.style.setProperty("--gp-ref-max-width",`${this.s.containerMaxWidth}`);this.style.setProperty("--gp-ref-alignment",`${this.s.interfaceAlignment}`);this.style.setProperty("--gp-ref-column-flex",`${Math.floor(100/this.columnsCount)}%`);this.downloadImage=this.downloadImage.bind(this);this.onScroll=this.onScroll.bind(this);this.openImage=this.openImage.bind(this);this.closeImage=this.closeImage.bind(this);this.onImageWheel=this.onImageWheel.bind(this);
this.onImageDown=this.onImageDown.bind(this);this.onImageMove=this.onImageMove.bind(this);this.onImageDblClick=this.onImageDblClick.bind(this);this.resizeDown=this.resizeDown.bind(this);this.resizeMove=this.resizeMove.bind(this);this.resizeUp=this.resizeUp.bind(this);this.resizeDblClick=this.resizeDblClick.bind(this);this.handleResizeWindow=this.handleResizeWindow.bind(this);this.onResize=this.onResize.bind(this);document.addEventListener("_ref_progress",({detail:{percentage:c}})=>{this.updateProgress(c)});
document.addEventListener("_ref_results",({detail:{images:c,isLastPage:d,isFirstPage:e,searchEngine:g,query:f}})=>{g===this.pendingSearch&&(this.searchData=e?c:[...this.searchData,...c],this.pendingSearch=null,this.isLastPage=d,this.renderImages({images:c,isFirstPage:e,query:f}),this.hideProgress(),this.closeImage())});document.addEventListener("_ref_complete",({detail:{base64:c,width:d,height:e,url:g,query:f,type:h,isFromHistory:k}})=>{g===this.pendingImage&&(k||this.addToHistory(g,d,e,f),this.pendingImage=
null,this.showPreview(c,d,e,{query:f,type:h,url:g}),this.hideProgress())});document.addEventListener("_ref_complete",()=>{this.historyBtn.removeAttribute("hidden")},{once:!0});document.addEventListener("_ref_error",({detail:{type:c,previewURL:d,width:e,height:g,query:f,isFromHistory:h}})=>{"search"===c?this.pendingSearch=null:"image"===c&&d?this.downloadImage(d,e,g,f,null,h):(this.pendingImage=null,this.hideProgress())});this.gpproxy.addEventListener("turn_started",c=>{this.container&&(this.isLastPage=
this.isRefOpened=!1,this.lastQuery=this.lastColumnsCount=null,this.queryInput.value="",this.scrollPos=0,this.searchData=null,this.results.innerHTML="",delete this.results.dataset.query)});this.createPainterBtn()}toggle(a){this.s.enabled=a??!document.getElementById("__next")?.classList.contains("gp-reference-rendered_");this.s.enabled?this.enable():this.disable()}enable(){document.getElementById("__next").classList.add("gp-reference-rendered_");setTimeout(this.calculateColumnsCount.bind(this),1E3);
this.dispatchEvent(new CustomEvent("state_changed",{detail:{isEnabled:!0}}))}disable(){document.getElementById("__next").classList.remove("gp-reference-rendered_");this.dispatchEvent(new CustomEvent("state_changed",{detail:{isEnabled:!1}}))}init(){this.container||this.render();window.addEventListener("resize",this.handleResizeWindow);this.screen=document.querySelector("#content > .screen");this.screen.before(this.container);this.s.enabled?this.enable():this.disable()}terminate(){this.container&&(this.pendingSearch=
this.pendingImage=null,this.isReRenderNeeded=this.isResizing=!1,this.container.remove(),this.container.classList.remove("image-opened_"),this.zoomer.reset(),window.removeEventListener("resize",this.handleResizeWindow),this.disable())}render(){this.container=document.createElement("div");this.container.className="gp-reference_";var a=this.container;a.addEventListener("dropenter",()=>{},!0);a.addEventListener("dropleave",()=>{},!0);a.addEventListener("drop",async c=>{c.preventDefault();let d;c.dataTransfer.items&&
"file"===c.dataTransfer.items[0].kind?d=c.dataTransfer.items[0].getAsFile():c.dataTransfer.files.length&&(d=c.dataTransfer.files[0]);if(d&&GPReference_.IMAGE_TYPES.has(d.type)){const e=new FileReader;e.addEventListener("loadend",g=>{this.showPreview(e.result,0,0,{query:"file",type:d.type})});e.readAsDataURL(d)}},!0);a.addEventListener("dragover",c=>{c.preventDefault();c.dataTransfer.dropEffect="move"},!0);a=document.createElement("div");a.className="wrapper_";this.container.appendChild(a);var b=document.createElement("div");
b.className="header_";b.addEventListener("animationend",c=>{"gp-ref-fade-out_"===c.animationName&&this.style.setProperty("--gp-ref-progress","0%")});b.addEventListener("pointerleave",c=>{this.historyList.classList.remove("shown_")});a.appendChild(b);this.queryInput=document.createElement("input");this.queryInput.className="query_";this.queryInput.autocomplete="off";this.queryInput.addEventListener("keydown",c=>{if("Enter"===c.key){const d=c.target.value.trim();GPReference_.URL_PATTERN.test(d)?this.openImageURL(d):
d&&d!==this.lastQuery&&(this.lastQuery=d,this.searchImages(d,!1));c.target.blur()}else"Escape"===c.key&&c.target.blur()});this.queryInput.addEventListener("focus",c=>{c.target.select();document.dispatchEvent(new CustomEvent("_keys_lock",{detail:{state:!0}}));document.addEventListener("pointerdown",d=>{d.target!==this.queryInput&&this.queryInput.blur()},{once:!0,capture:!0})});this.queryInput.addEventListener("blur",c=>{window.getSelection().removeAllRanges();document.dispatchEvent(new CustomEvent("_keys_lock",
{detail:{state:!1}}))});b.appendChild(this.queryInput);this.historyBtn=document.createElement("div");this.historyBtn.className="history-btn_";this.historyBtn.setAttribute("hidden","");this.historyBtn.addEventListener("pointerdown",c=>{0===c.button&&this.history.size&&(this.historyList.classList.toggle("shown_"),this.historyList.scrollTop=0)});b.appendChild(this.historyBtn);this.historyList=document.createElement("div");this.historyList.className="history-list_";this.historyList.addEventListener("pointerup",
c=>{if(c=c.target.closest(".history-item_")){var {url:d,width:e,height:g,query:f}=c.dataset;this.downloadImage(d,e,g,f,null,!0);this.historyList.classList.remove("shown_")}});b.appendChild(this.historyList);this.searchEnginesMenu=document.createElement("div");this.searchEnginesMenu.className="search-engines-menu_";b.appendChild(this.searchEnginesMenu);this.searchEngines=document.createElement("div");this.searchEngines.className="search-engines_";this.searchEngines.addEventListener("pointerdown",c=>
{0===c.button&&(this.searchEngines.classList.contains("shown_")?c.target===this.searchEngines&&this.searchEngines.classList.remove("shown_"):this.searchEngines.classList.add("shown_"))});this.searchEngines.addEventListener("click",c=>{c.target.matches(".search-engine_.selected_")&&this.searchEngines.classList.remove("shown_")});this.searchEngines.addEventListener("pointerup",c=>{if(c.target.classList.contains("search-engine_")){var d=c.target.dataset.searchEngine;if(d!==this.s.searchEngine){this.s.searchEngine=
d;const e=this.queryInput.value.trim();this.searchByEngine(e,d);Array.from(this.searchEngines.children).forEach(g=>{g.style.order=+(g!==c.target)});this.searchEngines.classList.remove("shown_");this.searchEngines.title=c.target.title}}});Object.values(GPReference_.SEARCH_ENGINES).forEach(c=>{const d=document.createElement("div");d.className=`search-engine_ ${c}_`;d.title=c[0].toUpperCase()+c.slice(1);d.dataset.searchEngine=c;this.searchEngines.appendChild(d)});b=this.searchEngines.querySelector(`[data-search-engine="${this.s.searchEngine}"]`);
b.classList.add("selected_");this.searchEngines.title=b.title;this.searchEnginesMenu.appendChild(this.searchEngines);Array.from(this.searchEngines.children).forEach(c=>{c.style.order=+(c.dataset.searchEngine!==this.s.searchEngine)});this.results=document.createElement("div");this.results.className="results_";this.results.addEventListener("click",this.openImage);this.results.addEventListener("scroll",this.onScroll);this.results.addEventListener("contextmenu",this.blockContextMenu);a.appendChild(this.results);
this.imageObserver=new IntersectionObserver(c=>{c.forEach(d=>{const e=d.target;d.isIntersecting&&(e.src=e.dataset.src,this.imageObserver.unobserve(e))})},{root:this.results});this.imageWrapper=document.createElement("div");this.imageWrapper.className="image-wrapper_";this.imageWrapper.addEventListener("wheel",this.onImageWheel);this.imageWrapper.addEventListener("pointerdown",this.onImageDown);this.imageWrapper.addEventListener("dblclick",this.onImageDblClick);this.imageWrapper.addEventListener("contextmenu",
this.blockContextMenu);a.appendChild(this.imageWrapper);this.image=document.createElement("div");this.image.className="image_";this.imageWrapper.appendChild(this.image);this.zoomer=window.renderer({minScale:this.s.minZoom,maxScale:this.s.maxZoom,element:this.image,defaultScaleSensitivity:this.s.zoomSensitivity});b=document.createElement("div");b.className="resizer_ left_";b.dataset.dir="left";b.addEventListener("pointerdown",this.resizeDown);b.addEventListener("pointerup",this.resizeUp);b.addEventListener("dblclick",
this.resizeDblClick);a.appendChild(b);b=document.createElement("div");b.className="resizer_ right_";b.dataset.dir="right";b.addEventListener("pointerdown",this.resizeDown);b.addEventListener("pointerup",this.resizeUp);b.addEventListener("dblclick",this.resizeDblClick);a.appendChild(b)}createPainterBtn(){this.painterBtn=document.createElement("div");this.painterBtn.className="gp-reference-btn_";this.painterBtn.addEventListener("click",()=>{this.toggle()})}searchByEngine(a,b){a&&(this.lastQuery=a,this.searchImages(a,
!1));(a=this.searchEngines.querySelector(".selected_"))&&a.classList.remove("selected_");this.searchEngines.querySelector(`[data-search-engine=${b}]`).classList.add("selected_")}searchImages(a,b){a&&(this.pendingImage=null,this.pendingSearch=this.s.searchEngine,document.dispatchEvent(new CustomEvent("_ref_search",{detail:{searchEngine:this.s.searchEngine,next:!!b,query:a}})),this.container.classList.remove("complete_"))}renderImages({images:a,isFirstPage:b,query:c,scrollPos:d}){if(a?.length){var e=
Array(this.columnsCount).fill(0),g=Array(this.columnsCount).fill().map(()=>document.createDocumentFragment());if(b)for(this.results.innerHTML="",this.results.scrollTop=0,this.results.dataset.query=c,this.columns=[],b=0;b<this.columnsCount;b++){const f=document.createElement("div");f.className="column_";f.dataset.index=`${b}`;this.columns[b]=f;this.results.appendChild(f)}else e.map((f,h)=>+this.columns[h].dataset.height);a.forEach(f=>{var h=f.image.width/f.image.height;const k=document.createElement("div");
k.className="preview_";k.style.backgroundColor=f.dominantColor;k.dataset.url=f.image.url;k.dataset.previewURL=f.preview.url;k.dataset.width=f.image.width;k.dataset.height=f.image.height;k.dataset.aspectRatio=h;const l=new Image;l.width=h*GPReference_.PREVIEW_MAX_HEIGHT;l.height=GPReference_.PREVIEW_MAX_HEIGHT;l.dataset.src=f.preview.url;k.appendChild(l);this.imageObserver.observe(l);h=this.getMinHeightColumnIndex(e);g[h].appendChild(k);e[h]+=f.image.height/f.image.width});this.columns.forEach((f,
h)=>{f.dataset.height=e[h];f.appendChild(g[h])});a=!!this.results.getBoundingClientRect().height;void 0!==d&&setTimeout(()=>{this.results.scrollTop=d},a?0:500);a&&setTimeout(()=>{this.isNextPageNeeded()&&this.searchImages(c,!0)},a?0:500)}}getMinHeightColumnIndex(a){return a.reduce((b,c,d,e)=>c<e[b]?d:b,0)}isNextPageNeeded(){return!this.isLastPage&&!this.pendingSearch&&this.columns.some(a=>{const b=this.results.scrollTop,c=this.results.getBoundingClientRect().height;a=a.getBoundingClientRect().height;
return b+c>=a})}calculateColumnsCount(a){a=a||this.results.getBoundingClientRect().width||this.imageWrapper.getBoundingClientRect().width;this.columnsCount=Math.floor(a/GPReference_.RESULTS_COLUMN_MIN_WIDTH);this.style.setProperty("--gp-ref-column-flex",`${Math.floor(100/this.columnsCount)}%`)}onScroll(){!this.isResizing&&this.isNextPageNeeded()&&this.searchImages(this.lastQuery,!0);this.scrollPos=this.results.scrollTop}updateProgress(a){this.container.classList.toggle("progress_",!~a);this.style.setProperty("--gp-ref-progress",
`${a}%`)}hideProgress(){this.container.classList.remove("progress_");this.container.classList.add("complete_")}downloadImage(a,b,c,d,e,g){this.pendingImage=a;document.dispatchEvent(new CustomEvent("_ref_image",{detail:{searchEngine:this.s.searchEngine,url:a,width:b,height:c,query:d,previewURL:e,isFromHistory:g}}));this.container.classList.remove("complete_")}async showPreview(a,b,c,{query:d,type:e,url:g}){b&&c||([b,c]=await this.getImageDimensions(a));this.image.metadata={base64:a,query:d,type:e,
url:g};this.image.style.backgroundImage=`url(${a})`;this.image.style.aspectRatio=`${b} / ${c}`;this.container.classList.add("image-opened_");(a=this.history.get(g)?.pos)?this.zoomer.setState(a):this.zoomer.reset();this.isRefOpened=!0}async getImageDimensions(a){return new Promise((b,c)=>{const d=new Image;d.onload=()=>{b([d.naturalWidth,d.naturalHeight])};d.onerror=c;d.src=a})}onImageDown(a){switch(a.button){case 0:a.ctrlKey?this.saveImage():(a.target.setPointerCapture(a.pointerId),a.target.addEventListener("pointermove",
this.onImageMove),a.target.addEventListener("pointerup",b=>{b.target.removeEventListener("pointermove",this.onImageMove);this.updateHistoryState()},{once:!0}));break;case 1:this.zoomer.reset();this.updateHistoryState();break;case 2:this.closeImage()}a.preventDefault()}onImageMove(a){this.zoomer.panBy({originX:a.movementX,originY:a.movementY})}onImageDblClick(a){this.zoomer.reset();this.updateHistoryState()}onImageWheel(a){a.preventDefault();this.zoomer.zoom({deltaScale:-Math.sign(a.deltaY),x:a.pageX-
window.scrollX,y:a.pageY-window.scrollY,scaleSensitivity:this.s.zoomSensitivity});1===this.zoomer.getMinScale()&&1>=this.zoomer.getScale()&&this.zoomer.reset();this.updateHistoryState()}openImageURL(a){this.downloadImage(a,0,0,"url",null,null)}openImage(a){if(a.target.classList.contains("preview_")){var {url:b,width:c,height:d,previewURL:e}=a.target.dataset;this.downloadImage(b,c,d,this.results.dataset.query,e,null)}}closeImage(a){this.results.dataset.query&&(this.isRefOpened=!1,this.zoomer.reset(),
this.container.classList.remove("image-opened_"),this.isReRenderNeeded&&(this.calculateColumnsCount(),this.renderImages({images:this.searchData,isFirstPage:!0,query:this.results.dataset.query})))}saveImage(){const {base64:a,query:b,type:c}=this.image.metadata,d=c.split("/")[1].split("+")[0],e=document.createElement("a");e.href=a;e.download=`${b}.${d}`;e.click()}addToHistory(a,b,c,d){this.history.delete(a);this.history.set(a,{width:b,height:c,query:d});this.renderHistory()}updateHistoryState(){const a=
this.history.get(this.image.metadata.url);a&&(a.pos=this.zoomer.getState())}renderHistory(){this.historyList.innerHTML="";const a=document.createDocumentFragment();Array.from(this.history).reverse().forEach(([b,{width:c,height:d,query:e}],g)=>{const f=document.createElement("div");f.className="history-item_";f.dataset.url=b;f.dataset.width=c;f.dataset.height=d;f.dataset.query=e;b=document.createElement("div");b.className="index_";b.textContent=`${this.history.size-g}.`;f.appendChild(b);g=document.createElement("div");
g.className="label_";g.textContent=e;f.appendChild(g);a.appendChild(f)});this.historyList.appendChild(a)}blockContextMenu(a){a.preventDefault()}resizeDown(a){a.target.setPointerCapture(a.pointerId);this.resizeStartX=a.pageX;this.resizeInitialWidth=this.getContainerWidth();this.lastColumnsCount=this.columnsCount;a.target.addEventListener("pointermove",this.resizeMove);this.isResizing=!0}resizeMove(a){const b=a.pageX-this.resizeStartX;this.style.setProperty("--gp-ref-max-width",`${Math.max(this.resizeInitialWidth+
2*("left"===a.target.dataset.dir?-b:b),GPReference_.CONTAINER_MIN_WIDTH)}px`);this.isRefOpened?this.isReRenderNeeded=!0:this.calculateColumnsCount()}resizeUp(a){var b=this.getContainerWidth();if(b!==this.resizeInitialWidth){this.style.setProperty("--gp-ref-max-width","none");const c=this.getContainerWidth();b=b<c?`${b}px`:"none";this.s.containerMaxWidth=b;this.style.setProperty("--gp-ref-max-width",b)}a.target.removeEventListener("pointermove",this.resizeMove);this.isResizing=!1;!this.isRefOpened&&
this.searchData&&this.columnsCount!==this.lastColumnsCount&&this.renderImages({images:this.searchData,isFirstPage:!0,query:this.results.dataset.query})}resizeDblClick(a){a="none"===window.getComputedStyle(this.container).maxWidth?`${GPReference_.CONTAINER_MIN_WIDTH}px`:"none";this.s.containerMaxWidth=a;this.style.setProperty("--gp-ref-max-width",a);this.isRefOpened?this.isReRenderNeeded=!0:(this.calculateColumnsCount(),this.renderImages({images:this.searchData,isFirstPage:!0,query:this.results.dataset.query}))}getContainerWidth(){return this.container.getBoundingClientRect().width-
2*GPReference_.BORDER_SIZE}handleResizeWindow(a){clearTimeout(this.resizeTimer);this.resizeTimer=setTimeout(this.onResize,250)}onResize(){this.isRefOpened?this.isReRenderNeeded=!0:(this.calculateColumnsCount(),this.renderImages({images:this.searchData,isFirstPage:!0,query:this.results.dataset.query}))}isEnabled(){return this.s.enabled}getPainterButton(){return this.painterBtn}updateSettings({detail:{settings:a}}){"interfaceAlignment"in a&&this.style.setProperty("--gp-ref-alignment",`${a.interfaceAlignment}`);
this.container&&("minZoom"in a&&this.zoomer.setMinScale(a.minZoom),"maxZoom"in a&&this.zoomer.setMaxScale(a.maxZoom))}}window.GPReference_=GPReference_;class GPPlayersManager_ extends EventTarget{static DISPLAY_MODE={NORMAL:"normal",EXPANDED:"expanded",FULLSCREEN:"fullscreen"};static PREVIEW_PANEL_PATHS=["write","memory"];static DEFAULT_SETTINGS={autoplay:!0,openPlayerWithDoubleClick:!1,defaultDisplayMode:this.DISPLAY_MODE.NORMAL};static SETTINGS_UI={autoplay:{type:"checkbox",description:"\u0410\u0432\u0442\u043e\u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f \u0441\u0440\u0430\u0437\u0443 \u043f\u043e\u0441\u043b\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u043f\u043b\u0435\u0435\u0440\u0430 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"},
openPlayerWithDoubleClick:{type:"checkbox",description:"\u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043f\u043b\u0435\u0435\u0440 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0434\u0432\u043e\u0439\u043d\u043e\u0433\u043e \u043a\u043b\u0438\u043a\u0430 \u043f\u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0443 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"},defaultDisplayMode:{type:"list",args:Object.values(this.DISPLAY_MODE),description:"\u0420\u0435\u0436\u0438\u043c \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043e\u043a\u043d\u0430 \u043f\u043b\u0435\u0435\u0440\u0430 \u043f\u0440\u0438 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0438 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"}};static MODULE={title:"Timelapse Player",
dependencies:["GPTimelapsePlayer_"],settings:{storage:"gp_timelapse-player",defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){new GPPlayersManager_(a.gpproxy,a.sm)}constructor(a,b){super();this.gpproxy=a;this.s=b.setSettings(this);this.currentPath=null;this.onAlbumMiddleClick=this.onAlbumMiddleClick.bind(this);this.onAlbumDoubleClick=this.onAlbumDoubleClick.bind(this);this.onImageMiddleClick=this.onImageMiddleClick.bind(this);this.onImageDoubleClick=this.onImageDoubleClick.bind(this);
document.addEventListener("_url_changed",({detail:{path:c}})=>{this.currentPath=c.slice(1)});this.gpproxy.addEventListener("data",({detail:{event:c}})=>{c===GPProxy_.EVENT.TURN_STARTED?this.closePlayers():c===GPProxy_.EVENT.GAME_STARTED?(document.addEventListener("pointerdown",this.onImageMiddleClick),document.addEventListener("dblclick",this.onImageDoubleClick)):[GPProxy_.EVENT.ALBUM_INFO,GPProxy_.EVENT.NEW_GAME,GPProxy_.EVENT.ALBUM_SCORE,GPProxy_.EVENT.GAME_QUIT].includes(c)?(this.closePlayers(),
c!==GPProxy_.EVENT.ALBUM_INFO&&(document.removeEventListener("pointerdown",this.onAlbumMiddleClick),document.removeEventListener("dblclick",this.onAlbumDoubleClick))):c===GPProxy_.EVENT.GALLERY_SETTINGS&&(document.addEventListener("pointerdown",this.onAlbumMiddleClick),document.addEventListener("dblclick",this.onAlbumDoubleClick),document.removeEventListener("pointerdown",this.onImageMiddleClick),document.removeEventListener("dblclick",this.onImageDoubleClick))});this.gpproxy.addEventListener("album_rejoin",
()=>{document.addEventListener("pointerdown",this.onAlbumMiddleClick);document.addEventListener("dblclick",this.onAlbumDoubleClick)});this.gpproxy.addEventListener("game_rejoin",()=>{document.addEventListener("pointerdown",this.onImageMiddleClick);document.addEventListener("dblclick",this.onImageDoubleClick)})}onImageMiddleClick(a){1===a.button&&this.handleImageClick(a)}onImageDoubleClick(a){0===a.button&&this.s.openPlayerWithDoubleClick&&this.handleImageClick(a)}handleImageClick(a){if(this.isPreviewPanelShown()&&
"CANVAS"===a.target.tagName&&a.target.parentElement.parentElement.classList.contains("core")){const b={data:this.gpproxy.getPrevImageData(),meta:{author:"",title:"",date:Date.now()}};a=a.target.parentElement.parentElement;const c=document.querySelector(".screen");a.isPlayerRendered||this.renderPlayer(b,a,c,GPTimelapsePlayer_.DISPLAY_MODE.NORMAL,!1,!0)}}isPreviewPanelShown(){return GPPlayersManager_.PREVIEW_PANEL_PATHS.includes(this.currentPath)}onAlbumMiddleClick(a){1===a.button&&this.handleAlbumClick(a)}onAlbumDoubleClick(a){0===
a.button&&this.s.openPlayerWithDoubleClick&&this.handleAlbumClick(a)}handleAlbumClick(a){if("CANVAS"===a.target.tagName&&!a.target.parentElement.classList.contains("animation")){var b=a.target.closest(".item");if(b){a=[...b.parentElement.children].filter(d=>d.classList.contains("item")).indexOf(b);a=this.gpproxy.getAlbumItem(a);b=b.querySelector(".balloon");var c=document.querySelector(".screen");b.isPlayerRendered||this.renderPlayer(a,b,c)}}}renderPlayer(a,b,c,d,e,g){const f=new GPTimelapsePlayer_({image:a,
container:b,mainContainer:c},d||this.s.defaultDisplayMode,g);(e??this.s.autoplay)&&f.addEventListener("data-loaded",()=>{f.play()})}closePlayers(){GPTimelapsePlayer_.closeAll()}}window.GPPlayersManager_=GPPlayersManager_;class GPTimelapsePlayer_ extends EventTarget{static players=new Set;static CACHE_ENABLE=!0;static CACHE_INTERVAL=1E3;static ORIGINAL_WIDTH=758;static ORIGINAL_HEIGHT=424;static DENSITY=1;static WIDTH=this.ORIGINAL_WIDTH*this.DENSITY;static HEIGHT=this.ORIGINAL_HEIGHT*this.DENSITY;static BACKGROUND_COLOR="#FFFFFF";static STROKE_OFFSET=3;static SPEEDS=[[1,1],[5,1],[15,1],[30,1],[50,1],[0,1],[0,2],[0,4],[0,8],[0,16],[0,32]];static SPEED=0;static SPEED_SLIDER_WIDTH=130;static SPEED_SLIDER_HEIGHT=16;static SPEED_SLIDER_THUMB_WIDTH=14;static M_STROKE_OFFSET=67;static DISPLAY_MODE={NORMAL:"normal",
EXPANDED:"expanded",FULLSCREEN:"fullscreen"};static DEFAULT_DISPLAY_MODE=GPTimelapsePlayer_.DISPLAY_MODE.NORMAL;constructor({image:{data:a,background:b,auth:c,meta:{author:d,title:e,date:g}},container:f,mainContainer:h},k=GPTimelapsePlayer_.DEFAULT_DISPLAY_MODE,l=!1){super();GPTimelapsePlayer_.players.add(this);this.density=GPTimelapsePlayer_.DENSITY;this.width=GPTimelapsePlayer_.WIDTH;this.height=GPTimelapsePlayer_.HEIGHT;this.originalData=a.slice();this.data=a;this.background=b;this.auth=c;this.author=
d;this.title=e;this.date=new Date(g);this.container=f;this.container.isPlayerRendered=!0;this.mainContainer=h;this.defaultDisplayMode=k;this.defaultDisplayModeDensity=this.getModeDensity(k);this.cache;this.canvas;this.ctx;this.isPlaying=!1;this.currentSpeed=JSON.parse(window.localStorage.getItem("gp-timelapse-player-speed"))||GPTimelapsePlayer_.SPEED;this.speed=GPTimelapsePlayer_.SPEEDS[this.currentSpeed];this.sPos=this.pos=0;this.lastContainerDimension={width:0,height:0};this.isContextLayoutShown=
this.isFullscreen=this.isExpanded=!1;this.isContextMenuDisabled=l;this.progressBarPointerMoveHandler=this.progressBarPointerMoveHandler.bind(this);this.resizeHandler=this.resizeHandler.bind(this);this.toggleFullscreen=this.toggleFullscreen.bind(this);this.playPause=this.playPause.bind(this);this.drawing=this.drawing.bind(this);this.expand=this.expand.bind(this);this.terminate=this.terminate.bind(this);this.toggleContextLayout=this.toggleContextLayout.bind(this);this.saveImage=this.saveImage.bind(this);
this.speedViewPointerMoveHandler=this.speedViewPointerMoveHandler.bind(this);window.addEventListener("resize",this.resizeHandler);this.addEventListener("cache-updated",this.updateCacheHandler);this.initData();this.initCacheWorker()}static closeAll(){GPTimelapsePlayer_.players.forEach(a=>{a.terminate()})}updateCacheHandler({detail:{density:a}}){if(a===this.defaultDisplayModeDensity){this.render();switch(this.defaultDisplayMode){case GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED:this.expand(!0);break;case GPTimelapsePlayer_.DISPLAY_MODE.FULLSCREEN:this.player.requestFullscreen()}this.seek(this.data.length);
this.dispatchEvent(new Event("image-rendered"));this.dispatchEvent(new CustomEvent("data-loaded",{detail:{author:this.author,title:this.title,date:this.date.toISOString()}}));this.removeEventListener("cache-updated",this.updateCacheHandler)}}getModeDensity(a){switch(a){case GPTimelapsePlayer_.DISPLAY_MODE.NORMAL:const {width:b,height:c}=getComputedStyle(this.container);return this.getDensityByDimensions(parseInt(b),parseInt(c)).density;case GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED:const {width:d,
height:e}=getComputedStyle(this.mainContainer);return this.getDensityByDimensions(parseInt(d),parseInt(e)).density;case GPTimelapsePlayer_.DISPLAY_MODE.FULLSCREEN:return this.getDensityByDimensions(window.screen.width,window.screen.height).density}}terminate(){this.pause();this.worker.terminate();this.cache=this.originalData=this.data=null;this.player.remove();this.container.isPlayerRendered=!1;this.container=null;this.speedInput&&this.speedInput.remove();window.removeEventListener("resize",this.resizeHandler);
GPTimelapsePlayer_.players.delete(this);this.dispatchEvent(new Event("terminated"))}initData(){const a=[];for(let b=0;b<this.data.length;b++)this.data[b].index=b,this.isMStroke(this.data[b])&&a.push(b);a.reverse().forEach(b=>{this.data.splice(b,1)})}isMStroke(a){return!(1===a[0]&&a[3][0]>GPTimelapsePlayer_.ORIGINAL_WIDTH&&a[3][1]>GPTimelapsePlayer_.ORIGINAL_HEIGHT)||a[3][0]-GPTimelapsePlayer_.ORIGINAL_WIDTH-GPTimelapsePlayer_.M_STROKE_OFFSET||a.at(-1)[1]-GPTimelapsePlayer_.ORIGINAL_HEIGHT-GPTimelapsePlayer_.M_STROKE_OFFSET?
!1:!0}render(){this.player=document.createElement("div");this.player.className="timelapse-player_";this.player.addEventListener("click",e=>{e.stopPropagation()});this.player.addEventListener("pointerdown",e=>{e.stopPropagation()});this.player.addEventListener("pointerup",e=>{e.stopPropagation()});this.player.addEventListener("mouseup",e=>{e.stopPropagation()});this.player.addEventListener("mousedown",e=>{e.preventDefault();e.stopPropagation();1===e.button&&(this.isFullscreen?this.toggleFullscreen():
this.expand())},!0);this.player.addEventListener("contextmenu",e=>{e.stopPropagation();e.preventDefault();this.toggleContextLayout()});this.player.addEventListener("fullscreenchange",e=>{this.isFullscreen=!!document.fullscreenElement;this.player.classList.toggle("fullscreen_",this.isFullscreen);this.mainContainer.classList.toggle("gp-tp-fullscreen_",this.isFullscreen);this.resizeHandler()});this.bgCanvas=document.createElement("canvas");this.bgCanvas.className="background-canvas_";this.bgCanvas.width=
this.width;this.bgCanvas.height=this.height;this.player.appendChild(this.bgCanvas);this.bgCtx=this.bgCanvas.getContext("2d");this.bgCtx.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR;this.bgCtx.fillRect(0,0,this.bgCanvas.width,this.bgCanvas.height);this.background&&this.drawFunction(this.bgCtx,this.background,this.density,!1);this.canvas=document.createElement("canvas");this.canvas.className="canvas_";this.canvas.width=this.width;this.canvas.height=this.height;this.player.appendChild(this.canvas);
this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0});this.strokeCanvas=document.createElement("canvas");this.strokeCanvas.className="stroke-canvas_";this.strokeCanvas.width=this.width;this.strokeCanvas.height=this.height;this.player.appendChild(this.strokeCanvas);this.strokeCtx=this.strokeCanvas.getContext("2d");var a=document.createElement("div");a.className="event-catcher_";a.addEventListener("click",this.playPause);a.addEventListener("dblclick",this.toggleFullscreen);this.player.appendChild(a);
a=document.createElement("div");a.className="controls_";a.style.cssText="";this.player.appendChild(a);const b=document.createElement("div");b.className="progress-bar_";b.addEventListener("pointermove",e=>{const [g,,f]=this.getCoords(e);d.style.width=`${100*Math.max(0,Math.min(1,g/f))}%`},!0);b.addEventListener("pointerdown",e=>{if(0===e.button){var g=this.isPlaying;this.progress.classList.remove("smooth_");this.player.classList.toggle("finished_",this.pos===this.data.length-1);this.progressBarPointerMoveHandler(e);
b.setPointerCapture(e.pointerId);b.addEventListener("pointermove",this.progressBarPointerMoveHandler);b.addEventListener("pointerup",f=>{b.removeEventListener("pointermove",this.progressBarPointerMoveHandler);this.progress.classList.add("smooth_");this.player.classList.toggle("finished_",this.pos===this.data.length);g&&this.pos<this.data.length&&this.play()},{once:!0})}});a.appendChild(b);var c=document.createElement("div");c.className="progress-bar-bg_";b.appendChild(c);const d=document.createElement("div");
d.className="progress-hover_";b.appendChild(d);this.progress=document.createElement("div");this.progress.className="progress_ smooth_";this.updateProgress();b.appendChild(this.progress);c=document.createElement("div");c.className="play-btn_ btn_";c.title="\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c/\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u043d\u0438\u0435";a.appendChild(c);c.addEventListener("click",e=>{this.playPause()});
c=document.createElement("div");c.className="first-frame-btn_ btn_";c.title="\u041a \u043f\u0435\u0440\u0432\u043e\u043c\u0443 \u0448\u0442\u0440\u0438\u0445\u0443";c.addEventListener("click",e=>{this.seek(0);this.updateProgress();this.player.classList.remove("finished_")});a.appendChild(c);c=document.createElement("div");c.className="speed-down-btn_ btn_";c.title="\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";c.addEventListener("click",e=>
{this.changeSpeed(-1)});a.appendChild(c);c=document.createElement("div");c.className="speed-up-btn_ btn_";c.title="\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";c.addEventListener("click",e=>{this.changeSpeed(1)});a.appendChild(c);c=document.createElement("div");c.className="last-frame-btn_ btn_";c.title="\u041a \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c\u0443 \u0448\u0442\u0440\u0438\u0445\u0443";c.addEventListener("click",e=>
{this.seek(this.data.length);this.updateProgress();this.player.classList.add("finished_")});a.appendChild(c);this.speedView=document.createElement("div");this.speedView.className="speed_";this.speedView.title="\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";this.speedView.textContent=" ";this.updateSpeedView();a.appendChild(this.speedView);this.speedView.addEventListener("pointerdown",e=>{const {x:g,y:f}=this.player.getBoundingClientRect(),h=(e.clientY-
f-(e.clientY-e.target.getBoundingClientRect().y))/this.scaleY;this.renderSpeedInput((e.clientX-g)/this.scaleX,h);this.speedView.setPointerCapture(e.pointerId);this.speedView.addEventListener("pointermove",this.speedViewPointerMoveHandler);this.speedView.addEventListener("pointerup",k=>{this.speedView.removeEventListener("pointermove",this.speedViewPointerMoveHandler);this.speedInput?.remove()},{once:!0})});this.strokeNumView=document.createElement("div");this.strokeNumView.className="stroke_";this.strokeNumView.title=
"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0448\u0442\u0440\u0438\u0445";this.strokeNumView.textContent=" ";this.updateStrokeView();a.appendChild(this.strokeNumView);a.appendChild(document.createElement("span"));c=document.createElement("div");c.className="expand-btn_ btn_";c.title="\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c/\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c";c.addEventListener("click",e=>{this.expand()});a.appendChild(c);c=document.createElement("div");c.className=
"fullscreen-btn_ btn_";c.title="\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0430 \u0432\u0435\u0441\u044c \u044d\u043a\u0440\u0430\u043d";c.addEventListener("click",this.toggleFullscreen);a.appendChild(c);a=document.createElement("div");a.className="close-btn_";a.title="\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u0442\u0435\u043b\u044c";a.addEventListener("click",this.terminate);this.player.appendChild(a);this.contextLayout=
document.createElement("div");this.contextLayout.className="context-layout_";this.contextLayout.addEventListener("click",this.toggleContextLayout);a=document.createElement("div");a.className="save-img-data-btn_ btn_";a.title="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a";a.addEventListener("click",e=>{e.stopPropagation();this.saveImageData()});this.contextLayout.appendChild(a);a=document.createElement("div");a.className="save-img-btn_ btn_";
a.title="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435";a.addEventListener("click",e=>{e.stopPropagation();this.saveImage()});this.contextLayout.appendChild(a);this.player.appendChild(this.contextLayout);this.container.firstElementChild.before(this.player);this.resizeHandler()}toggleContextLayout(){this.isContextMenuDisabled||(this.pause(),this.isContextLayoutShown=!this.isContextLayoutShown,this.player.classList.toggle("context-menu_",
this.isContextLayoutShown))}updateSpeedView(){let a=Number(!this.speed[0]);this.speedView.firstChild.nodeValue=`x${a?100*this.speed[a]:this.speed[a]}`}updateStrokeView(){this.strokeNumView.firstChild.nodeValue=`${this.pos} / ${this.data.length}`}resizeHandler(){const a=this.isPlaying;this.pause();if(document.fullscreenElement===this.player)this.setSize(document.documentElement.clientWidth,document.documentElement.clientHeight);else{const d=this.isExpanded?this.mainContainer:this.container;let {width:e,
height:g}=getComputedStyle(d);e=parseInt(e);g=parseInt(g);const {width:f,height:h}=this.lastContainerDimension;if(d!==this.mainContainer||e!==f||g!==h)this.setSize(e,g),this.lastContainerDimension={width:e,height:g}}a&&this.play();const {width:b,height:c}=this.mainContainer.getBoundingClientRect();this.scaleX=b/this.mainContainer.offsetWidth;this.scaleY=c/this.mainContainer.offsetHeight}getDensityByDimensions(a,b){a=Math.min(Math.ceil(a/GPTimelapsePlayer_.ORIGINAL_WIDTH),Math.ceil(b/GPTimelapsePlayer_.ORIGINAL_HEIGHT));
return{density:a,canvasWidth:GPTimelapsePlayer_.ORIGINAL_WIDTH*a,canvasHeight:GPTimelapsePlayer_.ORIGINAL_HEIGHT*a}}setSize(a,b){const {density:c,canvasWidth:d,canvasHeight:e}=this.getDensityByDimensions(a,b),{width:g,height:f}=this.calculateAspectRatioFit(GPTimelapsePlayer_.ORIGINAL_WIDTH,GPTimelapsePlayer_.ORIGINAL_HEIGHT,a,b);a=document.documentElement.style;a.setProperty("--timelapse-player-width",`${Math.round(g)}px`);a.setProperty("--timelapse-player-height",`${Math.round(f)}px`);this.density=
c;this.width=d;this.height=e;this.bgCanvas.width=d;this.bgCanvas.height=e;this.canvas.width=d;this.canvas.height=e;this.strokeCanvas.width=d;this.strokeCanvas.height=e;this.redraw()}redraw(){this.pause();if(this.background){this.clearBackground();var a=this.getCache();this.cache[this.density]?(a=a.at(-1),this.bgCtx.putImageData(a,0,0)):this.drawFunction(this.bgCtx,this.background,this.density,!1)}else this.bgCtx.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR,this.bgCtx.fillRect(0,0,this.bgCanvas.width,
this.bgCanvas.height);this.clearCanvas();a=this.data.slice(0,this.pos);this.draw(this.ctx,a);this.clearStroke();this.stroke&&(a=this.stroke.slice(0,GPTimelapsePlayer_.STROKE_OFFSET+this.sPos+1),this.draw(this.strokeCtx,[a],this.density,!1))}calculateAspectRatioFit(a,b,c,d){c=Math.min(c/a,d/b);return{width:a*c,height:b*c}}expand(a){this.isExpanded=a??!this.isExpanded;this.player.classList.toggle("expanded_",this.isExpanded);this.isExpanded?this.mainContainer.appendChild(this.player):this.container.appendChild(this.player);
this.resizeHandler()}playPause(){this.isPlaying?this.pause():this.play()}play(a=this.pos){a||this.clearCanvas();this.isPlaying=!0;this.updateProgress();this.player.classList.add("playing_");setTimeout(()=>{this.player.classList.remove("finished_")},24);this.timer=requestAnimationFrame(this.drawing)}pause(){this.isPlaying=!1;cancelAnimationFrame(this.timer);this.player.classList.remove("playing_")}stop(){this.pause();this.pos=0;this.updateProgress()}seek(a){this.pause();a=Math.max(0,Math.min(this.data.length,
a));if(a!==this.pos||!a){this.clearStroke();if(a<this.pos||!this.pos){this.clearCanvas();var b=this.data.slice(0,a)}else b=this.data.slice(this.pos,a);this.draw(this.ctx,b);this.pos=a;this.sPos=0;this.stroke=null;this.updateStrokeView()}}drawing(){if(this.stroke)this.drawingStroke(this.stroke);else if(this.pos<this.data.length){const a=this.data.slice(this.pos,this.pos+this.speed[1]),b=a.at(-1);this.speed[0]&&[1,2].includes(b[0])?(this.sPos=0,this.stroke=b,this.drawingStroke(b)):(this.draw(this.ctx,
a),this.pos=Math.min(this.data.length,this.pos+this.speed[1]),this.pos<this.data.length?this.timer=requestAnimationFrame(this.drawing):(this.player.classList.add("finished_"),this.pause()),this.updateProgress(),this.updateStrokeView())}else this.pos=0,this.updateProgress(),this.play()}drawingStroke(a){if(this.speed[0]&&this.sPos<a.length-GPTimelapsePlayer_.STROKE_OFFSET){const b=a.slice(0,GPTimelapsePlayer_.STROKE_OFFSET+this.sPos+1);this.sPos+=this.speed[0];this.clearStroke();this.draw(this.strokeCtx,
[b],this.density,!1);this.timer=requestAnimationFrame(()=>{this.drawingStroke(a)})}else this.sPos=0,this.pos=Math.min(this.data.length,this.pos+this.speed[1]),this.clearStroke(),this.draw(this.ctx,[a]),this.updateProgress(),this.updateStrokeView(),this.stroke=null,this.pos<this.data.length?this.timer=requestAnimationFrame(this.drawing):(this.player.classList.add("finished_"),this.pause())}changeSpeed(a,b){this.currentSpeed=Math.max(0,Math.min(GPTimelapsePlayer_.SPEEDS.length-1,b??this.currentSpeed+
a));this.speed=GPTimelapsePlayer_.SPEEDS[this.currentSpeed];window.localStorage.setItem("gp-timelapse-player-speed",JSON.stringify(this.currentSpeed));this.updateSpeedView()}speedViewPointerMoveHandler(a){a=(a.clientX-this.player.getBoundingClientRect().x)/this.scaleX;a=Math.round(Math.max(0,Math.min(GPTimelapsePlayer_.SPEED_SLIDER_WIDTH-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH,a-this.speedInput.currentX))/((GPTimelapsePlayer_.SPEED_SLIDER_WIDTH-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH)/(GPTimelapsePlayer_.SPEEDS.length-
1)));this.speedInput.value=a;this.changeSpeed(null,a)}renderSpeedInput(a,b){if(!this.speedInput){this.speedInput=document.createElement("input");this.speedInput.className="speed-slider_";this.speedInput.type="range";this.speedInput.min=0;this.speedInput.max=GPTimelapsePlayer_.SPEEDS.length-1;this.speedInput.style.width=`${GPTimelapsePlayer_.SPEED_SLIDER_WIDTH}px`;this.speedInput.style.height=`${GPTimelapsePlayer_.SPEED_SLIDER_HEIGHT}px`;var c=GPTimelapsePlayer_.SPEEDS.findIndex(([d])=>!d);this.speedInput.style.setProperty("--bg-separator",
`${Math.round(c/GPTimelapsePlayer_.SPEEDS.length*100)+Math.round(GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH/GPTimelapsePlayer_.SPEED_SLIDER_WIDTH*100)/2}%`)}this.speedInput.value=this.currentSpeed;c=(GPTimelapsePlayer_.SPEED_SLIDER_WIDTH-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH)/(GPTimelapsePlayer_.SPEEDS.length-1)*Number(this.speedInput.value);this.speedInput.style.top=`${b-GPTimelapsePlayer_.SPEED_SLIDER_HEIGHT-10}px`;this.speedInput.style.left=`${a-c-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH/
2}px`;this.player.appendChild(this.speedInput);this.speedInput.currentX=a-c}clearBackground(){this.bgCtx.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR;this.bgCtx.fillRect(0,0,this.width,this.height)}clearCanvas(){this.ctx.clearRect(0,0,this.width,this.height)}clearStroke(){this.strokeCtx.clearRect(0,0,this.width,this.height)}updateProgress(a=this.pos){this.progress.style.width=`${Math.round(a/this.data.length*100)}%`}splitStroke(a){const [b,c,d,...e]=a;if(1===b||2===b){a=[];for(let g=1;g<=e.length;g++)a.push([b,
c,d,...e.slice(0,g)]);return a}return[a]}getCoords(a,b){b=(b||a.target).getBoundingClientRect();const [c,d]=a.touches?[a.touches[0].clientX,a.touches[0].clientY]:[a.clientX,a.clientY],[e,g]=[c-b.left,d-b.top];return[Math.round(e),Math.round(g),b.width,b.height]}progressBarPointerMoveHandler(a){const [b,,c]=this.getCoords(a);a=Math.max(0,Math.min(1,b/c));const d=Math.round(this.data.length*a);this.progress.style.width=`${100*a}%`;this.seek(d)}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():
(this.expand(!1),this.player.requestFullscreen())}saveImage(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;var b=a.getContext("2d");this.draw(b,this.data,this.density,!0);b=document.createElement("canvas");b.width=this.width;b.height=this.height;var c=b.getContext("2d");c.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR;c.fillRect(0,0,this.width,this.height);if(this.background){var d=this.getCache();this.cache[this.density]?(d=d.at(-1),c.putImageData(d,0,0)):this.drawFunction(c,
this.background,this.density,!1)}c=document.createElement("canvas");c.width=this.width;c.height=this.height;d=c.getContext("2d");d.drawImage(b,0,0,this.width,this.height);d.drawImage(a,0,0,this.width,this.height);a=this.date.toLocaleDateString("ru-RU");a=`${this.author} - ${this.title} (${a}).png`;b=document.createElement("a");b.href=c.toDataURL();b.download=a;b.click()}async saveImageData(){var a=this.date.toLocaleDateString("ru-RU");a=`${this.author} - ${this.title} (${a}).gpimg`;var b={m:{a:this.author,
t:this.title,d:this.date.toISOString()},d:this.originalData};this.background&&(b.b=this.background);this.auth&&(b.a=this.auth);b=await GPUtils_.wCompressData(b);GPUtils_.saveBlob(b,a)}getCache(){this.cache?.[this.density]||this.updateCache();return this.cache[this.density]}updateCache(){const a=this.cache||{};a[this.density]||this.worker.postMessage({type:"get-cache",density:this.density});this.cache=a}draw(a,b,c,d,e=!0){if(b){var g=GPTimelapsePlayer_.CACHE_INTERVAL;if(GPTimelapsePlayer_.CACHE_ENABLE&&
e&&b.length>g)if(e=this.getCache(),!this.cache[this.density]&&b.at(-1).index+1<g)this.drawFunction(a,b,c,d);else{const f=Math.floor((b.at(-1).index+1)/g)-1;a.putImageData(e[f],0,0);b=b.slice(-(b.at(-1).index+1-(f+1)*g));this.drawFunction(a,b,c,d)}else this.drawFunction(a,b,c,d)}}drawFunction(a,b,c=this.density,d=!0,e=!1){a.lineCap=a.lineJoin="round";a.save();if(b){let n=[];for(var g=0;g<b.length;g++){var f=b[g],h=f[0];f=(f[1],f.slice(2));if(10!=h){var k=void 0;a.save();if(8!=h){for(k=1;k<f.length;k++)f[k]=
[f[k][0]*c,f[k][1]*c];if(2<f.length)switch(h){case 1:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;k=[f[1][0],f[1][1]];a.beginPath();a.moveTo(...k);for(var l=2;l<f.length;l++)k=[f[l][0],f[l][1]],h=[f[l-1][0],f[l-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(k[0]-h[0])/2,h[1]+(k[1]-h[1])/2);a.lineTo(k[0],k[1]);a.stroke();break;case 2:a.strokeStyle="#FFFFFF";a.lineWidth=f[0]*c;k=[f[1][0],f[1][1]];d&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo(...k);
for(l=2;l<f.length;l++)k=[f[l][0],f[l][1]],h=[f[l-1][0],f[l-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(k[0]-h[0])/2,h[1]+(k[1]-h[1])/2);a.lineTo(k[0],k[1]);a.stroke();d&&(a.globalCompositeOperation="source-over");break;case 3:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.moveTo(f[1][0],f[1][1]);a.lineTo(f[2][0],f[2][1]);a.stroke();break;case 4:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.rect(f[1][0],f[1][1],
f[2][0]-f[1][0],f[2][1]-f[1][1]);a.stroke();break;case 6:h=f[0];a.fillStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;a.beginPath();a.rect(f[1][0],f[1][1],f[2][0]-f[1][0],f[2][1]-f[1][1]);a.fill();break;case 5:h=f[0];a.strokeStyle=h[0];a.lineWidth=h[1];a.globalAlpha=h[2];a.lineWidth*=c;h=(f[2][0]-f[1][0])/2;k=(f[2][1]-f[1][1])/2;l=Math.round(f[1][0]+h);f=Math.round(f[1][1]+k);var m=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(l,f-k);a.bezierCurveTo(l+m*h,f-k,l+h,f-m*k,l+h,f);a.bezierCurveTo(l+
h,f+m*k,l+m*h,f+k,l,f+k);a.bezierCurveTo(l-m*h,f+k,l-h,f+m*k,l-h,f);a.bezierCurveTo(l-h,f-m*k,l-m*h,f-k,l,f-k);a.stroke();break;case 7:h=f[0],a.fillStyle=h[0],a.lineWidth=h[1],a.globalAlpha=h[2],a.lineWidth*=c,h=(f[2][0]-f[1][0])/2,k=(f[2][1]-f[1][1])/2,l=Math.round(f[1][0]+h),f=Math.round(f[1][1]+k),m=(Math.sqrt(2)-1)/3*4,a.beginPath(),a.moveTo(l,f-k),a.bezierCurveTo(l+m*h,f-k,l+h,f-m*k,l+h,f),a.bezierCurveTo(l+h,f+m*k,l+m*h,f+k,l,f+k),a.bezierCurveTo(l-m*h,f+k,l-h,f+m*k,l-h,f),a.bezierCurveTo(l-
h,f-m*k,l-m*h,f-k,l,f-k),a.fill()}else if(![6,7].includes(h)){switch(h){case 2:a.fillStyle="#FFFFFF";a.lineWidth=f[0]*c;k=f[1];d&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*c;a.globalAlpha=1;k=f[1];break;default:k=f[0],a.fillStyle=k[0],a.lineWidth=k[1],a.globalAlpha=k[2],a.lineWidth*=c,k=f[1]}a.beginPath();a.arc(k[0],k[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==h&&d&&(a.globalCompositeOperation="source-over")}}else{h=f[0];a.fillStyle=h[0];a.globalAlpha=
h[1];a.beginPath();for(h=1;h<f.length;h+=4)a.rect(f[h]*c,f[h+1]*c,f[h+2]*c,f[h+3]*c);a.fill()}a.restore()}else e&&n.push(f)}for(b=0;b<n.length;b++){d=n[b];for(e=1;e<d.length;e++)d[e]=[d[e][0]*c,d[e][1]*c];a.strokeStyle="#CC0053";a.lineWidth=2*c;a.globalAlpha=1;e=[d[1][0],d[1][1]];a.beginPath();a.moveTo(...e);for(g=2;g<d.length;g++)e=[d[g][0],d[g][1]],h=[d[g-1][0],d[g-1][1]],a.quadraticCurveTo(h[0],h[1],h[0]+(e[0]-h[0])/2,h[1]+(e[1]-h[1])/2);a.lineTo(e[0],e[1]);a.stroke()}}a.restore()}initCacheWorker(){let {width:a,
height:b}=getComputedStyle(this.container);a=parseInt(a);b=parseInt(b);var {density:c}=this.getDensityByDimensions(a,b);let {width:d,height:e}=getComputedStyle(this.mainContainer);d=parseInt(d);e=parseInt(e);const {density:g}=this.getDensityByDimensions(d,e),{density:f}=this.getDensityByDimensions(window.screen.width,window.screen.height),h=[...(new Set([c,g,f]))];this.worker||(c=URL.createObjectURL(new Blob([this.getFuncBody(this.cacheWorkerBody)])),this.worker=new Worker(c),URL.revokeObjectURL(c),
this.worker.addEventListener("message",({data:k})=>{"worker-ready"===k.type?h.forEach(l=>{this.worker.postMessage({type:"get-cache",density:l})}):"cache-updated"===k.type&&(this.cache=k.cache,this.dispatchEvent(new CustomEvent("cache-updated",{detail:{density:k.density}})))}));this.worker.postMessage({type:"init",data:this.data,background:this.background,draw:this.getFuncBody(this.drawFunction),CACHE_INTERVAL:GPTimelapsePlayer_.CACHE_INTERVAL,ORIGINAL_WIDTH:GPTimelapsePlayer_.ORIGINAL_WIDTH,ORIGINAL_HEIGHT:GPTimelapsePlayer_.ORIGINAL_HEIGHT,
BACKGROUND_COLOR:GPTimelapsePlayer_.BACKGROUND_COLOR})}cacheWorkerBody(){function a(g){var f=b*g,h=c*g;if(!this.cache[g]){this.cache[g]=[];const l=e,m=Math.floor(self.data.length/l);f=new OffscreenCanvas(f,h);h=f.getContext("2d",{willReadFrequently:!0});let n;self.background&&(h.fillStyle=d,h.fillRect(0,0,f.width,f.height),self.draw(h,this.background,g,!1),n=h.getImageData(0,0,f.width,f.height),h.clearRect(0,0,f.width,f.height));for(let p=0;p<m;p++){var k=p*l;k=self.data.slice(k,k+l);self.draw(h,
k,g);k=h.getImageData(0,0,f.width,f.height);this.cache[g].push(k)}self.background&&this.cache[g].push(n)}}let b,c,d,e;self.data;self.draw;self.cache=[];self.addEventListener("message",({data:g})=>{"init"===g.type?(self.data=g.data,self.background=g.background,self.draw=new Function("a","l","f","g","h",'var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var l=0;return function(){return l<a.length?{done:!1,value:a[l++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var l="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return l?l.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var l,f=[];!(l=a.next()).done;)f.push(l.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};f=void 0===f?this.density:f;g=void 0===g?!0:g;h=void 0===h?!1:h;a.lineCap=a.lineJoin="round";a.save();if(l){for(var n=[],m=0;m<l.length;m++){var b=l[m],c=b[0];b=(b[1],b.slice(2));if(10!=c){var d;a.save();if(8!=c){for(d=1;d<b.length;d++)b[d]=[b[d][0]*f,b[d][1]*f];if(2<b.length)switch(c){case 1:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;d=[b[1][0],b[1][1]];a.beginPath();a.moveTo.apply(a,$jscomp.arrayFromIterable(d));for(var e=2;e<b.length;e++)d=[b[e][0],b[e][1]],c=[b[e-1][0],b[e-1][1]],a.quadraticCurveTo(c[0],c[1],c[0]+(d[0]-c[0])/2,c[1]+(d[1]-c[1])/2);a.lineTo(d[0],d[1]);a.stroke();break;case 2:a.strokeStyle="#FFFFFF";a.lineWidth=b[0]*f;d=[b[1][0],b[1][1]];g&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo.apply(a,$jscomp.arrayFromIterable(d));for(e=2;e<b.length;e++)d=[b[e][0],b[e][1]],c=[b[e-1][0],b[e-1][1]],a.quadraticCurveTo(c[0],c[1],c[0]+(d[0]-c[0])/2,c[1]+(d[1]-c[1])/2);a.lineTo(d[0],d[1]);a.stroke();g&&(a.globalCompositeOperation="source-over");break;case 3:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;a.beginPath();a.moveTo(b[1][0],b[1][1]);a.lineTo(b[2][0],b[2][1]);a.stroke();break;case 4:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.stroke();break;case 6:c=b[0];a.fillStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.fill();break;case 5:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;c=(b[2][0]-b[1][0])/2;d=(b[2][1]-b[1][1])/2;e=Math.round(b[1][0]+c);b=Math.round(b[1][1]+d);var k=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(e,b-d);a.bezierCurveTo(e+k*c,b-d,e+c,b-k*d,e+c,b);a.bezierCurveTo(e+c,b+k*d,e+k*c,b+d,e,b+d);a.bezierCurveTo(e-k*c,b+d,e-c,b+k*d,e-c,b);a.bezierCurveTo(e-c,b-k*d,e-k*c,b-d,e,b-d);a.stroke();break;case 7:c=b[0],a.fillStyle=c[0],a.lineWidth=c[1],a.globalAlpha=c[2],a.lineWidth*=f,c=(b[2][0]-b[1][0])/2,d=(b[2][1]-b[1][1])/2,e=Math.round(b[1][0]+c),b=Math.round(b[1][1]+d),k=(Math.sqrt(2)-1)/3*4,a.beginPath(),a.moveTo(e,b-d),a.bezierCurveTo(e+k*c,b-d,e+c,b-k*d,e+c,b),a.bezierCurveTo(e+c,b+k*d,e+k*c,b+d,e,b+d),a.bezierCurveTo(e-k*c,b+d,e-c,b+k*d,e-c,b),a.bezierCurveTo(e-c,b-k*d,e-k*c,b-d,e,b-d),a.fill()}else if(![6,7].includes(c)){switch(c){case 2:a.fillStyle="#FFFFFF";a.lineWidth=b[0]*f;d=b[1];g&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*f;a.globalAlpha=1;d=b[1];break;default:d=b[0],a.fillStyle=d[0],a.lineWidth=d[1],a.globalAlpha=d[2],a.lineWidth*=f,d=b[1]}a.beginPath();a.arc(d[0],d[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==c&&g&&(a.globalCompositeOperation="source-over")}}else{c=b[0];a.fillStyle=c[0];a.globalAlpha=c[1];a.beginPath();for(c=1;c<b.length;c+=4)a.rect(b[c]*f,b[c+1]*f,b[c+2]*f,b[c+3]*f);a.fill()}a.restore()}else h&&n.push(b)}for(l=0;l<n.length;l++){g=n[l];for(h=1;h<g.length;h++)g[h]=[g[h][0]*f,g[h][1]*f];a.strokeStyle="#CC0053";a.lineWidth=2*f;a.globalAlpha=1;h=[g[1][0],g[1][1]];a.beginPath();a.moveTo.apply(a,$jscomp.arrayFromIterable(h));for(m=2;m<g.length;m++)h=[g[m][0],g[m][1]],c=[g[m-1][0],g[m-1][1]],a.quadraticCurveTo(c[0],c[1],c[0]+(h[0]-c[0])/2,c[1]+(h[1]-c[1])/2);a.lineTo(h[0],h[1]);a.stroke()}}a.restore();'),
e=g.CACHE_INTERVAL,b=g.ORIGINAL_WIDTH,c=g.ORIGINAL_HEIGHT,d=g.BACKGROUND_COLOR,self.postMessage({type:"worker-ready"})):"get-cache"===g.type&&(self.cache[g.density]||a(g.density),self.postMessage({type:"cache-updated",cache:self.cache,density:g.density}))})}getFuncBody(a){a=a.toString();return a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))}}window.GPTimelapsePlayer_=GPTimelapsePlayer_;class GPTimer_ extends EventTarget{static STARTED="started";static PAUSED="paused";static STOPPED="stopped";static SETTING="setting";static SOUND_ALERT_URL="https://garticphone.com/sounds/timeout.mp3";static SETTING_MINUTE_STEP=5;static DEFAULT_SETTINGS={reverted:!0,delimiterFlicker:!0,soundAlert:!0,soundAlertVolume:1,runAfterTurnStart:!1,readyAfterTimeExpires:!1,defaultTimer:"1800000",timers:[]};static SETTINGS_UI={reverted:{type:"checkbox",description:"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043e\u0442\u0441\u0447\u0451\u0442\u0430 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u043c \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0438"},
delimiterFlicker:{type:"checkbox",description:"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043c\u0435\u0440\u0446\u0430\u043d\u0438\u0435 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f \u0447\u0430\u0441\u043e\u0432 \u0438 \u043c\u0438\u043d\u0443\u0442"},_2:{text:"Sound Alert"},soundAlert:{type:"checkbox",description:"\u0417\u0432\u0443\u043a\u043e\u0432\u043e\u0435 \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0435, \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0449\u0435\u0435 \u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438"},
soundAlertVolume:{type:"range",args:[0,1,.01],formatter:this.volumeFormatter,description:"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0433\u0440\u043e\u043c\u043a\u043e\u0441\u0442\u0438 \u0437\u0432\u0443\u043a\u043e\u0432\u043e\u0433\u043e \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u044f"},_3:{text:"Triggers"},runAfterTurnStart:{type:"checkbox",description:"\u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u0442\u0430\u0439\u043c\u0435\u0440 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u043e\u0441\u043b\u0435 \u043d\u0430\u0447\u0430\u043b\u0430 \u0440\u0430\u0443\u043d\u0434\u0430"},
readyAfterTimeExpires:{type:"checkbox",description:"\u041d\u0430\u0436\u0438\u043c\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u0438 \u043f\u043e\u0441\u043b\u0435 \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044f \u0432\u0440\u0435\u043c\u0435\u043d\u0438"},_4:{text:"Timers"},defaultTimer:{type:"list",args:GPTimer_.DEFAULT_SETTINGS.timers,proxyProp:"timers",formatter:this.timeFormatter,description:"\u0422\u0430\u0439\u043c\u0435\u0440 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0432\u0445\u043e\u0434\u0435 \u043d\u0430 \u0441\u0430\u0439\u0442)"},
timers:{type:"list-md",formatter:this.timeFormatter,description:"\u0421\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0445 \u0442\u0430\u0439\u043c\u0435\u0440\u043e\u0432"}};static timeFormatter(a){return`${Math.floor(a/36E5)}:${String(Math.floor(a/6E4)%60).padStart(2,"0")}`}static volumeFormatter(a){return`${Math.round(100*a)}`}static MODULE={title:"Timer",settings:{storage:"gp_timer",defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){a.timer=
new GPTimer_(a.sm)}constructor(a){if(GPTimer_.instance)return GPTimer_.instance;super();GPTimer_.instance=this;this.s=a.setSettings(this,this.updateSettings);this.timer;this.value=+this.s.defaultTimer;this.timeStarted;this.timePaused;this.elapsed=0;this.state=GPTimer_.STOPPED;this.onPointerDown=this.onPointerDown.bind(this);this.onWheel=this.onWheel.bind(this);this.onAddBtnClick=this.onAddBtnClick.bind(this);this.render()}static getInstance(){return this.instance}getElement(){return this.container}render(){this.container=
document.createElement("div");this.container.className="gp-timer_";this.container.addEventListener("pointerdown",this.onPointerDown);this.container.addEventListener("wheel",this.onWheel);this.container.addEventListener("contextmenu",b=>{b.preventDefault()});this.hours=document.createElement("div");this.hours.className="hours_";this.minutes=document.createElement("div");this.minutes.className="minutes_";this.seconds=document.createElement("div");this.seconds.className="seconds_";this.delimiter=document.createElement("div");
this.delimiter.className="delimiter_";this.delimiter.classList.toggle("flicker_",this.s.delimiterFlicker);this.delimiter.textContent=":";this.addBtn=document.createElement("div");this.addBtn.className="add-btn_";this.addBtn.textContent="+";this.addBtn.addEventListener("click",this.onAddBtnClick);this.container.appendChild(this.hours);this.container.appendChild(this.delimiter);this.container.appendChild(this.minutes);this.container.appendChild(this.seconds);this.container.appendChild(this.addBtn);
const a=this.formatTime(this.value);this.renderTime(a);this.alert=new Audio(GPTimer_.SOUND_ALERT_URL);this.alert.src=GPTimer_.SOUND_ALERT_URL}onPointerDown(a){0===a.button?this.playPause():2===a.button?this.revertTime():1===a.button&&(this.state===GPTimer_.STARTED?this.reset():this.toggleSetting())}onWheel(a){var b=0>a.deltaY;if(this.state===GPTimer_.SETTING){var c=Number.parseInt(this.hours.textContent);let d=Number.parseInt(this.minutes.textContent);switch(a.target){case this.hours:c+=b?1:-1;c=
(0>c?c+24:c)%24;break;case this.minutes:d+=(b?1:-1)*GPTimer_.SETTING_MINUTE_STEP,d=(0>d?d+60:d)%60}this.value=36E5*Math.max(Math.min(c,24),0)+6E4*Math.max(Math.min(d,55),0);b=this.formatTime(this.value);this.renderTime(b)}else this.state!==GPTimer_.STARTED&&(a=this.s.timers.length,c=this.s.timers.findIndex(d=>+d===this.value),~c?(b=c+(b?-1:1),this.value=+this.s.timers[(0>b?b+a:b)%a]):a&&(this.value=+this.s.timers[0]),this.reset())}onAddBtnClick(a){this.value&&!this.s.timers.includes(String(this.value))&&
(this.s.timers=[...this.s.timers,String(this.value)].sort((b,c)=>c-b))}toggleSetting(){this.state!==GPTimer_.SETTING?(this.reset(),this.updateState(GPTimer_.SETTING)):this.updateState(GPTimer_.STOPPED)}revertTime(a){this.state===GPTimer_.STARTED&&(void 0===a&&(this.s.reverted=a=!this.s.reverted),this.container.classList.remove("last-minute_"),a=this.formatTime(a?Math.max(this.value-this.elapsed,0):Math.min(this.elapsed,this.value)),this.renderTime(a))}renderTime({h:a,m:b,s:c}){this.hours.textContent=
a;this.minutes.textContent=String(b).padStart(2,"0");!this.s.reverted||a||b||(this.container.classList.add("last-minute_"),this.seconds.textContent=String(c).padStart(2,"0"))}tick(){this.elapsed=Date.now()-this.timeStarted;const a=this.formatTime(this.s.reverted?Math.max(this.value-this.elapsed,0):Math.min(this.elapsed,this.value));this.renderTime(a);this.elapsed>=this.value&&(this.stop(),this.s.soundAlert&&!this.s.readyAfterTimeExpires&&this.runAlert(),this.dispatchEvent(new Event("finish")),this.container.classList.add("finished_"))}playPause(){switch(this.state){case GPTimer_.STOPPED:case GPTimer_.PAUSED:this.start();
break;case GPTimer_.STARTED:this.pause()}}start(){clearInterval(this.timer);this.container.classList.remove("finished_");this.state===GPTimer_.STOPPED?this.timeStarted=Date.now():this.state===GPTimer_.PAUSED&&(this.timeStarted=Date.now()-(this.timePaused-this.timeStarted));this.timer=setInterval(this.tick.bind(this),1E3);this.updateState(GPTimer_.STARTED);this.tick()}pause(){this.timePaused=Date.now();clearInterval(this.timer);this.updateState(GPTimer_.PAUSED)}stop(){this.container.classList.remove("last-minute_");
clearInterval(this.timer);this.updateState(GPTimer_.STOPPED)}reset(){this.stop();this.elapsed=0;const a=this.formatTime(this.value,!0);this.renderTime(a);this.container.classList.remove("finished_")}formatTime(a){return{h:Math.floor(a/36E5),m:Math.floor(a/6E4)%60,s:Math.round(a/1E3)%61}}runAlert(a=0){this.alert.currentTime=a;this.alert.play()}updateState(a){this.state=a;this.container.dataset.state=a}updateSettings({detail:{settings:a}}){"reverted"in a&&this.revertTime(settings.reverted);"delimiterFlicker"in
a&&this.delimiter.classList.toggle("flicker_",a.delimiterFlicker);"soundAlertVolume"in a&&(this.alert.volume=Number.parseFloat(a.soundAlertVolume),1===Object.keys(a).length&&this.runAlert(.3));"defaultTimer"in a&&this.state===GPTimer_.STOPPED&&(this.value=+a.defaultTimer)}}window.GPTimer_=GPTimer_;class GPKnownUsersDB_ extends EventTarget{static READ="readonly";static WRITE="readwrite";static DB_NAME="gp_users_db";static STORE_NAME="users";static USERS_LIMIT=1E4;constructor(){super();this.db=null;this.init()}init(){return new Promise((a,b)=>{const c=window.indexedDB.open(GPKnownUsersDB_.DB_NAME,1);c.addEventListener("error",d=>{console.error("Users Database Request Error:",d.target.errorCode);b(d.target.errorCode)});c.addEventListener("success",d=>{d=d.target.result;d.addEventListener("error",
e=>{console.error("Users Database Error:",e.target.errorCode)});this.db=d;this.dispatchEvent(new CustomEvent("init",{detail:d}));a(d)});c.addEventListener("upgradeneeded",d=>{d=d.target.result.createObjectStore(GPKnownUsersDB_.STORE_NAME,{keyPath:"username"});d.createIndex("username","username",{unique:!0});d.createIndex("last_seen","last_seen")})})}async hasUsers(a){const b=new Set;if(!this.db)return b;const c=await this.getStore(GPKnownUsersDB_.READ);(await Promise.all(a.map(d=>this.getUser(d,c)))).forEach(d=>
{null!==d&&b.add(d)});return b}async hasUser(a,b){return null!==await this.getUser(a,b)?!0:!1}getUser(a,b){return this.db?new Promise(async c=>{b||=await this.getStore(GPKnownUsersDB_.READ);const d=b.getKey(a);d.addEventListener("success",e=>{c(e.target.result??null)});d.addEventListener("error",()=>{c(null)})}):Promise.resolve(null)}async addUsers(a){if(a?.length)for(let b of a)await this.addUser(b)}addUser(a,b){return this.db?new Promise(async c=>{var d={username:a,last_seen:Date.now()};b||=await this.getStore(GPKnownUsersDB_.WRITE);
d=b.put(d);d.addEventListener("success",async e=>{await this.size()>GPKnownUsersDB_.USERS_LIMIT&&await this.clean();c(!0)});d.addEventListener("error",e=>{c(!1)})}):Promise.resolve(!1)}async deleteUser(a){this.db&&(await this.getStore(GPKnownUsersDB_.WRITE)).delete(a)}async clean(){if(this.db){var a=await this.size()-GPKnownUsersDB_.USERS_LIMIT;if(!(0>=a)){var b=await this.getStore(GPKnownUsersDB_.WRITE);b.index("last_seen").openKeyCursor(null,"next").addEventListener("success",c=>{(c=c.target.result)&&
a&&(b.delete(c.primaryKey),a--,c.continue())})}}}size(){return new Promise(async a=>{(await this.getStore(GPKnownUsersDB_.READ)).count().addEventListener("success",b=>{a(b.target.result)})})}async getStore(a){try{return this.db.transaction([GPKnownUsersDB_.STORE_NAME],a).objectStore(GPKnownUsersDB_.STORE_NAME)}catch(b){return await this.init(),this.getStore(a)}}}window.GPKnownUsersDB_=GPKnownUsersDB_;class GPPreview_ extends EventTarget{static CANVAS_WIDTH=758;static CANVAS_HEIGHT=424;static CANVAS_DENSITY=.5;static MAX_PANEL_WIDTH=window.screen.width/3;static MIN_PANEL_WIDTH=180;static PANEL_WIDTH_STEP=10;static MIN_PANEL_BORDER_WIDTH=2;static ORIENTATIONS={t:"top",b:"bottom",l:"left",r:"right"};static ORIENTATION={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};static WINDOW_URL="https://gpmod.github.io/preview";constructor(a,b,{x:c,y:d,o:e},g){super();this.gpproxy=a;this.enabled=!!b;this.panelOffsetX=
c;this.panelOffsetY=d;this.panelOrientation=e;this.panelWidth=g;this.panelBorderWidth=GPPreview_.MIN_PANEL_BORDER_WIDTH;this.window=null;this.cache=new Map;this.worker=null;this.addEventListener("rendered",()=>{this.panel.classList.add("rendered_")});this.gpproxy.addEventListener("data",({detail:{event:f}})=>{f===GPProxy_.EVENT.GAME_STARTED&&this.cache.clear()});window.addEventListener("message",f=>{"gp-preview-win-closed"===f.data?.type&&(this.window=null,this.panel.classList.replace("win-mode_",
"frame-mode_"))});window.addEventListener("resize",()=>{this.updatePanelPosition()});this.render();this.toggle(b)}render(){this.showPanelBtn=document.createElement("div");this.showPanelBtn.className="gp-preview-btn_ gp-module-btn_";this.showPanelBtn.title="\u041f\u0440\u0435\u0432\u044c\u044e \u0437\u0430\u0446\u0435\u043d\u0437\u0443\u0440\u0435\u043d\u043d\u044b\u0445 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432";this.showPanelBtn.addEventListener("click",()=>{this.toggle()});this.showPanelBtn.addEventListener("pointerenter",
()=>{this.panel.classList.add("hover_")});this.showPanelBtn.addEventListener("pointerleave",()=>{this.panel.classList.remove("hover_")});document.body.appendChild(this.showPanelBtn);this.panel=document.createElement("div");this.panel.className="gp-preview_";this.panel.style.setProperty("--gp-preview-width",`${this.panelWidth}px`);this.panel.addEventListener("contextmenu",b=>{b.preventDefault()});this.panel.addEventListener("wheel",b=>{b.preventDefault();this.panelWidth=0<b.deltaY?Math.max(this.panelWidth-
GPPreview_.PANEL_WIDTH_STEP,GPPreview_.MIN_PANEL_WIDTH):Math.min(this.panelWidth+GPPreview_.PANEL_WIDTH_STEP,GPPreview_.MAX_PANEL_WIDTH);this.updatePanelSize();this.updatePanelPosition();this.dispatchEvent(new CustomEvent("panel-width-changed",{detail:{width:this.panelWidth}}))});this.panel.addEventListener("pointerdown",b=>{if(0===b.button){var [c,d,e,g]=this.getCoords(b),f=(h=>{this.setPanelPosition(h.pageX-c,h.pageY-d,e,g)}).bind(this);this.panel.setPointerCapture(b.pointerId);this.panel.addEventListener("pointermove",
f);this.panel.addEventListener("pointerup",()=>{this.dispatchEvent(new CustomEvent("panel-pos-changed",{detail:{x:this.panelOffsetX,y:this.panelOffsetY,o:this.panelOrientation}}));this.panel.removeEventListener("pointermove",f)},{once:!0});f(b)}});this.panel.addEventListener("pointerdown",b=>{if(1===b.button||2===b.button)this.panel.setPointerCapture(b.pointerId),this.panel.addEventListener("pointerup",c=>{if(1===c.button||2===c.button)this.window?this.closeWindow():this.openWindow()},{once:!0})});
const a=document.createElement("div");a.className="warning_";this.panel.appendChild(a);this.canvas=this.createCanvas();this.panel.appendChild(this.canvas);document.body.appendChild(this.panel);this.updatePanelPosition();this.updatePanelSize()}createCanvas(){const a=document.createElement("canvas");a.className="canvas_";a.width=GPPreview_.CANVAS_WIDTH*GPPreview_.CANVAS_DENSITY;a.height=GPPreview_.CANVAS_HEIGHT*GPPreview_.CANVAS_DENSITY;return a}replaceCanvas(){const a=this.createCanvas();this.canvas.replaceWith(a);
this.canvas=a}toggle(a){this.enabled=void 0!==a?!!a:!this.enabled;this.panel.classList.toggle("shown_",this.enabled);this.enabled?(this.panel.classList.add("frame-mode_"),this.initWorker()):(this.window&&this.closeWindow(),this.terminateWorker(),this.replaceCanvas());this.dispatchEvent(new CustomEvent("status",{detail:{status:this.enabled}}));this.showPanelBtn.classList.toggle("pressed_",this.enabled)}openWindow(){this.window&&this.window.close();this.window=window.open(GPPreview_.WINDOW_URL);this.panel.classList.replace("frame-mode_",
"win-mode_")}closeWindow(){this.window.close();this.window=null;this.panel.classList.replace("win-mode_","frame-mode_")}updatePanelSize(){this.panel.style.setProperty("--gp-preview-width",`${this.panelWidth}px`);this.panelBorderWidth=Math.max(Math.round(this.panelWidth/142),GPPreview_.MIN_PANEL_BORDER_WIDTH);this.panel.style.setProperty("--gp-preview-border-width",`${this.panelBorderWidth}px`)}updatePanelPosition(){const a=Math.max(Math.min(this.panelOffsetX,document.documentElement.clientWidth-this.panelWidth-
this.panelBorderWidth),this.panelBorderWidth),b=Math.max(Math.min(this.panelOffsetY,document.documentElement.clientHeight-this.panelWidth/(GPPreview_.CANVAS_WIDTH/GPPreview_.CANVAS_HEIGHT)-this.panelBorderWidth),this.panelBorderWidth);this.panel.style.inset="unset";this.panelOrientation.split("").map(c=>GPPreview_.ORIENTATIONS[c]).forEach(c=>{switch(c){case GPPreview_.ORIENTATION.TOP:case GPPreview_.ORIENTATION.BOTTOM:this.panel.style[c]=`${b}px`;break;case GPPreview_.ORIENTATION.LEFT:case GPPreview_.ORIENTATION.RIGHT:this.panel.style[c]=
`${a}px`}})}setPanelPosition(a,b,c,d){if(!c||!d){const [k,l]=this.panel.getBoundingClientRect();c=k;d=l}const e=document.documentElement.clientWidth,g=document.documentElement.clientHeight,f=Math.max(Math.min(a,e-c-this.panelBorderWidth),this.panelBorderWidth),h=Math.max(Math.min(b,g-d-this.panelBorderWidth),this.panelBorderWidth);this.panel.style.inset="unset";this.panel.dataset.orien="";b+d/2>g/2?(this.panelOffsetY=Math.round(g-(h+d)),this.panel.style.bottom=`${this.panelOffsetY}px`,this.panel.dataset.orien+=
"b"):(this.panelOffsetY=Math.round(h),this.panel.style.top=`${this.panelOffsetY}px`,this.panel.dataset.orien+="t");a+c/2>e/2?(this.panelOffsetX=Math.round(e-(f+c)),this.panel.style.right=`${this.panelOffsetX}px`,this.panel.dataset.orien+="r"):(this.panelOffsetX=Math.round(f),this.panel.style.left=`${this.panelOffsetX}px`,this.panel.dataset.orien+="l");this.panelOrientation=this.panel.dataset.orien}getCoords(a){const [b,c]=a.touches?[a.touches[0].clientX,a.touches[0].clientY]:[a.clientX,a.clientY];
a=a.currentTarget.getBoundingClientRect();return[Math.round(b-a.left),Math.round(c-a.top),a.width,a.height]}initWorker(){const a=this.canvas.transferControlToOffscreen();this.worker=GPUtils_.createWorker(this.workerBody);this.worker.postMessage({type:"init",data:{canvas:a,density:GPPreview_.CANVAS_DENSITY}},[a]);this.worker.addEventListener("message",({data:{type:b,...c}})=>{switch(b){case "cache":const {imageData:d,cacheId:e}=c;this.cache.set(e,d);break;case "rendered":this.dispatchEvent(new Event("rendered"))}})}terminateWorker(){this.worker&&
this.worker.terminate()}workerBody(){self.addEventListener("message",({data:{type:a,data:b}})=>{switch(a){case "draw":const {strokes:c,cacheId:d}=b;self.clear();self.draw(self.ctx,c,self.density,!0,!1);a=self.ctx.getImageData(0,0,self.canvas.width,self.canvas.height);self.postMessage({type:"cache",imageData:a,cacheId:d});self.postMessage({type:"rendered"});break;case "clear":self.clear();break;case "cache":self.clear();self.ctx.putImageData(b,0,0);self.postMessage({type:"rendered"});break;case "init":const {canvas:e,
density:g}=b;self.density=g;self.canvas=e;self.ctx=self.canvas.getContext("2d");self.ctx.imageSmoothingQuality="high"}});self.clear=function(){self.ctx.clearRect(0,0,self.canvas.width,self.canvas.height)};self.draw=new Function("a","m","f","h","k",'a.lineCap=a.lineJoin="round";a.save();if(m){let n=[];for(var l=0;l<m.length;l++){var b=m[l],c=b[0];b=(b[1],b.slice(2));if(10!=c){var d=void 0;a.save();if(8!=c){for(d=1;d<b.length;d++)b[d]=[b[d][0]*f,b[d][1]*f];if(2<b.length)switch(c){case 1:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;d=[b[1][0],b[1][1]];a.beginPath();a.moveTo(...d);for(var e=2;e<b.length;e++)d=[b[e][0],b[e][1]],c=[b[e-1][0],b[e-1][1]],a.quadraticCurveTo(c[0],c[1],c[0]+(d[0]-c[0])/2,c[1]+(d[1]-c[1])/2);a.lineTo(d[0],d[1]);a.stroke();break;case 2:a.strokeStyle="#FFFFFF";a.lineWidth=b[0]*f;d=[b[1][0],b[1][1]];h&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo(...d);for(e=2;e<b.length;e++)d=[b[e][0],b[e][1]],c=[b[e-1][0],b[e-1][1]],a.quadraticCurveTo(c[0],c[1],c[0]+(d[0]-c[0])/2,c[1]+(d[1]-c[1])/2);a.lineTo(d[0],d[1]);a.stroke();h&&(a.globalCompositeOperation="source-over");break;case 3:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;a.beginPath();a.moveTo(b[1][0],b[1][1]);a.lineTo(b[2][0],b[2][1]);a.stroke();break;case 4:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.stroke();break;case 6:c=b[0];a.fillStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.fill();break;case 5:c=b[0];a.strokeStyle=c[0];a.lineWidth=c[1];a.globalAlpha=c[2];a.lineWidth*=f;c=(b[2][0]-b[1][0])/2;d=(b[2][1]-b[1][1])/2;e=Math.round(b[1][0]+c);b=Math.round(b[1][1]+d);var g=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(e,b-d);a.bezierCurveTo(e+g*c,b-d,e+c,b-g*d,e+c,b);a.bezierCurveTo(e+c,b+g*d,e+g*c,b+d,e,b+d);a.bezierCurveTo(e-g*c,b+d,e-c,b+g*d,e-c,b);a.bezierCurveTo(e-c,b-g*d,e-g*c,b-d,e,b-d);a.stroke();break;case 7:c=b[0],a.fillStyle=c[0],a.lineWidth=c[1],a.globalAlpha=c[2],a.lineWidth*=f,c=(b[2][0]-b[1][0])/2,d=(b[2][1]-b[1][1])/2,e=Math.round(b[1][0]+c),b=Math.round(b[1][1]+d),g=(Math.sqrt(2)-1)/3*4,a.beginPath(),a.moveTo(e,b-d),a.bezierCurveTo(e+g*c,b-d,e+c,b-g*d,e+c,b),a.bezierCurveTo(e+c,b+g*d,e+g*c,b+d,e,b+d),a.bezierCurveTo(e-g*c,b+d,e-c,b+g*d,e-c,b),a.bezierCurveTo(e-c,b-g*d,e-g*c,b-d,e,b-d),a.fill()}else if(![6,7].includes(c)){switch(c){case 2:a.fillStyle="#FFFFFF";a.lineWidth=b[0]*f;d=b[1];h&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*f;a.globalAlpha=1;d=b[1];break;default:d=b[0],a.fillStyle=d[0],a.lineWidth=d[1],a.globalAlpha=d[2],a.lineWidth*=f,d=b[1]}a.beginPath();a.arc(d[0],d[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==c&&h&&(a.globalCompositeOperation="source-over")}}else{c=b[0];a.fillStyle=c[0];a.globalAlpha=c[1];a.beginPath();for(c=1;c<b.length;c+=4)a.rect(b[c]*f,b[c+1]*f,b[c+2]*f,b[c+3]*f);a.fill()}a.restore()}else k&&n.push(b)}for(m=0;m<n.length;m++){h=n[m];for(k=1;k<h.length;k++)h[k]=[h[k][0]*f,h[k][1]*f];a.strokeStyle="#CC0053";a.lineWidth=2*f;a.globalAlpha=1;k=[h[1][0],h[1][1]];a.beginPath();a.moveTo(...k);for(l=2;l<h.length;l++)k=[h[l][0],h[l][1]],c=[h[l-1][0],h[l-1][1]],a.quadraticCurveTo(c[0],c[1],c[0]+(k[0]-c[0])/2,c[1]+(k[1]-c[1])/2);a.lineTo(k[0],k[1]);a.stroke()}}a.restore()')}load(a,
b){if(a)if(this.panel.classList.add("loading_"),this.panel.classList.remove("rendered_"),this.window)this.window.postMessage({type:"data",data:a},GPPreview_.WINDOW_URL);else{this.worker.postMessage({type:"clear"});const c=this.cache.get(b);c?this.worker.postMessage({type:"cache",data:c}):this.worker.postMessage({type:"draw",data:{strokes:a,cacheId:b}})}}clear(){this.window?this.window.postMessage({type:"clear"},GPPreview_.WINDOW_URL):this.worker.postMessage({type:"clear"});this.panel.classList.remove("loading_")}isEnabled(){return this.enabled||
this.window}}window.GPPreview_=GPPreview_;class GPModeration_ extends EventTarget{static NEW_ACCOUNT_PERIODS=["3600000","86400000","604800000","2678400000"];static NEW_ACCOUNT_PERIODS_ALIASES=["\u0427\u0430\u0441","\u0414\u0435\u043d\u044c","\u041d\u0435\u0434\u0435\u043b\u044f","\u041c\u0435\u0441\u044f\u0446"];static ALBUM_ITEM_TYPE={IMAGE:"image",TEXT:"text",ANIMATION:"animation"};static CENSORING_REASON={BANNED_PLAYER:"banned_player",BACKGROUND:"background",UNKNOWN_PLAYER:"unknown_player",NEW_ACCOUNT:"new_account",FORGERY:"forgery",BY_USER:"by_user",
ANIMATION_FRAME:"animation_frame"};static PREVIEW_PATHS=["write","memory"];static PREVIEW_MONITOR_INTERVAL=200;static PREVIEW_MONITOR_TIMEOUT=2E3;static DEFAULT_SETTINGS={showUI:!1,autoKick:!0,autoKickNewAccounts:!1,compactMode:!0,playersColorIndication:!0,censorDrawings:!0,censorSentences:!0,censorNicknames:!1,censorUnknownPlayers:!1,censorNewAccounts:!1,newAccountPeriod:"86400000",sendBanReports:!0,previewEnabled:!1,previewPanelPos:{x:0,y:0,o:"br"},previewPanelWidth:280};static SETTINGS_UI={autoKick:{type:"checkbox",
description:"\u0412\u044b\u0433\u043e\u043d\u044f\u0442\u044c \u0438\u0437 \u043b\u043e\u0431\u0431\u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0445"},autoKickNewAccounts:{type:"checkbox",description:"\u0412\u044b\u0433\u043e\u043d\u044f\u0442\u044c \u0438\u0437 \u043b\u043e\u0431\u0431\u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430\u043c\u0438 (Twitch)"},
_1:{text:"Interface"},compactMode:{type:"checkbox",description:"\u041a\u043e\u043c\u043f\u0430\u043a\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0441\u043f\u0438\u0441\u043a\u0430"},playersColorIndication:{type:"checkbox",description:"\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0442\u044c \u0446\u0432\u0435\u0442\u043e\u0432\u044b\u0435 \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0445, \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445 \u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430\u043c\u0438 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0440\u043e\u0434\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"},
_2:{text:"Censor Content"},censorDrawings:{type:"checkbox",description:"\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0440\u0438\u0441\u0443\u043d\u043a\u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0432\u043d\u0435\u0441\u0451\u043d\u043d\u044b\u0445 \u0432 \u0447\u0451\u0440\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a"},censorSentences:{type:"checkbox",description:"\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0432\u043d\u0435\u0441\u0451\u043d\u043d\u044b\u0445 \u0432 \u0447\u0451\u0440\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a"},
censorNicknames:{type:"checkbox",description:"\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0432\u043d\u0435\u0441\u0451\u043d\u043d\u044b\u0445 \u0432 \u0447\u0451\u0440\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a"},_3:{text:"Censor Rules"},censorUnknownPlayers:{type:"checkbox",description:"\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0412\u044b \u0432\u0438\u0434\u0438\u0442\u0435 \u0432 \u0438\u0433\u0440\u0430\u0445 \u0432\u043f\u0435\u0440\u0432\u044b\u0435"},
censorNewAccounts:{type:"checkbox",description:"\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u044b \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u0447\u0438\u0442\u0430\u044e\u0442\u0441\u044f \u043d\u043e\u0432\u044b\u043c\u0438 (Twitch)"},newAccountPeriod:{type:"list",args:GPModeration_.NEW_ACCOUNT_PERIODS,formatter:this.newAccountPeriodFormatter,description:"\u041f\u0435\u0440\u0438\u043e\u0434, \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u043d\u043e\u0432\u044b\u043c"},
_4:{text:"Reports"},sendBanReports:{type:"checkbox",description:"\u041e\u0442\u0441\u044b\u043b\u0430\u0442\u044c \u043e\u0442\u0447\u0451\u0442\u044b, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0435 \u0438 \u0430\u0432\u0442\u043e\u0440\u0435, \u043f\u0440\u0438 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"}};static newAccountPeriodFormatter(a,
b){return GPModeration_.NEW_ACCOUNT_PERIODS_ALIASES[b]}static MODULE={title:"Moderation",dependencies:"GPUtils_ GPAssets_ GPAlbumObserver_ GPKnownUsersDB_ GPImageReportSender_ GPPreview_".split(" "),settings:{storage:"gp_userlist",defaultSettings:this.DEFAULT_SETTINGS,ui:this.SETTINGS_UI}};static INIT(a){new GPModeration_(a.gpproxy,a.sm,a.act,a.av,a.ac)}constructor(a,b,c,d,e){super();this.gpproxy=a;this.av=d;this.ac=e;this.usersDB=new GPKnownUsersDB_;this.s=b.setSettings(this,this.updateSettings);
this.list;this.buttons;this.banlist=new Set(JSON.parse(window.localStorage.getItem("ul_banlist"))||[]);this.isMiddlewareActive=!1;this.searchPreviewTimer;b=new GPAlbumObserver_(a);b.addHandler(this.handleItem.bind(this));b.addHandler(this.handlePreviewItem.bind(this));this.albumItems=b.getItems();this.playersObserver=new GPPlayersObserver_(a);this.playersObserver.addHandler(this.handlePlayer.bind(this));this.reportSender=new GPImageReportSender_(GPImageReportSender_.BAN,this.gpproxy,c);this.preview=
new GPPreview_(this.gpproxy,this.s.previewEnabled,this.s.previewPanelPos,this.s.previewPanelWidth);this.preview.addEventListener("status",({detail:{status:g}})=>{this.s.previewEnabled=g});this.preview.addEventListener("panel-pos-changed",({detail:g})=>{this.s.previewPanelPos=g});this.preview.addEventListener("panel-width-changed",({detail:{width:g}})=>{this.s.previewPanelWidth=g});this.censorItems=new Map;this.unknownUsers=new Set;this.suspiciousItems=this.ac?.getSuspiciousItems()??new Set;this.userDatesCreated=
{};this.isAlbumBgHidden=!1;this.middleware=this.middleware.bind(this);this.usersClickHandler=this.usersClickHandler.bind(this);this.banlistClickHandler=this.banlistClickHandler.bind(this);this.albumItemClickHandler=this.albumItemClickHandler.bind(this);this.albumItemEnterHandler=this.albumItemEnterHandler.bind(this);this.albumItemLeaveHandler=this.albumItemLeaveHandler.bind(this);this.imagePreviewOverHandler=this.imagePreviewOverHandler.bind(this);this.imagePreviewLeaveHandler=this.imagePreviewLeaveHandler.bind(this);
this.imagePreviewDownHandler=this.imagePreviewDownHandler.bind(this);this.handlePreviewImage=this.handlePreviewImage.bind(this);this.addEventListener("user_updated",()=>{this.saveBanlist()});this.addEventListener("user_updated",()=>{this.handleItems()});this.gpproxy.addEventListener("game_rejoin",()=>{this.gpproxy.isAuthorized&&this.parseUnknownUsers()});this.gpproxy.addEventListener("album_rejoin",()=>{this.gpproxy.isAuthorized&&(this.init(),this.gpproxy.isAuthorized&&(this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM,
GPProxy_.EVENT.ALBUM_INFO],this.middleware),this.isMiddlewareActive=!0))});this.gpproxy.addEventListener("data",({detail:{event:g}})=>{this.gpproxy.isAuthorized&&(g===GPProxy_.EVENT.GAME_STARTED?this.parseUnknownUsers():g===GPProxy_.EVENT.GALLERY_SETTINGS?(this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM,GPProxy_.EVENT.ALBUM_INFO],this.middleware),this.isMiddlewareActive=!0,this.init()):this.isMiddlewareActive&&[GPProxy_.EVENT.NEW_GAME,GPProxy_.EVENT.ALBUM_SCORE,GPProxy_.EVENT.GAME_QUIT,
GPProxy_.EVENT.GAME_STARTED].includes(g)&&(this.gpproxy.removeWSMsgMiddleware(this.middleware),this.isMiddlewareActive=!1,this.terminate()))});this.gpproxy.addEventListener("albums_ended",()=>{if(this.gpproxy.isAuthorized&&this.gpproxy.isOwner()){var g=this.gpproxy.getUsers().filter(({nick:f,viewer:h})=>!this.gpproxy.isYou(f)&&!h&&!this.banlist.has(this.formatUsername(f))).map(({nick:f})=>f);this.usersDB.addUsers(g)}});this.gpproxy.addEventListener("users_updated",({detail:{users:g}})=>{this.clearPlayers(g);
this.renderUsers(g);this.requestUserDatesCreated(g)});this.gpproxy.addEventListener("owner_status",()=>{this.updatePlayers()});document.addEventListener("_user_dates_created_updated",({detail:{userDatesCreated:g}})=>{this.updateUserDatesCreatedCache(g);this.renderUsers()});document.addEventListener("_url_changed",({detail:{path:g}})=>{this.isPreviewScreen(g)&&(document.addEventListener("pointerover",this.imagePreviewOverHandler),document.addEventListener("pointerdown",this.imagePreviewDownHandler),
document.addEventListener("_url_changed",()=>{document.removeEventListener("pointerover",this.imagePreviewOverHandler);document.removeEventListener("pointerdown",this.imagePreviewDownHandler)},{once:!0}),this.searchPreviewImage().then(this.handlePreviewImage))});this.ac&&this.ac.addEventListener("trigger",this.acTriggerHandler.bind(this));this.render();this.initInitialState()}getElement(){return this.container}init(){document.addEventListener("pointerdown",this.albumItemClickHandler)}terminate(){this.censorItems.clear();
this.unknownUsers.clear();document.removeEventListener("pointerdown",this.albumItemClickHandler)}initInitialState(){const a=this.gpproxy.getUsers();this.clearPlayers(a);this.renderUsers(a);this.requestUserDatesCreated(a)}render(){this.renderUselist()}renderUselist(){this.container=document.createElement("div");this.container.className="userlist_";this.container.classList.toggle("shown_",this.s.showUI);this.container.classList.toggle("compact_",this.s.compactMode);this.container.classList.toggle("autokick_",
this.s.autoKick);this.buttons=document.createElement("div");this.buttons.className="ul-buttons_";this.container.appendChild(this.buttons);this.activateBtn=document.createElement("div");this.activateBtn.className="ul-activate-btn_ ul-button_ gp-module-btn_";this.activateBtn.classList.toggle("pressed_",this.s.showUI);this.activateBtn.title="\u0421\u043f\u0438\u0441\u043e\u043a \u0438\u0433\u0440\u043e\u043a\u043e\u0432";this.activateBtn.addEventListener("click",b=>{this.s.showUI=!this.s.showUI;this.container.classList.toggle("shown_",
this.s.showUI);this.container.classList.remove("banlist_");this.renderUsers();this.activateBtn.classList.toggle("pressed_",this.s.showUI)});this.buttons.appendChild(this.activateBtn);var a=document.createElement("div");a.className="ul-mode-btn_ ul-button_";a.title="\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043b\u043d\u044b\u043c \u0438 \u043a\u043e\u043c\u043f\u0430\u043a\u0442\u043d\u044b\u043c \u0440\u0435\u0436\u0438\u043c\u0430\u043c\u0438";
a.addEventListener("click",b=>{this.s.compactMode=!this.s.compactMode;this.container.classList.toggle("compact_",this.s.compactMode)});this.buttons.appendChild(a);this.buttons.appendChild(document.createElement("div"));a=document.createElement("div");a.className="ul-autokick-btn_ ul-button_";a.title="\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432";
a.addEventListener("click",b=>{this.s.autoKick=!this.s.autoKick;this.container.classList.toggle("autokick_",this.s.autoKick);this.clearPlayers()});this.buttons.appendChild(a);a=document.createElement("div");a.className="ul-banlist-btn_ ul-button_";a.title="\u0421\u043f\u0438\u0441\u043e\u043a \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432";a.addEventListener("click",b=>{this.container.classList.toggle("banlist_")});this.buttons.appendChild(a);
this.list=document.createElement("div");this.list.className="ul-users_";this.list.addEventListener("contextmenu",this.usersClickHandler);this.list.addEventListener("dblclick",this.usersClickHandler);this.list.addEventListener("click",b=>{b.ctrlKey&&this.usersClickHandler(b)});this.container.appendChild(this.list);this.banlistElem=document.createElement("div");this.banlistElem.className="ul-banlist_";this.banlistElem.addEventListener("contextmenu",this.banlistClickHandler);this.banlistElem.addEventListener("dblclick",
this.banlistClickHandler);this.banlistElem.addEventListener("click",b=>{b.ctrlKey&&this.banlistClickHandler(b)});this.container.appendChild(this.banlistElem);this.renderBanlist();document.body.appendChild(this.container)}renderBanlist(){const a=this.banlistElem.scrollTop;this.banlistElem.innerHTML="";const b=document.createDocumentFragment();var c=document.createElement("span");c.className="ul-title_";c.textContent="\u0417\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0435";b.appendChild(c);this.banlist.size?
this.banlist.forEach(d=>{const e=document.createElement("div");e.className="ul-banned-user_";e.textContent=d;e.dataset.username=d;b.appendChild(e)}):(c=document.createElement("div"),c.className="ul-banlist-placeholder_",c.textContent="\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442",b.appendChild(c));this.banlistElem.appendChild(b);this.banlistElem.scrollTop=a}renderBtn(a,b,c){const d=document.createElement("div");d.className=`ul-button_ ul-${a}-btn_`;d.title=b||"";d.addEventListener("click",
c);this.buttons.appendChild(d);return d}renderUsers(a){if(this.s.showUI){a=a||this.gpproxy.getUsers();var b=this.list.scrollTop;this.list.innerHTML="";var c,d=document.createDocumentFragment();a.forEach(e=>{if(e.viewer&&!c){c=!0;const g=document.createElement("span");g.className="ul-title_";g.textContent="\u041e\u0436\u0438\u0434\u0430\u044e\u0442";d.appendChild(g)}d.appendChild(this.renderUser(e))});this.list.appendChild(d);this.list.scrollTop=b}}renderUser(a){const b=document.createElement("div");
b.className="ul-user_";b.classList.toggle("owner_",!!a.owner);b.classList.toggle("away_",!!a.away);b.classList.toggle("ready_",!!a.ready);b.classList.toggle("viewer_",!!a.viewer);b.classList.toggle("you_",!!a.you);b.classList.toggle("banned_",!a.you&&this.isUserBanned(a));b.dataset.username=a.nick;var c=document.createElement("div");c.className="ul-av_";b.appendChild(c);const d=document.createElement("span");d.className="img_";d.style.backgroundImage=`url(/images/avatar/${a.avatar}.svg)`;c.appendChild(d);
this.gpproxy.isAuthorized&&(c=this.formatUsername(a.nick),this.av.requestState(c,g=>{d.style.backgroundImage=`url(${g})`}));const e=document.createElement("div");e.className="ul-nick_";e.title=a.nick;e.textContent=a.nick;b.appendChild(e);a.you||this.usersDB.hasUser(a.nick).then(g=>{g||(b.classList.toggle("unknown_",!g),e.dataset.sinceCreation=a.nick,this.isNewAccount(a.nick)&&(b.classList.add("new_"),b.dataset.created=this.getDateCreated(a.nick),b.addEventListener("pointerenter",f=>{e.dataset.sinceCreation=
this.getSinceCreationTime(b.dataset.created)??a.nick})))});c=document.createElement("div");c.className="ul-state_";b.appendChild(c);return b}handlePlayer(a,b){if(this.gpproxy.isOwner()&&(delete a.dataset.state,this.s.playersColorIndication)){var c=b??a.querySelector(".nick")?.textContent;this.gpproxy.isYou(c)||(this.isBannedUser(c)?a.dataset.state="banned":this.usersDB.hasUser(c).then(d=>{d||(a.dataset.state="unknown",this.isNewAccount(c)&&(a.dataset.state="new"))}))}}updatePlayer(a){if(this.gpproxy.isOwner()){var b=
this.playersObserver.getPlayerItems().get(a);b&&this.handlePlayer(b,a)}}updatePlayers(){this.playersObserver.getPlayerItems().size&&this.gpproxy.getUsers().forEach(({nick:a})=>{this.updatePlayer(a)})}getSinceCreationTime(a){const b=Date.now()-(new Date(a)).getTime();var c=[26784E5,864E5,36E5,6E4];a=c.findIndex(f=>b>=f);if(!~a)return"\u043c\u0435\u043d\u044c\u0448\u0435 \u043c\u0438\u043d\u0443\u0442\u044b";c=Math.trunc(b/c[a]);const d=c%100,e=d%10;let g;if(10<=d&&20>d)g=2;else if(1===e)g=0;else if(1<
e&&5>e)g=1;else if(!e||4<e)g=2;return`${c} ${[["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u0435\u0432"],["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"],["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"],["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]][a][g]}`}isUserBanned({nick:a,id:b}){return a&&b?!this.gpproxy.isYou(b)&&
this.banlist.has(this.formatUsername(a))?!0:!1:!1}clearPlayers(a){this.gpproxy.isOwner()&&this.s.autoKick&&(a=a||this.gpproxy.getUsers(),this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.LOBBY)&&a.forEach(b=>{this.gpproxy.isYou(b.nick)||(this.isUserBanned(b)||this.autoKickNewAccounts&&this.isNewAccount(b.nick))&&this.gpproxy.kickPlayer(b.id)}))}formatUsername(a){return this.gpproxy.isDiscordAuth()?a:a.toLowerCase()}usersClickHandler(a){a.preventDefault();if(this.gpproxy.isAuthorized&&(a=a.target.closest(".ul-user_"),
!a?.classList.contains("you_"))){const b=this.toggleUserBan(a.dataset.username);a.classList.toggle("banned_",b);a.classList.add("unknown_")}}banlistClickHandler(a){var b=a.target.closest(".ul-banned-user_");b&&(b=b.dataset.username,this.banlist.delete(b),this.renderBanlist(),this.renderUsers(),this.clearPlayers(),this.updatePlayer(b),this.dispatchEvent(new CustomEvent("user_updated",{detail:{username:b,isBanned:!1}})));a.preventDefault()}middleware([a,b]){if(this.s.censorDrawings||this.s.censorNicknames||
this.s.censorSentences)if(a[1]===GPProxy_.EVENT.ALBUM_ITEM&&a[2].active){if(this.isUserBanned(a[2].user))if(a[2].data?.length)switch(a[2].type){case GPProxy_.ALBUM_ITEM_TYPE.DESCRIPTION:this.s.censorSentences&&(a[3]=null,b=!0)}else this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND)&&this.s.censorDrawings&&a[2].bg&&(a[2].data=this.gpproxy.getAlbum().background,a[2].bg=!1,this.isAlbumBgHidden=b=!0)}else if(a[1]===GPProxy_.EVENT.ALBUM_INFO){this.isAlbumBgHidden=!1;a[2].background&&
this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND)&&this.isUserBanned(a[2].bookAuthor)&&this.s.censorDrawings&&(a[2].background=[],this.isAlbumBgHidden=b=!0);const c=this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND)&&this.isUserBanned(this.gpproxy.getAlbum().bookAuthor)&&this.s.censorDrawings;a[2].timeline?.length&&(a[2].timeline=a[2].timeline.map(d=>{c&&d.bg&&(d.data=this.gpproxy.getAlbum().background,d.bg=!1,b=!0);return d}))}return[a,b]}async albumItemClickHandler(a){if(0===
a.button){var b=a.target.closest(".item");if(b){var c=this.getUsername(b),d,e=!1;if(this.isAlbumAvatar(a.target))this.gpproxy.isYou(c)||this.isAnimationItem(b)||(d=this.toggleUserBan(c))&&this.s.sendBanReports&&this.reportSender.send({itemId:this.getItemId(b),albumId:this.gpproxy.getCurrentAlbumId()});else if(this.isAlbumContent(a.target)){if(this.isEmptyItem(b))return;this.shouldBeBannedItem(b,c)||this.isPreviewedItem(b)||b.dataset.cr&&b.dataset.cr!==GPModeration_.CENSORING_REASON.BY_USER?(this.toggleAlbumItemPreview(b),
e=!0,this.preview.isEnabled()&&(this.preview.clear(),b.classList.remove("previewed_"))):(c=`${this.gpproxy.getCurrentAlbumId()}_${b.dataset.id}`,(a=!this.censorItems.has(c))?this.censorItems.set(c,b.dataset.type):this.censorItems.delete(c))}if(void 0!==d||this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND_NO_PREVIEW)&&0===this.getItemId(b))this.handleItems(e?b:null);else if(await this.handleItem(b),this.gpproxy.isAnimateMode()&&!this.isAnimationItem(b)&&(b=this.getAnimationItem()))this.toggleAlbumItemPreview(b,
!1),this.handleItem(b)}}}isAlbumAvatar(a){return a.parentElement.classList.contains("avatar")}isAlbumContent(a){return("CANVAS"===a.tagName||"SPAN"===a.tagName)&&a.closest(".drawBalloon:not(.load)")||("SPAN"===a.tagName||a.classList.contains("balloon"))&&a.closest(".answerBalloon:not(.load)")}handleItem(a){this.resetItem(a);const b=this.getUsername(a);this.isAnimationItem(a)?this.hasCensoredImageItems()?this.censorItem(a,GPModeration_.CENSORING_REASON.ANIMATION_FRAME):this.shouldBeCensoredItem(a)&&
this.censorItem(a,GPModeration_.CENSORING_REASON.BY_USER):(this.isBannedUser(b)&&a.classList.add("banned_"),this.isSuspiciousItem(a)&&a.classList.add("suspicious_"),this.shouldBeBannedItem(a,b)?this.censorItem(a,GPModeration_.CENSORING_REASON.BANNED_PLAYER):this.shouldBeCensoredByUnknownPlayer(a,b)?this.censorItem(a,GPModeration_.CENSORING_REASON.UNKNOWN_PLAYER):this.shouldBeCensoredByNewAccount(a,b)?this.censorItem(a,GPModeration_.CENSORING_REASON.NEW_ACCOUNT):this.shouldByCensoredByBackground(a)?
this.censorItem(a,GPModeration_.CENSORING_REASON.BACKGROUND):this.shouldBeCensoredItem(a)&&this.censorItem(a,GPModeration_.CENSORING_REASON.BY_USER))}async handleItems(a){for(const b of this.albumItems)b!==a&&(this.toggleAlbumItemPreview(b,!1),await this.handleItem(b))}resetItem(a){a.classList.remove("banned_","censored_","censored-nickname_","suspicious_");delete a.dataset.cr}isEmptyItem(a){return a.firstElementChild?.classList.contains("empty")}isPreviewedItem(a){return a.classList.contains("preview_")}isSuspiciousItem(a){return this.isImageItem(a)?
this.suspiciousItems.has(this.getContentId(a)):!1}toggleAlbumItemPreview(a,b){a.classList.toggle("preview_",b)}censorItem(a,b=GPModeration_.CENSORING_REASON.BY_USER){a.classList.add("censored_");a.dataset.cr=b;b===GPModeration_.CENSORING_REASON.BANNED_PLAYER&&a.classList.toggle("censored-nickname_",this.s.censorNicknames)}shouldByCensoredByBackground(a){return(this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND_NO_PREVIEW)||this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND)&&
!this.isAlbumBgHidden)&&0<this.getItemId(a)?(a=this.getUsername(this.albumItems[0]),this.isBannedItem(this.albumItems[0],a)||this.isCensoredItem(this.albumItems[0])):!1}shouldBeCensoredItem(a){return this.isCensoredItem(a)}shouldBeBannedItem(a,b){return this.isAnimationItem(a)?!1:this.isBannedItem(a,b)}shouldBeCensoredByUnknownPlayer(a,b){a=this.isImageItem(a);return!this.gpproxy.isYou(b)&&this.s.censorUnknownPlayers&&(this.s.censorDrawings&&a||this.s.censorSentences&&!a)?this.unknownUsers.has(b):
!1}async parseUnknownUsers(){const a=this.gpproxy.getUsers().filter(c=>!c.viewer&&!c.owner).map(c=>c.nick),b=await this.usersDB.hasUsers(a);this.unknownUsers=new Set(a.filter(c=>!b.has(c)))}shouldBeCensoredByNewAccount(a,b){a=this.isImageItem(a);return!this.gpproxy.isYou(b)&&this.s.censorNewAccounts&&this.unknownUsers.has(b)&&(this.s.censorDrawings&&a||this.s.censorSentences&&!a)&&this.isNewAccount(b)?!0:!1}getItemId(a){return+a.dataset.id}isBannedUser(a){return this.banlist.has(this.formatUsername(a))}getUsername(a){return a.querySelector(":scope > :is(.answerBalloon, .drawBalloon) > div:not(.avatar) > span")?.textContent}toggleUserBan(a){const b=
this.formatUsername(a),c=!this.banlist.has(b);c?(this.banlist.add(b),this.usersDB.deleteUser(b)):this.banlist.delete(b);this.renderUsers();this.renderBanlist();this.clearPlayers();this.updatePlayer(a);this.dispatchEvent(new CustomEvent("user_updated",{detail:{username:a,isBanned:c}}));return c}getAnimationItem(){return this.albumItems.find(a=>"animation"===a.dataset.type)}getContentId(a){return this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM)?`${this.gpproxy.getCurrentAlbumId()}_${this.getItemId(a)}`:
`t_${this.gpproxy.getCurrentTurnId()}`}isCensoredItem(a,b){a=this.censorItems.get(this.getContentId(a));return b?b===a:!!a}isCensoredImageItem(a){return this.isCensoredItem(a,GPModeration_.ALBUM_ITEM_TYPE.IMAGE)}isBannedItem(a,b){return this.isBannedUser(b)&&(this.isImageItem(a)&&this.s.censorDrawings||this.isTextItem(a)&&this.s.censorSentences)?!0:!1}hasCensoredImageItems(){return this.albumItems.some(a=>this.isCensoredImageItem(a))?!0:this.s.censorDrawings?this.albumItems.some(a=>this.isImageItem(a)&&
(a.dataset.cr===GPModeration_.CENSORING_REASON.BANNED_PLAYER||a.dataset.cr===GPModeration_.CENSORING_REASON.UNKNOWN_PLAYER||a.dataset.cr===GPModeration_.CENSORING_REASON.NEW_ACCOUNT)):!1}isTextItem(a){return"text"===a.dataset.type}isImageItem(a){return"image"===a.dataset.type}isAnimationItem(a){return"animation"===a.dataset.type}isNewAccount(a){a=this.getDateCreated(a);return!!a&&Date.now()-(new Date(a)).getTime()<=+this.s.newAccountPeriod}getDateCreated(a){return this.userDatesCreated[this.formatUsername(a)]}updateUserDatesCreatedCache(a){this.userDatesCreated=
Object.assign({},this.userDatesCreated,a)}requestUserDatesCreated(a){this.gpproxy.isOwner()&&this.gpproxy.isTwitchAuth()&&(a=a.filter(b=>!this.hasUserDateCreated(b.nick)&&!this.gpproxy.isYou(b.nick)&&!this.gpproxy.isViewer(b)).map(b=>this.formatUsername(b.nick)),a.length&&document.dispatchEvent(new CustomEvent("_request_user_dates_created",{detail:{users:a}})))}hasUserDateCreated(a){return void 0!==this.userDatesCreated[this.formatUsername(a)]}saveBanlist(){window.localStorage.setItem("ul_banlist",
JSON.stringify(Array.from(this.banlist)))}searchPreviewImage(a=!1){const b=Date.now();return new Promise(c=>{const d=()=>{clearTimeout(this.searchPreviewTimer);var e=document.querySelector(".screen > :is(.write, .memory) .core > div > canvas");e?(e=e.parentElement,e.dataset.type="image",c(e)):!a&&Date.now()-b<GPModeration_.PREVIEW_MONITOR_TIMEOUT&&(this.searchPreviewTimer=setTimeout(()=>{d()},GPModeration_.PREVIEW_MONITOR_INTERVAL))};d()})}handlePreviewImage(a){this.resetItem(a);const b=this.gpproxy.getPrevData()?.user?.nick;
b&&(this.isSuspiciousItem(a)&&a.classList.add("suspicious_"),this.shouldBeBannedItem(a,b)?this.censorItem(a,GPModeration_.CENSORING_REASON.BANNED_PLAYER):this.shouldBeCensoredByUnknownPlayer(a,b)?this.censorItem(a,GPModeration_.CENSORING_REASON.UNKNOWN_PLAYER):this.shouldBeCensoredByNewAccount(a,b)?this.censorItem(a,GPModeration_.CENSORING_REASON.NEW_ACCOUNT):this.isCensoredItem(a)&&this.censorItem(a,GPModeration_.CENSORING_REASON.BY_USER))}handlePreviewItem(a){this.isImageItem(a)&&(a=a.querySelector(".balloon"),
a.addEventListener("pointerenter",this.albumItemEnterHandler),a.addEventListener("pointerleave",this.albumItemLeaveHandler))}albumItemEnterHandler(a){if(this.preview.isEnabled()&&(a=a.currentTarget.closest(".item"),a.matches(".banned_, .censored_, .suspicious_"))){a.classList.add("previewed_");var b=this.getItemId(a);a=this.gpproxy.getAlbumItem(b);b=`${this.gpproxy.getCurrentAlbumId()}_${b}`;this.preview.load(a.data,b)}}albumItemLeaveHandler(a){this.preview.isEnabled()&&(a=a.currentTarget.closest(".item"),
a.classList.contains("previewed_")&&(a.classList.remove("previewed_"),this.preview.clear()))}imagePreviewOverHandler(a){if(this.preview.isEnabled()&&this.isPreviewCanvas(a.target)){const b=this.gpproxy.getPrevImageData();b&&(a=a.target.parentElement,a.matches(".banned_, .censored_, .suspicious_")&&(a.classList.add("previewed_"),a.addEventListener("pointerleave",this.imagePreviewLeaveHandler,{once:!0}),a=this.gpproxy.getCurrentTurnId(),this.preview.load(b,`t_${a}`)))}}imagePreviewLeaveHandler(a){this.preview.isEnabled()&&
(a.currentTarget.classList.remove("previewed_"),this.preview.clear())}imagePreviewDownHandler(a){if(0===a.button&&this.isPreviewCanvas(a.target)){a=a.target.parentElement;var b=this.gpproxy.getPrevData()?.user?.nick;this.shouldBeBannedItem(a,b)||this.isPreviewedItem(a)||a.dataset.cr&&a.dataset.cr!==GPModeration_.CENSORING_REASON.BY_USER?(a.classList.toggle("preview_"),this.preview.isEnabled()&&(this.preview.clear(),a.classList.remove("previewed_"))):(b=`t_${this.gpproxy.getCurrentTurnId()}`,this.censorItems.has(b)?
this.censorItems.delete(b):this.censorItems.set(b,a.dataset.type));this.handlePreviewImage(a)}}isPreviewCanvas(a){return"CANVAS"===a.tagName&&a.parentElement.parentElement.classList.contains("core")}isPreviewScreen(a){return GPModeration_.PREVIEW_PATHS.includes(a.slice(1))}acTriggerHandler({detail:{itemId:a,albumId:b}}){this.gpproxy.getCurrentAlbumId()===b&&(b=this.albumItems.find(c=>this.getItemId(c)===a))&&b.classList.add("suspicious_")}updateSettings({detail:{settings:a}}){"showUI"in a&&(this.container.classList.toggle("shown_",
a.showUI),this.container.classList.remove("banlist_"),this.renderUsers(),this.activateBtn.classList.toggle("pressed_",a.showUI));"autoKick"in a&&(this.container.classList.toggle("autokick_",a.autoKick),this.clearPlayers());"compactMode"in a&&this.container.classList.toggle("compact_",a.compactMode);"playersColorIndication"in a&&this.updatePlayers();"newAccountPeriod"in a&&this.renderUsers();["censorSentences","censorNicknames"].some(b=>b in a)&&this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM)&&
this.handleItems();["censorDrawings","censorUnknownPlayers","censorNewAccounts"].some(b=>b in a)&&(this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM)?this.handleItems():this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.GAME)&&this.searchPreviewImage(!0).then(this.handlePreviewImage))}}window.GPModeration_=GPModeration_;
}).call(this)
